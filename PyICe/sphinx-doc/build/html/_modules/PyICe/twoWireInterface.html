<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyICe.twoWireInterface &mdash; PyICe 9000 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '9000',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/tssop.ico"/>
    <link rel="top" title="PyICe 9000 documentation" href="../../PyICe.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for PyICe.twoWireInterface</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SMBus Interface Hardware Drivers</span>
<span class="sd">================================</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">abc</span>
<span class="kn">from</span> <span class="nn">PyICe</span> <span class="kn">import</span> <span class="n">visa_wrappers</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">serial</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">smbus</span>
    <span class="n">smbusMissing</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">smbusMissing</span> <span class="o">=</span> <span class="bp">True</span>

<div class="viewcode-block" id="twoWireInterface"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface">[docs]</a><span class="k">class</span> <span class="nc">twoWireInterface</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;this is the master i2c class, all other i2c adapters inherit from this</span>

<span class="sd">    All SMBus Protocols are implemented generically with I2C Primitives</span>
<span class="sd">    Board specific subclasses should overload as necessary for increased performance</span>
<span class="sd">    addr7 is the 7-bit chip address  The 8-bit read/write addresses are computed locally</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>
    
<div class="viewcode-block" id="twoWireInterface.close"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close the underlying (serial) interface&#39;&#39;&#39;</span>
        <span class="k">pass</span>
    <span class="c">#I2C Generic Protocol Methods - Must be implemented in hardware/firmware specific classes</span></div>
    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="twoWireInterface.start"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;I2C Start  - Falling SDA with SCL high.  Returns True or False to indicate successful arbitration&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.restart"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.restart">[docs]</a>    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;I2C Re-Start  - Falling SDA with SCL high between start and stop condition.</span>
<span class="sd">        Implement only if restart requires a different action than a normal start in underlying hardware.</span>
<span class="sd">        Returns True or False to indicate successful arbitration&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>
    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="twoWireInterface.stop"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;I2C Stop  - Rising SDA with SCL high.  Returns True or False to indicate successful arbitration&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span></div>
    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="twoWireInterface.write"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Transmit 8 bits plus 9th acknowledge clock.  Returns True or False to indicate slave acknowledge&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span></div>
    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="twoWireInterface.read_ack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_ack">[docs]</a>    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read 8 bits from slave transmitter  and assert SDA during 9th acknowledge clock.  Returns 8 bit data&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span></div>
    <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="twoWireInterface.read_nack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_nack">[docs]</a>    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read 8 bits from slave transmitter  and release SDA during 9th acknowledge clock to request end of transmission.  Returns 8 bit data&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.resync_communication"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.resync_communication">[docs]</a>    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;attempt to correct problems caused by dropped/duplicate characters in serial buffer, etc.</span>
<span class="sd">            Don&#39;t do anything here.  Method must be overloaded to implement hardware-specific recovery procedure.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>
    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">i2cUnimplementedError</span><span class="p">()</span>

    <span class="c">###Utilities###</span>
<div class="viewcode-block" id="twoWireInterface.scan"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.scan">[docs]</a>    <span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find all devices on bus by checking acknowledge of each address in turn.&#39;&#39;&#39;</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">addr</span><span class="p">):</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">responses</span></div>
<div class="viewcode-block" id="twoWireInterface.check_size"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.check_size">[docs]</a>    <span class="k">def</span> <span class="nf">check_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;make sure data fits within word of length  &quot;bits&quot;&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">data</span> <span class="o">&gt;=</span> <span class="mi">0</span> 
        <span class="k">assert</span> <span class="n">data</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">**</span><span class="n">bits</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="twoWireInterface.read_addr"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_addr">[docs]</a>    <span class="k">def</span> <span class="nf">read_addr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;compute 8-bit read address from 7-bit address&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">addr7</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c">#&amp; 0xFF</span></div>
<div class="viewcode-block" id="twoWireInterface.write_addr"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write_addr">[docs]</a>    <span class="k">def</span> <span class="nf">write_addr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;compute 8-bit write address from 7-bit address&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">addr7</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="c">#&amp; 0xFF</span></div>
<div class="viewcode-block" id="twoWireInterface.low_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.low_byte">[docs]</a>    <span class="k">def</span> <span class="nf">low_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Select lower byte from 16-bit data&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data16</span> <span class="o">&amp;</span> <span class="mh">0xFF</span></div>
<div class="viewcode-block" id="twoWireInterface.high_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.high_byte">[docs]</a>    <span class="k">def</span> <span class="nf">high_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Select upper byte from 16-bit data&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data16</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span></div>
<div class="viewcode-block" id="twoWireInterface.word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.word">[docs]</a>    <span class="k">def</span> <span class="nf">word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowByte</span><span class="p">,</span> <span class="n">highByte</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return 16-bit value from two SMBus bytes&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">highByte</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">lowByte</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.pec">[docs]</a>    <span class="k">def</span> <span class="nf">pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">byteList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        http://smbus.org/specs/smbus20.pdf</span>
<span class="sd">        Each bus transaction requires a Packet Error Code (PEC) calculation by both the transmitter and receiver</span>
<span class="sd">        within each packet. The PEC uses an 8-bit cyclic redundancy check (CRC-8) of each read or write bus</span>
<span class="sd">        transaction to calculate a Packet Error Code (PEC). The PEC may be calculated in any way that conforms</span>
<span class="sd">        to a CRC-8 represented by the polynomial, C(x) = x8 + x2 + x1 + 1 and must be calculated in the order of</span>
<span class="sd">        the bits as received.</span>
<span class="sd">        Calculating the PEC for transmission or reception is implemented in a method chosen by the device</span>
<span class="sd">        manufacturer. It is possible to perform the check with low-cost hardware or firmware algorithm that could</span>
<span class="sd">        process the message bit-by-bit or with a byte-wise look-up table. The SMBus web page provides some</span>
<span class="sd">        example CRC-8 methods.</span>
<span class="sd">        The PEC is appended to the message as dictated by the protocols in section 5.5. The PEC calculation</span>
<span class="sd">        includes all bytes in the transmission, including address, command and data. The PEC calculation does not</span>
<span class="sd">        include ACK, NACK, START, STOP nor Repeated START bits. This means that the PEC is computed</span>
<span class="sd">        over the entire message from the first START condition.</span>
<span class="sd">        Whether a device implements packet error checking may be determined by the specification revision code</span>
<span class="sd">        that is present in the SpecificationInfo() command for a Smart Battery, Smart Battery Charger or Smart</span>
<span class="sd">        Battery Selector. See these individual specifications for exact revision coding identities. It may also be</span>
<span class="sd">        discovered in the UDID, defined in section 5.6.1, for other devices.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#byteList is an ordered list of every byte in the transaction including address, command code (subaddr) and data</span>
        <span class="c">#http://en.wikipedia.org/wiki/Cyclic_redundancy_check</span>
        <span class="c">#http://en.wikipedia.org/wiki/Computation_of_CRC</span>
        <span class="c">#http://ghsi.de/CRC/</span>
        <span class="c">#http://smbus.org/faq/crc8Applet.htm</span>
        <span class="c">#http://www.hackersdelight.org/crc.pdf</span>
        <span class="n">crc</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="mh">0x07</span> <span class="c">#x^8 + x^2 + x^1 + 1, discard x^8 term</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">byteList</span><span class="p">:</span>
            <span class="c">#big endian -&gt; msb goes in first</span>
            <span class="n">crc</span> <span class="o">^=</span> <span class="n">byte</span>
            <span class="k">for</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="n">crc</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">):</span> <span class="c">#msb was set before left shift ( &amp; 0x80)</span>
                    <span class="c">#xor with crc if pre-shift msb was 1</span>
                    <span class="n">crc</span> <span class="o">^=</span> <span class="n">poly</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">crc</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span>

    <span class="c">#SMBus Protocols implemented with I2C Primitives</span>
    <span class="c">#Board specific subclasses should overload as necessary for increased performance</span>
    <span class="c">#addr7 is the 7-bit chip address  The 8-bit read/write addresses are computed locally</span></div>
<div class="viewcode-block" id="twoWireInterface.quick_command_rd"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.quick_command_rd">[docs]</a>    <span class="k">def</span> <span class="nf">quick_command_rd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Here, part of the slave address denotes the command – the R/W# bit. The R/W# bit may be used to simply</span>
<span class="sd">            turn a device function on or off, or enable/disable a low-power standby mode. There is no data sent or</span>
<span class="sd">            received.</span>
<span class="sd">            The quick command implementation is good for very small devices that have limited support for the</span>
<span class="sd">            SMBus specification. It also limits data on the bus for simple devices.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Start Signal during quick_command_rd&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;I2C Error: Slave read address failed to acknowledge during quick_command_rd&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Stop Signal during quick_command_rd&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.quick_command_wr"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.quick_command_wr">[docs]</a>    <span class="k">def</span> <span class="nf">quick_command_wr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Here, part of the slave address denotes the command – the R/W# bit. The R/W# bit may be used to simply</span>
<span class="sd">            turn a device function on or off, or enable/disable a low-power standby mode. There is no data sent or</span>
<span class="sd">            received.</span>
<span class="sd">            The quick command implementation is good for very small devices that have limited support for the</span>
<span class="sd">            SMBus specification. It also limits data on the bus for simple devices.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Start Signal during quick_command_wr&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;I2C Error: Slave write address failed to acknowledge during quick_command_wr&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Stop Signal during quick_command_wr&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.send_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.send_byte">[docs]</a>    <span class="k">def</span> <span class="nf">send_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A simple device may recognize its own slave address and accept up to 256 possible encoded commands in</span>
<span class="sd">            the form of a byte that follows the slave address.</span>
<span class="sd">            All or parts of the Send Byte may contribute to the command. For example, the highest 7 bits of the</span>
<span class="sd">            command code might specify an access to a feature, while the least significant bit would tell the device to</span>
<span class="sd">            turn the feature on or off. Or, a device may set the “volume” of its output based on the value it received</span>
<span class="sd">            from the Send Byte protocol.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Start Signal during send_byte&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&#39;I2C Error: Failed to Assert Stop Signal during send_byte&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.send_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.send_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">send_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;send_byte with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cDataPECAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.receive_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.receive_byte">[docs]</a>    <span class="k">def</span> <span class="nf">receive_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Receive Byte is similar to a Send Byte, the only difference being the direction of data transfer. A</span>
<span class="sd">            simple device may have information that the host needs. It can do so with the Receive Byte protocol. The</span>
<span class="sd">            same device may accept both Send Byte and Receive Byte protocols. A NACK (a ‘1’ in the ACK bit</span>
<span class="sd">            position) signifies the end of a read transfer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data8</span></div>
<div class="viewcode-block" id="twoWireInterface.receive_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.receive_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">receive_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;receive_byte with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&quot;I2C Error: Failed PEC check&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data8</span></div>
<div class="viewcode-block" id="twoWireInterface.alert_response"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.alert_response">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Another optional signal is an interrupt line for devices that want to trade their ability to master for a pin.</span>
<span class="sd">        SMBALERT# is a wired-AND signal just as the SMBCLK and SMBDAT signals are. SMBALERT# is</span>
<span class="sd">        used in conjunction with the SMBus General Call Address. Messages invoked with the SMBus are 2 bytes</span>
<span class="sd">        long.</span>
<span class="sd">        A slave-only device can signal the host through SMBALERT# that it wants to talk. The host processes the</span>
<span class="sd">        interrupt and simultaneously accesses all SMBALERT# devices through the Alert Response Address</span>
<span class="sd">        (ARA). Only the device(s) which pulled SMBALERT# low will acknowledge the Alert Response Address.</span>
<span class="sd">        The host performs a modified Receive Byte operation. The 7 bit device address provided by the slave</span>
<span class="sd">        transmit device is placed in the 7 most significant bits of the byte. The eighth bit can be a zero or one.</span>

<span class="sd">        Returns 7 bit address of responding device.</span>
<span class="sd">        Returns None if no response to ARA.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="mh">0xC</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c">#no response to Alert Response Address</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data8</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span></div>
<div class="viewcode-block" id="twoWireInterface.alert_response_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.alert_response_pec">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alert Response Query to SMBALERT# interrupt with Packet Error Check.</span>
<span class="sd">            Returns 7 bit address of responding device.</span>
<span class="sd">            Returns None if no response to ARA.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="mh">0xC</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="mh">0xC</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c">#no response to Alert Response Address</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pec</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&quot;I2C Error: Failed PEC check&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data8</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span></div>
<div class="viewcode-block" id="twoWireInterface.write_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Byte access is the command code. The next byte </span>
<span class="sd">            is the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data byte. The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.write_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write_byte with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cDataPECAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.write_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write_word">[docs]</a>    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Word access is the command code. The next two bytes</span>
<span class="sd">            are the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data word (low byte first). The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataLow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataLowAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataHighAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.write_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.write_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write_word with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataLow</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataLow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataLowAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataHighAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cDataPECAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.read_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns one byte of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data8</span></div>
<div class="viewcode-block" id="twoWireInterface.read_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read_byte with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC Failure: expected 0x{:X} but got 0x{:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">),</span> <span class="n">pec</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data8</span>    </div>
<div class="viewcode-block" id="twoWireInterface.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns two bytes of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="n">dataLow</span><span class="p">,</span> <span class="n">highByte</span><span class="o">=</span><span class="n">dataHigh</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.read_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read_word with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataLow</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC Failure: expected 0x{:X} but got 0x{:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">),</span> <span class="n">pec</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="n">dataLow</span><span class="p">,</span> <span class="n">highByte</span><span class="o">=</span><span class="n">dataHigh</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.process_call"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.process_call">[docs]</a>    <span class="k">def</span> <span class="nf">process_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The process call is so named because a command sends data and waits for the slave to return a value</span>
<span class="sd">            dependent on that data. The protocol is simply a Write Word followed by a Read Word without the Read-</span>
<span class="sd">            Word command field and the Write-Word STOP bit.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataLow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataLowAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataHighAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="n">dataLow</span><span class="p">,</span> <span class="n">highByte</span><span class="o">=</span><span class="n">dataHigh</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.process_call_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.process_call_pec">[docs]</a>    <span class="k">def</span> <span class="nf">process_call_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;process_call with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataLow</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataLow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataLowAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataHighAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">dataLow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataLow</span><span class="p">)</span>
        <span class="n">dataHigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataHigh</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC Failure: expected 0x{:X} but got 0x{:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">),</span> <span class="n">pec</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="n">dataLow</span><span class="p">,</span> <span class="n">highByte</span><span class="o">=</span><span class="n">dataHigh</span><span class="p">)</span> </div>
<div class="viewcode-block" id="twoWireInterface.block_write"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_write">[docs]</a>    <span class="k">def</span> <span class="nf">block_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Block Write begins with a slave address and a write condition. After the command code the host</span>
<span class="sd">            issues a byte count which describes how many more bytes will follow in the message. If a slave has 20</span>
<span class="sd">            bytes to send, the byte count field will have the value 20 (14h), followed by the 20 bytes of data. The byte</span>
<span class="sd">            count does not include the PEC byte. The byte count may not be 0. A Block Read or Write is allowed to</span>
<span class="sd">            transfer a maximum of 32 data bytes.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataByteList</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCount</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Write requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byteCount</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteList</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.block_write_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_write_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_write_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block_write with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataByteList</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCount</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Write requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byteCount</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byteCount</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cDataPECAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span></div>
<div class="viewcode-block" id="twoWireInterface.block_read"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_read">[docs]</a>    <span class="k">def</span> <span class="nf">block_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A Block Read differs from a block write in that the repeated START condition exists to satisfy the</span>
<span class="sd">            requirement for a change in the transfer direction. A NACK immediately preceding the STOP condition</span>
<span class="sd">            signifies the end of the read transfer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">byteCount</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Write requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">dataByteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">byteCount</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">byte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
            <span class="n">dataByteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="n">byte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="n">dataByteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataByteList</span></div>
<div class="viewcode-block" id="twoWireInterface.block_read_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_read_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_read_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block_read with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byteCount</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCount</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Write requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">dataByteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">byteCount</span><span class="p">):</span>
            <span class="n">byte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
            <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
            <span class="n">dataByteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC Failure: expected 0x{:X} but got 0x{:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">),</span> <span class="n">pec</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dataByteList</span></div>
<div class="viewcode-block" id="twoWireInterface.block_process_call"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_process_call">[docs]</a>    <span class="k">def</span> <span class="nf">block_process_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The block write-block read process call is a two-part message. The call begins with a slave address and a</span>
<span class="sd">            write condition. After the command code the host issues a write byte count (M) that describes how many</span>
<span class="sd">            more bytes will be written in the first part of the message. If a master has 6 bytes to send, the byte count</span>
<span class="sd">            field will have the value 6 (0000 0110b), followed by the 6 bytes of data. The write byte count (M) cannot</span>
<span class="sd">            be zero.</span>
<span class="sd">            The second part of the message is a block of read data beginning with a repeated start condition followed</span>
<span class="sd">            by the slave address and a Read bit. The next byte is the read byte count (N), which may differ from the</span>
<span class="sd">            write byte count (M). The read byte count (N) cannot be zero.</span>
<span class="sd">            The combined data payload must not exceed 32 bytes. The byte length restrictions of this process call are</span>
<span class="sd">            summarized as follows:</span>
<span class="sd">            • M ≥ 1 byte</span>
<span class="sd">            • N ≥ 1 byte</span>
<span class="sd">            • M + N ≤ 32 bytes</span>
<span class="sd">            The read byte count does not include the PEC byte. The PEC is computed on the total message beginning</span>
<span class="sd">            with the first slave address and using the normal PEC computational rules. It is highly recommended that a</span>
<span class="sd">            PEC byte be used with the Block Write-Block Read Process Call.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCountWrite</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataByteListWrite</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCountWrite</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">byteCountWrite</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c">#slave must return at least 1 byte and total limitation is 32</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Process Call requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byteCountWrite</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteListWrite</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCountRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">byteCountRead</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">byteCountWrite</span><span class="o">+</span><span class="n">byteCountRead</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Process Call requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">dataByteListRead</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">byteCountRead</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">dataByteListRead</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">())</span>
        <span class="n">dataByteListRead</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dataByteListRead</span></div>
<div class="viewcode-block" id="twoWireInterface.block_process_call_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.block_process_call_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_process_call_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block write-block read process call with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">commandCode</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCountWrite</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataByteListWrite</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCountWrite</span> <span class="o">&gt;</span> <span class="mi">31</span> <span class="ow">or</span> <span class="n">byteCountWrite</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="c">#slave must return at least 1 byte and total limitation is 32</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Process Call requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byteCountWrite</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byteCountWrite</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteListWrite</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">i2cDataAcknowledgeError</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">()</span>
        <span class="n">byteCountRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byteCountRead</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">byteCountRead</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="n">byteCountWrite</span><span class="o">+</span><span class="n">byteCountRead</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&quot;I2C Error: Block Process Call requires maximum 32 data bytes&quot;</span><span class="p">)</span>
        <span class="n">dataByteListRead</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">byteCountRead</span><span class="p">):</span>
            <span class="n">byte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
            <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
            <span class="n">dataByteListRead</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pec</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC Failure: expected 0x{:X} but got 0x{:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">),</span> <span class="n">pec</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dataByteListRead</span>

    <span class="c">###List reading aggregation commands###</span></div>
    <span class="k">def</span> <span class="nf">_read_x_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="n">rd_function</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7 using rd_function protocol.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cc_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">cc_list</span><span class="p">:</span>
            <span class="n">cc_data</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd_function</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cc_data</span>
<div class="viewcode-block" id="twoWireInterface.read_byte_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_byte_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_byte results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        Overload this method to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_x_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_byte</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.read_byte_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_byte_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_byte_pec results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        Overload this method to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_x_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_byte_pec</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.read_word_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_word_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_word results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        Overload this method to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_x_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_word</span><span class="p">)</span></div>
<div class="viewcode-block" id="twoWireInterface.read_word_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.twoWireInterface.read_word_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_word_pec results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        Overload this method to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_x_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_word_pec</span><span class="p">)</span>
        </div></div>
<div class="viewcode-block" id="i2c_dummy"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy">[docs]</a><span class="k">class</span> <span class="nc">i2c_dummy</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;dummy interface for testing without any hardware.  No actual communication occurs.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delay</span> <span class="o">=</span> <span class="n">delay</span>
<div class="viewcode-block" id="i2c_dummy.start"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.  Return value indicates that transaction was successful.&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_dummy.stop"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.  Return value indicates that transaction was successful.&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_dummy.write"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.  Return value indicates that transaction was successful.&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_dummy.read_ack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.read_ack">[docs]</a>    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.  Return random 8-bit value&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dummy.read_nack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.read_nack">[docs]</a>    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.  Return random 8-bit value&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dummy.resync_communication"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dummy.resync_communication">[docs]</a>    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;don&#39;t do anything.&#39;&#39;&#39;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_delay</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="i2c_buspirate"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate">[docs]</a><span class="k">class</span> <span class="nc">i2c_buspirate</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;dangerous prototypes bus pirate communication board&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_raw_serial</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span> <span class="o">=</span> <span class="n">interface_raw_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_i2c</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x02</span><span class="s">&#39;</span> <span class="c">#responds 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x03</span><span class="s">&#39;</span> <span class="c">#responds 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x04</span><span class="s">&#39;</span> <span class="c">#responds with byte</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;ack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x06</span><span class="s">&#39;</span>  <span class="c">#responds 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;nack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x07</span><span class="s">&#39;</span>  <span class="c">#responds 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeread&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x08</span><span class="s">&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writebyte&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x10</span><span class="s">&#39;</span>  <span class="c">#responds 0x01 then 0x00 ACK or 0x01 NACK</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x11</span><span class="s">&#39;</span>  <span class="c">#responds 0x01 then (0x00 ACK or 0x01 NACK) for each byte</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;write3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x12</span><span class="s">&#39;</span>  <span class="c">#responds 0x01 then (0x00 ACK or 0x01 NACK) for each byte</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;write4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x13</span><span class="s">&#39;</span>  <span class="c">#responds 0x01 then (0x00 ACK or 0x01 NACK) for each byte</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__init_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span> <span class="c">#exit any menus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="c">#reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="c">#get into binary mode</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">resp</span> <span class="o">!=</span> <span class="s">&#39;BBIO1&#39;</span><span class="p">):</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate failed to enter binary mode after 20 attempts&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Buspirate entering binary mode attempt {}: &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tries</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#enter binary mode</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
            <span class="k">print</span> <span class="n">resp</span>
        <span class="c">#get into i2c mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x02</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#enter binary i2c mode</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">!=</span> <span class="s">&#39;I2C1&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate failed to enter I2C mode: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="c">#set voltage levels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x4C</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#power and pullups on</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate failed to enable supply and pullups: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="c">#vpullup select not yet implemented 7/16/2013.  3.3V shorted to Vpu on board temporarily</span>
        <span class="c">#self.ser.write(&#39;\x51&#39;) #3.3v pullup</span>
        <span class="c">#resp = self.ser.read(1)</span>
        <span class="c">#if resp != &#39;\x01&#39;:</span>
        <span class="c">#     raise i2cMasterError(&#39;Buspirate failed to set pullup voltage to 3.3v: {}&#39;.format(resp))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x63</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#speed 400kHz</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate failed to set bus speedto 400kHz: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
<div class="viewcode-block" id="i2c_buspirate.close"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close the underlying (serial) interface&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="i2c_buspirate.start"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;I2C Start  - Falling SDA with SCL high.  Returns True or False to indicate successful arbitration&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">])</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>
<div class="viewcode-block" id="i2c_buspirate.stop"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;I2C Start  - Rising SDA with SCL high.  Returns True or False to indicate successful arbitration&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">])</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>
<div class="viewcode-block" id="i2c_buspirate.write"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Transmit 8 bits plus 9th acknowledge clock.  Returns True or False to indicate slave acknowledge&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writebyte&#39;</span><span class="p">],</span> <span class="n">data8</span><span class="p">]))</span>
        <span class="c">#buspirate returns 0x01 to acknowledge command</span>
        <span class="c">#then returns 0x00 for ACK or 0x01 for NACK</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x01\x00</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\x01\x01</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate write unxepected communication: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span></div>
<div class="viewcode-block" id="i2c_buspirate.read_ack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.read_ack">[docs]</a>    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read 8 bits from slave transmitter  and assert SDA during 9th acknowledge clock.  Returns 8 bit data&#39;&#39;&#39;</span>
        <span class="c">#read returns byte</span>
        <span class="c">#ack returns 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;ack&#39;</span><span class="p">]]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_nack: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>
<div class="viewcode-block" id="i2c_buspirate.read_nack"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.read_nack">[docs]</a>    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read 8 bits from slave transmitter  and release SDA during 9th acknowledge clock to request end of transmission.  Returns 8 bit data&#39;&#39;&#39;</span>
        <span class="c">#read returns byte</span>
        <span class="c">#nack returns 0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;nack&#39;</span><span class="p">]]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_nack: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>
    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_i2c</span><span class="p">()</span>

<div class="viewcode-block" id="i2c_buspirate.send_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.send_byte">[docs]</a>    <span class="k">def</span> <span class="nf">send_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A simple device may recognize its own slave address and accept up to 256 possible encoded commands in</span>
<span class="sd">            the form of a byte that follows the slave address.</span>
<span class="sd">            All or parts of the Send Byte may contribute to the command. For example, the highest 7 bits of the</span>
<span class="sd">            command code might specify an access to a feature, while the least significant bit would tell the device to</span>
<span class="sd">            turn the feature on or off. Or, a device may set the “volume” of its output based on the value it received</span>
<span class="sd">            from the Send Byte protocol.&#39;&#39;&#39;</span>
        <span class="c">#self.ser.write(bytearray([self.commands[&#39;start&#39;], self.write_addr(addr7), data8, self.commands[&#39;stop&#39;]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeread&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x02</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">data8</span><span class="p">]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to send_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        </div>
<div class="viewcode-block" id="i2c_buspirate.receive_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.receive_byte">[docs]</a>    <span class="k">def</span> <span class="nf">receive_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Receive Byte is similar to a Send Byte, the only difference being the direction of data transfer. A</span>
<span class="sd">            simple device may have information that the host needs. It can do so with the Receive Byte protocol. The</span>
<span class="sd">            same device may accept both Send Byte and Receive Byte protocols. A NACK (a ‘1’ in the ACK bit</span>
<span class="sd">            position) signifies the end of a read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeread&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to receive_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="i2c_buspirate.write_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.write_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Byte access is the command code. The next byte </span>
<span class="sd">            is the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data byte. The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeread&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x03</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to send_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
             </div>
<div class="viewcode-block" id="i2c_buspirate.write_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.write_word">[docs]</a>    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Word access is the command code. The next two bytes</span>
<span class="sd">            are the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data word (low byte first). The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeread&#39;</span><span class="p">],</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x04</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span>
             <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to write_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        </div>
<div class="viewcode-block" id="i2c_buspirate.read_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.read_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns one byte of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeword&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writebyte&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;nack&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate short response to read_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#start</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate read_byte start failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write command response</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write addr ack</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_byte write address acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#command code ack</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_byte command code acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#start</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate read_byte restart failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write command response</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#read addr ack</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_byte read address acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#nack command response </span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_byte: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#stop</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected read_byte stop failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="i2c_buspirate.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_buspirate.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns two bytes of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writeword&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;writebyte&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;ack&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;read&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;nack&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="p">[</span><span class="s">&#39;stop&#39;</span><span class="p">]]))</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate short response to read_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#start</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word start failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write command response</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write addr ack</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word write address acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#command code ack</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word command code acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#start</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word restart failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#write command response</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#read addr ack</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word read address acknowledge failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="c">#LSByte is resp[7]</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#ack command response </span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="c">#MSByte is resp[9]</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#nack command response </span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate unexpected response to read_word: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">resp</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\x01</span><span class="s">&#39;</span><span class="p">:</span> <span class="c">#stop</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Buspirate read_word stop failure: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">7</span><span class="p">],</span> <span class="n">highByte</span><span class="o">=</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">resp</span><span class="p">)[</span><span class="mi">9</span><span class="p">])</span>
        </div></div>
<div class="viewcode-block" id="i2c_pic"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_pic">[docs]</a><span class="k">class</span> <span class="nc">i2c_pic</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;communication class to simplify talking to dave&#39;s external i2c interface firmware on George&#39;s development board (pic18F4553 and similar)</span>
<span class="sd">        requires pySerial</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_raw_serial</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span> <span class="o">=</span> <span class="n">interface_raw_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_i2c</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__init_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x03</span><span class="s">&quot;</span><span class="p">)</span>  <span class="c">#ctl-c</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">)</span>  <span class="c">#carriage return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">)</span>     <span class="c">#select the external interface</span>
        <span class="n">loopcount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span><span class="p">(</span><span class="n">char</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\x02</span><span class="s">&quot;</span><span class="p">):</span> <span class="c"># read characters until start of text</span>
            <span class="k">if</span> <span class="n">loopcount</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Failed to set PIC to external interface menu: loopcount&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Failed to set PIC to external interface menu: timeout&#39;</span><span class="p">)</span>
            <span class="n">loopcount</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&quot;E8&quot;</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="s">&quot;AA&quot;</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<div class="viewcode-block" id="i2c_pic.close"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_pic.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close the underlying (serial) interface&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_i2c</span><span class="p">()</span>
        
    <span class="c">#implement i2c primitives</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Start&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;S&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Start&quot;</span><span class="p">)</span>
        <span class="c">#return (ret_str[2:] == &quot;S&quot;) #The Pic doesn&#39;t know if bus arbitration succeeded - failure to return start indicates USB failure</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;p&quot;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;P&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Stop&quot;</span><span class="p">)</span>
        <span class="c">#return (ret_str[0] == &quot;P&quot;) #The Pic doesn&#39;t know if bus arbitration succeeded - failure to return stop indicates USB failure</span>
        <span class="k">return</span> <span class="bp">True</span>                   
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;K&quot;</span> <span class="ow">and</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;N&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Write&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;K&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RK&quot;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot; &quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad communication during read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RN&quot;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot; &quot;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad communication during read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>

    <span class="c">#overload for faster access</span>
<div class="viewcode-block" id="i2c_pic.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_pic.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read word&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;s&quot;</span> <span class="o">+</span> <span class="n">addr_w</span> <span class="o">+</span> <span class="n">commandCode</span> <span class="o">+</span> <span class="s">&quot;s&quot;</span> <span class="o">+</span> <span class="n">addr_r</span> <span class="o">+</span> <span class="s">&quot;RKRNP&quot;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">31</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">31</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short response to read_word:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;K&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cWriteAddressAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Error: Write address acknowledge fail during read_word&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;K&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cCommandCodeAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Error: Command code acknowledge fail during read_word&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;K&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cReadAddressAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Error: Read address acknowledge fail during read_word&quot;</span><span class="p">)</span>
        <span class="n">lsb</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span>
        <span class="n">lsb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lsb</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">msb</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">26</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span>
        <span class="n">msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">msb</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">data16</span> <span class="o">=</span> <span class="p">(</span><span class="n">msb</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">lsb</span>
        <span class="k">return</span> <span class="n">data16</span>
    
</div></div>
<div class="viewcode-block" id="i2c_scpi"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi">[docs]</a><span class="k">class</span> <span class="nc">i2c_scpi</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;communication class to simplify talking to atmega32u4 with Steve/Eric SCPI firmware</span>
<span class="sd">    requires pySerial</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">visa_interface</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">visa_interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cc_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">init_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_twi</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="c">#modified this to remove the pyserial inWaiting, now its a plain visa interface</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()):</span>
                <span class="k">pass</span>
        <span class="k">except</span> <span class="n">visa_wrappers</span><span class="o">.</span><span class="n">visaWrapperException</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;***** Attempting RE-SYNC&quot;</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_i2c</span><span class="p">()</span>
<div class="viewcode-block" id="i2c_scpi.close"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close the underlying (serial) interface&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">bus_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;W?;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;(@&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">port_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2C:PORT:TWSR?;&#39;</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;TWSR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2C:PORT:TWCR?;&#39;</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;TWCR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">reset_twi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2C:PORT:RST;&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="n">FCLK</span> <span class="o">=</span> <span class="mf">16e6</span>
        <span class="n">TWBR</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(((</span><span class="n">FCLK</span> <span class="o">/</span> <span class="n">frequency</span> <span class="o">-</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="n">TWBR</span> <span class="o">&lt;=</span> <span class="mi">255</span> <span class="ow">and</span> <span class="n">TWBR</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2C:PORT:TWBR {};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TWBR</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_twi</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Setting I2C port to {}Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FCLK</span> <span class="o">/</span> <span class="p">(</span><span class="mi">16</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">TWBR</span><span class="p">))</span>
    <span class="c">###I2C Primitives###</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:S?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to start: {}, check and/or cycle COM port.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;S&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Start: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;S&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:P?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;P&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>                   
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">write_str_b</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:0X?{};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">write_str_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;K&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:RK?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:RN?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="c">###SMBus Overloads###</span>
<div class="viewcode-block" id="i2c_scpi.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read word&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;SMB:RW?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_scpi.read_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.read_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read word&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCodeStr</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;SMB:RW:PEC?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCodeStr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">11</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">lsb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">lsb</span><span class="p">,</span><span class="n">msb</span><span class="p">,</span><span class="n">pec</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&quot;I2C Error: read_word Failed PEC check. Received:{} Expected:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">lsb</span><span class="p">,</span><span class="n">msb</span><span class="p">])))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_scpi.read_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.read_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read byte&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:RB?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_scpi.read_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.read_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read byte&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCodeStr</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:RB:PEC?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCodeStr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">data8</span><span class="p">,</span><span class="n">pec</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&quot;I2C Error: read_byte Failed PEC check. Received:{} Expected:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pec</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">data8</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">data8</span></div>
<div class="viewcode-block" id="i2c_scpi.write_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.write_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write byte&#39;&#39;&#39;</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WB?(@{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error writing command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_scpi.write_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.write_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write byte&#39;&#39;&#39;</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCodeStr</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">]))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WB:PEC?(@{},{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCodeStr</span><span class="p">,</span><span class="n">data_w</span><span class="p">,</span><span class="n">pec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Error in write_byte_pec (Possible PEC failure): {} ({},{},{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_scpi.write_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.write_word">[docs]</a>    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write word&#39;&#39;&#39;</span>
        <span class="n">data16</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data16</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WW?(@{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error writing command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_scpi.write_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.write_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write word&#39;&#39;&#39;</span>
        <span class="n">data16</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCodeStr</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data16</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">commandCode</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)]))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WW:PEC?(@{},{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCodeStr</span><span class="p">,</span><span class="n">data_w</span><span class="p">,</span><span class="n">pec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Error in write_word_pec (Possible PEC failure): {} ({},{},{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_scpi.alert_response"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.alert_response">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Another optional signal is an interrupt line for devices that want to trade their ability to master for a pin.</span>
<span class="sd">        SMBALERT# is a wired-AND signal just as the SMBCLK and SMBDAT signals are. SMBALERT# is</span>
<span class="sd">        used in conjunction with the SMBus General Call Address. Messages invoked with the SMBus are 2 bytes</span>
<span class="sd">        long.</span>
<span class="sd">        A slave-only device can signal the host through SMBALERT# that it wants to talk. The host processes the</span>
<span class="sd">        interrupt and simultaneously accesses all SMBALERT# devices through the Alert Response Address</span>
<span class="sd">        (ARA). Only the device(s) which pulled SMBALERT# low will acknowledge the Alert Response Address.</span>
<span class="sd">        The host performs a modified Receive Byte operation. The 7 bit device address provided by the slave</span>
<span class="sd">        transmit device is placed in the 7 most significant bits of the byte. The eighth bit can be a zero or one.</span>
<span class="sd">        </span>
<span class="sd">        Returns 7 bit address of responding device.</span>
<span class="sd">        Returns None if no response to ARA&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:SMB:ARA?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to alert_response: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to alert_response: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span> <span class="c">#no response</span>
        <span class="n">resp_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span></div>
<div class="viewcode-block" id="i2c_scpi.alert_response_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi.alert_response_pec">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alert Response Query to SMBALERT# interrupt with Packet Error Check</span>
<span class="sd">            Returns 7 bit address of responding device.</span>
<span class="sd">            Returns None if no response to ARA&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:SMB:ARA:PEC?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to alert_response_pec: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to alert_response_pec: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">resp_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">pec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="mh">0xC</span><span class="p">),</span><span class="n">resp_addr</span><span class="p">,</span><span class="n">pec</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&quot;I2C Error: ARA Failed PEC check&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">resp_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span></div>
    <span class="k">def</span> <span class="nf">_read_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_str</span><span class="p">,</span><span class="n">fmt_str</span><span class="p">,</span> <span class="n">pec</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="n">pec_str</span> <span class="o">=</span> <span class="s">&quot;B&quot;</span> <span class="k">if</span> <span class="n">pec</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cc_list</span><span class="p">))</span> 
        <span class="n">cc_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cc_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cc_list</span><span class="p">):</span>
            <span class="n">write_str</span> <span class="o">=</span> <span class="s">&quot;:TWIBlock:SET &quot;</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">cc_list</span><span class="p">:</span>
                <span class="n">write_str</span> <span class="o">+=</span> <span class="s">&quot;{},&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
            <span class="n">write_str</span> <span class="o">=</span> <span class="n">write_str</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cc_list</span> <span class="o">=</span> <span class="n">cc_list</span><span class="p">[:]</span> <span class="c">#copy the list values</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="c">#write_str = &#39;{} {}&#39;.format(cmd_str,addr_r)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">,</span><span class="n">addr_r</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">ask_for_values_binary</span><span class="p">(</span><span class="n">write_str</span><span class="p">,</span><span class="n">format_str</span><span class="o">=</span><span class="s">&quot;{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span><span class="n">pec_str</span><span class="p">),</span> <span class="n">byte_order</span><span class="o">=</span><span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">terminationCharacter</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">visa_wrappers</span><span class="o">.</span><span class="n">visaWrapperException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="s">&quot;VISA error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span>
            <span class="c">#the cfgpro emits two error code bytes at the beginning of its response; both are absorbed into data[0] by unsigned short format</span>
            <span class="c">#unfortunately, with PEC the error is aligned with the second and third (fake PEC) byte locations. The first byte is always 0.</span>
            <span class="k">if</span> <span class="n">pec</span><span class="p">:</span>
                <span class="c">#error in this case is in the second (msbyte of word) and third (fake PEC) bytes (data[0:1])</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C communication error at command code:{}. Error count:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C communication error at command code:{}. Error count:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cdata</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span><span class="p">:</span>
            <span class="c">#the cfgpro emits two error code bytes at the beginning of its response; they remain in data[0:1] with unsigned char format</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C communication error at command code:{}. Error count:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Implementation incomplete&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">pec</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span>
                <span class="c">#fake PEC at [0] for acknowledge status flag</span>
                <span class="n">data_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">pec_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span><span class="p">:</span>
                <span class="c">#data already aligned correctly</span>
                <span class="n">data_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">pec_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Implementation incomplete&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">cc</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">pec</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cc_list</span><span class="p">,</span><span class="n">data_list</span><span class="p">,</span><span class="n">pec_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="n">pec</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC failure at address: {}, command code: {}. Read: {}. Expected: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">pec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">value</span><span class="p">)])))</span>
                <span class="k">elif</span> <span class="n">fmt_str</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">value</span><span class="p">,</span><span class="n">pec</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;PEC failure at address: {}, command code: {}. Read: {}. Expected: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">pec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span><span class="n">value</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Implementation incomplete&quot;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cc</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cc_list</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c">#print &#39;read_bin: {}&#39;.format(results)            </span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">read_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="c">#return self._read_list(cmd_str=&#39;:TWIBlock:GET:Word:BIN?&#39;,fmt_str=&#39;H&#39;,pec=False,addr7=addr7, cc_list=cc_list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_list</span><span class="p">(</span><span class="n">cmd_str</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\xE7</span><span class="s">&#39;</span><span class="p">,</span><span class="n">fmt_str</span><span class="o">=</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="n">pec</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">addr7</span><span class="o">=</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="o">=</span><span class="n">cc_list</span><span class="p">)</span> <span class="c">#binary trigger skips SCPI parser</span>
    <span class="k">def</span> <span class="nf">read_word_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="c">#return self._read_list(cmd_str=&#39;:TWIBlock:GET:Word:PEC:BIN?&#39;,fmt_str=&#39;H&#39;,pec=True,addr7=addr7, cc_list=cc_list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_list</span><span class="p">(</span><span class="n">cmd_str</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\xE8</span><span class="s">&#39;</span><span class="p">,</span><span class="n">fmt_str</span><span class="o">=</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="n">pec</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">addr7</span><span class="o">=</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="o">=</span><span class="n">cc_list</span><span class="p">)</span> <span class="c">#binary trigger skips SCPI parser</span>
    <span class="k">def</span> <span class="nf">read_byte_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="c">#return self._read_list(cmd_str=&#39;:TWIBlock:GET:BYTE:BIN?&#39;,fmt_str=&#39;B&#39;,pec=False,addr7=addr7, cc_list=cc_list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_list</span><span class="p">(</span><span class="n">cmd_str</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\xE5</span><span class="s">&#39;</span><span class="p">,</span><span class="n">fmt_str</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="n">pec</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">addr7</span><span class="o">=</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="o">=</span><span class="n">cc_list</span><span class="p">)</span> <span class="c">#binary trigger skips SCPI parser</span>
    <span class="k">def</span> <span class="nf">read_byte_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="c">#return self._read_list(cmd_str=&#39;:TWIBlock:GET:BYTE:PEC:BIN?&#39;,fmt_str=&#39;B&#39;,pec=True,addr7=addr7, cc_list=cc_list)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_list</span><span class="p">(</span><span class="n">cmd_str</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\xE6</span><span class="s">&#39;</span><span class="p">,</span><span class="n">fmt_str</span><span class="o">=</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="n">pec</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">addr7</span><span class="o">=</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="o">=</span><span class="n">cc_list</span><span class="p">)</span> <span class="c">#binary trigger skips SCPI parser</span>
</div>
<div class="viewcode-block" id="i2c_scpi_sp"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp">[docs]</a><span class="k">class</span> <span class="nc">i2c_scpi_sp</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;communication class to simplify talking to atmega32u4 softport with Steve/Eric SCPI firmware</span>
<span class="sd">    requires pySerial</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">visa_interface</span><span class="p">,</span> <span class="n">portnum</span><span class="p">,</span> <span class="n">sclpin</span><span class="p">,</span> <span class="n">sdapin</span><span class="p">,</span> <span class="n">pullup_en</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;create I2C software port out of any GPIO pins</span>
<span class="sd">        visa_interface&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">visa_interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;:I2CSP{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">portnum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_twi</span><span class="p">(</span><span class="n">sclpin</span> <span class="o">=</span> <span class="n">sclpin</span><span class="p">,</span> <span class="n">sdapin</span> <span class="o">=</span> <span class="n">sdapin</span><span class="p">,</span> <span class="n">pullup_en</span> <span class="o">=</span> <span class="n">pullup_en</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">init_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="c">#modified this to remove the pyserial inWaiting, now its a plain visa interface</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
<div class="viewcode-block" id="i2c_scpi_sp.close"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close the underlying (serial) interface&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">bus_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:W?;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;(@&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">port_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">configure_twi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sclpin</span><span class="p">,</span> <span class="n">sdapin</span><span class="p">,</span> <span class="n">pullup_en</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:PORT:SDApin {};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sdapin</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:PORT:SCLpin {};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sclpin</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">pullup_en</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:PORT:PUEN;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:PORT:EN;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
    <span class="c">###I2C Primitives###</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:S?;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to start: {}, check and/or cycle COM port.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;S&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Start: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;S&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:P?;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;P&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">write_str_b</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:0X?{};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">((</span><span class="n">write_str_b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">write_str</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;K&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:RK?;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:RN?;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="c">###SMBus Overloads###</span>
<div class="viewcode-block" id="i2c_scpi_sp.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read word&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:RW?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">write_str</span><span class="p">))</span>
        <span class="c">#time.sleep(0.001)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">data16</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data16</span></div>
<div class="viewcode-block" id="i2c_scpi_sp.read_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp.read_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus read byte&#39;&#39;&#39;</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">addr_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:RB?(@{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">write_str</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error reading command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="n">word</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data8</span></div>
<div class="viewcode-block" id="i2c_scpi_sp.write_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp.write_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write byte&#39;&#39;&#39;</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WB?(@{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">write_str</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_byte: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error writing command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="i2c_scpi_sp.write_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_scpi_sp.write_word">[docs]</a>    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;faster way to do an smbus write word&#39;&#39;&#39;</span>
        <span class="n">data16</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span>
        <span class="n">addr_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">commandCode</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">commandCode</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">data_w</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data16</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SMB:WW?(@{},{},{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr_w</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data_w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">write_str</span><span class="p">))</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to write_word: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;1&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C Acknowledge Error writing command code:{}. Resp={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">True</span></div>
    <span class="k">def</span> <span class="nf">write_softport_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sclk_freq</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">freq_to_counts</span><span class="p">(</span><span class="n">sclk_freq</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">sclk_freq</span> <span class="o">-</span> <span class="mf">24.374e-6</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.625e-6</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">counts_to_freq</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="mf">2.625e-6</span> <span class="o">+</span> <span class="mf">24.374e-6</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">freq_to_counts</span><span class="p">(</span><span class="n">sclk_freq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counts</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">counts</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Softport delay must be in [0..255], frequency range is limited to {} to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counts_to_freq</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="n">counts_to_freq</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{}:PORT:DELAY {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;ERR?&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;Softport delay must be in [0..255], frequency range is limited to {} to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counts_to_freq</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span><span class="n">counts_to_freq</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>

<span class="c"># needs to be moved to lab, not twi</span></div>
<span class="k">class</span> <span class="nc">i2c_scpi_testhook</span><span class="p">(</span><span class="n">i2c_scpi</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">serial_port</span><span class="p">):</span>
        <span class="n">i2c_scpi</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serial_port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;i2c_scpi_testhook at {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serial_port</span><span class="p">)</span> <span class="c">#what is the str repr of a serial port object?</span>
    <span class="c">###lab.py instrument driver methods###</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">pin_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a channel of name channel_name, associated with physical pin pin_name.</span>
<span class="sd">        When written to, the pin state is changed.</span>
<span class="sd">        Valid pin_names are: HOOK1, HOOK2, HOOK3, HOOK4, </span>
<span class="sd">        PAD_TP_1, PAD_TP_2, PAD_TP_3, PAD_TP_4, PAD_TP_5, </span>
<span class="sd">        PAD_TP_6, PAD_TP_7, PAD_TP_8, PAD_TP_9, GPIO&#39;&#39;&#39;</span>
        <span class="n">pin_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">channel_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pin_name</span>
    <span class="k">def</span> <span class="nf">read_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;When read, this channel returns the state of the pin (not necessarily what it was set to).</span>
<span class="sd">        Possible responses are:</span>
<span class="sd">        0,1,Z,P</span>
<span class="sd">        Where Z is high-z</span>
<span class="sd">        and P is weak pullup&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">channel_name</span><span class="p">])</span> <span class="c">#perhaps this should return what the pin was set to, not what was read-back (wired-nor)?</span>
    <span class="k">def</span> <span class="nf">write_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;When channel is written to, the pin state is updated.</span>
<span class="sd">        Valid values are:</span>
<span class="sd">        0,1,Z,P</span>
<span class="sd">        Where Z is high-z</span>
<span class="sd">        and P is weak pullup&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">channel_name</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>
    <span class="c">###purple-board specific hardware driver methods###</span>
    <span class="k">def</span> <span class="nf">set_dvcc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_write</span><span class="p">(</span><span class="mh">0xE8</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">)</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="mf">63.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aux_stop</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">set_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Pins are: HOOK1, HOOK2, HOOK3, HOOK4, </span>
<span class="sd">        PAD_TP_1, PAD_TP_2, PAD_TP_3, PAD_TP_4, PAD_TP_5, </span>
<span class="sd">        PAD_TP_6, PAD_TP_7, PAD_TP_8, PAD_TP_9, GPIO</span>

<span class="sd">        Value is 0,1,Z,P</span>
<span class="sd">        Where Z is high-z</span>
<span class="sd">        and P is weak pullup</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;Z&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;z&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value argument passed for pin: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">pin_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SETPin(@{},{});:SETPin?(@{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin_name</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">pin_name</span><span class="p">)</span> <span class="c">#set the pin and read back its state to make sure there were no usb communication problems</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to set_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to set_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to set_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Failed to set_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">read_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin_name</span><span class="p">):</span>
        <span class="n">pin_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SETPin?(@{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to read_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to read_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to read_pin: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">pin_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;HOOK1&#39;</span><span class="p">,</span> <span class="s">&#39;HOOK2&#39;</span><span class="p">,</span> <span class="s">&#39;HOOK3&#39;</span><span class="p">,</span> <span class="s">&#39;HOOK4&#39;</span><span class="p">,</span> 
        <span class="s">&#39;PAD_TP_1&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_2&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_3&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_4&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_5&#39;</span><span class="p">,</span> 
        <span class="s">&#39;PAD_TP_6&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_7&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_8&#39;</span><span class="p">,</span> <span class="s">&#39;PAD_TP_9&#39;</span><span class="p">,</span> <span class="s">&#39;GPIO&#39;</span><span class="p">]</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">pin_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">uname</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid pin name {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="c">###Secondary I2C Port Primitives###</span>
    <span class="k">def</span> <span class="nf">aux_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2CAux:S?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to aux port start: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;S&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad aux port Start: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;S&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">aux_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2CAux:P?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to aux port stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;P&quot;</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cStartStopError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad aux port Stop: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>                   
    <span class="k">def</span> <span class="nf">aux_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">write_str_b</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:I2CAux:0X?{};&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">write_str_b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to aux port write: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;K&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">aux_read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2CAux:RK?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to aux port read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to aux port read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to aux port read_ack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">aux_read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:I2CAux:RN?;&#39;</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Short Response to aux port read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Long Response to aux port read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;I2C Error: Bad Response to aux port read_nack: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>

<div class="viewcode-block" id="i2c_dc590"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590">[docs]</a><span class="k">class</span> <span class="nc">i2c_dc590</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generic DC590/Linduino Driver.</span>
<span class="sd">     Note that DC590 will not communicate unless it detects pullups on auxillary i2c port.</span>
<span class="sd">     Linduino does not have above limitiation.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_stream</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">interface_stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_i2c</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">init_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span> <span class="c">#Linduino bootloader delay!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span> 
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span> <span class="c">#Linduino bootloader delay!</span>
        <span class="k">print</span> <span class="s">&#39;DC590 init response: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="c">#discard any responses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;O&#39;</span><span class="p">)</span> <span class="c">#Enable isolated power</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i2c_mode</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">i2cMasterError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">e</span>
<div class="viewcode-block" id="i2c_dc590.i2c_mode"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590.i2c_mode">[docs]</a>    <span class="k">def</span> <span class="nf">i2c_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Switch DC590 I2C/SPI mux to SPI&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;MI&#39;</span><span class="p">)</span> <span class="c">#Switch to isolated I2C Mode</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="nb">buffer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">buffer</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Error switching DC590 to I2C Mode. Unexpected data in buffer:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">buffer</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">_hex_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integer</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return integer formatted correctly for transmission over DC590 serial link&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">integer</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">)</span> <span class="c">#no response expected</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">)</span> <span class="c">#no response expected</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="n">data8</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;S&#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">data8</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;0&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span> <span class="c">#how long do we have to wait to see if the dc590 is going to &quot;N&quot;ack</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;N&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span> <span class="c">#failed acknowledge</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;X&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;DC590 EEPROM detection failed, communications disabled: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Bad response to DC590 write command: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">read_ack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Q&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_ack command, EEPROM Present?: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_ack command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_nack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;R&quot;</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_nack command, EEPROM Present?: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_nack command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
     <span class="c">###SMBus Overloads   </span>
    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}sS{}Rp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_byte command, EEPROM Present?: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_byte command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<div class="viewcode-block" id="i2c_dc590.read_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590.read_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;SMBus Read Byte Protocol with Packet Error Checking.</span>
<span class="sd">        Slave device address specified in 7-bit format.</span>
<span class="sd">        Returns 8-bit data from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}sS{}QRp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_byte_pec command, EEPROM Present?: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ret_str</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;DC590 read_byte_pec command failed PEC&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;N&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&#39;DC590 read_byte_pec failed acknowledge: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;DC590 EEPROM detection failed, communications disabled: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_byte_pec command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">byteList</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span></div>
    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}sS{}QRp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_word command, EEPROM Present?: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="s">&#39;N&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;DC590 read_word failed acknowledge: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;DC590 EEPROM detection failed, communications disabled: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_word command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span> <span class="n">highByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
<div class="viewcode-block" id="i2c_dc590.read_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590.read_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;SMBus Read Word Protocol with Packet Error Checking.</span>
<span class="sd">        Slave device address specified in 7-bit format.</span>
<span class="sd">        Returns 16-bit data from slave.&#39;&#39;&#39;</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">)]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}sS{}QQRp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Short response to DC590 read_word_pec command, EEPROM Present?: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ret_str</span><span class="p">)</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;DC590 read_word_pec command failed PEC&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;N&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&#39;DC590 read_word_pec failed acknowledge: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">ret_str</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;DC590 EEPROM detection failed, communications disabled: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ret_extra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&#39;Long response to DC590 read_word_pec command: {} then {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">,</span> <span class="n">ret_extra</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span> <span class="n">highByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}S{}p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;Response: {} from DC590 write_byte command&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">write_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">]</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">))</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}S{}S{}p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;Bad response: {} from DC590 write_byte_pec command&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}S{}S{}p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;Response: {} from DC590 write_word command&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">write_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">data16</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">commandCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">high_byte</span><span class="p">(</span><span class="n">data16</span><span class="p">)]</span>
        <span class="n">byteList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">(</span><span class="n">byteList</span><span class="p">))</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}S{}S{}S{}p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;Bad response: {} from DC590 write_word_pec command&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">send_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">byteList</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="n">addr7</span><span class="p">),</span> <span class="n">data8</span><span class="p">]</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;sS{}S{}p&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hex_str</span><span class="p">,</span> <span class="n">byteList</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cError</span><span class="p">(</span><span class="s">&#39;Response: {} from DC590 send_byte command&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">resync_communication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="i2c_dc590_list_read"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read">[docs]</a><span class="k">class</span> <span class="nc">i2c_dc590_list_read</span><span class="p">(</span><span class="n">i2c_dc590</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;use with Steve M&#39;s linduino sketch extension DC590ListRead implementing ganged register reads</span>
<span class="sd">        todo: add PEC support to .ino and Python.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_stream</span><span class="p">):</span>
        <span class="n">i2c_dc590</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">_set_chip_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span> <span class="o">!=</span> <span class="n">addr7</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span> <span class="o">=</span> <span class="n">addr7</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;a{address:02X}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">addr7</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_set_command_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span> <span class="o">!=</span> <span class="n">cc_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span> <span class="o">=</span> <span class="n">cc_list</span>
            <span class="n">write_str</span> <span class="o">=</span> <span class="s">&quot;A&quot;</span>
            <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">:</span>
                    <span class="n">write_str</span> <span class="o">+=</span> <span class="s">&#39;1&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">write_str</span> <span class="o">+=</span> <span class="s">&#39;0&#39;</span>
            <span class="n">write_str</span> <span class="o">+=</span> <span class="s">&#39;;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_unpack_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">PEC</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">cc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PEC</span><span class="p">:</span>
                <span class="n">highByte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">lowByte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">pecByte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">6</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span><span class="p">),</span><span class="n">lowByte</span><span class="p">,</span><span class="n">highByte</span><span class="p">,</span><span class="n">pecByte</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;Linduino read_word_list_pec command failed PEC&#39;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="n">lowByte</span><span class="p">,</span> <span class="n">highByte</span><span class="o">=</span><span class="n">highByte</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">lowByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span> <span class="n">highByte</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">set_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="p">):</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">frequency</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="mf">1e5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="mf">4e5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Set I2C frequency to either 100000Hz or 400000Hz&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="i2c_dc590_list_read.enable_streaming_word_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.enable_streaming_word_list">[docs]</a>    <span class="k">def</span> <span class="nf">enable_streaming_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Turn on streaming I2C data</span>
<span class="sd">        Uses the chip address and commandCode list set up with previous read_{word,byte}_list() command.</span>
<span class="sd">        Not really compatible with PyICe except in I2C-only stand alone data logger mode.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.disable_streaming"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.disable_streaming">[docs]</a>    <span class="k">def</span> <span class="nf">disable_streaming</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Turn off streaming I2C data and flush buffers.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c">#need to wait for buffers?</span>
        <span class="k">print</span> <span class="s">&quot;Extra stuff:&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_streaming_word_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_streaming_word_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_streaming_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of single read results.</span>
<span class="sd">        Expects streaming to have been previously enabled using enable_streaming_word_list()</span>
<span class="sd">        This method must be called often enough in the main loop to keep buffers from overflowing.</span>
<span class="sd">        The main loop should spend time here on blocking IO as data fills the serial buffer if the computer is fast enough to keep up.</span>
<span class="sd">        Not really compatible with PyICe except in I2C-only stand alone data logger mode because of this blocking IO speed requirement.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">response_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span>        <span class="c"># (cc_lsit) * 4 nibbles + 2 &quot;;\n&quot;</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">response_length</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_string</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response_length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_string</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;N;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C list read acknowledge Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;Short response to DC590 read_word_list command: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_word_list</span><span class="p">(</span><span class="n">return_string</span><span class="p">,</span> <span class="n">PEC</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_streaming_word_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_streaming_word_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_streaming_word_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Incomplete stream read handler.&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unimplemented.&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_streaming_byte_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_streaming_byte_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_streaming_byte_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Incomplete stream read handler.&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unimplemented.&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_streaming_byte_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_streaming_byte_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_streaming_byte_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Incomplete stream read handler.&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unimplemented.&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_word_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_word_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="n">PEC</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_word results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        This method overloads twoWireInterface.read_word_list() to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_chip_address</span><span class="p">(</span><span class="n">addr7</span><span class="p">)</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cc_list</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_command_codes</span><span class="p">(</span><span class="n">cc_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PEC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Ec&quot;</span><span class="p">)</span>
            <span class="n">response_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span>        <span class="c"># (cc_lsit) * 4 nibbles + 2 &quot;;\n&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ec&quot;</span><span class="p">)</span>
            <span class="n">response_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span>        <span class="c"># (cc_lsit) * 4 nibbles + 2 &quot;;\n&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">response_length</span><span class="p">)</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_string</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response_length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_string</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;N;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C list read acknowledge Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;Short response to DC590 read_word_list command: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;Long response to DC590 read_word_list command: {} then {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unpack_word_list</span><span class="p">(</span><span class="n">return_string</span><span class="p">,</span> <span class="n">PEC</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_word_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_word_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_word results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        This method overloads twoWireInterface.read_word_list_pec() to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_word_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="n">PEC</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_byte_list"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_byte_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="n">PEC</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_byte results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        This method overloads twoWireInterface.read_byte_list() to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_chip_address</span><span class="p">(</span><span class="n">addr7</span><span class="p">)</span>
        <span class="n">cc_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cc_list</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_command_codes</span><span class="p">(</span><span class="n">cc_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">PEC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Eb&quot;</span><span class="p">)</span>
            <span class="n">response_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span>        <span class="c"># (cc_lsit) * 2 nibbles + 2 &quot;;\n&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;eb&quot;</span><span class="p">)</span>
            <span class="n">response_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span>        <span class="c"># (cc_lsit) * 2 nibbles + 2 &quot;;\n&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">response_length</span><span class="p">)</span>
        <span class="n">return_string</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_string</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">response_length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_string</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&quot;N;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">i2cAcknowledgeError</span><span class="p">(</span><span class="s">&quot;I2C list read acknowledge Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;Short response to DC590 read_byte_list command: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">cc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dc590_cc_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">PEC</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">return_string</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">pec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">return_string</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pec</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">write_addr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span><span class="p">),</span><span class="n">cc</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr_7</span><span class="p">),</span><span class="n">data</span><span class="p">,</span><span class="n">pec</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="n">i2cPECError</span><span class="p">(</span><span class="s">&#39;Linduino read_byte_list_pec command failed PEC&#39;</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">cc</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">return_string</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">i2cMasterError</span><span class="p">(</span><span class="s">&quot;Long response to DC590 read_byte_list command: {} then {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">return_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">None</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">results</span></div>
<div class="viewcode-block" id="i2c_dc590_list_read.read_byte_list_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_dc590_list_read.read_byte_list_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_list_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return dictionary of read_byte results.  </span>
<span class="sd">        Reads each commandCode of cc_list in turn at chip address addr7</span>
<span class="sd">        This method overloads twoWireInterface.read_byte_list_pec() to improve communication speed when the instrument supports it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_byte_list</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">cc_list</span><span class="p">,</span> <span class="n">PEC</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
</div></div>
<div class="viewcode-block" id="i2c_kernel"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel">[docs]</a><span class="k">class</span> <span class="nc">i2c_kernel</span><span class="p">(</span><span class="n">twoWireInterface</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;communication class using Linux kernel driver</span>
<span class="sd">        requires py-smbus library provided as part of lm-sensors project i2c-tools library</span>
<span class="sd">        you may need to go to PyICe/deps/i2c-tools and build i2c-tools and py-smbus on your machine before this will work (Make/gcc)</span>
<span class="sd">        alternatively, install python-smbus and i2c-tools from your distribution&#39;s package manager (apt-get,yum,opkg,port,etc).</span>
<span class="sd">        note that the library names for the various protocols do not match the SMBus protocol specification.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#http://wiki.erazor-zone.de/wiki:linux:python:smbus:doc</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bus_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;check /sys/bus/i2c/devices/i2c* to see which memory location corresponds to which filesystem mapping&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus_number</span> <span class="o">=</span> <span class="n">bus_number</span>
        <span class="k">if</span> <span class="n">smbusMissing</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;python-smbus (and maybe i2c-tools) is missing on this computer.  Install with your distribution&#39;s package manager or build from source.  Linux only.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span> <span class="o">=</span> <span class="n">smbus</span><span class="o">.</span><span class="n">SMBus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bus_number</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="c">#no i2c primitives are available using this library!</span>
    
    <span class="c">#protocol-specific access</span>
<div class="viewcode-block" id="i2c_kernel.quick_command_wr"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.quick_command_wr">[docs]</a>    <span class="k">def</span> <span class="nf">quick_command_wr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Here, part of the slave address denotes the command – the R/W# bit. The R/W# bit may be used to simply</span>
<span class="sd">            turn a device function on or off, or enable/disable a low-power standby mode. There is no data sent or</span>
<span class="sd">            received.</span>
<span class="sd">            The quick command implementation is good for very small devices that have limited support for the</span>
<span class="sd">            SMBus specification. It also limits data on the bus for simple devices.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_quick</span><span class="p">(</span><span class="n">addr7</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.send_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.send_byte">[docs]</a>    <span class="k">def</span> <span class="nf">send_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A simple device may recognize its own slave address and accept up to 256 possible encoded commands in</span>
<span class="sd">            the form of a byte that follows the slave address.</span>
<span class="sd">            All or parts of the Send Byte may contribute to the command. For example, the highest 7 bits of the</span>
<span class="sd">            command code might specify an access to a feature, while the least significant bit would tell the device to</span>
<span class="sd">            turn the feature on or off. Or, a device may set the “volume” of its output based on the value it received</span>
<span class="sd">            from the Send Byte protocol.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.send_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.send_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">send_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;send_byte with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">data8</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.receive_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.receive_byte">[docs]</a>    <span class="k">def</span> <span class="nf">receive_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Receive Byte is similar to a Send Byte, the only difference being the direction of data transfer. A</span>
<span class="sd">            simple device may have information that the host needs. It can do so with the Receive Byte protocol. The</span>
<span class="sd">            same device may accept both Send Byte and Receive Byte protocols. A NACK (a ‘1’ in the ACK bit</span>
<span class="sd">            position) signifies the end of a read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.receive_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.receive_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">receive_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;receive_byte with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.alert_response"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.alert_response">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Another optional signal is an interrupt line for devices that want to trade their ability to master for a pin.</span>
<span class="sd">        SMBALERT# is a wired-AND signal just as the SMBCLK and SMBDAT signals are. SMBALERT# is</span>
<span class="sd">        used in conjunction with the SMBus General Call Address. Messages invoked with the SMBus are 2 bytes</span>
<span class="sd">        long.</span>
<span class="sd">        A slave-only device can signal the host through SMBALERT# that it wants to talk. The host processes the</span>
<span class="sd">        interrupt and simultaneously accesses all SMBALERT# devices through the Alert Response Address</span>
<span class="sd">        (ARA). Only the device(s) which pulled SMBALERT# low will acknowledge the Alert Response Address.</span>
<span class="sd">        The host performs a modified Receive Byte operation. The 7 bit device address provided by the slave</span>
<span class="sd">        transmit device is placed in the 7 most significant bits of the byte. The eighth bit can be a zero or one.</span>

<span class="sd">        Returns 7 bit address of responding device.</span>
<span class="sd">        Returns None if no response to ARA&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive_byte</span><span class="p">(</span><span class="mh">0xC</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c">#probably not right: expect nack if no SMBALERT...</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.alert_response_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.alert_response_pec">[docs]</a>    <span class="k">def</span> <span class="nf">alert_response_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alert Response Query to SMBALERT# interrupt with Packet Error Check</span>

<span class="sd">            Returns 7 bit address of responding device.</span>
<span class="sd">            Returns None if no response to ARA&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">receive_byte</span><span class="p">(</span><span class="mh">0xC</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> <span class="c">#probably not right: expect nack if no SMBALERT...</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.write_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.write_byte">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Byte access is the command code. The next byte </span>
<span class="sd">            is the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data byte. The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.write_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.write_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write_byte with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data8</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_byte_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data8</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.write_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.write_word">[docs]</a>    <span class="k">def</span> <span class="nf">write_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The first byte of a Write Word access is the command code. The next two bytes</span>
<span class="sd">            are the data to be written. In this example the master asserts the slave device address followed by the write</span>
<span class="sd">            bit. The device acknowledges and the master delivers the command code. The slave again acknowledges</span>
<span class="sd">            before the master sends the data word (low byte first). The slave acknowledges each byte, and the</span>
<span class="sd">            entire transaction is finished with a STOP condition.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_word_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.write_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.write_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">write_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write_word with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_word_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.read_byte"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.read_byte">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns one byte of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.read_byte_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.read_byte_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_byte_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read_byte with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_byte_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.read_word"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.read_word">[docs]</a>    <span class="k">def</span> <span class="nf">read_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reading data is slightly more complicated than writing data. First the host must write a command to the</span>
<span class="sd">            slave device. Then it must follow that command with a repeated START condition to denote a read from</span>
<span class="sd">            that device’s address. The slave then returns two bytes of data.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_word_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.read_word_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.read_word_pec">[docs]</a>    <span class="k">def</span> <span class="nf">read_word_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read_word with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_word_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.process_call"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.process_call">[docs]</a>    <span class="k">def</span> <span class="nf">process_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The process call is so named because a command sends data and waits for the slave to return a value</span>
<span class="sd">            dependent on that data. The protocol is simply a Write Word followed by a Read Word without the Read-</span>
<span class="sd">            Word command field and the Write-Word STOP bit.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">process_call</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.process_call_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.process_call_pec">[docs]</a>    <span class="k">def</span> <span class="nf">process_call_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;process_call with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">data16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">process_call</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">data16</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_write"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_write">[docs]</a>    <span class="k">def</span> <span class="nf">block_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The Block Write begins with a slave address and a write condition. After the command code the host</span>
<span class="sd">            issues a byte count which describes how many more bytes will follow in the message. If a slave has 20</span>
<span class="sd">            bytes to send, the byte count field will have the value 20 (14h), followed by the 20 bytes of data. The byte</span>
<span class="sd">            count does not include the PEC byte. The byte count may not be 0. A Block Read or Write is allowed to</span>
<span class="sd">            transfer a maximum of 32 data bytes.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteList</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c">#self.bus.write_i2c_block_data(addr7, commandCode, dataByteList)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_block_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">dataByteList</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_write_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_write_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_write_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block_write with additional PEC byte written to slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteList</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="c">#self.bus.write_i2c_block_data(addr7, commandCode, dataByteList)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">write_block_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">commandCode</span><span class="p">,</span> <span class="n">dataByteList</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_read"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_read">[docs]</a>    <span class="k">def</span> <span class="nf">block_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A Block Read differs from a block write in that the repeated START condition exists to satisfy the</span>
<span class="sd">            requirement for a change in the transfer direction. A NACK immediately preceding the STOP condition</span>
<span class="sd">            signifies the end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_block_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_read_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_read_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_read_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block_read with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">read_block_data</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_process_call"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_process_call">[docs]</a>    <span class="k">def</span> <span class="nf">block_process_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The block write-block read process call is a two-part message. The call begins with a slave address and a</span>
<span class="sd">            write condition. After the command code the host issues a write byte count (M) that describes how many</span>
<span class="sd">            more bytes will be written in the first part of the message. If a master has 6 bytes to send, the byte count</span>
<span class="sd">            field will have the value 6 (0000 0110b), followed by the 6 bytes of data. The write byte count (M) cannot</span>
<span class="sd">            be zero.</span>
<span class="sd">            The second part of the message is a block of read data beginning with a repeated start condition followed</span>
<span class="sd">            by the slave address and a Read bit. The next byte is the read byte count (N), which may differ from the</span>
<span class="sd">            write byte count (M). The read byte count (N) cannot be zero.</span>
<span class="sd">            The combined data payload must not exceed 32 bytes. The byte length restrictions of this process call are</span>
<span class="sd">            summarized as follows:</span>
<span class="sd">            • M ≥ 1 byte</span>
<span class="sd">            • N ≥ 1 byte</span>
<span class="sd">            • M + N ≤ 32 bytes</span>
<span class="sd">            The read byte count does not include the PEC byte. The PEC is computed on the total message beginning</span>
<span class="sd">            with the first slave address and using the normal PEC computational rules. It is highly recommended that a</span>
<span class="sd">            PEC byte be used with the Block Write-Block Read Process Call.</span>
<span class="sd">            Note that there is no STOP condition before the repeated START condition, and that a NACK signifies the</span>
<span class="sd">            end of the read transfer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteListWrite</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">block_process_call</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2c_kernel.block_process_call_pec"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2c_kernel.block_process_call_pec">[docs]</a>    <span class="k">def</span> <span class="nf">block_process_call_pec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;block write-block read process call with additional PEC byte read from slave.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">commandCode</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">dataByteListWrite</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">check_size</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">pec</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bus</span><span class="o">.</span><span class="n">block_process_call</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span><span class="n">commandCode</span><span class="p">,</span><span class="n">dataByteListWrite</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">i2cIOError</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="i2cError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cError">[docs]</a><span class="k">class</span> <span class="nc">i2cError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;I2C Error Superclass - Don&#39;t raise this exception.  Use more specific subclass.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>
<div class="viewcode-block" id="i2cUnimplementedError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cUnimplementedError">[docs]</a><span class="k">class</span> <span class="nc">i2cUnimplementedError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Feature currently unimplemented.  Write it if you want it!&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cMasterError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cMasterError">[docs]</a><span class="k">class</span> <span class="nc">i2cMasterError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Unexpected response from I2C interface device,</span>
<span class="sd">    possibly caused by dropped USB packets, serial error,</span>
<span class="sd">    unpowered master, or other &#39;computer&#39; problems.</span>
<span class="sd">    Excludes communication problems with a device on the two-wire bus.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cStartStopError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cStartStopError">[docs]</a><span class="k">class</span> <span class="nc">i2cStartStopError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Failed to assert Start of Stop signals - not supported by all hardware&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cAcknowledgeError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device, but slave devices not acknowledging address or subsequent data bytes.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cAddressAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cAddressAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cAddressAcknowledgeError</span><span class="p">(</span><span class="n">i2cAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device, but slave device not acknowledging address.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cWriteAddressAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cWriteAddressAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cWriteAddressAcknowledgeError</span><span class="p">(</span><span class="n">i2cAddressAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device, but slave device not acknowledging write address.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cReadAddressAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cReadAddressAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cReadAddressAcknowledgeError</span><span class="p">(</span><span class="n">i2cAddressAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device, but slave device not acknowledging read address.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cCommandCodeAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cCommandCodeAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cCommandCodeAcknowledgeError</span><span class="p">(</span><span class="n">i2cAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device, but slave device not acknowledging command code.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cDataAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cDataAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cDataAcknowledgeError</span><span class="p">(</span><span class="n">i2cAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device and slave address, but slave devices not acknowledging subsequent data bytes.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cDataLowAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cDataLowAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cDataLowAcknowledgeError</span><span class="p">(</span><span class="n">i2cDataAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device and slave address, but slave devices not acknowledging low data byte.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cDataHighAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cDataHighAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cDataHighAcknowledgeError</span><span class="p">(</span><span class="n">i2cDataAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device and slave address, but slave devices not acknowledging high data byte.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cDataPECAcknowledgeError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cDataPECAcknowledgeError">[docs]</a><span class="k">class</span> <span class="nc">i2cDataPECAcknowledgeError</span><span class="p">(</span><span class="n">i2cDataAcknowledgeError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master device and slave address, but slave devices not acknowledging PEC data byte.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cPECError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cPECError">[docs]</a><span class="k">class</span> <span class="nc">i2cPECError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Got expected responses from I2C master and slave acknowledging all bytes, but failed to reconcile SMBus packet error check.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="i2cIOError"><a class="viewcode-back" href="../../_autosummary/PyICe.twoWireInterface.html#PyICe.twoWireInterface.i2cIOError">[docs]</a><span class="k">class</span> <span class="nc">i2cIOError</span><span class="p">(</span><span class="n">i2cError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;I2C Bus communication failure, not otherwise specified.&#39;&#39;&#39;</span>
    <span class="k">pass</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;test code&#39;&#39;&#39;</span>
    <span class="k">pass</span>
<span class="c">##    import serial</span>
<span class="c">##    myport = serial.Serial(&#39;com13&#39;, timeout=1)</span>
<span class="c">##    foo = i2c_dc590_serial(myport)</span>

<span class="c">##    myport = serial.Serial(&#39;com15&#39;, timeout=5)</span>
<span class="c">##    foo = i2c_scpi(myport)</span>


<span class="c">##    myport = serial.Serial(&#39;com9&#39;, timeout=5)</span>
<span class="c">##    foo = i2c_pic(myport)</span>
<span class="c">##    try:</span>
<span class="c">##        print hex(foo.read_word(0x74, 0xaa)) #fan controller</span>
<span class="c">##    except i2cError as e:</span>
<span class="c">##        print e</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../PyICe.html">
              <img class="logo" src="../../_static/tssop.png" alt="Logo"/>
            </a></p>
<h3><a href="../../PyICe.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_instruments.html">PyICe.lab_instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_core.html">PyICe.lab_core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_utils.html">PyICe.lab_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.LTC_plot.html">PyICe.LTC_plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_gui.html">PyICe.lab_gui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_interfaces.html">PyICe.lab_interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.twi_instrument.html">PyICe.twi_instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.twoWireInterface.html">PyICe.twoWireInterface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.spi_instrument.html">PyICe.spi_instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.spi_interface.html">PyICe.spi_interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.visa_wrappers.html">PyICe.visa_wrappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.xml_registers.html">PyICe.xml_registers</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../PyICe.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Linear Technology Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>