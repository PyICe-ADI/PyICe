<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyICe.lab_instruments &mdash; PyICe 9000 documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '9000',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/tssop.ico"/>
    <link rel="top" title="PyICe 9000 documentation" href="../../PyICe.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for PyICe.lab_instruments</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Instrument Drivers</span>
<span class="sd">##################</span>

<span class="sd">Supported lab instruments</span>
<span class="sd">-------------------------</span>
<span class="sd">agilent_34970a_chassis</span>
<span class="sd">  collection instrument for all 34970 plugins</span>
<span class="sd">agilent_34970a_20ch</span>
<span class="sd">  20ch meter</span>
<span class="sd">agilent_34970a_34908A_40ch</span>
<span class="sd">  40ch meter</span>
<span class="sd">agilent_34970a_dacs</span>
<span class="sd">  2 dacs</span>
<span class="sd">agilent_34970a_dig_out8</span>
<span class="sd">  8 bit digital output</span>
<span class="sd">agilent_34970a_dig_in8</span>
<span class="sd">  8 bit digital input</span>
<span class="sd">agilent_34970a_actuator</span>
<span class="sd">  34970a actuator module</span>
<span class="sd">agilent_e3631a</span>
<span class="sd">  triple supply</span>
<span class="sd">agilent_e53181a</span>
<span class="sd">  frequency counter</span>
<span class="sd">agilent_34401a</span>
<span class="sd">  multimeter</span>
<span class="sd">agilent_34461a</span>
<span class="sd">  multimeter</span>
<span class="sd">bus_pirate_gpio</span>
<span class="sd">  general purpose input/output using the bus pirate</span>
<span class="sd">bk 8500</span>
<span class="sd">  single channel 300W electronic load</span>
<span class="sd">hp_3478a</span>
<span class="sd">  multimeter</span>
<span class="sd">agilent_n3301</span>
<span class="sd">  2 channel electronic load</span>
<span class="sd">htx9000</span>
<span class="sd">  usb serial load box (Steve Martin)</span>
<span class="sd">htx9001</span>
<span class="sd">  configurator pro (Steve Martin)</span>
<span class="sd">htx9001a</span>
<span class="sd">  configurator pro A (Steve Martin)</span>
<span class="sd">kikusui_plz334w</span>
<span class="sd">  Kikusui PLZ 334W single channel 330w load (Almost certainly also supports PLZ 664WA)</span>
<span class="sd">kikusui_pbz20_20</span>
<span class="sd">  Kikusui PBZ20-20 single channel bipolar power supply (20V/20A)</span>
<span class="sd">kikusui_pbz40_10</span>
<span class="sd">  Kikusui PBZ40-10 single channel bipolar power supply (40V/10A)</span>
<span class="sd">hameg_4040</span>
<span class="sd">  Hameg 4 channel 10A 384W supply</span>
<span class="sd">sorensen_lhp_100_10</span>
<span class="sd">  1000w supply 100v 10a</span>
<span class="sd">sorensen_xt_250_25</span>
<span class="sd">  250V 250mA DC supply</span>
<span class="sd">tektronix_3054</span>
<span class="sd">  Oscilloscope</span>
<span class="sd">autonicstk</span>
<span class="sd">  Autonics TK series RS-485 Modbus PID Temperature Controller</span>
<span class="sd">modbus_relay</span>
<span class="sd">  Two-channel Modbus RTU RS-485 controllable relay</span>
<span class="sd">temptronic_4310</span>
<span class="sd">  ThermoStream (max temp 175)</span>
<span class="sd">delta_9039</span>
<span class="sd">  GPIB Oven</span>
<span class="sd">Sun EC1x</span>
<span class="sd">  Temp chamber</span>
<span class="sd">Sun EX0x</span>
<span class="sd">  Temp chamber</span>
<span class="sd">Franken_oven</span>
<span class="sd">  Temperature chamber controlled by autonicstk and modbus_relay</span>
<span class="sd">oven_w4sd</span>
<span class="sd">  Vermont Lab Oven controller</span>
<span class="sd">krohnhite_523</span>
<span class="sd">  DC Source/Calibrator</span>
<span class="sd">krohnhite_526</span>
<span class="sd">  DC Source/Calibrator with LAN</span>
<span class="sd">powermux</span>
<span class="sd">  8x8 power switching matrix board (Steve Martin)</span>
<span class="sd">keithley_7002</span>
<span class="sd">  Switch system</span>
<span class="sd">hp_3458a</span>
<span class="sd">  8.5 digit multimeter</span>
<span class="sd">RL1000</span>
<span class="sd">  Reay Labs Efficiency Meter.</span>
<span class="sd">agilent_3034a</span>
<span class="sd">  4-channel oscilloscope</span>
<span class="sd">hp_4195a</span>
<span class="sd">  network analyzer</span>
<span class="sd">keithley_4200</span>
<span class="sd">  semiconductor parameter analyzer (HP4145 command set)</span>
<span class="sd">hp_4155b</span>
<span class="sd">  semiconductor parameter analyzer (HP4145 command set)</span>
<span class="sd">ADT7410</span>
<span class="sd">  Analog Devices I2C Silicon Temperature Sensor</span>
<span class="sd">AD5272</span>
<span class="sd">  Analog Devices I2C 10-bit Potentiometer</span>
<span class="sd">PCF8574</span>
<span class="sd">  I2C GPIO chip, multiple vendors</span>
<span class="sd">TDS640A</span>
<span class="sd">  Tektronix Digital Scope</span>
<span class="sd">fluke45</span>
<span class="sd">  multimeter</span>
<span class="sd">saleae</span>
<span class="sd">  Logic Pro 8/16 Analog DAQ. Digital support possible later</span>
<span class="sd">agilent_e4433b</span>
<span class="sd">  Agilent E4433B ESG-D Series Signal Generator 250kHz - 4GHz</span>
<span class="sd">firmata</span>
<span class="sd">  Firmata universal embedded system (Arduino) control protocol</span>

<span class="sd">Virtual Instruments</span>
<span class="sd">-------------------</span>
<span class="sd">instrument_humanoid</span>
<span class="sd">  Notification helper to put human control of a manual instrument into an otherwise automated measurement.</span>
<span class="sd">delay_loop</span>
<span class="sd">  Instrument wrapper for lab_utils.delay_loop enables logging of delay diagnostic vairables.</span>
<span class="sd">clipboard</span>
<span class="sd">  Store and retrieve data to/from windows/linux/osx clipboard.</span>
<span class="sd">accumulator</span>
<span class="sd">  Accumulator Virtual Instrument</span>
<span class="sd">timer</span>
<span class="sd">  Timer Virtual Instrument</span>
<span class="sd">integrator</span>
<span class="sd">  Integrator Virtual Instrument</span>
<span class="sd">differencer</span>
<span class="sd">  Differencer Virtual Instrument</span>
<span class="sd">differentiator</span>
<span class="sd">  Differentiator Virtual Instrument</span>
<span class="sd">servo</span>
<span class="sd">  Servo controller, for kelvins etc</span>
<span class="sd">servo_group</span>
<span class="sd">  Group Servo Control, servos multiple servos into regulation</span>
<span class="sd">ramp_to</span>
<span class="sd">  Move forcing channels incrementally to control overshoot</span>
<span class="sd">threshold_finder</span>
<span class="sd">  Automatically find thresholds and hysteresis</span>
<span class="sd">calibrator</span>
<span class="sd">  Remap write values through two-point or univariate transform</span>
<span class="sd">smart_battery_emulator</span>
<span class="sd">  A pair of threaded writers to output smart battery commands to a smart-battery charger</span>


<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">lab_core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">lab_interfaces</span><span class="o">,</span> <span class="nn">visa_wrappers</span><span class="o">,</span> <span class="nn">lab_utils</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">datetime</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">atexit</span>
<span class="kn">import</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">struct</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABCMeta</span><span class="p">,</span> <span class="n">abstractmethod</span>


<div class="viewcode-block" id="a3497xa_instrument"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.a3497xa_instrument">[docs]</a><span class="k">class</span> <span class="nc">a3497xa_instrument</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">,</span><span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;superclass of all Agilent 34970 plugin instruments&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">automatic_monitor</span><span class="p">):</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;a3497xa&#39;</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_active</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_scan_internal_addresses</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scanlist_ordered</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_automatic_monitor</span><span class="p">(</span><span class="n">automatic_monitor</span><span class="p">)</span> <span class="c">#This doesn&#39;t work!!! Monitor update rate is also affected by channel delay for some reason.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_automatic_monitor</span> <span class="o">=</span> <span class="n">automatic_monitor</span> <span class="c">#Why twice???</span>
<div class="viewcode-block" id="a3497xa_instrument.enable_automatic_monitor"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.a3497xa_instrument.enable_automatic_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">enable_automatic_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span> <span class="c">#This doesn&#39;t work!!! Monitor update rate is also affected by channel delay for some reason.</span>
        <span class="sd">&#39;&#39;&#39;set to True to enable monitor channel auto-switching after single-channel scanlist read.</span>
<span class="sd">        After first reading, front panel display will continuously update with new results and successive reads will generally be faster without mux switching.</span>
<span class="sd">        set False to force traditional scanlist behavior and manual monitor channel selection via set_monitor and get_monitor_data methods.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_automatic_monitor</span> <span class="o">=</span> <span class="n">enable</span></div>
    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_list</span><span class="p">):</span>
        <span class="c">#channel_list is a list of channel objects</span>
        <span class="c"># returns a dictionary of read data by channel name</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="c">#special case for reading the moniotor</span>
        <span class="c">#This doesn&#39;t work!!! Monitor update rate is also affected by channel delay for some reason.</span>
        <span class="k">if</span> <span class="bp">False</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_automatic_monitor</span> \
           <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> \
           <span class="ow">and</span> <span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span> \
           <span class="ow">and</span> <span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;volts_dc&#39;</span><span class="p">,</span> <span class="s">&#39;current_dc&#39;</span><span class="p">,</span> <span class="s">&#39;thermocouple&#39;</span><span class="p">]:</span>
            <span class="n">az_multiplier</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;auto_zero&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span> <span class="c">#wait for two full measurement cycles in case first one was just getting started when input changed. Then add one more below for mismatched clocks.</span>
            <span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="n">az_multiplier</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.017</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;NPLC&#39;</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="c">#emergency exit in the case of excessive quantization noise to thermal noise ratio.</span>
            <span class="c">#measurements take ~2x the expected NPLC time with autozero and ~1x the expected NPLC time with autozero disabled, </span>
            <span class="c">#but don&#39;t scale well below NPLC=1</span>
            <span class="n">stale_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_monitor_data</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">stale_result</span>
            <span class="k">while</span> <span class="n">result</span> <span class="o">==</span> <span class="n">stale_result</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
                <span class="c">#wait</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_monitor_data</span><span class="p">()</span>
            <span class="n">questionable_result</span> <span class="o">=</span> <span class="n">result</span> <span class="c">#may have changed forcing conditions during last conversion</span>
            <span class="k">while</span> <span class="n">result</span> <span class="o">==</span> <span class="n">questionable_result</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
                <span class="c">#wait some more</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_monitor_data</span><span class="p">()</span>
            <span class="c">#if time.time() &gt; max_time:</span>
            <span class="c">#    print &#39;WARNING: 3497x monitor channel: {} read timed out without value change. This might be normal if quantization noise exceeds thermal noise.&#39;.format(channel_list[0].get_name())</span>
            <span class="n">results</span><span class="p">[</span><span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_monitor_data</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_active</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">scan_internal_addresses</span> <span class="o">=</span> <span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channel_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">scan_internal_addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span><span class="p">)</span>
        <span class="n">scan_internal_addresses</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">scan_internal_addresses</span><span class="p">))</span> <span class="c"># remove duplicates</span>
        <span class="c"># note cannot store last scan and avoid writing it reconfiguring channels breaks it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_scan_internal_addresses</span> <span class="o">=</span> <span class="n">scan_internal_addresses</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;ROUTe:SCAN (@&quot;</span>
        <span class="k">for</span> <span class="n">internal_address</span> <span class="ow">in</span> <span class="n">scan_internal_addresses</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">internal_address</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="c">#then get the list back to learn channel order</span>
        <span class="n">txt_scanlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;ROUTe:SCAN?&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">txt_scanlist</span> <span class="o">=</span> <span class="n">txt_scanlist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;(@&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Communication problem; attempting resyc.&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Resync complete; better luck next time.&#39;</span><span class="p">)</span>
        <span class="n">txt_scanlist</span> <span class="o">=</span> <span class="n">txt_scanlist</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&quot;)&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scanlist_ordered</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">txt_scanlist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_complete</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">internal_address</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scanlist_ordered</span><span class="p">,</span><span class="n">vals</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="n">internal_address</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channel_list</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="c">#if self._automatic_monitor and len(channel_list) == 1:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">channel_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span> <span class="o">=</span> <span class="n">channel_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:MONitor (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:MONitor:STATe ON&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">read_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">):</span>
        <span class="c"># the scan list is in the delegator, not the creating instrument</span>
        <span class="k">assert</span> <span class="n">internal_address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_delegator</span><span class="p">()</span><span class="o">.</span><span class="n">scan_results</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolve_delegator</span><span class="p">()</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="n">internal_address</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">read_apply_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">,</span><span class="n">function</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_raw</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_add_bay_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_object</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;bay&#39;</span><span class="p">,</span><span class="n">bay</span><span class="p">)</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">,</span><span class="n">number</span><span class="o">+</span><span class="mi">100</span><span class="o">*</span><span class="n">bay</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_internal_address_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="a3497xa_instrument.set_monitor"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.a3497xa_instrument.set_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">set_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">monitor_channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;View named channel measurement on the front panel whenever scan is idle&#39;&#39;&#39;</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_channel</span><span class="p">(</span><span class="n">monitor_channel_name</span><span class="p">)</span>
        <span class="n">channel_number</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_number</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;ROUTe:SCAN (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor_channel_num</span> <span class="o">=</span> <span class="n">channel_number</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:MONitor (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_number</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:MONitor:STATe ON&quot;</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">get_monitor_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">channel_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_monitor</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="sd">&#39;&#39;&#39;return data from last monitor reading&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;ROUTe:MONitor:DATA?&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="agilent_3497xa_chassis"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_chassis">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_chassis</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A lab_bench-like container object to speed up operation of the 34970 instrument.</span>
<span class="sd">    If each plugin from the three expansion bays is added individually to the lab_bench,</span>
<span class="sd">    the scanlist must be modified for each plugin to run separate scans on each individual plugin.</span>
<span class="sd">    This object will construct a composite scanlist, then appropriately parse the results back to the individual instruments.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">,</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Agilent 34970 collection object.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;34970a_chasis&#39;</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_chasis @ {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">),</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="n">automatic_monitor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_3497xa_chassis.add"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_chassis.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">new_instrument</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;only appropriate to add instantiated 34907 plugin instrument objects to this class (20ch, 40ch, dacs, dig-in, dig-out, etc)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_instrument</span><span class="p">,</span> <span class="n">a3497xa_instrument</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;{} doesn&#39;t fit inside 34970 expansion bay.  If you push too hard, you might break something&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument</span><span class="p">))</span>
        <span class="n">channel_group</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">new_instrument</span><span class="p">)</span>
        <span class="n">new_instrument</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>
<span class="k">class</span> <span class="nc">agilent_34970a_chassis</span><span class="p">(</span><span class="n">agilent_3497xa_chassis</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_chassis</span><span class="p">(</span><span class="n">agilent_3497xa_chassis</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="agilent_3497xa_20ch_40ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_20ch_40ch</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Superclass for the 34901A, 34902A and 34908A input measurement multiplexers</span>
<span class="sd">        All functionality common to the 20Ch and 40Ch is implemented here and inherited</span>
<span class="sd">        by the appropriate subclasses.</span>

<span class="sd">        Capabilities:</span>
<span class="sd">           34901A, 34902A: Scanning and direct measurement</span>
<span class="sd">               of temperature, voltage, resistance, frequency,</span>
<span class="sd">               and current (34901A only) using the internal DMM.</span>
<span class="sd">           34908A: Scanning and direct measurement</span>
<span class="sd">               of temperature, voltage, and resistance using</span>
<span class="sd">               the internal DMM.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span> <span class="n">bay</span><span class="p">,</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;&quot;interface_visa&quot;</span>
<span class="sd">            bay is 1-3.  1 is top slot, 3 is bottom slot.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;34970a_mux&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bay</span> <span class="o">=</span> <span class="n">bay</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_mux bay: {} @ {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">),</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="n">automatic_monitor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Register a named channel.  No configuration takes place.  When the channel is read directly,</span>
<span class="sd">            or through read_channels(), an appropriate scanlist will be written to the 34970.</span>
<span class="sd">            channel_num is 1-22 for the 20Ch mux (1-20 no current, 21-22 current only)</span>
<span class="sd">            channel_num is 1-40 for the 40Ch mux&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="n">channel_num</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_apply_function</span><span class="p">(</span><span class="n">internal_address</span><span class="p">,</span><span class="nb">float</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bay_number</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_dc_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_dc_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span><span class="n">NPLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span><span class="n">high_z</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">disable_autozero</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">Rsource</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Shortcut method to add voltage channel and configure in one step.&#39;&#39;&#39;</span>
        <span class="c">#TODO: add_extended_channels argument to add nplc, delay, etc all at once???</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_num</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;volts_dc&#39;</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_display_format_function</span><span class="p">(</span><span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">float_data</span><span class="p">:</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">eng_string</span><span class="p">(</span><span class="n">float_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;:3.6g&#39;</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Rsource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span> <span class="p">(</span><span class="s">&quot;WARNING: Rsource({Rsource:.3g} ohms) and Delay({delay:.3g} s) &quot;</span>
                       <span class="s">&quot;BOTH specified in add_channel_dc_voltage(&#39;{chname}&#39;)</span><span class="se">\n</span><span class="s">&quot;</span>
                       <span class="s">&quot;  hence I&#39;m IGNORING Rsource and setting Delay to {delay:g} s&quot;</span>
                       <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rsource</span><span class="o">=</span><span class="n">Rsource</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">chname</span><span class="o">=</span><span class="n">channel_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">9</span> <span class="o">*</span> <span class="n">Rsource</span> <span class="o">*</span> <span class="mf">1390e-12</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mf">0.002</span><span class="p">)</span> <span class="c"># per Steve&#39;s memo SM87, 2ms minimum. Delay resolution = 1ms per Agilent manual.</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&quot;Rsource&quot;</span><span class="p">,</span> <span class="n">Rsource</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_dc_voltage</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">NPLC</span><span class="p">,</span><span class="nb">range</span><span class="p">,</span><span class="n">high_z</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">disable_autozero</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&quot;delay&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_dc_voltage</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_thermocouple"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_thermocouple">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_thermocouple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span><span class="n">tcouple_type</span><span class="p">,</span><span class="n">NPLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">disable_autozero</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Shortcut method to add thermistor measurement channel and configure in one step.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span> <span class="s">&#39;thermocouple&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_display_format_function</span><span class="p">(</span><span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">float_data</span><span class="p">:</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">eng_string</span><span class="p">(</span><span class="n">float_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;:3.6g&#39;</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">u&#39;°C&#39;</span><span class="p">)</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_thermocouple</span><span class="p">(</span><span class="n">internal_address</span><span class="p">,</span><span class="n">tcouple_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_nplc</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="n">NPLC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_autozero</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span> <span class="n">disable_autozero</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_thermocouple</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
    <span class="k">def</span> <span class="nf">_set_impedance_10GOhm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">high_z</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set channel impedance to &gt;1GOhm if high_z is True and voltage range allows, otherwise 10M</span>
<span class="sd">            impedance always 10M if argument is false&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;input_impedance_hiz&#39;</span><span class="p">,</span><span class="n">high_z</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">high_z</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut:IMPedance:AUTO ON , (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut:IMPedance:AUTO OFF , (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_config_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">NPLC</span><span class="p">,</span><span class="nb">range</span><span class="p">,</span><span class="n">high_z</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">disable_autozero</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reconfigure channel to measure DC voltage, with input impedance &gt;10G if range allows.</span>
<span class="sd">            Optionally specify number of powerline cycles integration period and attenuator range.&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:VOLTage:DC {} , (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_nplc</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">NPLC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_impedance_10GOhm</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">high_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_autozero</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">disable_autozero</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_delay</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_config_thermocouple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">,</span><span class="n">thermocouple_type</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thermocouple_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;J&#39;</span><span class="p">,</span><span class="s">&#39;K&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid thermocouple type, valid types are J,K,T&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:TEMPerature TCouple,{},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">thermocouple_type</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_config_channel_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delay specified number of seconds between closing relay and starting DMM measurement for channel.&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;delay&#39;</span><span class="p">,</span><span class="n">delay</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUT:CHAN:DELAY {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_configure_channel_autozero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">disable_autozero</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Disable or enable (default) the autozero mode. The OFF and ONCE</span>
<span class="sd">        parameters have a similar effect. Autozero OFF does not issue a new</span>
<span class="sd">        zero measurement until the next time the instrument goes to the</span>
<span class="sd">        &quot;wait-for-trigger&quot; state. Autozero ONCE issues an immediate zero</span>
<span class="sd">        measurement. The :AUTO? query the autozero mode. Returns &quot;0&quot;</span>
<span class="sd">        (OFF or ONCE) or &quot;1&quot; (ON).</span>
<span class="sd">        </span>
<span class="sd">        Autozero OFF Operation</span>
<span class="sd">        Following instrument warm-up at calibration temperature ±1 °C</span>
<span class="sd">        and &lt; 10 minutes, add 0.0002% range additional error + 5 μV.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:ZERO:AUTO {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;ONCE&quot;</span> <span class="k">if</span> <span class="n">disable_autozero</span> <span class="k">else</span> <span class="s">&quot;ON&quot;</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;auto_zero&#39;</span><span class="p">,</span><span class="ow">not</span><span class="p">(</span><span class="n">disable_autozero</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_config_channel_scaling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Perform y=mx+b scaling to channel inside instrument and change displayed units&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CALCulate:SCALe:GAIN {}, (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;gain&#39;</span><span class="p">,</span> <span class="n">gain</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CALCulate:SCALe:OFFSet {}, (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CALCulate:SCALe:UNIT &quot;{}&quot;, (@{})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;unit&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_display_format_function</span><span class="p">(</span><span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">float_data</span><span class="p">:</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">eng_string</span><span class="p">(</span><span class="n">float_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;:3.6g&#39;</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="n">unit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CALCulate:SCALe:STATe ON ,(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_configure_channel_nplc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="n">nplc</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">channel_type</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">)</span>
            <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;NPLC&#39;</span><span class="p">,</span><span class="n">nplc</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ChannelAttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Cannot configure nplc for channel {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">channel_type</span> <span class="o">==</span> <span class="s">&#39;volts_dc&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage:DC:NPLC {}, (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nplc</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">channel_type</span> <span class="o">==</span> <span class="s">&#39;current_dc&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURRent:DC:NPLC {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nplc</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">channel_type</span> <span class="o">==</span> <span class="s">&#39;thermocouple&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:TEMPerature:NPLC {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nplc</span><span class="p">,</span><span class="n">internal_address</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unkown 34970_type, cannot set NPLC for this type of channel&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_nplc"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_nplc">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_nplc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the nplc setting of an existing channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">nplc</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_nplc</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">nplc</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_nplc</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;NPLC&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_delay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_delay">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the delay of an existing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">delay</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_delay</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">delay</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delay</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;delay&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_input_hiz"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_input_hiz">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_input_hiz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the input impedance of an existing channel.</span>
<span class="sd">        Write channel to True for &gt;10G mode (&lt;~10V), False for 10Meg mode.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">hiz</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_impedance_10GOhm</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">hiz</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_input_hiz</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;input_impedance_hiz&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_autozero"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_autozero">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_autozero</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the auto-zero mode of an existing channel.</span>
<span class="sd">        Write channel to True autozero every measurement (doubling measurement time), False for one-time autozero.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">enable_autozero</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_autozero</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">disable_autozero</span><span class="o">=</span><span class="ow">not</span><span class="p">(</span><span class="n">enable_autozero</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_autozero</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;auto_zero&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_gain"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_gain">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the gain (span multiplier) of an existing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">gain</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_scaling</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="n">gain</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_gain</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;gain&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_offset"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_offset">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the offset of an existing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">offset</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_scaling</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_offset</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;offset&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch_40ch.add_channel_unit"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch_40ch.add_channel_unit">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a secondary channel that can modify the displayed unit (V/A/etc) of an existing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">unit</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_scaling</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_offset</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;unit&#39;</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="agilent_3497xa_20ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_20ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch_40ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extends base class to add methods specific to the 20-channel mux that are</span>
<span class="sd">        not appropriate for the 40-channel mux such as frequency, current measurement (internal shunt),</span>
<span class="sd">        and current measurement (external sense resistor).&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">agilent_3497xa_20ch_40ch</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34901A&quot;</span>
<div class="viewcode-block" id="agilent_3497xa_20ch.add_channel_dc_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch.add_channel_dc_current">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span><span class="n">NPLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="s">&#39;AUTO&#39;</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">disable_autozero</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;DC current measurement only allowed on 34901A channels 21 and 22&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">channel_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid channel number, channel cannot be used for current&#39;</span><span class="p">)</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_num</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;current_dc&#39;</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_display_format_function</span><span class="p">(</span><span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">float_data</span><span class="p">:</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">eng_string</span><span class="p">(</span><span class="n">float_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;:3.6g&#39;</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_dc_current</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="nb">range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_nplc</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">NPLC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_channel_autozero</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">disable_autozero</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_delay</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_dc_current</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span></div>
    <span class="k">def</span> <span class="nf">_config_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;DC current measurement only allowed on 34901A channels 21 and 22&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;internal_address&#39;</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;range&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:CURRent:DC {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span> <span class="n">internal_address</span><span class="p">))</span>
<div class="viewcode-block" id="agilent_3497xa_20ch.add_channel_ammeter_range"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch.add_channel_ammeter_range">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_ammeter_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">base_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Modify ammeter current range shunt.&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">21</span> <span class="ow">or</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">22</span>
        <span class="n">range_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="nb">range</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config_dc_current</span><span class="p">(</span><span class="n">base_channel</span><span class="p">,</span> <span class="nb">range</span><span class="p">))</span>
        <span class="n">range_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_ammeter_range</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">range_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;measurement_channel&#39;</span><span class="p">,</span> <span class="n">base_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">range_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">base_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;range&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">range_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch.config_freq"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch.config_freq">[docs]</a>    <span class="k">def</span> <span class="nf">config_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure a channel to measure frequency.&#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&#39;config_freq expect this to change and become an add_channel&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_address_by_name</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:FREQuency (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch.config_res"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch.config_res">[docs]</a>    <span class="k">def</span> <span class="nf">config_res</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;DC resistance measurement &#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&#39;config_res expect this to change and become an add_channel&#39;</span>
        <span class="n">ch_list</span> <span class="o">=</span>  <span class="s">&quot;(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_internal_address_by_name</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:RESistance &quot;</span> <span class="o">+</span> <span class="n">ch_list</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_3497xa_20ch.add_channel_current_sense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_20ch.add_channel_current_sense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_current_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span><span class="n">gain</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">NPLC</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span><span class="n">resistance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">disable_autozero</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">Rsource</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure channel to return current measurement by scaling voltage measured across</span>
<span class="sd">            user-supplied sense resistor.  Specify either gain or its reciprocal resistance.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">Rsource</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Rsource</span> <span class="o">=</span> <span class="n">resistance</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_dc_voltage</span><span class="p">(</span><span class="n">channel_name</span>     <span class="o">=</span> <span class="n">channel_name</span><span class="p">,</span>
                                              <span class="n">channel_num</span>      <span class="o">=</span> <span class="n">channel_num</span><span class="p">,</span>
                                              <span class="n">NPLC</span>             <span class="o">=</span> <span class="n">NPLC</span><span class="p">,</span>
                                              <span class="nb">range</span>            <span class="o">=</span> <span class="nb">range</span><span class="p">,</span>
                                              <span class="n">disable_autozero</span> <span class="o">=</span> <span class="n">disable_autozero</span><span class="p">,</span>
                                              <span class="n">Rsource</span>          <span class="o">=</span> <span class="n">Rsource</span>
                                             <span class="p">)</span>
        <span class="k">if</span> <span class="n">resistance</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">gain</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Resistance and Gain cannot both be specified&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">resistance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">resistance</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&quot;shunt_resistance&quot;</span><span class="p">,</span> <span class="n">resistance</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&quot;gain&quot;</span><span class="p">,</span> <span class="n">gain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_scaling</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">gain</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;A&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config_channel_delay</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_sense</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">set_display_format_function</span><span class="p">(</span><span class="n">function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">float_data</span><span class="p">:</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">eng_string</span><span class="p">(</span><span class="n">float_data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;:3.6g&#39;</span><span class="p">,</span><span class="n">si</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;A&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span>
</div></div>
<span class="k">class</span> <span class="nc">agilent_34970a_20ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_20ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch</span><span class="p">):</span>
    <span class="k">pass</span>
<div class="viewcode-block" id="agilent_3497xa_40ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_40ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_40ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch_40ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Implement any methods specific to the 40-channel mux here.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">agilent_3497xa_20ch_40ch</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34908A&quot;</span></div>
<span class="k">class</span> <span class="nc">agilent_34970a_40ch</span><span class="p">(</span><span class="n">agilent_3497xa_40ch</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_40ch</span><span class="p">(</span><span class="n">agilent_3497xa_40ch</span><span class="p">):</span>
    <span class="k">pass</span>
<div class="viewcode-block" id="agilent_34970a_34908A_40ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34970a_34908A_40ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_34970a_34908A_40ch</span><span class="p">(</span><span class="n">agilent_3497xa_40ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extend base class to add module name to class name for compatibility.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="agilent_34972a_34908A_40ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34972a_34908A_40ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_34972a_34908A_40ch</span><span class="p">(</span><span class="n">agilent_3497xa_40ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extend base class to add module name to class name for compatibility.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="agilent_34970a_34901A_20ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34970a_34901A_20ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_34970a_34901A_20ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extend base class to add module name to class name for compatibility.&#39;&#39;&#39;</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="agilent_34972a_34901A_20ch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34972a_34901A_20ch">[docs]</a><span class="k">class</span> <span class="nc">agilent_34972a_34901A_20ch</span><span class="p">(</span><span class="n">agilent_3497xa_20ch</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Extend base class to add module name to class name for compatibility.&#39;&#39;&#39;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="agilent_3497xa_dacs"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dacs">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_dacs</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;control of the two dacs in the multifunction module&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span> <span class="n">bay</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Bay is numbered (1,2,3).  1 is the upper bay.  3 is the lower bay.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_3497xa_dacs&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bay</span> <span class="o">=</span> <span class="n">bay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34907A&quot;</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_dacs bay: {} @ {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_3497xa_dacs.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dacs.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named DAC channel to instrument.  num is 1-2, mapping to physical channel 4-5.&#39;&#39;&#39;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">channel_num</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">channel_num</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;ERROR invalid dac &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">channel_num</span><span class="p">)</span>
        <span class="n">channel_num</span> <span class="o">+=</span> <span class="mi">3</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel_num</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">voltage</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_voltage</span><span class="p">(</span><span class="n">internal_address</span><span class="p">,</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;DAC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bay_number</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="agilent_3497xa_dacs.write_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dacs.write_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named DAC to voltage.  Range is +/-12V with 16bit (366uV) resolution.&#39;&#39;&#39;</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;SOURCE:VOLT &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, (@&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">internal_address</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
</div></div>
<span class="k">class</span> <span class="nc">agilent_34970a_dacs</span><span class="p">(</span><span class="n">agilent_3497xa_dacs</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_dacs</span><span class="p">(</span><span class="n">agilent_3497xa_dacs</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="agilent_3497xa_actuator"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_actuator">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_actuator</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;agilent_a34970a_actuator 20 channel general purpose actuator plugin module</span>
<span class="sd">        each channel is a relay which can be toggled from open to closed.</span>
<span class="sd">        note that the physical open button on the unit switches the relay to the NC position.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">bay</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa is a interface_visa</span>
<span class="sd">            bay is 34970 plugin bay 1-3.  &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_3497xa_actuator&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bay</span> <span class="o">=</span> <span class="n">bay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34903A&quot;</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_actuator: {} @ {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">),</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_3497xa_actuator.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_actuator.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_num is 1-20&#39;&#39;&#39;</span>
        <span class="n">internal_address</span> <span class="o">=</span> <span class="n">channel_num</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="o">*</span><span class="mi">100</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">internal_address</span><span class="p">,</span><span class="n">state</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;actuator&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bay_number</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
    <span class="k">def</span> <span class="nf">_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:CLOSe (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ROUTe:OPEN (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">internal_address</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">internal_address</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;boolean True closes relay channel_name, boolean False opens relay channel_name&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close</span><span class="p">(</span><span class="n">internal_address</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">(</span><span class="n">internal_address</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">open_all_relays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c">#NB #CB fixed to use self.bay intead of hard coded base address = 200</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="o">*</span><span class="mi">100</span>
        <span class="k">for</span> <span class="n">internal_address</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="o">+</span><span class="mi">21</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">(</span><span class="n">internal_address</span><span class="p">)</span></div>
<span class="k">class</span> <span class="nc">agilent_34970a_actuator</span><span class="p">(</span><span class="n">agilent_3497xa_actuator</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_actuator</span><span class="p">(</span><span class="n">agilent_3497xa_actuator</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="agilent_3497xa_dig_out8"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dig_out8">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_dig_out8</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;agilent_a34970a_dig_out8 8 bit digital output of the 34907A plugin module</span>
<span class="sd">        each multifunction module has 2 8 bit digital ports or 1 16 bit port</span>
<span class="sd">        each 8 bit port may be input or output but not both.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa</span>
<span class="sd">            bay is 34970 plugin bay 1-3.  ch is digital bank 1-2.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_3497xa_dig_out8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bay</span> <span class="o">=</span> <span class="n">bay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34907A&quot;</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_digital bay: {} @ {} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">),</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span> <span class="o">=</span> <span class="n">ch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_address</span> <span class="o">=</span> <span class="n">bay</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">ch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defined_bit_mask</span> <span class="o">=</span> <span class="mi">0</span>
<div class="viewcode-block" id="agilent_3497xa_dig_out8.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dig_out8.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add channel by channel_name, shifted left by start bits and masked to size bits.</span>
<span class="sd">            ie to create a 3 bit digital channel on bits 1,2,3 add_channel(&quot;channel_name&quot;,1,3)&#39;&#39;&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">start</span>
        <span class="k">if</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined_bit_mask</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;{} {}: bit defined in multiple channels. Prev Mask: {}, Channel Mask: {} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">channel_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_defined_bit_mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_defined_bit_mask</span> <span class="o">|=</span> <span class="n">mask</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;{}: only 8 bits allowed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_bits</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;digital_output&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bay_number</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
    <span class="k">def</span> <span class="nf">_write_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write named channel to value.  Value is an integer which counts by &quot;1&quot;.</span>
<span class="sd">            The value is automatically truncated and shifted according to the location information</span>
<span class="sd">            provided to add_channel().  The remainder of the digital word not included in the channel remains unchanged.&#39;&#39;&#39;</span>
        <span class="c">#construct mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">|=</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SOURce:DIGital:DATA {},(@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_address</span><span class="p">))</span></div>
<span class="k">class</span> <span class="nc">agilent_34970a_dig_out8</span><span class="p">(</span><span class="n">agilent_3497xa_dig_out8</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_dig_out8</span><span class="p">(</span><span class="n">agilent_3497xa_dig_out8</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="agilent_3497xa_dig_in8"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dig_in8">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_dig_in8</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;agilent_a34970a_dig_in8  8 bit digital input of the 34907A plugin module</span>
<span class="sd">        each multifunction module has 2 8 bit digital ports or 1 16 bit port</span>
<span class="sd">        each 8 bit port may be input or output but not both&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa</span>
<span class="sd">            bay is 34970 plugin bay 1-3.  ch is digital bank 1-2.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_3497xa_dig_in8&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bay</span> <span class="o">=</span> <span class="n">bay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_type</span> <span class="o">=</span> <span class="s">&quot;34907A&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span> <span class="o">=</span> <span class="n">ch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span>
        <span class="n">a3497xa_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;34970a_digital bay: {},{} @ {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">),</span> <span class="n">automatic_monitor</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CONFigure:DIGital:BYTE (@{})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_address</span><span class="p">))</span>
<div class="viewcode-block" id="agilent_3497xa_dig_in8.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_dig_in8.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add channel by name, shifted left by start bits and masked to size bits.</span>
<span class="sd">            ie to create a 3 bit digital channel on bits 1,2,3 add_channel(&quot;channel_name&quot;,1,3)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="o">+</span><span class="n">size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;{}: only 8 bits allowed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="n">conversion_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_bits</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_apply_function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_address</span><span class="p">,</span> <span class="n">conversion_function</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="n">read_function</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;34970_type&#39;</span><span class="p">,</span><span class="s">&#39;digital_input&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_bay_number</span><span class="p">(</span><span class="n">new_channel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bay</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
    <span class="k">def</span> <span class="nf">_read_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the measured value for the named channel.  Value is shifted right to count by &quot;1&quot; independent of</span>
<span class="sd">            the actual location of the channel within the physical byte.&#39;&#39;&#39;</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">start</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">start</span> <span class="c">#data string from instrument is f.p. (ex &#39;+2.55E+02&#39;)</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<span class="k">class</span> <span class="nc">agilent_34970a_dig_in8</span><span class="p">(</span><span class="n">agilent_3497xa_dig_in8</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_dig_in8</span><span class="p">(</span><span class="n">agilent_3497xa_dig_in8</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="agilent_3497xa_totalizer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3497xa_totalizer">[docs]</a><span class="k">class</span> <span class="nc">agilent_3497xa_totalizer</span><span class="p">(</span><span class="n">a3497xa_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Implement this if you need it</span>
<span class="sd">        26-bit totalizer on physical channel s03 of the 34907A plugin module&#39;&#39;&#39;</span>
        <span class="c">#self.plugin_type = &quot;34907A&quot;</span>
    <span class="k">pass</span></div>
<span class="k">class</span> <span class="nc">agilent_34970a_totalizer</span><span class="p">(</span><span class="n">agilent_3497xa_totalizer</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_34972a_totalizer</span><span class="p">(</span><span class="n">agilent_3497xa_totalizer</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="agilent_n3301"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_n3301">[docs]</a><span class="k">class</span> <span class="nc">agilent_n3301</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Agilent N3301 Electronic Load with two channels</span>
<span class="sd">        This is a minimal class to interface with an Agilent N3301 electronic load.</span>
<span class="sd">        Only immediate constant current mode is supported, which means you can only control</span>
<span class="sd">        setting a constant current load and the new setpoint takes effect right away.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Constructor takes visa GPIB address or interface object (visa,rl1009, rs232) as parameter.  Ex: &quot;GPIB0::3&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_n3301&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;n3300: @ {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="c">#Reset the instrument to put it in a known state, turn</span>
        <span class="c">#ON all the loads, and set them to zero.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reset the instrument to quickly set all loads</span>
<span class="sd">            to zero.  (Draw no power)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<div class="viewcode-block" id="agilent_n3301.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_n3301.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span> <span class="n">add_sense_channel</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add current force writable channel. Optionally add current readback _isense channel&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_sense_channel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">,</span><span class="n">channel_num</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">current</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">(</span><span class="n">channel_num</span><span class="p">,</span><span class="n">current</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">(</span><span class="n">channel_num</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_num</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTRUMENT {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_num</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURRENT {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTRUMENT {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_num</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;MEASURE:CURRENT?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="agilent_e36xxa"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e36xxa">[docs]</a><span class="k">class</span> <span class="nc">agilent_e36xxa</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generic base class for Agilent programmable DC power supply&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">voltage</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_voltage</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_write_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">voltage_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">current_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">current</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_current</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">current</span><span class="p">))</span>
        <span class="n">current_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_default_write_delay</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">current_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">vsense_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_vsense</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">vsense_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="n">isense_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_isense</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">isense_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTrument:SELect &quot;</span> <span class="o">+</span> <span class="n">num</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTrument:SELect &quot;</span> <span class="o">+</span> <span class="n">num</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURRent &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_e36xxa.read_vsense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e36xxa.read_vsense">[docs]</a>    <span class="k">def</span> <span class="nf">read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Query the instrument and return float representing actual measured terminal voltage.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># Clear out instrument&#39;s input buffer</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INSTrument:SELect &quot;</span> <span class="o">+</span> <span class="n">num</span> <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:MEASure:VOLTage?&quot;</span><span class="p">))</span></div>
<div class="viewcode-block" id="agilent_e36xxa.read_isense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e36xxa.read_isense">[docs]</a>    <span class="k">def</span> <span class="nf">read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Query the instrument and return float representing actual measured terminal current.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># Clear out instrument&#39;s input buffer</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INSTrument:SELect &quot;</span> <span class="o">+</span> <span class="n">num</span> <span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:MEASure:CURRent?&quot;</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">set_ilim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">ilim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;removed, write to the appropriate channel instead&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">enable_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># Clear out instrument&#39;s input buffer</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:OUTput:STATe ON&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:OUTput:STATe OFF&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">output_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;OUTput:STATe?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_remote_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">remote</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Required for RS-232 control.  Not allowed for GPIB control&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># Clear out instrument&#39;s input buffer</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:SYSTem:REMote&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:SYSTem:LOCal&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="agilent_e3631a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e3631a">[docs]</a><span class="k">class</span> <span class="nc">agilent_e3631a</span><span class="p">(</span><span class="n">agilent_e36xxa</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Triple-channel programmable DC power supply&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_e3631a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(),</span> <span class="n">lab_interfaces</span><span class="o">.</span><span class="n">interface_visa_serial</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_remote_mode</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_write_delay</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span> <span class="c"># track function was being left enabled in some cases</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="c">#initialize to instrument on, all voltages 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;APPLy P6V,  0.0, 0.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;APPLy P25V, 0.0, 0.0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;APPLy N25V, 0.0, 0.0&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_output</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_e3631a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e3631a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">ilim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">add_sense_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Register a named channel with the instrument.</span>
<span class="sd">            channel_name is a user-supplied string</span>
<span class="sd">            num is &quot;P6V&quot;, &quot;P25V&quot;, &quot;N25V&quot;, P50V has been removed, refer to virtual instrument </span>
<span class="sd">            optionally add _isense and _vsense readback channels&#39;&#39;&#39;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;P6V&#39;</span><span class="p">,</span><span class="s">&#39;P25V&#39;</span><span class="p">,</span><span class="s">&#39;N25V&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid channel number &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">v_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span><span class="n">ilim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_sense_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v_chan</span>
</div></div>
<div class="viewcode-block" id="agilent_e364xa"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e364xa">[docs]</a><span class="k">class</span> <span class="nc">agilent_e364xa</span><span class="p">(</span><span class="n">agilent_e36xxa</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dual-channel programmable DC power supply&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">resetoutputs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_e3648a&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(),</span> <span class="n">lab_interfaces</span><span class="o">.</span><span class="n">interface_visa_serial</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_remote_mode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_write_delay</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c">#initialize to instrument on, all voltages 0</span>
        <span class="k">if</span> <span class="n">resetoutputs</span><span class="p">:</span> <span class="c">#NB, original scpi was incorrect format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTrument:SELect OUT1&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;APPLy 0.0, 0.0&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTrument:SELect OUT2&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;APPLy 0.0, 0.0&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_output</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_e364xa.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e364xa.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">ilim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Register a named channel with the instrument.</span>
<span class="sd">            channel_name is a user-supplied string</span>
<span class="sd">            num must be either &quot;OUT1&quot; or &quot;OUT2&quot;</span>
<span class="sd">            optionally add _ilim, _isense and _vsense channels&#39;&#39;&#39;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;OUT1&#39;</span><span class="p">,</span><span class="s">&#39;OUT2&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid channel number &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span><span class="n">ilim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_current</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">ilim</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">set_ovp_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">,</span><span class="n">num</span><span class="p">):</span> <span class="c">#NB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_output</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;VOLT:PROT {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;VOLT:PROT:STAT ON&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">select_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span> <span class="c">#NB</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;OUT1&#39;</span><span class="p">,</span><span class="s">&#39;OUT2&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Invalid channel number &quot;{}&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;INSTrument:SELect {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span></div>
<span class="k">class</span> <span class="nc">agilent_e3648a</span><span class="p">(</span><span class="n">agilent_e364xa</span><span class="p">):</span> <span class="c">#NB</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">agilent_e3649a</span><span class="p">(</span><span class="n">agilent_e364xa</span><span class="p">):</span> <span class="c">#NB</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="agilent_34401a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a">[docs]</a><span class="k">class</span> <span class="nc">agilent_34401a</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel agilent_34401a meter</span>
<span class="sd">        defaults to dc voltage, note this instrument currently does not support using multiple measurement types at the same time&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_34401a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;a34401 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">(),</span> <span class="n">lab_interfaces</span><span class="o">.</span><span class="n">interface_visa_serial</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_remote_mode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dc_voltage</span><span class="p">()</span>
<div class="viewcode-block" id="agilent_34401a.config_dc_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.config_dc_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="n">BW</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure DC volts.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [.02,.2,1,10,100] and set range to [0.1, 1, 10, 100, 1000]&#39;&#39;&#39;</span>
        <span class="c">#DJS Todo: Move this stuff to channel wrappers like 34970</span>
        <span class="k">if</span> <span class="n">NPLC</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error: Not a valid NPLC setting, valid settings are 0.02, 0.2, 1, 10, 100&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">BW</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error: Not a valid BW setting, valid settings are 3, 20, 200&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNCtion </span><span class="se">\&quot;</span><span class="s">VOLT:DC</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="c">#range is optional string value that is the manual range the meter should operate in.</span>
        <span class="c">#valid values are in volts: [0.01, 0.1, 1, 3]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:VOLTage:DC &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage:DC:NPLC &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:DETector:BANDwidth &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BW</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut:IMPedance:AUTO ON&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_34401a.config_dc_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.config_dc_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">BW</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for DC current measurement</span>
<span class="sd">            NPLC is an optional number of integration powerline cycles</span>
<span class="sd">                Valid values are: [.02,.2,1,10,100]</span>
<span class="sd">            range is optional string value that is the manual range the meter should operate in.</span>
<span class="sd">                Valid values are in amps: [0.01, 0.1, 1, 3]&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">NPLC</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">.</span><span class="mo">02</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error: Not a valid NPLC setting, valid settings are 0.02, 0.2, 1, 10, 100&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNCtion </span><span class="se">\&quot;</span><span class="s">CURRent:DC</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CONFigure:CURRent:DC &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURRent:DC:NPLC &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:DETector:BANDwidth &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">BW</span><span class="p">))</span></div>
<div class="viewcode-block" id="agilent_34401a.config_ac_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.config_ac_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC voltage measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut:IMPedance:AUTO ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNCtion </span><span class="se">\&quot;</span><span class="s">VOLT:AC</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_34401a.config_ac_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.config_ac_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC current measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNCtion </span><span class="se">\&quot;</span><span class="s">CURRent:AC</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_34401a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument without configuring measurement type.&#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_meter</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_34401a.read_meter"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34401a.read_meter">[docs]</a>    <span class="k">def</span> <span class="nf">read_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing meter measurement.  Units are V,A,Ohm, etc depending on meter configuration.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;READ?&quot;</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">_set_remote_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">remote</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Required for RS-232 control.  Not allowed for GPIB control&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">remote</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SYSTem:REMote&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SYSTem:LOCal&quot;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="agilent_34461A"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_34461A">[docs]</a><span class="k">class</span> <span class="nc">agilent_34461A</span><span class="p">(</span><span class="n">agilent_34401a</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;LXI, histogram, Truevolt 34401 modernized replacement 6.5 digit DMM&#39;&#39;&#39;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="agilent_e53181a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a">[docs]</a><span class="k">class</span> <span class="nc">agilent_e53181a</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Agilent e53181a frequency counter</span>
<span class="sd">        single channel, only uses channel 1 (front)</span>
<span class="sd">        you may need to set an expected value for autotriggering</span>
<span class="sd">        not recommended below 20hz</span>
<span class="sd">        defaults to 1Meg input R, 10x attenuation&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_e53181a&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;agilent_e53181a @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_expect</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*CLS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_input_attenuation_1x</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_input_impedance_1Meg</span><span class="p">()</span>
<div class="viewcode-block" id="agilent_e53181a.config_input_attenuation_1x"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.config_input_attenuation_1x">[docs]</a>    <span class="k">def</span> <span class="nf">config_input_attenuation_1x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set input attenuator to 1x&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INPut1:ATTenuation 1&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.config_input_attenuation_10x"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.config_input_attenuation_10x">[docs]</a>    <span class="k">def</span> <span class="nf">config_input_attenuation_10x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set input attenuator to 10x (divide by 10)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INPut1:ATTenuation 10&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.config_input_impedance_50"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.config_input_impedance_50">[docs]</a>    <span class="k">def</span> <span class="nf">config_input_impedance_50</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set input impedance to 50 Ohm&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INPut1:IMPedance 50&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.config_input_impedance_1Meg"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.config_input_impedance_1Meg">[docs]</a>    <span class="k">def</span> <span class="nf">config_input_impedance_1Meg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set input impedance to 1 MegOhm&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:INPut1:IMPedance 1e6&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.config_expect"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.config_expect">[docs]</a>    <span class="k">def</span> <span class="nf">config_expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">expected_frequency</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;specify expected frequency to help with counting very low frequencies.&#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">expected_frequency</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expect</span> <span class="o">=</span> <span class="n">expected_frequency</span></div>
<div class="viewcode-block" id="agilent_e53181a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channels to instrument.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_dutycycle</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_dutycycle&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_freq</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.add_channel_freq"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.add_channel_freq">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named frequency channel to instrument&#39;&#39;&#39;</span>
        <span class="n">freq_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_frequency</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">freq_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.add_channel_dutycycle"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.add_channel_dutycycle">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_dutycycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named dutycycle channel to instrument&#39;&#39;&#39;</span>
        <span class="n">dutycycle_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_dutycycle</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">dutycycle_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_e53181a.read_frequency"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.read_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">read_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing measured frequency of named channel.&#39;&#39;&#39;</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;:MEASure:FREQuency? </span><span class="si">%3.0f</span><span class="s">, 1, (@1)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">expect</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">txt</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Waiting on frequency meter&quot;</span>
                <span class="k">print</span> <span class="n">e</span></div>
<div class="viewcode-block" id="agilent_e53181a.read_dutycycle"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e53181a.read_dutycycle">[docs]</a>    <span class="k">def</span> <span class="nf">read_dutycycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing measured duty cycle of named channel.&#39;&#39;&#39;</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;:MEASure:DCYCle? </span><span class="si">%3.0f</span><span class="s">, 1, (@1)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">expect</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="n">txt</span><span class="p">))</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Waiting on frequency meter&quot;</span>
                <span class="k">print</span> <span class="n">e</span>
</div></div>
<div class="viewcode-block" id="bus_pirate_gpio"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bus_pirate_gpio">[docs]</a><span class="k">class</span> <span class="nc">bus_pirate_gpio</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;bus pirate board as a gpio driver, uses binary mode to control and read up to 5 bits.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_raw_serial</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;creates a bus_pirate_gpio object, serial_port can be a pyserial object or a string&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;bus_pirate_gpio&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;BUS PIRATE {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_raw_serial</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span> <span class="o">=</span> <span class="n">interface_raw_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_bus_pirate_binary</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_enable_mask</span> <span class="o">=</span> <span class="mb">0b00011111</span> <span class="c"># start as inputs, inputs are 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pin_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;AUX&quot;</span><span class="p">,</span><span class="s">&quot;MISO&quot;</span><span class="p">,</span><span class="s">&quot;CS&quot;</span><span class="p">,</span><span class="s">&quot;MOSI&quot;</span><span class="p">,</span><span class="s">&quot;CLK&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pin_mask</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;AUX&quot;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s">&quot;MOSI&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s">&quot;CLK&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s">&quot;MISO&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s">&quot;CS&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
    <span class="k">def</span> <span class="nf">_config_bus_pirate_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span> <span class="c">#exit any menus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="c">#reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="c">#get into binary mode</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">resp</span> <span class="o">!=</span> <span class="s">&#39;BBIO1&#39;</span><span class="p">):</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Buspirate failed to enter binary mode after 20 attempts&#39;</span><span class="p">)</span>
            <span class="c">#print &#39;Buspirate entering binary mode attempt {}: &#39;.format(tries),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span><span class="p">)</span> <span class="c">#enter binary mode</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">_bus_pirate_set_as_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin_names</span><span class="p">):</span>
        <span class="c">#both writes and reads, its how the bus pirate works</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">pin_name</span> <span class="ow">in</span> <span class="n">pin_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_enable_mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_mask</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
        <span class="n">byte</span> <span class="o">=</span>  <span class="nb">chr</span><span class="p">(</span><span class="mh">0x40</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_enable_mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="c"># write bits</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">read_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">read_data</span>
    <span class="k">def</span> <span class="nf">_bus_pirate_get_pin_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bus_pirate_set_as_outputs</span><span class="p">([]))</span>
    <span class="k">def</span> <span class="nf">_bus_pirate_write_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">byte</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xC0</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="p">)</span>
        <span class="n">byte</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xE0</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="c"># write bits</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="c">#print bin(ord(resp))</span>
    <span class="k">def</span> <span class="nf">_get_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_mask</span><span class="p">[</span><span class="n">pin_name</span><span class="p">]</span>
<div class="viewcode-block" id="bus_pirate_gpio.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bus_pirate_gpio.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">pin_names</span><span class="p">,</span><span class="n">output</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add channel by channel_name,</span>
<span class="sd">            ie to create a 3 bit digital output channel on pins CLK,MISO,MOSI add_channel(&quot;channel_name&quot;,[&quot;CLK&quot;,MISO&quot;,MOSI&quot;],output=1)</span>
<span class="sd">            as always the FIRST pin is the MSB&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pin_names</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">):</span>
            <span class="n">pin_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin_names</span><span class="p">]</span> <span class="c">#convert to a list if a string was given</span>
        <span class="n">pin_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pin_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">pin_name</span> <span class="ow">in</span> <span class="n">pin_names</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pin_name</span> <span class="ow">in</span> <span class="n">pin_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pin_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;{}: not a valid pin name&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_pins</span><span class="p">(</span><span class="n">pin_names</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bus_pirate_set_as_outputs</span><span class="p">(</span><span class="n">pin_names</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pins</span><span class="p">(</span><span class="n">pin_names</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_write_pins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin_names</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write named channel to value.  Value is an integer which counts by &quot;1&quot;.</span>
<span class="sd">            The value is automatically truncated and shifted according to the location information</span>
<span class="sd">            provided to add_channel().  The remainder of the digital word not included in the channel remains unchanged.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pin_names</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Buspirate {}: value {} too large&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin_names</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">pin_name</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">pin_names</span><span class="p">):</span>
            <span class="n">pin_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mask</span><span class="p">(</span><span class="n">pin_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span> <span class="o">|=</span> <span class="n">pin_mask</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">output_data</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">pin_mask</span>
            <span class="n">value</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bus_pirate_write_outputs</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_read_pins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin_names</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the forcing value for the named channel.&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">pin_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bus_pirate_get_pin_state</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pin_name</span> <span class="ow">in</span> <span class="n">pin_names</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">pin_data</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pin_mask</span><span class="p">[</span><span class="n">pin_name</span><span class="p">]:</span>
                <span class="n">data</span> <span class="o">|=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="bk8500"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500">[docs]</a><span class="k">class</span> <span class="nc">bk8500</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The below license only applies to most of the code in the bk8500 instrument:</span>

<span class="sd">    Provides the interface to a 26 byte instrument along with utility</span>
<span class="sd">    functions.  This is based on provided drivers, minor style changes</span>
<span class="sd">    were made and lab.py fucntions were added.  The original license and</span>
<span class="sd">    documentation are included below.</span>

<span class="sd">    Open Source Initiative OSI - The MIT License:Licensing</span>
<span class="sd">    Tue, 2006-10-31 04:56 - nelson</span>

<span class="sd">    The MIT License</span>

<span class="sd">    Copyright (c) 2009 BK Precision</span>

<span class="sd">    Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="sd">    of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="sd">    in the Software without restriction, including without limitation the rights</span>
<span class="sd">    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="sd">    copies of the Software, and to permit persons to whom the Software is</span>
<span class="sd">    furnished to do so, subject to the following conditions:</span>

<span class="sd">    The above copyright notice and this permission notice shall be included in</span>
<span class="sd">    all copies or substantial portions of the Software.</span>

<span class="sd">    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="sd">    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="sd">    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="sd">    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="sd">    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="sd">    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="sd">    THE SOFTWARE.</span>


<span class="sd">    This python module provides a functional interface to a B&amp;K DC load</span>
<span class="sd">    through the DCLoad object.  This object can also be used as a COM</span>
<span class="sd">    server by running this module as a script to register it.  All the</span>
<span class="sd">    DCLoad object methods return strings.  All units into and out of the</span>
<span class="sd">    DCLoad object&#39;s methods are in SI units.</span>

<span class="sd">    See the documentation file that came with this script.</span>

<span class="sd">    $RCSfile: dcload.py $</span>
<span class="sd">    $Revision: 1.0 $</span>
<span class="sd">    $Date: 2008/05/17 15:57:15 $</span>
<span class="sd">    $Author:  Don Peterson $</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_raw_serial</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;bk8500&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;BK8500 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_raw_serial</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="n">interface_raw_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_constants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteControl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteSense</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;Off&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nl</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="c">#debug output?</span>
    <span class="k">def</span> <span class="nf">_set_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#most of this is from the manufacturer&#39;s class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># Set to 1 to see dumps of commands and responses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">=</span> <span class="mi">26</span>  <span class="c"># Number of bytes in a packet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span> <span class="o">=</span> <span class="mf">1e4</span>  <span class="c"># Convert current in A to 0.1 mA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span> <span class="o">=</span> <span class="mf">1e3</span>  <span class="c"># Convert voltage in V to mV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span>   <span class="o">=</span> <span class="mf">1e3</span>  <span class="c"># Convert power in W to mW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span> <span class="o">=</span> <span class="mf">1e3</span>  <span class="c"># Convert resistance in ohm to mohm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_ms</span> <span class="o">=</span> <span class="mi">1000</span>           <span class="c"># Converts seconds to ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="c"># Number of settings storage registers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lowest_register</span>  <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highest_register</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="c"># Values for setting modes of CC, CV, CW, or CR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;cc&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;cv&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;cw&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;cr&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span>
<div class="viewcode-block" id="bk8500.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sortcut function adds CC force channel.</span>
<span class="sd">        if add_extended_channels, additionally add _isense,_vsense,_psense,_mode readback channels</span>
<span class="sd">        Add CV,CW,CR,remote_sense channels separately if you need them.&#39;&#39;&#39;</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&#39;_isense&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&#39;_vsense&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_psense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&#39;_psense&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_mode</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&#39;_mode&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ch</span></div>
<div class="viewcode-block" id="bk8500.add_channel_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_current">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single CC forcing channel and force zero current&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_SetCCCurrent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># self.TurnLoadOn() Is now handled in self._SetCCCurrent</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="bk8500.add_channel_isense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_isense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single current readback channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_vsense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_vsense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single voltage readback channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_psense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_psense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_psense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read back computed power dissipated in load&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_psense</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_mode"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_mode">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read back operating mode (Off, Constant Current, Constant Voltage, Constant Power, Constant Resistance)&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return measured voltage float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputValues</span><span class="p">()[</span><span class="s">&#39;voltage&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return measured current float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputValues</span><span class="p">()[</span><span class="s">&#39;current&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_read_psense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return measured power float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetInputValues</span><span class="p">()[</span><span class="s">&#39;power&#39;</span><span class="p">]</span>
<div class="viewcode-block" id="bk8500.add_channel_remote_sense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_remote_sense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_remote_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Enable/disable remote voltage sense through rear panel connectors&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteSense</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single CV forcing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_SetCVVoltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_power"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_power">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single CW forcing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_SetCWPower</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.add_channel_resistance"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.add_channel_resistance">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_resistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add single CR forcing channel&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_SetCRResistance</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_SetCCCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMode</span><span class="p">(</span><span class="s">&quot;cc&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;Constant Current&#39;</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOff</span><span class="p">()</span> <span class="c"># Don&#39;t trust setting of 0 to not drop out load.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteControl</span><span class="p">()</span> <span class="c">#just in case somebody pushed front panel &quot;Local&quot; button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOn</span><span class="p">()</span> <span class="c"># Because it could be off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCCCurrent</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_SetCVVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMode</span><span class="p">(</span><span class="s">&quot;cv&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;Constant Voltage&#39;</span>
        <span class="k">if</span> <span class="n">voltage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOff</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteControl</span><span class="p">()</span> <span class="c">#just in case somebody pushed front panel &quot;Local&quot; button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOn</span><span class="p">()</span> <span class="c"># Because it could be off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCVVoltage</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_SetCWPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMode</span><span class="p">(</span><span class="s">&quot;cw&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;Constant Power&#39;</span>
        <span class="k">if</span> <span class="n">power</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOff</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteControl</span><span class="p">()</span> <span class="c">#just in case somebody pushed front panel &quot;Local&quot; button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOn</span><span class="p">()</span> <span class="c"># Because it could be off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCWPower</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_SetCRResistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resistance</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMode</span><span class="p">(</span><span class="s">&quot;cr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;Constant Resistance&#39;</span>
        <span class="k">if</span> <span class="n">resistance</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOff</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetRemoteControl</span><span class="p">()</span> <span class="c">#just in case somebody pushed front panel &quot;Local&quot; button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TurnLoadOn</span><span class="p">()</span> <span class="c"># Because it could be off</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCRResistance</span><span class="p">(</span><span class="n">resistance</span><span class="p">)</span>

    <span class="c"># below is mostly code from manufacturer</span>
<div class="viewcode-block" id="bk8500.DumpCommand"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.DumpCommand">[docs]</a>    <span class="k">def</span> <span class="nf">DumpCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print out the contents of a 26 byte command.  Example:</span>
<span class="sd">            aa .. 20 01 ..   .. .. .. .. ..</span>
<span class="sd">            .. .. .. .. ..   .. .. .. .. ..</span>
<span class="sd">            .. .. .. .. ..   cb</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%02x</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="nb">bytes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&quot;00&quot;</span><span class="p">:</span>
                <span class="c"># Use the decimal point character if you see an</span>
                <span class="c"># unattractive printout on your machine.</span>
                <span class="c">#s = &quot;.&quot;*2</span>
                <span class="c"># The following alternate character looks nicer</span>
                <span class="c"># in a console window on Windows.</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.CommandProperlyFormed"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.CommandProperlyFormed">[docs]</a>    <span class="k">def</span> <span class="nf">CommandProperlyFormed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return 1 if a command is properly formed; otherwise, return 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">commands</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span>
            <span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span>
            <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">,</span>
            <span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span>
            <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x4A</span><span class="p">,</span> <span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x4D</span><span class="p">,</span> <span class="mh">0x4E</span><span class="p">,</span> <span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span>
            <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x5A</span><span class="p">,</span> <span class="mh">0x5B</span><span class="p">,</span>
            <span class="mh">0x5C</span><span class="p">,</span> <span class="mh">0x5D</span><span class="p">,</span> <span class="mh">0x5E</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span>
            <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x6A</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x12</span>
        <span class="p">)</span>
        <span class="c"># Must be proper length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot;Command length = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;-- should be &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c"># First character must be 0xaa</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mh">0xaa</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot;First byte should be 0xaa&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c"># Second character (address) must not be 0xff</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot;Second byte cannot be 0xff&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c"># Third character must be valid command</span>
        <span class="n">byte3</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%02X</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot;Third byte not a valid command:  </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">byte3</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="c"># Calculate checksum and validate it</span>
        <span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checksum</span> <span class="o">!=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="s">&quot;Incorrect checksum&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span></div>
<div class="viewcode-block" id="bk8500.CalculateChecksum"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.CalculateChecksum">[docs]</a>    <span class="k">def</span> <span class="nf">CalculateChecksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the sum of the bytes in cmd modulo 256.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">))</span>
        <span class="n">checksum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">checksum</span> <span class="o">+=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">checksum</span> <span class="o">%=</span> <span class="mi">256</span>
        <span class="k">return</span> <span class="n">checksum</span></div>
    <span class="k">def</span> <span class="nf">StartCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xaa</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span>
<div class="viewcode-block" id="bk8500.SendCommand"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SendCommand">[docs]</a>    <span class="k">def</span> <span class="nf">SendCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sends the command to the serial stream and returns the 26 byte</span>
<span class="sd">        response.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;BK8500 bombed because these don&#39;t match:&quot;</span>
            <span class="k">print</span> <span class="s">&quot;command: &quot;</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;0x&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">byte</span><span class="p">)),</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">response: &quot;</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;0x&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">byte</span><span class="p">)),</span>
            <span class="k">print</span>
            <span class="k">print</span>
            <span class="k">print</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>
<div class="viewcode-block" id="bk8500.ResponseStatus"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.ResponseStatus">[docs]</a>    <span class="k">def</span> <span class="nf">ResponseStatus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a message string about what the response meant.  The</span>
<span class="sd">        empty string means the response was OK.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mh">0x90</span> <span class="p">:</span> <span class="s">&quot;Wrong checksum&quot;</span><span class="p">,</span>
            <span class="mh">0xA0</span> <span class="p">:</span> <span class="s">&quot;Incorrect parameter value&quot;</span><span class="p">,</span>
            <span class="mh">0xB0</span> <span class="p">:</span> <span class="s">&quot;Command cannot be carried out&quot;</span><span class="p">,</span>
            <span class="mh">0xC0</span> <span class="p">:</span> <span class="s">&quot;Invalid command&quot;</span><span class="p">,</span>
            <span class="mh">0x80</span> <span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">responses</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span></div>
<div class="viewcode-block" id="bk8500.CodeInteger"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.CodeInteger">[docs]</a>    <span class="k">def</span> <span class="nf">CodeInteger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a little endian string for the indicated value.  Two</span>
<span class="sd">        and 4 byte integers are the only ones allowed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="c"># Make sure it&#39;s an integer</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_bytes</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span></div>
<div class="viewcode-block" id="bk8500.DecodeInteger"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.DecodeInteger">[docs]</a>    <span class="k">def</span> <span class="nf">DecodeInteger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct an integer from the little endian string. 1, 2, and 4 byte</span>
<span class="sd">        strings are the only ones allowed.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">n</span>  <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
                <span class="n">n</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span></div>
<div class="viewcode-block" id="bk8500.GetReserved"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetReserved">[docs]</a>    <span class="k">def</span> <span class="nf">GetReserved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_used</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a string of nul characters of such length to pad a</span>
<span class="sd">        command to one less than the packet size (leaves room for the</span>
<span class="sd">        checksum byte.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">-</span> <span class="n">num_used</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">num</span></div>
<div class="viewcode-block" id="bk8500.PrintCommandAndResponse"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.PrintCommandAndResponse">[docs]</a>    <span class="k">def</span> <span class="nf">PrintCommandAndResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">cmd_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print the command and its response if debugging is on.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">cmd_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">cmd_name</span> <span class="o">+</span> <span class="s">&quot; command:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DumpCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="p">(</span><span class="n">cmd_name</span> <span class="o">+</span> <span class="s">&quot; response:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">DumpCommand</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetCommand"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetCommand">[docs]</a>    <span class="k">def</span> <span class="nf">GetCommand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct the command with an integer value of 0, 1, 2, or</span>
<span class="sd">        4 bytes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_bytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">num_bytes</span> <span class="o">+</span> <span class="mi">3</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="n">num_bytes</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cmd</span></div>
<div class="viewcode-block" id="bk8500.GetData"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetData">[docs]</a>    <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Extract the little endian integer from the data and return it.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Bad number of bytes:  </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">num_bytes</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">Reserved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_used</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">num_used</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">num_used</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length_packet</span> <span class="o">-</span> <span class="n">num_used</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<div class="viewcode-block" id="bk8500.SendIntegerToLoad"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SendIntegerToLoad">[docs]</a>    <span class="k">def</span> <span class="nf">SendIntegerToLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Send the indicated command along with value encoded as an integer</span>
<span class="sd">        of the specified size.  Return the instrument&#39;s response status.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCommand</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">num_bytes</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResponseStatus</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetIntegerFromLoad"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetIntegerFromLoad">[docs]</a>    <span class="k">def</span> <span class="nf">GetIntegerFromLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd_byte</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Construct a command from the byte in cmd_byte, send it, get</span>
<span class="sd">        the response, then decode the response into an integer with the</span>
<span class="sd">        number of bytes in num_bytes.  msg is the debugging string for</span>
<span class="sd">        the printout.  Return the integer.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">num_bytes</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="n">cmd_byte</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span> <span class="o">+</span> <span class="n">num_bytes</span><span class="p">])</span></div>
<div class="viewcode-block" id="bk8500.TurnLoadOn"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.TurnLoadOn">[docs]</a>    <span class="k">def</span> <span class="nf">TurnLoadOn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Turns the load on&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Turn load on&quot;</span>
        <span class="n">on</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.TurnLoadOff"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.TurnLoadOff">[docs]</a>    <span class="k">def</span> <span class="nf">TurnLoadOff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Turns the load off&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Turn load off&quot;</span>
        <span class="n">off</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetRemoteControl"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetRemoteControl">[docs]</a>    <span class="k">def</span> <span class="nf">SetRemoteControl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Sets the load to remote control&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set remote control&quot;</span>
        <span class="n">remote</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetLocalControl"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetLocalControl">[docs]</a>    <span class="k">def</span> <span class="nf">SetLocalControl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Sets the load to local control&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set local control&quot;</span>
        <span class="n">local</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">local</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetMaxCurrent"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetMaxCurrent">[docs]</a>    <span class="k">def</span> <span class="nf">SetMaxCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="s">&quot;Sets the maximum current the load will sink&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set max current&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">current</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetMaxCurrent"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetMaxCurrent">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaxCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Returns the maximum current the load will sink&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set max current&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetMaxVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetMaxVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">SetMaxVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="s">&quot;Sets the maximum voltage the load will allow&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set max voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">voltage</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetMaxVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetMaxVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaxVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the maximum voltage the load will allow&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get max voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetMaxPower"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetMaxPower">[docs]</a>    <span class="k">def</span> <span class="nf">SetMaxPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="s">&quot;Sets the maximum power the load will allow&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set max power&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">power</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetMaxPower"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetMaxPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetMaxPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the maximum power the load will allow&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get max power&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x27</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetMode"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetMode">[docs]</a>    <span class="k">def</span> <span class="nf">SetMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="s">&quot;Sets the mode (constant current, constant voltage, etc.&quot;</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Unknown mode&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set mode&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x28</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()],</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetMode"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetMode">[docs]</a>    <span class="k">def</span> <span class="nf">GetMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the mode (constant current, constant voltage, etc.&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get mode&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">modes_inv</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s">&quot;cv&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s">&quot;cw&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s">&quot;cr&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">modes_inv</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span></div>
<div class="viewcode-block" id="bk8500.SetCCCurrent"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetCCCurrent">[docs]</a>    <span class="k">def</span> <span class="nf">SetCCCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="s">&quot;Sets the constant current mode&#39;s current level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set CC current&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x2A</span><span class="p">,</span> <span class="n">current</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetCCCurrent"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetCCCurrent">[docs]</a>    <span class="k">def</span> <span class="nf">GetCCCurrent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the constant current mode&#39;s current level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get CC current&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x2B</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetCVVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetCVVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">SetCVVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="s">&quot;Sets the constant voltage mode&#39;s voltage level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set CV voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x2C</span><span class="p">,</span> <span class="n">voltage</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetCVVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetCVVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">GetCVVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the constant voltage mode&#39;s voltage level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get CV voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x2D</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetCWPower"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetCWPower">[docs]</a>    <span class="k">def</span> <span class="nf">SetCWPower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">):</span>
        <span class="s">&quot;Sets the constant power mode&#39;s power level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set CW power&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x2E</span><span class="p">,</span> <span class="n">power</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetCWPower"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetCWPower">[docs]</a>    <span class="k">def</span> <span class="nf">GetCWPower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the constant power mode&#39;s power level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get CW power&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x2F</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetCRResistance"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetCRResistance">[docs]</a>    <span class="k">def</span> <span class="nf">SetCRResistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resistance</span><span class="p">):</span>
        <span class="s">&quot;Sets the constant resistance mode&#39;s resistance level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set CR resistance&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x30</span><span class="p">,</span> <span class="n">resistance</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetCRResistance"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetCRResistance">[docs]</a>    <span class="k">def</span> <span class="nf">GetCRResistance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the constant resistance mode&#39;s resistance level&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get CR resistance&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x31</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetTransient"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetTransient">[docs]</a>    <span class="k">def</span> <span class="nf">SetTransient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">A_time_s</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">B_time_s</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">&quot;continuous&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets up the transient operation mode.  mode is one of</span>
<span class="sd">        &quot;CC&quot;, &quot;CV&quot;, &quot;CW&quot;, or &quot;CR&quot;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Unknown mode&quot;</span><span class="p">)</span>
        <span class="n">opcodes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;cc&quot;</span><span class="p">:</span><span class="mh">0x32</span><span class="p">,</span> <span class="s">&quot;cv&quot;</span><span class="p">:</span><span class="mh">0x34</span><span class="p">,</span> <span class="s">&quot;cw&quot;</span><span class="p">:</span><span class="mh">0x36</span><span class="p">,</span> <span class="s">&quot;cr&quot;</span><span class="p">:</span><span class="mh">0x38</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cc&quot;</span><span class="p">:</span>
            <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span>
        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cv&quot;</span><span class="p">:</span>
            <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span>
        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cw&quot;</span><span class="p">:</span>
            <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">const</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="n">opcodes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">const</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">A_time_s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">to_ms</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">const</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">B_time_s</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">to_ms</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">transient_operations</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;continuous&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;pulse&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;toggled&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CodeInteger</span><span class="p">(</span><span class="n">transient_operations</span><span class="p">[</span><span class="n">operation</span><span class="p">],</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="s">&quot;Set </span><span class="si">%s</span><span class="s"> transient&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResponseStatus</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetTransient"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetTransient">[docs]</a>    <span class="k">def</span> <span class="nf">GetTransient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="s">&quot;Gets the transient mode settings&quot;</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Unknown mode&quot;</span><span class="p">)</span>
        <span class="n">opcodes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;cc&quot;</span><span class="p">:</span><span class="mh">0x33</span><span class="p">,</span> <span class="s">&quot;cv&quot;</span><span class="p">:</span><span class="mh">0x35</span><span class="p">,</span> <span class="s">&quot;cw&quot;</span><span class="p">:</span><span class="mh">0x37</span><span class="p">,</span> <span class="s">&quot;cr&quot;</span><span class="p">:</span><span class="mh">0x39</span><span class="p">}</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="n">opcodes</span><span class="p">[</span><span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="s">&quot;Get </span><span class="si">%s</span><span class="s"> transient&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">A_timer_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
        <span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">B_timer_ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">15</span><span class="p">])</span>
        <span class="n">time_const</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="n">transient_operations_inv</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&quot;continuous&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s">&quot;pulse&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s">&quot;toggled&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cc&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">A</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">),</span> <span class="n">A_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">B</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">),</span> <span class="n">B_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">transient_operations_inv</span><span class="p">[</span><span class="n">operation</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cv&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">A</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">),</span> <span class="n">A_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">B</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">),</span> <span class="n">B_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">transient_operations_inv</span><span class="p">[</span><span class="n">operation</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;cw&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">A</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">),</span> <span class="n">A_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">B</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">),</span> <span class="n">B_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">transient_operations_inv</span><span class="p">[</span><span class="n">operation</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">((</span><span class="n">A</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span><span class="p">),</span> <span class="n">A_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">B</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_resistance</span><span class="p">),</span> <span class="n">B_timer_ms</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">time_const</span><span class="p">),</span>
                    <span class="n">transient_operations_inv</span><span class="p">[</span><span class="n">operation</span><span class="p">]))</span></div>
<div class="viewcode-block" id="bk8500.SetBatteryTestVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetBatteryTestVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">SetBatteryTestVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_voltage</span><span class="p">):</span>
        <span class="s">&quot;Sets the battery test voltage&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set battery test voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x4E</span><span class="p">,</span> <span class="n">min_voltage</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetBatteryTestVoltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetBatteryTestVoltage">[docs]</a>    <span class="k">def</span> <span class="nf">GetBatteryTestVoltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the battery test voltage&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get battery test voltage&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x4F</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetLoadOnTimer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetLoadOnTimer">[docs]</a>    <span class="k">def</span> <span class="nf">SetLoadOnTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_in_s</span><span class="p">):</span>
        <span class="s">&quot;Sets the time in seconds that the load will be on&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set load on timer&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x50</span><span class="p">,</span> <span class="n">time_in_s</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetLoadOnTimer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetLoadOnTimer">[docs]</a>    <span class="k">def</span> <span class="nf">GetLoadOnTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the time in seconds that the load will be on&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get load on timer&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x51</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetLoadOnTimerState"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetLoadOnTimerState">[docs]</a>    <span class="k">def</span> <span class="nf">SetLoadOnTimerState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="s">&quot;Enables or disables the load on timer state&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set load on timer state&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x50</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetLoadOnTimerState"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetLoadOnTimerState">[docs]</a>    <span class="k">def</span> <span class="nf">GetLoadOnTimerState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Gets the load on timer state&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get load on timer&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x53</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;disabled&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;enabled&quot;</span></div>
<div class="viewcode-block" id="bk8500.SetCommunicationAddress"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetCommunicationAddress">[docs]</a>    <span class="k">def</span> <span class="nf">SetCommunicationAddress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the communication address.  Note:  this feature is</span>
<span class="sd">        not currently supported.  The communication address should always</span>
<span class="sd">        be set to 0.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set communication address&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x54</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.EnableLocalControl"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.EnableLocalControl">[docs]</a>    <span class="k">def</span> <span class="nf">EnableLocalControl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Enable local control (i.e., key presses work) of the load&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Enable local control&quot;</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x55</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.DisableLocalControl"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.DisableLocalControl">[docs]</a>    <span class="k">def</span> <span class="nf">DisableLocalControl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Disable local control of the load&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Disable local control&quot;</span>
        <span class="n">disabled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x55</span><span class="p">,</span> <span class="n">disabled</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetRemoteSense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetRemoteSense">[docs]</a>    <span class="k">def</span> <span class="nf">SetRemoteSense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="s">&quot;Enable or disable remote sensing&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set remote sense&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x56</span><span class="p">,</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetRemoteSense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetRemoteSense">[docs]</a>    <span class="k">def</span> <span class="nf">GetRemoteSense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Get the state of remote sensing&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get remote sense&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x57</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetTriggerSource"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetTriggerSource">[docs]</a>    <span class="k">def</span> <span class="nf">SetTriggerSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s">&quot;immediate&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set how the instrument will be triggered.</span>
<span class="sd">        &quot;immediate&quot; means triggered from the front panel.</span>
<span class="sd">        &quot;external&quot; means triggered by a TTL signal on the rear panel.</span>
<span class="sd">        &quot;bus&quot; means a software trigger (see TriggerLoad()).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">trigger</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;immediate&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;external&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;bus&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trigger</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Trigger type </span><span class="si">%s</span><span class="s"> not recognized&quot;</span> <span class="o">%</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set trigger type&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x54</span><span class="p">,</span> <span class="n">trigger</span><span class="p">[</span><span class="n">source</span><span class="p">],</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetTriggerSource"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetTriggerSource">[docs]</a>    <span class="k">def</span> <span class="nf">GetTriggerSource</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Get how the instrument will be triggered&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get trigger source&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x59</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">trigger_inv</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&quot;immediate&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s">&quot;external&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s">&quot;bus&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">trigger_inv</span><span class="p">[</span><span class="n">t</span><span class="p">]</span></div>
<div class="viewcode-block" id="bk8500.TriggerLoad"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.TriggerLoad">[docs]</a>    <span class="k">def</span> <span class="nf">TriggerLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Provide a software trigger.  This is only of use when the trigger</span>
<span class="sd">        mode is set to &quot;bus&quot;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="mh">0x5A</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="s">&quot;Trigger load (trigger = bus)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResponseStatus</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SaveSettings"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SaveSettings">[docs]</a>    <span class="k">def</span> <span class="nf">SaveSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="s">&quot;Save instrument settings to a register&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lowest_register</span> <span class="o">&lt;=</span> <span class="n">register</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_register</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Save to register </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">register</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x5B</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.RecallSettings"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.RecallSettings">[docs]</a>    <span class="k">def</span> <span class="nf">RecallSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="s">&quot;Restore instrument settings from a register&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lowest_register</span> <span class="o">&lt;=</span> <span class="n">register</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">highest_register</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetCommand</span><span class="p">(</span><span class="mh">0x5C</span><span class="p">,</span> <span class="n">register</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="s">&quot;Recall register </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">register</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ResponseStatus</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.SetFunction"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.SetFunction">[docs]</a>    <span class="k">def</span> <span class="nf">SetFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="o">=</span><span class="s">&quot;fixed&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the function (type of operation) of the load.</span>
<span class="sd">        function is one of &quot;fixed&quot;, &quot;short&quot;, &quot;transient&quot;, or &quot;battery&quot;.</span>
<span class="sd">        Note &quot;list&quot; is intentionally left out for now.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Set function to </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">function</span>
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;fixed&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;short&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;transient&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;battery&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendIntegerToLoad</span><span class="p">(</span><span class="mh">0x5D</span><span class="p">,</span> <span class="n">functions</span><span class="p">[</span><span class="n">function</span><span class="p">],</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="bk8500.GetFunction"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetFunction">[docs]</a>    <span class="k">def</span> <span class="nf">GetFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Get the function (type of operation) of the load&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Get function&quot;</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetIntegerFromLoad</span><span class="p">(</span><span class="mh">0x5E</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">num_bytes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">functions_inv</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&quot;fixed&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s">&quot;short&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s">&quot;transient&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s">&quot;battery&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">functions_inv</span><span class="p">[</span><span class="n">fn</span><span class="p">]</span></div>
<div class="viewcode-block" id="bk8500.GetInputValues"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.bk8500.GetInputValues">[docs]</a>    <span class="k">def</span> <span class="nf">GetInputValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns voltage in V, current in A, and power in W, op_state byte,</span>
<span class="sd">        and demand_state byte.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartCommand</span><span class="p">(</span><span class="mh">0x5F</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Reserved</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CalculateChecksum</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CommandProperlyFormed</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SendCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrintCommandAndResponse</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="s">&quot;Get input values&quot;</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">values</span><span class="p">[</span><span class="s">&quot;voltage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_voltage</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[</span><span class="s">&quot;current&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_current</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[</span><span class="s">&quot;power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeInteger</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">11</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_power</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</div></div>
<div class="viewcode-block" id="hameg_4040"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hameg_4040">[docs]</a><span class="k">class</span> <span class="nc">hameg_4040</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Hameg Lab Supply, model HMP 4040</span>
<span class="sd">        Four channel lab supply with GPIB interface.</span>

<span class="sd">        This instrument works by selecting the desired output with one command</span>
<span class="sd">        then sending &quot;source&quot; or &quot;measure&quot; commands to that output to set</span>
<span class="sd">        or measure voltage and current.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;hameg_4040&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;HMP4040 @  {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="c">#Reset the instrument to all outputs on, all voltages zero.</span>
        <span class="c">#turn on all channels with zero output voltage</span>
        <span class="c">#and one amp current limits (why?)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#print self.get_interface().resync()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#self.hameg_suck_time = 0.03</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span> <span class="o">=</span> <span class="o">.</span><span class="mo">03</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;turn OFF all channels&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTRUMENT:SELECT OUTPUT{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPUT:STATE OFF&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span> <span class="c"># do no remove</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<div class="viewcode-block" id="hameg_4040.set_retries"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hameg_4040.set_retries">[docs]</a>    <span class="k">def</span> <span class="nf">set_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">retries</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;attempt to be robust to communication interface problems&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span></div>
<div class="viewcode-block" id="hameg_4040.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hameg_4040.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">ilim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">delay</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add voltage forcing channel</span>
<span class="sd">            optionally add voltage force channel, current force channel &quot;_ilim&quot;, enable &quot;_enable&quot;, voltage sense &quot;_vsense&quot; and current sense &quot;_isense&quot;</span>
<span class="sd">            channel_name is channel name, ex: input_voltage</span>
<span class="sd">            num is channel number, allowed values are 1, 2, 3, 4</span>
<span class="sd">            ilim is optional current limit for this output, defaults to 1 amp.&#39;&#39;&#39;</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="n">current_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="n">enable_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_enable</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_enable&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span><span class="n">ilim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_enable&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
            <span class="n">current_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="n">enable_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">ilim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voltage_channel</span></div>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">voltage</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mf">32.05</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">current</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">current</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_voltage_readback</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_ovp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">voltage</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_ovp</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">voltage</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_ovp_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_ovp_status</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_fuse_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_fuse_status</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="n">state</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_fuse_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">fuse_delay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_fuse_enable</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">fuse_delay</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_fuse_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">link_list</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_fuse_links</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">link_list</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;hameg_number&#39;</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_master_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_master_enable</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_fuse_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">fuse_delay</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUSE:STATe ON&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUSE:STATe OFF&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUSE:DELay {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fuse_delay</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_fuse_links</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">link_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="n">link_string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">supply</span> <span class="ow">in</span> <span class="n">link_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUSE:LINK {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">supply</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SOURce:VOLTage {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SOURce:CURRent {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_voltage_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the voltage setting as known by the instrument&#39;&#39;&#39;</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="n">retry</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SOURce:VOLTage?&quot;</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">print</span> <span class="s">&quot;Resync {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">())</span>
                <span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the voltage measured by the instrument&#39;&#39;&#39;</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="n">retry</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="n">data</span> <span class="o">=</span>  <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEASure:SCALar:VOLT:DC?&quot;</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">print</span> <span class="s">&quot;Resync {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">())</span>
                <span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the current measured by the instrument&#39;&#39;&#39;</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="n">retry</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEASure:SCALar:CURRent:DC?&quot;</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">print</span> <span class="s">&quot;Resync {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">())</span>
                <span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">_write_ovp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set a channel OVP level&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage:PROTection:LEVel {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
    <span class="k">def</span> <span class="nf">_read_ovp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read channel OVP level&#39;&#39;&#39;</span>
        <span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="n">retry</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> 
                <span class="n">data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;VOLTage:PROTection:LEVel?&quot;</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> 
                <span class="k">return</span> <span class="n">data</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">print</span> <span class="s">&quot;Resync {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">())</span>
                <span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">_read_ovp_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read channel OVP level&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;VOLTage:PROTection:TRIPped?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">_read_fuse_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read if fuse is tripped&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> 
        <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;FUSE:TRIPed?&quot;</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">_write_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="c">#state is true/false</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INST:NSEL {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span> <span class="c">#needed for hw serial on fast linux</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPC?&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPUT:STATE ON&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPUT:STATE OFF&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_master_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="s">&quot;True -&gt; turn on all enabled channels / False -&gt; turn off all channels&quot;</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPut:GENeral ON&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPut:GENeral OFF&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hameg_suck_time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hp_3478a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a">[docs]</a><span class="k">class</span> <span class="nc">hp_3478a</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel hp_3478a meter</span>
<span class="sd">        defaults to dc voltage&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;hp_3478a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;hp_3478a @ &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dc_voltage</span><span class="p">()</span>
<div class="viewcode-block" id="hp_3478a.config_dc_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a.config_dc_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for DC voltage measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;F1&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3478a.config_dc_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a.config_dc_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for DC current measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;F5&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3478a.config_ac_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a.config_ac_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC voltage measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;F2&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3478a.config_ac_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a.config_ac_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC current measurement&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;F6&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3478a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3478a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument without configuring measurement type.&#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_meter</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing meter measurement.  Units are V,A,Ohm, etc depending on meter configuration.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="htx9000"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9000">[docs]</a><span class="k">class</span> <span class="nc">htx9000</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Single Channel Hypertronix (Steve Martin) HTX9000</span>
<span class="sd">        400nA &lt; IL &lt; 2.5A, up to 60V, 20W Max on fanless version.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;htx9000&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;HTX9000 {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_swipepad_lock</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_swipepad_lock</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Close interface (serial) port on exit&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<div class="viewcode-block" id="htx9000.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9000.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper function adds current forcing channel of channel_name</span>
<span class="sd">        optionally also adds _dropout and _readback channels.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_readback</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_readback&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_dropout</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_dropout&quot;</span><span class="p">)</span>
            <span class="c"># self.add_channel_swipepad_lock(channel_name + &quot;_swipepad_lock&quot;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_readback_current</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_dropout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_dropout</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_temp_heatsink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_heatsink_temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_temp_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_board_temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_swipepad_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_swipepad_lock</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to value.&#39;&#39;&#39;</span>
        <span class="c">#TODO: instrument currently broken - sets range to low if under-range on input Steve to fix.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># ooops need to fix instrument, does bad things when asked to make negative SM.</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;HIGH&quot;</span> <span class="ow">or</span> <span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;HI&quot;</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;SOURce:CURRent:RANGe:HIgh {:7.5e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;LOW&quot;</span> <span class="ow">or</span> <span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;LO&quot;</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;SOURce:CURRent:RANGe:LOw {:7.5e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Valid ranges are &quot;HIGH&quot; and &quot;LOW&quot;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;SOURce:CURRent {:7.5e}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SYSTem:ERRor?&quot;</span><span class="p">)</span>
            <span class="c">#print &quot;HTX9000 err {}&quot;.format(response)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;WARNING, SCPI Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;{} from inside HTX9000 {} write_channel &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
            <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;saw {} extra characters: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flush_chars</span><span class="p">),</span><span class="n">flush_chars</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_dropout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return False if in regulation, True if in dropout.&#39;&#39;&#39;</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;DROPout?&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">data</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;WARNING, Bad Response: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
                <span class="k">print</span> <span class="s">&quot;{} from inside HTX9000 {} read_dropout. SCPI Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SYSTem:ERRor?&quot;</span><span class="p">))</span>
                <span class="k">print</span> <span class="s">&quot;saw {} extra characters: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flush_chars</span><span class="p">),</span><span class="n">flush_chars</span><span class="p">)</span>
                <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_readback_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return current setting from instrument.  Steve verify that this is just a rounded version of what</span>
<span class="sd">            was previously written.&#39;&#39;&#39;</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SOURce:CURRent?&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
                <span class="k">print</span> <span class="s">&quot;{} from inside HTX9000 {} read_current. SCPI Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SYSTem:ERRor?&quot;</span><span class="p">))</span>
                <span class="k">print</span> <span class="s">&quot;saw {} extra characters: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flush_chars</span><span class="p">),</span><span class="n">flush_chars</span><span class="p">)</span>
                <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_read_heatsink_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TEMP:HEATsink?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_board_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TEMP:BOARD?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_swipepad_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Turn on or off the swipe pad lock so incidental contact doesn&#39;t change the value.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SYSTem:LOCK&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s">&quot;SYSTem:LOCK:RELease&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SYSTem:ERRor?&quot;</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;WARNING, SCPI Error: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;{} from inside HTX9000 {} write_channel &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
            <span class="n">flush_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;saw {} extra characters: {} during SYSTem:LOCK or SYSTem:LOCK:RELease&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flush_chars</span><span class="p">),</span><span class="n">flush_chars</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="htx9001"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001">[docs]</a><span class="k">class</span> <span class="nc">htx9001</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; HTX9001 Configurator Pro (Steve Martin)</span>
<span class="sd">        Breakout/Edge connector board for ATE Bench, with i2c</span>
<span class="sd">        Supports 4 types of channels:</span>
<span class="sd">        gpio - 10 Channels, Possible values are 0,1(5V),Z (HiZ), P (Weak Pull Up)</span>
<span class="sd">        test_hook - 5 channels, 1,0 pullup to 12V NO CURRENT LIMIT</span>
<span class="sd">        relay - Channels 1-4 and 9-12, correspond to supply numbers, 0 or 1 (1 is supply connected)</span>
<span class="sd">        dvcc - Controls I2C/SMBus DVCC voltage</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">interface_twi</span><span class="p">,</span> <span class="n">calibrating</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a htx9001 object&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;htx9001&#39;</span>
        <span class="c">#work with both serial port strings and pyserial objects</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;HTX9001 {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PC6&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PC7&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PD2&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PD3&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PD4&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PB0&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PB1&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PB2&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PB3&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PB4&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;PB5&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s">&#39;PB6&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s">&#39;PB7&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span><span class="s">&#39;PD5&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="s">&#39;PD6&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PF4&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PD7&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PF5&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PE6&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span><span class="s">&#39;PF6&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="s">&#39;PF0&#39;</span><span class="p">,</span><span class="mi">11</span><span class="p">:</span><span class="s">&#39;PF7&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="s">&#39;PF1&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gpio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">)</span><span class="o">*</span><span class="s">&#39;Z&#39;</span><span class="p">)</span> <span class="c">#HiZ all GPIO Pins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_calibration_valid</span><span class="p">(</span><span class="n">calibrating</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_disable_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:I2C:PORT:DISable;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
<div class="viewcode-block" id="htx9001.add_channel_dvcc"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001.add_channel_dvcc">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_dvcc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a channel controlling the dvcc voltage&#39;&#39;&#39;</span>
        <span class="n">dvcc</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_dvcc</span><span class="p">)</span>
        <span class="n">dvcc</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">dvcc</span><span class="p">)</span></div>
<div class="viewcode-block" id="htx9001.add_channel_relay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001.add_channel_relay">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">relay_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a relay channel,</span>
<span class="sd">            channel_name is the name of the channel,</span>
<span class="sd">            relay_number is the number of the relay (same number as the supply being switched)</span>
<span class="sd">            valid relays are 1-4 and 9-12&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">relay_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid relay number {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relay_number</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">[</span><span class="n">relay_number</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;relay number {} already used in another channel!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">relay_number</span><span class="p">))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">relay_number</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">[</span><span class="n">relay_number</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="htx9001.add_channel_test_hook"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001.add_channel_test_hook">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_test_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">test_hook_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a test hook channel,</span>
<span class="sd">            channel_name is the name of the channel</span>
<span class="sd">            test_hook_number is the number of the test hook (valid test hooks are 1-5&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">test_hook_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid test hook number {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_hook_number</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span><span class="p">[</span><span class="n">test_hook_number</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;test hook number {} already used in another channel!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_hook_number</span><span class="p">))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_test_hook</span><span class="p">(</span><span class="n">test_hook_number</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span><span class="p">[</span><span class="n">test_hook_number</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="htx9001.add_channel_gpio"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001.add_channel_gpio">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_gpio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">gpio_list</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pin_state</span> <span class="o">=</span> <span class="s">&quot;Z&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds a GPIO channel, can be a single bit or a bus of bits</span>
<span class="sd">            channel_name is the name of the channel</span>
<span class="sd">            gpio pins is either a single integer for a single bit or a list of integers ordered msb to lsb</span>
<span class="sd">            valid gpio_numbers are 1-10,</span>
<span class="sd">            valid settings are [{integer},&#39;z&#39;,&#39;Z&#39;,&#39;p&#39;,&#39;P&#39;,&#39;H&#39;,&#39;L&#39;]&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">gpio_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">gpio_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">gpio_pin</span> <span class="ow">in</span> <span class="n">gpio_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gpio_pin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid gpio {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gpio_pin</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">[</span><span class="n">gpio_pin</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;HTX9001(A) Warning: Non GPIO pin {} being redefined as a GPIO pin.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gpio_pin</span><span class="p">)</span>
                <span class="c"># raise Exception(&quot;gpio number {} already used in another channel!&quot;.format(gpio_pin))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">[</span><span class="n">gpio_pin</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">output</span><span class="p">:</span>
            <span class="c">#can&#39;t use integer channel because of possible P,Z values.</span>
            <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_gpio</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
            <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">pin_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pins_values</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_gpio</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">,</span> <span class="n">pin_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_dvcc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="mf">63.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twi</span><span class="o">.</span><span class="n">send_byte</span><span class="p">(</span><span class="mh">0x74</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;HTX9001 Configurator Communication error setting DVCC, retrying....&quot;</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_twi</span><span class="o">.</span><span class="n">resync_communication</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Sorry, couldn&#39;t fix it with resync_communication()&quot;</span>
        <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">read_channel_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_generic</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_pins_values</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">resync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_twi</span><span class="o">.</span><span class="n">init_i2c</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_clean_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t parse htx9001 input: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">_pin_response_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ret_str</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">_write_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">tries</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tries</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Failed to write pin {} to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;P&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for pin: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="c">#set the pin and read back its state to make sure there were no usb communication problems</span>
        <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="s">&quot;H&quot;</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="s">&quot;L&quot;</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;:SETPin:</span><span class="si">%s</span><span class="s">(@</span><span class="si">%s</span><span class="s">);:SETPin?(@</span><span class="si">%s</span><span class="s">);&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value_str</span><span class="p">,</span><span class="n">pin</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin_response_valid</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">tries</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_pin_setting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin</span><span class="p">,</span><span class="n">tries</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tries</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Failed to read pin {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="n">read_str</span> <span class="o">=</span> <span class="s">&#39;:SETPin?(@{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">read_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin_response_valid</span><span class="p">(</span><span class="n">ret_str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_pin_setting</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">tries</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret_val</span>
    <span class="k">def</span> <span class="nf">_read_pin_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pin</span><span class="p">,</span><span class="n">tries</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">tries</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Failed to read pin {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="n">read_str</span> <span class="o">=</span> <span class="s">&#39;:PINVal?(@{});&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">read_str</span><span class="p">)</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pin_response_valid</span><span class="p">(</span><span class="n">ret_str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pin_value</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span><span class="n">tries</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ret_val</span> <span class="o">=</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret_val</span>
    <span class="k">def</span> <span class="nf">_to_bit_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">out_length</span><span class="p">):</span>
        <span class="n">out_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Bad data for pins {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;0b&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">out_length</span><span class="p">,</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">out_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">]:</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">,</span><span class="s">&#39;0&#39;</span><span class="p">]:</span>
                    <span class="n">char</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">out_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;P&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Bad data {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_list</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">out_list</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Bad data for pins {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">out_length</span><span class="p">:</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">out_length</span><span class="p">:</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">out_list</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out_list</span>
    <span class="k">def</span> <span class="nf">_from_bit_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bit_list</span><span class="p">):</span>
        <span class="c">#attempt to build an integer from the bit list, otherwise return a string</span>
        <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bit_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">*=</span> <span class="mi">2</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bit_list</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">def</span> <span class="nf">_write_test_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">test_hook</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for test hook: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span><span class="p">[</span><span class="n">test_hook</span><span class="p">],</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_gpio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gpio_list</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">bit_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_bit_list</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">))</span>
        <span class="n">pin_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gpio_list</span><span class="p">,</span><span class="n">bit_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pin_name</span><span class="p">,</span><span class="n">pin_value</span> <span class="ow">in</span> <span class="n">pin_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">[</span><span class="n">pin_name</span><span class="p">],</span><span class="n">pin_value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">relay_number</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for relay: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">[</span><span class="n">relay_number</span><span class="p">],</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_pins_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pins</span><span class="p">,</span><span class="n">invert</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">pin_names</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">pins</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pins_generic</span><span class="p">(</span><span class="n">pin_names</span><span class="p">,</span><span class="n">invert</span><span class="o">=</span><span class="n">invert</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_pin_value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_pins_generic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pins</span><span class="p">,</span><span class="n">invert</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">function</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pins</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">pins</span> <span class="o">=</span> <span class="p">[</span><span class="n">pins</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">pins</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_bit_list</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_resistor_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resistor_number</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid Calibration Data&quot;</span><span class="p">)</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&quot;CAL:DATA ({},{});&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resistor_number</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_resistor_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resistor_number</span><span class="p">):</span>
        <span class="n">read_str</span> <span class="o">=</span> <span class="s">&quot;CAL:DATA?({});&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resistor_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">read_str</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_calibration_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">datestr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;CAL:DATE?&#39;</span><span class="p">)</span> <span class="c">#datetime.datetime.now().strftime(&quot;%Y-%m-%d&quot;)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">y</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="n">datestr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">date</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Board calibration date invalid: {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datestr</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">get_days_since_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cal_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_calibration_date</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cal_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">-</span><span class="n">cal_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
    <span class="k">def</span> <span class="nf">check_calibration_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calibrating</span><span class="p">):</span>
        <span class="n">cal_duration</span> <span class="o">=</span> <span class="mi">365</span> <span class="c">#days</span>
        <span class="n">days</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_days_since_calibration</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">days</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">calibrating</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Current sense resistor calibration date invalid.  Was board ever calibrated?&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">days</span> <span class="o">&gt;</span> <span class="n">cal_duration</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;******** HTX9001 Calibration Expired ********&quot;</span>
                <span class="k">print</span> <span class="s">&quot;Current sense resistor calibration required every {} days.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cal_duration</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;Calibration last performed {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_calibration_date</span><span class="p">())</span>
                <span class="k">print</span> <span class="s">&quot;Calibration overdue by {} days.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_days_since_calibration</span><span class="p">()</span><span class="o">-</span><span class="n">cal_duration</span><span class="p">)</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;Continue anyway?&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">resp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;HTX9001 Calibration Expired.  Calibration required every {} days&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cal_duration</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">set_all_relays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">relay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">relay</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_rip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">write_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;write_list format [(pin,value),(pin,value)....]</span>
<span class="sd">        this function uses raw pin names and builds a single query sting without readback for maximum speed</span>
<span class="sd">        there is currently no way to connect this with channels so the pin is the raw pin name like PB1 etc&#39;&#39;&#39;</span>
        <span class="n">write_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">pin</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">write_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;P&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for pin: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="c">#set the pin and read back its state to make sure there were no usb communication problems</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s">&quot;H&quot;</span>
            <span class="k">elif</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">value_str</span> <span class="o">=</span> <span class="s">&quot;L&quot;</span>
            <span class="n">write_str</span> <span class="o">+=</span> <span class="s">&#39;:SETPin:</span><span class="si">%s</span><span class="s">(@</span><span class="si">%s</span><span class="s">);&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value_str</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">write_str</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="htx9001a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001a">[docs]</a><span class="k">class</span> <span class="nc">htx9001a</span><span class="p">(</span><span class="n">htx9001</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; HTX9001 Configurator Pro A(Steve Martin)</span>
<span class="sd">        Breakout/Edge connector board for ATE Bench, with i2c</span>
<span class="sd">        Supports 5 types of channels:</span>
<span class="sd">        gpio - 10 Channels, Possible values are 0,1(5V),Z (HiZ), P (Weak Pull Up)</span>
<span class="sd">        test_hook - 5 channels, 1,0 pullup to 12V NO CURRENT LIMIT</span>
<span class="sd">        relay - Channels 1-12, correspond to supply numbers, 0 or 1 (1 is supply connected)</span>
<span class="sd">        ammeter relay - Channels 5-8</span>
<span class="sd">        dvcc - Controls I2C/SMBus DVCC voltage</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span> <span class="n">calibrating</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a htx9001a object&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;htx9001a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;HTX9001A {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_hook_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PC6&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PC7&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PD2&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PD3&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PD4&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PB0&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PB1&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PB2&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PB3&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PB4&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;PB5&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s">&#39;PB6&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s">&#39;PB7&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span><span class="s">&#39;PD5&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="s">&#39;PD6&#39;</span><span class="p">,</span><span class="s">&#39;SCL&#39;</span><span class="p">:</span><span class="s">&#39;PD0&#39;</span><span class="p">,</span><span class="s">&#39;SDA&#39;</span><span class="p">:</span><span class="s">&#39;PD1&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;PF4&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s">&#39;PD7&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;PF5&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;PE6&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PA4&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;PA6&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s">&#39;PA5&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s">&#39;PA3&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">:</span><span class="s">&#39;PF6&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="s">&#39;PF0&#39;</span><span class="p">,</span><span class="mi">11</span><span class="p">:</span><span class="s">&#39;PF7&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="s">&#39;PF1&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;PE1&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;PE0&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s">&#39;PF3&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s">&#39;PF2&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;PB5&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s">&#39;PB6&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s">&#39;PB7&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FCLK</span> <span class="o">=</span> <span class="mf">16e6</span> <span class="c"># crystal frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_gpio</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpio_pins</span><span class="p">)</span><span class="o">*</span><span class="s">&#39;Z&#39;</span><span class="p">)</span> <span class="c">#HiZ all GPIO Pins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_calibration_valid</span><span class="p">(</span><span class="n">calibrating</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prescale</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_enable</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">_disable_i2c</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;:I2C:PORT:DISable;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">resync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;HTX9001 resync clearing out serial port data &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<div class="viewcode-block" id="htx9001a.add_channel_irelay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.htx9001a.add_channel_irelay">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_irelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">irelay_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds an irelay channel,</span>
<span class="sd">            channel_name is the name of the channel,</span>
<span class="sd">            irelay_number is the number of the irelay (same number as the supply being switched)</span>
<span class="sd">            valid irelays are 5-8&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">irelay_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid irelay number {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">irelay_number</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">[</span><span class="n">irelay_number</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;irelay number {} already used in another channel!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">irelay_number</span><span class="p">))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_irelay</span><span class="p">(</span><span class="n">irelay_number</span><span class="p">,</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">[</span><span class="n">irelay_number</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
    <span class="k">def</span> <span class="nf">set_all_irelays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">irelay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_irelay</span><span class="p">(</span><span class="n">irelay</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_resistor_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">resistor_number</span><span class="p">):</span>
        <span class="n">read_str</span> <span class="o">=</span> <span class="s">&quot;CAL:DATA? {};&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resistor_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">read_str</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span> <span class="c"># may return a string like &quot;bad checksum&quot;</span>
    <span class="k">def</span> <span class="nf">_write_irelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">irelay_number</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for irelay: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_pin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">[</span><span class="n">irelay_number</span><span class="p">],</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_dvcc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLT:DVCC {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">add_channel_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid HTX9001A PWM pin number {}. Must be one of: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;HTX9001A Warning: Non PWM pin {} being redefined as a PWM pin.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="c"># raise Exception(&quot;HTX9001A pin number {} already in use by another channel!&quot;.format(pin))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_pwm_frequency</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_frequency&quot;</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_pwm_duty_cycle</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_dutycycle&quot;</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_pwm_enable</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_enable&quot;</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_pwm_freq_readback</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_freq_readback&quot;</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_enable</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_pwm_channel</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_channel_pwm_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">set_pwm_frequency</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">flow</span>    <span class="o">=</span> <span class="mf">16e6</span><span class="o">/</span><span class="mi">1024</span><span class="o">/</span><span class="mi">65536</span>
            <span class="n">fhigh</span>   <span class="o">=</span> <span class="mf">8e6</span> <span class="c"># datasheet, fmax = fclkio / 2</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">flow</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">fhigh</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid HTX9001A frequency {}. Must be between {} and {} Hz.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">flow</span><span class="p">,</span> <span class="n">fhigh</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_pwm_channel</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="n">set_pwm_frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_channel_pwm_duty_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">set_pwm_duty_cycle</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_pwm_channel</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="n">set_pwm_duty_cycle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_channel_pwm_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">set_pwm_enable</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for HTX9001A pwm_enable: {}. Try one of: 0,&quot;0&quot;,False,1,&quot;1&quot;,True.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_enable</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_pwm_channel</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="n">set_pwm_enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_channel_pwm_freq_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">compute_f</span><span class="p">(</span><span class="n">pin</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">FCLK</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prescale</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">compute_f</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_update_pwm_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="n">prescale_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">1024</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">prescale_choice</span> <span class="ow">in</span> <span class="n">prescale_list</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FCLK</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">/</span> <span class="n">prescale_choice</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">top</span> <span class="o">&lt;=</span> <span class="mi">65535</span> <span class="ow">and</span> <span class="n">top</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prescale</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">prescale_choice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FCLK</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">prescale</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">compare</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">pin</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_enable</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:PREScale {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prescale</span><span class="p">[</span><span class="n">pin</span><span class="p">])))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:TOP {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="n">pin</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:COMPare ({},{})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">],</span> <span class="n">compare</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:MODE ({},CLEAR)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:MODE ({},DISABLE)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">pin</span><span class="p">]))</span>
    <span class="k">def</span> <span class="nf">add_channel_servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">servo_number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">servo_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Invalid HTX9001A servo pin number {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">servo_number</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;HTX9001A Warning: Non Servo pin {} being redefined as a Servo pin.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
            <span class="c"># raise Exception(&quot;HTX9001A servo number {} already used in another channel!&quot;.format(servo_number))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_servo</span><span class="p">(</span><span class="n">servo_number</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_servo_enable</span><span class="p">(</span><span class="n">servo_number</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_pins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_servo_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">servo_number</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">servo_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;HTX9001A Invalid servo pin  number {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">servo_number</span><span class="p">))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_servo_enable</span><span class="p">(</span><span class="n">servo_number</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_servo_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">servo_number</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for HTX9001A servo_enable: {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:TOP 39999&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:PREScale 8&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:COMPare ({},3000)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:MODE ({},CLEAR)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:MODE ({},DISABLE)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">]))</span>
    <span class="k">def</span> <span class="nf">_write_servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">servo_number</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mf">1.51</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad value for HTX9001A servo: {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;PWM:COMPare ({},{})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_pins</span><span class="p">[</span><span class="n">servo_number</span><span class="p">],</span><span class="n">value</span><span class="o">*</span><span class="mi">2000</span><span class="o">+</span><span class="mi">2000</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">set_all_relays</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">relay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">relay_pins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">relay</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">relay</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">irelay_pins</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_irelay</span><span class="p">(</span><span class="n">relay</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="kikusui_plz"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_plz">[docs]</a><span class="k">class</span> <span class="nc">kikusui_plz</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Kikusui single channel electronic load superclass</span>
<span class="sd">        Instrument Family:</span>
<span class="sd">            PLZ 164W</span>
<span class="sd">            PLZ 164WA</span>
<span class="sd">            PLZ 334W</span>
<span class="sd">            PLZ 664WA</span>
<span class="sd">            PLZ1004W&#39;&#39;&#39;</span>
    <span class="c">#note that this superclass was developed and tested with only the PLZ 334W instrument</span>
    <span class="c">#some methods may need to be duplicated and moved to the instrument-specific classes</span>
    <span class="c">#to resolve any operational/feature differences such as range selection</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_plz&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kikusui_plz_name</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SOURce:FUNCtion:MODE CCCV&#39;</span><span class="p">)</span>
        <span class="c">#self.get_interface().write(&quot;CCCR 1&quot;) #constant current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLT 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPUT 1&quot;</span><span class="p">)</span>
        <span class="c">#SM: Change from high range if you need it</span>
        <span class="c">#self.get_interface().write(&quot;CURRent:RANGe LOW&quot;)</span>
        <span class="c">#self.get_interface().write(&quot;CURRent:RANGe MED&quot;) #DJS This was inadvertantly changed by Greg in commit 2539. Changing back. Not sure what it should be.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_mode</span><span class="p">()</span>
<div class="viewcode-block" id="kikusui_plz.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_plz.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">add_sense_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper function adds primary current forcing channel of channel_name plus _vsense and _isense readback channels.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_sense_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">)</span>
            <span class="c">#the old add_channel added more, however I&#39;m changing the default to this to speed up reading</span>
            <span class="c"># add channels independently if you want something different</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c">#default to zero current</span></div>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_range_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_slew_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_slew_rate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_pulse_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_pulse_on</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_duty_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>                                       <span class="c"># Duty cycle, frequency and current level are used for Switch operation</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_duty_cycle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current_level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_short</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>                                            <span class="c"># Short will only admit as much current as the current range. So before any short test</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_short</span><span class="p">)</span>             <span class="c"># Remember to input a high current in your own code to force the change in Range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span> 
    <span class="k">def</span> <span class="nf">add_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>        
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return channel measured voltage float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS:VOLT?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return channel measured power float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS:POW?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return channel measured current float.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS:CURR?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return channel range string.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;CURRent:RANGe?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return load state (1 -&gt; &quot;On&quot;, 0 -&gt; &quot;Off&quot;).&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;OUTPut?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return operation mode ( CC, CV, etc).&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;SOURce:FUNCtion:MODE?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">,</span><span class="n">autorange</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to force value current.  Optionally set range manually.</span>
<span class="sd">            Valid ranges are &quot;HIGH&quot;, &quot;MED&quot;, and &quot;LOW&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_mode</span><span class="p">(</span><span class="s">&quot;CC&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s">&quot;CC&quot;</span>
        <span class="k">if</span> <span class="n">autorange</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">current</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_low_threshold</span><span class="p">):</span>
                <span class="n">best_range</span> <span class="o">=</span> <span class="s">&quot;LOW&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">current</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_low_threshold</span> <span class="ow">and</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_high_threshold</span><span class="p">):</span>
                <span class="n">best_range</span> <span class="o">=</span> <span class="s">&quot;MED&quot;</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">current</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_high_threshold</span><span class="p">):</span>
                <span class="n">best_range</span> <span class="o">=</span> <span class="s">&quot;HIGH&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_range</span><span class="p">(</span><span class="n">best_range</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">!=</span> <span class="s">&quot;CV&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_mode</span><span class="p">(</span><span class="s">&quot;CV&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_range</span><span class="p">(</span><span class="s">&quot;HIGH&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLT {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_slew_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slew_rate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR:SLEW {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slew_rate</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_pulse_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pulse_on</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;PULSe {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pulse_on</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_duty_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">duty_cycle</span><span class="p">):</span>                    <span class="c">#duty_cycle is a percent from 5 to 95 %</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;PULSe:DCYCle {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frequency</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;PULSe:FREQuency {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_current_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_level</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;PULSe:LEVel:CURRent {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_level</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_short</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">short</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPut:SHORt {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">short</span><span class="p">))</span>        
    <span class="k">def</span> <span class="nf">_write_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">output</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPut 1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">output</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTPut 0&quot;</span><span class="p">)</span>
        <span class="n">timeout1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span>
        <span class="k">while</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_load</span><span class="p">())</span> <span class="o">!=</span> <span class="n">output</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeout1</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="k">print</span> <span class="s">&quot;Timeout1 for load on/off exceeded. Bump in lab_instruments.py if it is a consistent problem &quot;</span>
    <span class="k">def</span> <span class="nf">_write_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">range</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;LOW&quot;</span><span class="p">,</span> <span class="s">&quot;MED&quot;</span><span class="p">,</span> <span class="s">&quot;HIGH&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>           
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURRent:RANGe {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="o">.</span><span class="n">upper</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_enable</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Valid ranges are &quot;HIGH&quot;, &quot;MED&quot;, and &quot;LOW&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_range</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_write_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SOURce:FUNCtion:MODE {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>        
</div>
<div class="viewcode-block" id="kikusui_plz334w"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_plz334w">[docs]</a><span class="k">class</span> <span class="nc">kikusui_plz334w</span><span class="p">(</span><span class="n">kikusui_plz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel kikusui_plz334w electronic load&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_plz_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_plz334w&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_low_threshold</span> <span class="o">=</span> <span class="mf">0.66</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_high_threshold</span> <span class="o">=</span> <span class="mf">6.66</span>
        <span class="n">kikusui_plz</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="kikusui_plz664wa"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_plz664wa">[docs]</a><span class="k">class</span> <span class="nc">kikusui_plz664wa</span><span class="p">(</span><span class="n">kikusui_plz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel kikusui_plz664wa electronic load&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_plz_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_plz664w&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_low_threshold</span> <span class="o">=</span> <span class="mf">1.32</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_high_threshold</span> <span class="o">=</span> <span class="mf">13.2</span>
        <span class="n">kikusui_plz</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="kikusui_pbz"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pbz">[docs]</a><span class="k">class</span> <span class="nc">kikusui_pbz</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel kikusui_pbz20-20, pbz40-10 bipolar power supply parent class&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="c">#initialize to instrument on, current 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_status</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR:LEV:IMM:AMPL 0.0A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLT:LEV:IMM:AMPL 0V&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="kikusui_pbz.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pbz.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">ilim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper channel adds primary voltage forcing channel.</span>
<span class="sd">            Optionally specify channel current limit.  Valid range is [???-???]</span>
<span class="sd">            optionally also adds _ilim_source and _ilim_sink limit forcing channels&#39;&#39;&#39;</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="n">current_source_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_source</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim_source&quot;</span><span class="p">)</span>
            <span class="n">current_source_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="n">current_sink_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_sink</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim_sink&quot;</span><span class="p">)</span>
            <span class="n">current_sink_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="n">output_enable_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_output_enable</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_enable&quot;</span><span class="p">)</span>
            <span class="n">output_enable_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">output_enable_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="n">voltage_sense_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">)</span>
            <span class="n">current_sense_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim_source&quot;</span><span class="p">,</span> <span class="n">ilim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim_sink&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">ilim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_output_enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_current_source</span><span class="p">(</span><span class="n">ilim</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_current_sink</span><span class="p">(</span><span class="o">-</span><span class="n">ilim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voltage_channel</span></div>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current_source</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_sink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current_sink</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_output_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_output_enable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_voltage_readback</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR:PROT:UPP {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_current_sink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CURR:PROT:LOW {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set output voltage&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_output_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set output enable&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTP 1&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTP 0&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_voltage_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s actual setopint.  May differ by commanded value by rounding/range error&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;VOLT?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured output voltage.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS:VOLT?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured current output.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS:CURR?&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="kikusui_pbz20_20"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pbz20_20">[docs]</a><span class="k">class</span> <span class="nc">kikusui_pbz20_20</span><span class="p">(</span><span class="n">kikusui_pbz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Kikusui single channel 20V/20A bipolar power supply.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_pbz20_20&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;kikusui_pbz20-20 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="n">kikusui_pbz</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="kikusui_pbz40_10"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pbz40_10">[docs]</a><span class="k">class</span> <span class="nc">kikusui_pbz40_10</span><span class="p">(</span><span class="n">kikusui_pbz</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Kikusui single channel 40V/10A bipolar power supply.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_pbz40_10&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;kikusui_pbz40_10 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="n">kikusui_pbz</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="kikusui_pwr"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pwr">[docs]</a><span class="k">class</span> <span class="nc">kikusui_pwr</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Kikusui single channel unipolar power supply superclass</span>
<span class="sd">        Instrument Family:</span>
<span class="sd">            PWR400L</span>
<span class="sd">            PWR400M</span>
<span class="sd">            PWR400H</span>
<span class="sd">            PWR800L</span>
<span class="sd">            PWR800M</span>
<span class="sd">            PWR800H</span>
<span class="sd">            PWR1600L</span>
<span class="sd">            PWR1600M</span>
<span class="sd">            PWR1600H&#39;&#39;&#39;</span>
    <span class="c">#note that this superclass was developed and tested with only the PWR800l instrument</span>
    <span class="c">#some methods may need to be duplicated and moved to the instrument-specific classes</span>
    <span class="c">#to resolve any operational/feature differences such as range selection</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;node is a ???</span>
<span class="sd">           ch is a ???&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_pwr&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="s">&quot;kikusui_pwr800l {} @ {}:Node {}: Ch{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kikusui_pwr_name</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">ch</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">node</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ch</span> <span class="o">=</span> <span class="n">ch</span>
        <span class="c">#initialize to instrument on, current 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};*CLS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};*RST&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};VSET 0.000&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};ISET 0.000&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUT 1&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="kikusui_pwr.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pwr.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">ilim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper function adds primary voltage forcing channel channel_name</span>
<span class="sd">        optionally also adds _ilim forcing channel and _vsense and _isense readback channels.&#39;&#39;&#39;</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="n">current_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">)</span>
            <span class="n">current_channel</span><span class="o">.</span><span class="n">set_write_delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span> <span class="n">ilim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">(</span><span class="n">ilim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voltage_channel</span></div>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_power</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};VSET {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">,</span> <span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};ISET {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">,</span> <span class="n">current</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">enable</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};OUT 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};OUT 0&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured output voltage.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};VOUT?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">_read_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured power output.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};POUT?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured current output.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;NODE {};CH {};IOUT?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ch</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="kikusui_pwr800l"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.kikusui_pwr800l">[docs]</a><span class="k">class</span> <span class="nc">kikusui_pwr800l</span><span class="p">(</span><span class="n">kikusui_pwr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel kikusui PWR800l electronic load&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">ch</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kikusui_pwr_name</span> <span class="o">=</span> <span class="s">&quot;kikusui_pwr800l&quot;</span>
        <span class="n">kikusui_pwr</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">addr</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">ch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;kikusui_pwr800l&#39;</span>
</div>
<span class="k">class</span> <span class="nc">sorensen_generic_supply</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;sorensen_generic_supply&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorensen_name</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="c">#initialize to instrument on, all voltages 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VSET 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ISET 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUT 1&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">ilim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper method adds primary voltage forcing channel channe_name.</span>
<span class="sd">        optionally also adds _ilim forcing channel and _vsense and _isense readback channels.&#39;&#39;&#39;</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vsense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_vsense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_isense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_isense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_ilim&quot;</span><span class="p">,</span> <span class="n">ilim</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">(</span><span class="n">ilim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voltage_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_vsense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_isense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named channel to force voltage, optionally with ilim compliance current&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VSET {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ilim</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named channel&#39;s compliance current&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ISET {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ilim</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_read_vsense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured output voltage.&#39;&#39;&#39;</span>
        <span class="k">return</span>  <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;VOUT?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;VOUT &quot;</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_isense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns instrument&#39;s measured output current.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;IOUT? &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&quot;IOUT &quot;</span><span class="p">)</span> <span class="p">)</span>

<div class="viewcode-block" id="sorensen_lhp_100_10"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sorensen_lhp_100_10">[docs]</a><span class="k">class</span> <span class="nc">sorensen_lhp_100_10</span><span class="p">(</span><span class="n">sorensen_generic_supply</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel sorensen_lhp_100_10&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_name</span> <span class="o">=</span> <span class="s">&quot;sorensen_lhp_100_10&quot;</span>
        <span class="n">sorensen_generic_supply</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;sorensen_lhp_100_10&#39;</span></div>
<div class="viewcode-block" id="sorensen_xt_250_25"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sorensen_xt_250_25">[docs]</a><span class="k">class</span> <span class="nc">sorensen_xt_250_25</span><span class="p">(</span><span class="n">sorensen_generic_supply</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel sorensen_xt_250_25&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sorensen_name</span> <span class="o">=</span> <span class="s">&quot;sorensen_xt_250_25&quot;</span>
        <span class="n">sorensen_generic_supply</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;sorensen_xt_250_25&#39;</span>
</div>
<div class="viewcode-block" id="temptronic_4310"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310">[docs]</a><span class="k">class</span> <span class="nc">temptronic_4310</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
        <span class="c">#DJS: TODO - Merge into temperature_chamber class when able to test that nothing gets broken.</span>
    <span class="sd">&#39;&#39;&#39;single channel temptronic_4310 thermostream</span>
<span class="sd">        special methods: set_window(air_window), set_soak(soak_time), off()</span>
<span class="sd">        use wait_settle to wait for the soak to complete</span>
<span class="sd">        defaults to window = 3, soak=30</span>
<span class="sd">        extra data</span>
<span class="sd">           _sense - the sensed temperature</span>
<span class="sd">           _window - the temperature window</span>
<span class="sd">           _time - the total settling time (including soak)</span>
<span class="sd">           _soak - the programmed soak time&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">en_compressor</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Optionally disable compressor on startup&#39;&#39;&#39;</span>
        <span class="c">#needs enable/compressor channel work</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;temptronic_4310&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;temptronic_4310 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soak</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air2dut</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxair</span> <span class="o">=</span> <span class="mi">170</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DUTM 1&quot;</span><span class="p">)</span> <span class="c">#use dut measurement</span>
        <span class="k">if</span> <span class="n">en_compressor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;COOL 1&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Enabling Compressor... &quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">70</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Compressor Enabled&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="temptronic_4310.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper method to add most commonly used channels.</span>
<span class="sd">        channel_name represents temperature setpoint.</span>
<span class="sd">        optionlayy also adds _sense_dut, _sense_air, _soak, _window, and _soak_settling_time channels.&#39;&#39;&#39;</span>
        <span class="n">temp_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_temp</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_sense_dut</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_sense_dut&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_sense_air</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_sense_air&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_soak&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_window</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_window&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak_settling_time</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_soak_settling_time&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_channel</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_temp"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_temp">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel_name represents PID loop forcing temperature setpoint.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_temperature</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_sense_dut"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_sense_dut">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_sense_dut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents primary PID control loop thermocouple readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span>  <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TMPD?&quot;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_sense_air"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_sense_air">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_sense_air</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents secondary air stream thermocouple readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TMPA?&quot;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_soak"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_soak">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_soak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents soak time setpoint in seconds. Soak timer runs while temperature is continuously within &#39;window&#39; and resets to zero otherwise.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_soak</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_window"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_window">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents width setpoint of tolerance window to start soak timer. Setpoint is total window width in degrees (temp must be +/-window/2).&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_window</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_soak_settling_time"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_soak_settling_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_soak_settling_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents soak timer elapsed time readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_max_air"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_max_air">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_max_air</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents maximum airflow temperature setting.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_max_air</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxair</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temptronic_4310.add_channel_max_air2dut"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.add_channel_max_air2dut">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_max_air2dut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents maximum allowed temperature difference between airflow and dut setting.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_max_air2dut</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">air2dut</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_max_air</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">air2dut</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">_set_max_air2dut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxair</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">_set_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set allowed window to start soak timer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;WNDW &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_soak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set soak time in seconds&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soak</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;SOAK &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
<div class="viewcode-block" id="temptronic_4310.off"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temptronic_4310.off">[docs]</a>    <span class="k">def</span> <span class="nf">off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Turn off airflow and compressor, lift head, reset limits&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FLOW 0;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;HEAD 0;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;COOL 0;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ULIM {};&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">155</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set temperature&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SETN &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;SETP &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;WNDW &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;;ADMD &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">air2dut</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s">&quot;;ULIM &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxair</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;; SOAK &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FLOW 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_settle</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_wait_settle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Block until temperature has been within window for soak time.&#39;&#39;&#39;</span>
        <span class="n">settled</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span><span class="p">(</span><span class="n">settled</span> <span class="o">==</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">5</span>
            <span class="k">print</span> <span class="s">&quot;Waiting To Settle to &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; : &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;s&quot;</span><span class="p">,</span>
            <span class="n">tecr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TECR?&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">tecr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">settled</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<span class="k">class</span> <span class="nc">autonicstk</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_raw_serial</span><span class="p">,</span> <span class="n">modbus_address</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">PyICe.deps.modbus</span> <span class="kn">import</span> <span class="n">minimalmodbus</span>
        <span class="c">#minimalmodbus.BAUDRATE = 38400</span>
        <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">BAUDRATE</span> <span class="o">=</span> <span class="mi">9600</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Autonics TK Series PID&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Autonics PID @ {}:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">,</span><span class="n">modbus_address</span><span class="p">))</span>
        <span class="c">#self.add_interface_raw_serial(interface_raw_serial,timeout=5)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sp</span> <span class="o">=</span> <span class="n">interface_raw_serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_address</span> <span class="o">=</span> <span class="n">modbus_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span> <span class="o">=</span> <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">,</span><span class="n">modbus_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">stopbits</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">def</span> <span class="nf">add_basic_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_setpoint</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_measured</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_enable_output</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_advanced_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_mode</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_units</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_presets</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_heat_mv</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_cool_mv</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_alarm1</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_alarm2</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_autotune</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channels_tuning</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_sensor_type</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channels_alarm_config</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_decimal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>        
    <span class="k">def</span> <span class="nf">add_channel_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Measured Temperature Readback (PV)&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="s">&#39;{}_PV&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_temperature_sense</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Measure&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_measured</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_temperature_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_units</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Select Celsius or Farenheit. CAUTION: Units also change PID gains.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Units&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">151</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">151</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Celsius&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Farenheit&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Set&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_units</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_setpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Target Temperature Setpoint (SV)&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">retry_count</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_temperature</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Set&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_setpoint</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">165</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_heat_mv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Heater percent power manipulated variable (MV). Can be written directly in manual mode.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_MV_Heat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Heat&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_heat_mv</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_cool_mv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Cooler percent power manipulated variable (MV). Can be written directly in manual mode.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_MV_Cool&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Cool&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_cool_mv</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Automatic/Manual mode selector. Automatic uses temperature setpoint (SV). Manual uses heat and cool MV setpoints.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Mode&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Auto&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Manual&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Enables&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_mode</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_presets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Select one of 4 pre-selected temperatures.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Preset&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="c">#new_register.add_preset(&#39;Beef&#39;,0)</span>
        <span class="c">#new_register.add_preset(&#39;Pork&#39;,1)</span>
        <span class="c">#new_register.add_preset(&#39;Vegetable&#39;,2)</span>
        <span class="c">#new_register.add_preset(&#39;Yogurt&#39;,3)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Set&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_presets</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_alarm1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alarm 1 output status.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="s">&#39;{}_Alarm1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                       <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">1006</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">9</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Alarm&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm1&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_alarm1</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_alarm2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Alarm 2 output status.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="s">&#39;{}_Alarm2&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                       <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">1006</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">10</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;OK&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Alarm&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm2&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_alarm2</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_enable_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Enable/Disable heat and cool outputs.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_enable&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Run&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Stop&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Enables&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_enable_output</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">0</span> <span class="k">if</span> <span class="n">enable</span> <span class="k">else</span> <span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_heat_cool_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;enable heat only, cool only or heat-cool mode&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_heat_cool_mode&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">162</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">162</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Heat&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Cool&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Heat-Cool&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Enables&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_heat_cool_mode</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_autotune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Start autotune sequence.&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Autotune&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Run&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Stop&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_autotune</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channels_tuning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;PID control gain settings. See: https://en.wikipedia.org/wiki/PID_controller#Alternative_nomenclature_and_PID_forms&#39;&#39;&#39;</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Heat_Proportional&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Reciprocal heat proportional gain. Number of degrees over which the heat output transistion from 0</span><span class="si">%-100%</span><span class="s"> output due to proportional error alone.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Cool_Proportional&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Reciprocal cool proportional gain. Number of degrees over which the heat output transistion from 100</span><span class="si">%-0%</span><span class="s"> output due to proportional error alone.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Heat_Integral&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">103</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Heat integral time. Number of seconds over which the (measured) process variable will change from proportial residual error to zero error.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Cool_Integral&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Cool integral time. Number of seconds over which the (measured) process variable will change from proportial residual error to zero error.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Heat_Derivative&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Heat derivitive time. Scaling constant to map degrees/s (rate) into degrees of apparent error.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Cool_Derivative&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">106</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Cool derivitive time. Scaling constant to map degrees/s (rate) into degrees of apparent error.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Heat_Hysteresis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                         <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                         <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">109</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                         <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">109</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Heat hysteresis. Dead band for heat loop only. Not used with PID proportional output mode.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Cool_Hysteresis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                         <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                         <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                         <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Cool hysteresis. Dead band for cool loop only. Not used with PID proportional output mode.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Deadband&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                         <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                         <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                         <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Dead band between heat and cool loops. Negative value causes class-A operation.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_SSR1_Mode&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                         <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                         <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">166</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                         <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">166</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Standard&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Cycle&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Phase&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&quot;Heat PWM mode. &#39;Standard&#39; uses &#39;Heating_Control_Time&#39; setting. &#39;Cycle&#39; powers/unpowers the heater over whole power line cycles. &#39;Phase&#39; synchronously dims the heater by delaying turn-on during each power line cycle.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Heating_Control_Time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                         <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                         <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">170</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                         <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">170</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&quot;Heat control PWM period when in &#39;Standard&#39; SSR1_Mode.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Cooling_Control_Time&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">171</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">171</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&quot;Cool control PWM period.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_sensor_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Sensor&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Thermocouple_K_high&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Thermocouple_K_low&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;DIN_Pt100_high&#39;</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;DIN_Pt100_low&#39;</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
        
        <span class="c">#new_register.add_preset(&#39;PT100&#39;,0)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;PID_tuning&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;Temperature sensor type selection.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_alarm1_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_alarm2_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channels_alarm_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_low_limit&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">53</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_high_limit&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">54</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_alarm1_high</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_hysteresis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">202</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">202</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_Relay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">203</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">203</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Normally Open&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Normally Closed&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_on_delay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">204</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_off_delay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">205</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">205</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm1_mode&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Off&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High Limit&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation Low Limit&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High/Low Limit&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High/Low Limit Reverse&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Absolute High Limit&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Absolute Low Limit&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Loop Break&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Sensor Break&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Heater Burnout&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_low_limit&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_high_limit&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">56</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">signed</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_alarm2_high</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="mi">199</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_hysteresis&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">208</span><span class="p">,</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">208</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">numberOfDecimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_decimal</span><span class="p">(),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_Relay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>        
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">209</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">209</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Normally Open&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Normally Closed&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_on_delay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_off_delay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">211</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">211</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        <span class="n">new_register</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="s">&#39;{}_Alarm2_mode&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">),</span>
                                <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="mi">206</span><span class="p">,</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="mi">206</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Off&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High Limit&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation Low Limit&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High/Low Limit&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Deviation High/Low Limit Reverse&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Absolute High Limit&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Absolute Low Limit&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Loop Break&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Sensor Break&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Heater Burnout&#39;</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_read</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">use_presets_write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;Alarm_config&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">retry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">retry_count</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cmd</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="k">print</span> <span class="s">&#39;Flushed: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">retry_count</span><span class="o">=</span><span class="n">retry_count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Flushed: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
                <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">modbus_relay</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serial_port</span><span class="p">,</span> <span class="n">modbus_address</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">PyICe.deps.modbus</span> <span class="kn">import</span> <span class="n">minimalmodbus</span>
        <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">BAUDRATE</span> <span class="o">=</span> <span class="mi">9600</span>
        <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;2-channel Modbus RTU relay&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Modbus Dual Relay @ {}:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serial_port</span><span class="p">,</span> <span class="n">modbus_address</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span> <span class="o">=</span> <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">serial_port</span><span class="p">,</span> <span class="n">modbus_address</span><span class="p">)</span>
        <span class="c">#self.modbus_relay.debug = True</span>
        <span class="c">#self.modbus_relay.serial.stopbits = 1</span>
        <span class="c">#self.modbus_relay.serial.timeout = 1</span>
    <span class="k">def</span> <span class="nf">add_channel_relay1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="o">=</span><span class="s">&#39;relay1&#39;</span><span class="p">):</span>
        <span class="n">new_register</span> <span class="o">=</span>  <span class="n">register</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="n">registeraddress</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                 <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">relay_number</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">relay_number</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;relay&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_relay2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="o">=</span><span class="s">&#39;relay2&#39;</span><span class="p">):</span>
        <span class="n">new_register</span> <span class="o">=</span>  <span class="n">register</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span>
                                 <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span><span class="o">.</span><span class="n">read_register</span><span class="p">(</span><span class="n">registeraddress</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">functioncode</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
                                 <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">data</span><span class="p">,</span> <span class="n">relay_number</span><span class="o">=</span><span class="mi">2</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">relay_number</span><span class="p">))</span>
        <span class="n">new_register</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="s">&#39;relay&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_register</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">relay_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span><span class="o">.</span><span class="n">write_register</span><span class="p">(</span><span class="n">registeraddress</span><span class="o">=</span><span class="n">relay_number</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">256</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="mi">512</span><span class="p">),</span> <span class="n">functioncode</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">())</span>

<div class="viewcode-block" id="temperature_chamber"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber">[docs]</a><span class="k">class</span> <span class="nc">temperature_chamber</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;generic temperature chamber parent class to handle common tasks&#39;&#39;&#39;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMeta</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soak</span> <span class="o">=</span> <span class="mi">450</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settle_time_limit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="mf">2.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_blocking_mode</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="temperature_chamber.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper method to add most commonly used channels.</span>
<span class="sd">        channel_name represents temperature setpoint.</span>
<span class="sd">        optionally also adds _sense, _soak, _window, and _soak_settling_time channels.&#39;&#39;&#39;</span>
        <span class="n">temp_ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_temp</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_sense</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_sense&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_soak&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_window</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_window&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak_settling_time</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_soak_settling_time&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_blocking</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_blocking&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_enable</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_enable&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_ch</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_temp"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_temp">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel_name represents PID loop forcing temperature setpoint.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_temperature</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_temp</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_sense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_sense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents primary PID control loop thermocouple readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_temperature_sense</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_sense</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_soak"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_soak">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_soak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents soak time setpoint in seconds. Soak timer runs while temperature is continuously within &#39;window&#39; and resets to zero otherwise.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_soak</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_window"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_window">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents width setpoint of tolerance window to start soak timer. Setpoint is total window width in degrees (temp must be +/-window/2).&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_window</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_window</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_soak_settling_time"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_soak_settling_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_soak_settling_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents soak timer elapsed time readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_soak_settling_time</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_settle_time_limit"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_settle_time_limit">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_settle_time_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents max time to wait for oven to settle to within window before raising Exception.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_settle_time_limit</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settle_time_limit</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_settle_time_limit</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_blocking"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_blocking">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_blocking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;allow Python to continue immediately for gui/interactive use without waiting for slew/settle&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_blocking_mode</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_blocking</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blocking</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.add_channel_enable"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.add_channel_enable">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel name represents oven enable/disable setting.  Accepts boolean and True enables the oven.</span>
<span class="sd">        Heat and cool only settings also accepted if temperature chamber supports that.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_enable</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;True&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;False&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Heat_only&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_preset</span><span class="p">(</span><span class="s">&#39;Cool_only&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="temperature_chamber.set_blocking_mode"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.set_blocking_mode">[docs]</a>    <span class="k">def</span> <span class="nf">set_blocking_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">blocking</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;allow Python to continue immediately for gui/interactive use without waiting for slew/settle&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_blocking</span> <span class="o">=</span> <span class="n">blocking</span></div>
    <span class="k">def</span> <span class="nf">_set_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set allowed window to start soak timer.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">_set_settle_time_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set oven to standby and raise exception if oven does not settle within</span>
<span class="sd">            specified time&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settle_time_limit</span> <span class="o">=</span> <span class="n">seconds</span>
    <span class="k">def</span> <span class="nf">_set_soak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set soak time in seconds&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soak</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">_wait_settle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Block until temperature has been within window for soak time.</span>
<span class="sd">            Optionally abort, set oven to standby, and raise exception if oven temp fails to converge in specified time&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blocking</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">settled</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">progress_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">]</span>
        <span class="k">while</span><span class="p">(</span><span class="n">settled</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># 1 second delay</span>
            <span class="n">temp_current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_temperature_sense</span><span class="p">()</span>
            <span class="c">#print &quot;\rSettling {}/{}s  Current Temp:{}°C  Target Temp:{}±{}°C Total time this setting:{}s {}&quot;.format(settled,self.soak,temp_current,self.setpoint,self.window/2.0,self.time,progress_chars[self.time%len(progress_chars)]), #comma supresses newline</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c">#print doesn&#39;t make it to screen in a timely fashion without newline; windows OEM codepage doesn&#39;t support UNICODE</span>
            <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">Settling {}/{}s Current Temp:{:3.1f}C Target Temp:{:3.1f}+/-{:3.1f}C Total time this setting:{:3d}s {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">soak</span><span class="p">,</span><span class="n">temp_current</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">progress_chars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">progress_chars</span><span class="p">)]),</span> <span class="c">#comma supresses newline</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c">#print doesn&#39;t make it to screen in a timely fashion without newline</span>
            <span class="n">window_upper</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">window_lower</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp_current</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">window_upper</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp_current</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">window_lower</span><span class="p">):</span>
                <span class="n">settled</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">settled</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settle_time_limit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">settle_time_limit</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">print</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Oven failed to settle to {}C in {} seconds. Final Temp: {}C.</span><span class="se">\n</span><span class="s"> Oven Disabled. Test aborted.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">temp_current</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="c">#newline avoids overwriting oven status message with next print</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Program tempertaure setpoint to value. Implement for specific hardware.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_read_temperature_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read back actual chamber temperature.  Implement for specific hardware.&#39;&#39;&#39;</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;enable/disable temperature chamber heating and cooling. Also accepts heat/cool only arguments if chamber supports it.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="temperature_chamber.shutdown"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.temperature_chamber.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shutdown</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;separate method to turn off temperature chamber. </span>
<span class="sd">        overload if possible for individual hardware.</span>
<span class="sd">        otherwise, default to disable heating and cooling.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="ow">not</span> <span class="n">shutdown</span><span class="p">)</span>
    
</div></div>
<div class="viewcode-block" id="delta_9039"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delta_9039">[docs]</a><span class="k">class</span> <span class="nc">delta_9039</span><span class="p">(</span><span class="n">temperature_chamber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel delta 9039 oven</span>
<span class="sd">        use wait_settle to wait for the soak to complete</span>
<span class="sd">        defaults to window = 1, soak=90</span>
<span class="sd">        extra data</span>
<span class="sd">           _sense - the sensed temperature</span>
<span class="sd">           _window - the temperature window</span>
<span class="sd">           _time - the total settling time (including soak)</span>
<span class="sd">           _soak - the programmed soak time&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;delta_9039&#39;</span>
        <span class="n">temperature_chamber</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named channel to new temperature &quot;value&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SEtpoint &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_settle</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_read_temperature_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read back actual chamber temperature&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;Temperature?&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;enable/disable temperature chamber heating and cooling&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Active&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;STANdby&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="sun_ecxx"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sun_ecxx">[docs]</a><span class="k">class</span> <span class="nc">sun_ecxx</span><span class="p">(</span><span class="n">temperature_chamber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;sun ecXx oven instrument base class</span>
<span class="sd">        implements all methods common to sun ec0x and ec1x ovens&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="n">temperature_chamber</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_temperature_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read back actual chamber temperature&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TEMP?&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sun_ec0x"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sun_ec0x">[docs]</a><span class="k">class</span> <span class="nc">sun_ec0x</span><span class="p">(</span><span class="n">sun_ecxx</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;sun ec0 oven</span>
<span class="sd">        use wait_settle to wait for the soak to complete</span>
<span class="sd">        defaults to window = 1, soak=90</span>
<span class="sd">        extra data</span>
<span class="sd">           _sense - the sensed temperature</span>
<span class="sd">           _window - the temperature window</span>
<span class="sd">           _time - the total settling time (including soak)</span>
<span class="sd">           _soak - the programmed soak time&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="c">#instrument.__init__(self,&quot;sun_ec0x @ {}&quot;.format(interface_visa))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;sun_ec0x&#39;</span>
        <span class="n">sun_ecxx</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named channel to new temperature &quot;value&quot;&#39;&#39;&#39;</span>
        <span class="c">#self._standby()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">#self._active()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_settle</span><span class="p">()</span>
    <span class="c">#def _enable(self, enable):</span>
    <span class="c">#    &#39;&#39;&#39;&#39;enable temperature chamber heating and cooling&#39;&#39;&#39;</span>
    <span class="c">#    raise Exception(&#39;unimplemented. fix me!&#39;)</span>
</div>
<div class="viewcode-block" id="sun_ec1x"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sun_ec1x">[docs]</a><span class="k">class</span> <span class="nc">sun_ec1x</span><span class="p">(</span><span class="n">sun_ecxx</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;sun ec1x oven</span>
<span class="sd">        use wait_settle to wait for the soak to complete</span>
<span class="sd">        defaults to window = 1, soak=90</span>
<span class="sd">        extra data</span>
<span class="sd">           _sense - the sensed temperature</span>
<span class="sd">           _window - the temperature window</span>
<span class="sd">           _time - the total settling time (including soak)</span>
<span class="sd">           _soak - the programmed soak time</span>

<span class="sd">        upper_temp_limit (default 165) and lower_temp_limit (default -65) can be modified as properties of the sun_ec1x object outside the PyICe channel framework&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;sun_ec1x&#39;</span>
        <span class="n">sun_ecxx</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_temp_limit</span> <span class="o">=</span> <span class="mi">165</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_temp_limit</span> <span class="o">=</span> <span class="o">-</span><span class="mi">65</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SINT=NNNNNNNNNN0&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">slag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">resync</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Flushed {} characters: {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">slag</span><span class="p">),</span><span class="n">slag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="sun_ec1x.add_channel_user_sense"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sun_ec1x.add_channel_user_sense">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_user_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;channel_name represents secondary non-control thermocouple readback.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;UCHAN?&quot;</span><span class="p">)))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_user_sense</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set named channel to new temperature &quot;value&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SET={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_settle</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;individually control heat/cool outputs. Usually used through channel framework&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="o">==</span><span class="bp">False</span> <span class="ow">or</span> <span class="n">enable</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HOFF&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;COFF&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">enable</span><span class="o">==</span><span class="bp">True</span> <span class="ow">or</span> <span class="n">enable</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HON&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CON&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">enable</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="c">#heat only</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HON&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;COFF&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">enable</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="c">#cool only</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HOFF&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CON&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown oven enable value: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">enable</span><span class="p">))</span>
<div class="viewcode-block" id="sun_ec1x.shutdown"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.sun_ec1x.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shutdown</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;turn entire temp controller on or off. This is different than enabling/disabling the heat and cool outputs&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">shutdown</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;OFF&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;ON&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span></div>
    <span class="n">upper_temp_limit</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;UTL?&#39;</span><span class="p">)),</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span><span class="n">temp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;UTL={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>
    <span class="n">lower_temp_limit</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;LTL?&#39;</span><span class="p">)),</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span><span class="n">temp</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;LTL={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="Franken_oven"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.Franken_oven">[docs]</a><span class="k">class</span> <span class="nc">Franken_oven</span><span class="p">(</span><span class="n">autonicstk</span><span class="p">,</span> <span class="n">modbus_relay</span><span class="p">,</span> <span class="n">temperature_chamber</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Autonics controlled temperature chamber with Modbus remote-power relay&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_raw_serial</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">PyICe.deps.modbus</span> <span class="kn">import</span> <span class="n">minimalmodbus</span>
        <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">BAUDRATE</span> <span class="o">=</span> <span class="mi">9600</span>
        <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Autonics_Oven&#39;</span>
        <span class="c">#instrument.__init__(self,&quot;Autonics PID @ {}:1; relay @ {}:2&quot;.format(interface_raw_serial,interface_raw_serial))</span>
        <span class="n">temperature_chamber</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_raw_serial</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_pid</span> <span class="o">=</span> <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">,</span><span class="n">slaveaddress</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modbus_relay</span> <span class="o">=</span> <span class="n">minimalmodbus</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">interface_raw_serial</span><span class="p">,</span><span class="n">slaveaddress</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="c"># def add_channels(self, channel_name):</span>
        <span class="c"># self.add_channel_power_relay(&#39;{}_power_relay&#39;.format(channel_name))</span>
        <span class="c"># self.add_basic_channels(channel_name)</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">temp_channel</span> <span class="o">=</span> <span class="n">temperature_chamber</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">add_extended_channels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_power_relay</span><span class="p">(</span><span class="s">&#39;{}_power_relay&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">temp_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_power_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_relay1</span><span class="p">(</span><span class="n">channel_name</span><span class="p">)</span><span class="o">.</span><span class="n">set_category</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="n">autonicstk</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">)</span>
        <span class="c">#The following uses the Alarm1 output relay to enable/disable the heat SSR and the Alarm2 output relay to enable/disable the cool SSR</span>
        <span class="c">#Autonics Alarm wiring requires than modes both be set to &quot;Absolute High Limit&quot;</span>
        <span class="k">if</span> <span class="n">enable</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c">#heat/cool</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm1_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">199</span><span class="p">)</span> <span class="c">#alarm1 enables heat</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm2_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">199</span><span class="p">)</span> <span class="c">#alarm2 enables cool</span>
        <span class="k">if</span> <span class="n">enable</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c">#heat only</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm1_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">199</span><span class="p">)</span> <span class="c">#alarm1 enables heat</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm2_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>  <span class="c">#~alarm2 disables cool</span>
        <span class="k">elif</span> <span class="n">enable</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c">#cool only</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm1_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span> <span class="c">#~alarm1 disables heat</span>
            <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_alarm2_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">199</span><span class="p">)</span> <span class="c">#alarm2 enables cool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="n">enable</span>
    <span class="k">def</span> <span class="nf">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setpoint</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">autonicstk</span><span class="o">.</span><span class="n">_write_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_settle</span><span class="p">()</span>
<div class="viewcode-block" id="Franken_oven.shutdown"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.Franken_oven.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shutdown</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;turn entire temp controller on or off with modbus relay.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_relay</span><span class="p">(</span><span class="ow">not</span> <span class="n">shutdown</span><span class="p">,</span> <span class="n">relay_number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># class oven_w4sd(instrument):</span>
    <span class="c"># &#39;&#39;&#39;Burlington, VT Modbus oven.  Somebody in VT needs to document this instrument better.</span>
        <span class="c"># This instrument needs lots of help.  It looks like its mostly used through set_temp which as it is structured is incompatible with the channel setup</span>
        <span class="c"># most of the arguments to set temp need to be properties/attributes of this object so it can be used as a channel without sending all that crap.</span>
        <span class="c"># also, consider using PyICe.deps.modbus.minimalmodbus instead of implementing RTU protocol from scratch within driver</span>
        <span class="c"># inheritance from temperature_chamber may simplify implementation&#39;&#39;&#39;</span>
    <span class="c"># def __init__(self,interface_raw_serial,address):</span>
        <span class="c"># raise Exception(&quot;Oven_w4sd does not meet minimum quality requirements, do not use, I will try to fix this later, if someone will tell me how to use it.&quot;)</span>
        <span class="c"># &#39;&#39;&#39;what do you give this a string or an object for the serial_port&#39;&#39;&#39;</span>
        <span class="c"># self._base_name = &#39;oven_w4sd&#39;</span>
        <span class="c"># instrument.__init__(self,&quot;oven_w4sd @ {}&quot;.format(interface_raw_serial))</span>
        <span class="c"># self.address=address # this is the modbus address, not the serial port</span>
        <span class="c"># self.add_interface_raw_serial(interface_raw_serial)</span>
        <span class="c"># self.get_interface().term_chars = &quot;&quot;</span>
    <span class="c"># def add_channel(self,channel_name):</span>
        <span class="c"># self.add_channel_temp(channel_name)</span>
        <span class="c"># #self.add_channel_sense(channel_name + &quot;_sense&quot;) #need to write this method!</span>
    <span class="c"># def add_channel_temp(self,channel_name):</span>
        <span class="c"># &#39;&#39;&#39;Temp forcing channel.&#39;&#39;&#39;</span>
        <span class="c"># new_channel = channel(channel_name,write_function=self._write_temperature)</span>
        <span class="c"># self._add_channel(new_channel)</span>
    <span class="c"># def _write_temperature(self,value):</span>
        <span class="c"># value = int(value)</span>
        <span class="c"># if (value &lt; -60):</span>
            <span class="c"># print(&quot;WARNING: Temperature below -60C not allowed: &quot; + str(value))</span>
            <span class="c"># print(&quot;Setting temperature to -60C instead.&quot;)</span>
            <span class="c"># value = -60</span>
            <span class="c"># self.negtemp = 0xFF</span>
        <span class="c"># elif -60 &lt;= value &lt; 0:</span>
            <span class="c"># self.negtemp = 0xFF</span>
        <span class="c"># elif 0 &lt;= value &lt;= 180:</span>
            <span class="c"># self.negtemp = 0x00</span>
        <span class="c"># else:</span>
            <span class="c"># print(&quot;WARNING: Temperature above 180C not allowed: &quot; + str(value))</span>
            <span class="c"># print(&quot;Setting Temperature to 180C instead.&quot;)</span>
            <span class="c"># value = 180</span>
            <span class="c"># self.negtemp = 0x00</span>
        <span class="c"># #find twos comp for neg temp</span>
        <span class="c"># if value &lt; 0:          #check for neg temp</span>
            <span class="c"># value = abs(value)    #remove sign</span>
            <span class="c"># value ^= 0xFF #Restricted to unsigned 8bit but python is 32bit, so convert</span>
            <span class="c"># value = value + 0x01              #xor and add one. exp. -1, two&#39;s complement</span>
        <span class="c"># self.modbus_write.write(300,self.negtemp,value)</span>
    <span class="c"># def off(self):</span>
        <span class="c"># self._write_temperature(25)</span>
    <span class="c"># def set_temp(self,temp_setting,lb,temp_meas_channel=&quot;temp_meas&quot;,settletime=120,\</span>
                <span class="c"># settle_limit_temp_meas=2.0,oven_channel=None):</span>
        <span class="c"># # method for setting oven temperature and waiting to settle</span>
        <span class="c"># # default: settling is defined as temp_meas staying within +/- 2 for 120 sec</span>
        <span class="c"># # reads temperature (channel name default &quot;temp_meas&quot;)</span>
        <span class="c"># # temp_meas can be a thermocouple or die temp reading, etc, but must have units of degrees C</span>
        <span class="c"># # 30 min max settling time, or 2X settle time, whichever is longer</span>
        <span class="c"># # returns true if temperature settles in time limit, otherwise false</span>
        <span class="c"># time_limit = max(30*60.0,2*settletime)</span>
        <span class="c"># time_step = 15.0 # check temp every 15 seconds</span>
        <span class="c"># settle_steps = int(float(settletime)/time_step)</span>
        <span class="c"># init_force_delta = 5.0 # initially set oven 5C past target temp to speed up settling</span>
        <span class="c"># init_force_delta_hot = 10.0 # initial setting 10C pas target for temp &gt; 100</span>
        <span class="c"># settle_limit_temp_meas_init = 0 # force &gt;0 overshoot</span>
        <span class="c"># if oven_channel is None:</span>
            <span class="c"># oven_channel = self.channels[0]</span>
        <span class="c"># #</span>
        <span class="c"># if temp_setting &gt; float(lb.read_channel(temp_meas_channel)):</span>
            <span class="c"># if temp_setting &lt; 100:</span>
                <span class="c"># temp_oven = temp_setting + init_force_delta</span>
            <span class="c"># else:</span>
                <span class="c"># temp_oven = temp_setting + init_force_delta_hot</span>
        <span class="c"># else:</span>
                <span class="c"># temp_oven = temp_setting - init_force_delta</span>
        <span class="c"># self.write_channel(oven_channel,temp_oven)</span>
        <span class="c"># start_time = time.time()</span>
        <span class="c"># print(&quot;Monitoring temperature for settling&quot;)</span>
        <span class="c"># settled = False</span>
        <span class="c"># check_time = start_time</span>
        <span class="c"># # initial temp drive only if off by more than 0.5*tolerance</span>
        <span class="c"># if abs(float(lb.read_channel(temp_meas_channel)) - \</span>
           <span class="c"># (temp_setting-settle_limit_temp_meas_init)) &gt; \</span>
           <span class="c"># 0.5*settle_limit_temp_meas:</span>
            <span class="c"># while (time.time() &lt; start_time + time_limit) and not settled:</span>
                <span class="c"># check_time += time_step</span>
                <span class="c"># while time.time() &lt; check_time:</span>
                    <span class="c"># pass</span>
                <span class="c"># if temp_oven &gt; temp_setting:</span>
                    <span class="c"># #ramping up, check for &gt; setting-delta</span>
                    <span class="c"># settled = float(lb.read_channel(temp_meas_channel)) \</span>
                              <span class="c"># &gt; (temp_setting-settle_limit_temp_meas_init)</span>
                <span class="c"># else:</span>
                    <span class="c"># #ramping down, check for &lt; setting+delta</span>
                    <span class="c"># settled = float(lb.read_channel(temp_meas_channel)) \</span>
                              <span class="c"># &lt; (temp_setting+settle_limit_temp_meas_init)</span>
        <span class="c"># # now adjust the final oven setting empirically</span>
        <span class="c"># if temp_setting &lt; 0:</span>
            <span class="c"># temp_oven = temp_setting - 3.0</span>
        <span class="c"># elif temp_setting &lt; 50:</span>
            <span class="c"># temp_oven = temp_setting</span>
        <span class="c"># elif temp_setting &lt; 100:</span>
            <span class="c"># temp_oven = temp_setting + 2.0</span>
        <span class="c"># else:</span>
            <span class="c"># temp_oven = temp_setting + 3.0</span>
        <span class="c"># self.write_channel(oven_channel,temp_oven)</span>
        <span class="c"># # monitor for settling</span>
        <span class="c"># settled = self.monitor_temp_settle(temp_setting,start_time,time_limit,time_step,settle_steps,\</span>
                    <span class="c"># oven_channel,temp_meas_channel,settle_limit_temp_meas,lb)</span>
        <span class="c"># return settled</span>
    <span class="c"># def monitor_temp_settle(self,temp_setting,start_time,time_limit,time_step,settle_steps,\</span>
                    <span class="c"># oven_channel,temp_meas_channel,settle_limit_temp_meas,lb):</span>
        <span class="c"># check_time = time.time()</span>
        <span class="c"># temp_meas_list = []</span>
        <span class="c"># settled = False</span>
        <span class="c"># while (time.time() &lt; start_time + time_limit) and not settled:</span>
            <span class="c"># check_time += time_step</span>
            <span class="c"># #print(&quot;Waiting &quot;+str(time_step)+&quot; sec before checking temp&quot;)</span>
            <span class="c"># while time.time() &lt; check_time:</span>
                <span class="c"># pass</span>
            <span class="c"># temp_meas = float(lb.read_channel(temp_meas_channel))</span>
            <span class="c"># print(&quot;temp_meas: &quot;+str(round(temp_meas,1))+&quot;C&quot;)</span>
            <span class="c"># if abs(temp_meas-temp_setting) &gt; settle_limit_temp_meas:</span>
                <span class="c"># temp_meas_list = []</span>
                <span class="c"># temp_oven = self.read_channel(oven_channel)</span>
                <span class="c"># # detect major overshoot, set temperature to target if so</span>
                <span class="c"># if ((temp_meas &lt; temp_setting-settle_limit_temp_meas) \</span>
                   <span class="c"># and (temp_oven &lt; temp_setting)) or \</span>
                   <span class="c"># ((temp_meas &gt; temp_setting+settle_limit_temp_meas) \</span>
                   <span class="c"># and (temp_oven &gt; temp_setting)):</span>
                    <span class="c"># print(&quot;NOTE: Temperature overshoot with magnitude greater than &quot;\</span>
                          <span class="c"># +str(settle_limit_temp_meas)+&quot; detected.&quot;)</span>
                    <span class="c"># print(&quot;Setting oven temp = temp_setting&quot;)</span>
                    <span class="c"># self.write_channel(oven_channel,temp_setting)</span>
            <span class="c"># else:</span>
                <span class="c"># temp_meas_list.append(temp_meas)</span>
                <span class="c"># if len(temp_meas_list) &gt;= settle_steps:</span>
                    <span class="c"># settled = True</span>
        <span class="c"># return settled</span>
    <span class="c"># def modbus_write(self,reg,data1,data0):</span>
        <span class="c"># regH = (reg &amp; 0xFF00)&gt;&gt;8</span>
        <span class="c"># regL = reg &amp; 0x00FF</span>
        <span class="c"># moddata = [self.address, 0x06, regH, regL, data1, data0]</span>
        <span class="c"># CRCReg = 0xFFFF</span>
        <span class="c"># # first 4 numbers represent oven address register in oven</span>
        <span class="c"># # last 2 number are determined below</span>
        <span class="c"># for item in moddata:</span>
            <span class="c"># CRCRegH = CRCReg &amp; 0xFF00</span>
            <span class="c"># CRCRegL = CRCReg &amp; 0x00FF</span>
            <span class="c"># y = int(item)</span>
            <span class="c"># y = y ^ CRCRegL</span>
            <span class="c"># z = CRCRegH + y</span>
            <span class="c"># # this is the 8X routine, CRC</span>
            <span class="c"># count = 0</span>
            <span class="c"># while (count &lt; 8):  #do this 8 times, once for each bit</span>
                <span class="c"># x = z &amp; 1   #clear all but LSB</span>
                <span class="c"># z = z &gt;&gt; 1  #rotate right once</span>
                <span class="c"># if x == 1:  #test bit</span>
                    <span class="c"># z = z^0xA001   #if bit a 1 then OR, else continue</span>
                <span class="c"># count = count + 1</span>
            <span class="c"># CRCReg = z</span>
        <span class="c"># moddata.append(CRCReg&amp;0x00FF)</span>
        <span class="c"># moddata.append((CRCReg&amp;0xFF00)&gt;&gt;8)</span>
        <span class="c"># sendstring = &quot;&quot;</span>
        <span class="c"># for item in moddata:</span>
            <span class="c"># sendstring += chr(item)</span>
        <span class="c"># self.get_interface().write(sendstring)</span>
</div></div>
<div class="viewcode-block" id="agilent_e4433b"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_e4433b">[docs]</a><span class="k">class</span> <span class="nc">agilent_e4433b</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Agilent E4433B Signal Generator&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_e4433b&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;agilent_e4433b @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*RST&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">add_extended_channels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">write_output</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_extended_channels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_freq</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_freq&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_power</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_power&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">write_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">power</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_power</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_freq</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">power</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;POWER &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">power</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; DBM&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">freq</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FREQuency &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;MHZ&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">freq_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_freq</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">freq_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">power_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_power</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">power_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;FREQ?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">read_power</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;POWER?&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">enable_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTP:STAT ON&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">disable_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OUTP:STAT OFF&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="krohnhite_523"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.krohnhite_523">[docs]</a><span class="k">class</span> <span class="nc">krohnhite_523</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Krohn-Hite Model 523 Precision DC Source/Calibrator&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;krohnhite_523&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;krohnhite_523 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="c">#initialize to instrument on, value 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">float_lo_terminal</span><span class="p">()</span>  <span class="c">## float the lo terminal by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_crowbar</span><span class="p">()</span> <span class="c">## turn off crowbar by default</span>
    <span class="k">def</span> <span class="nf">ground_lo_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;g&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">float_lo_terminal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">disable_crowbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;v&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage_compliance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_compliance_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="n">current</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c">## current must be specified in mA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}mA&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="n">voltage</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">voltage</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}uV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mf">1e6</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">voltage</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}mV&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mf">1e3</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}V&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_write_compliance_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">compliance_voltage</span><span class="p">):</span>
        <span class="n">compliance_voltage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">compliance_voltage</span><span class="p">))</span>
        <span class="k">if</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">compliance_voltage</span> <span class="ow">and</span> <span class="n">compliance_voltage</span> <span class="o">&lt;=</span> <span class="mi">110</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{}C&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compliance_voltage</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Krohn-Hite 523: Invalid Compliance voltage: {}. Must be 1V to 110V&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compliance_voltage</span><span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="krohnhite_526"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.krohnhite_526">[docs]</a><span class="k">class</span> <span class="nc">krohnhite_526</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Krohn-Hite Model 526 Precision DC Source/Calibrator</span>
<span class="sd">    Driver uses 526 protocol (other protocols do not support LAN operation)</span>
<span class="sd">    Voltage Ranges are +/- 0.1V, 1V, 10V, 100V</span>
<span class="sd">    Current Ranges are +/- 10mA, 100mA</span>
<span class="sd">        CHAR   FN    ASCII CODE</span>
<span class="sd">        1      Polarity     + = Positive</span>
<span class="sd">                            0 = Crowbar</span>
<span class="sd">                            - = Negative</span>
<span class="sd">        2      MSD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        3      2SD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        4      3SD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        5      4SD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        6      5SD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        7      6SD          0 to 10 (use &#39;J&#39; for decimal 10)</span>
<span class="sd">        8      Range        0 = 100mV</span>
<span class="sd">                            1 = 1V</span>
<span class="sd">                            2 = 10V</span>
<span class="sd">                            3 = 100V</span>
<span class="sd">                            4 = 10mA</span>
<span class="sd">                            5 = 100mA</span>
<span class="sd">        9(OPT) Sense        2 = 2-Wire Mode</span>
<span class="sd">                            4 = 4-Wire Mode</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Krohn-Hite 526&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_iranges</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.01</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_vrange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># 10 V default range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_irange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="c"># 10 mA default range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sense</span> <span class="o">=</span> <span class="s">&#39;2&#39;</span> <span class="c"># default to 2-wire mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="mi">0</span>
<div class="viewcode-block" id="krohnhite_526.add_channel_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.krohnhite_526.add_channel_current">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to switch instrument to current mode and program current. Default current range is +/-10mA.  Create a irange channel to adjust range to (10, 100)mA &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_irange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="krohnhite_526.add_channel_irange"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.krohnhite_526.add_channel_irange">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_irange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to set current mode full scale range to +/-(10,100)mA.  Won&#39;t take effect until the current is programmed.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_irange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_irange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_iranges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Current range {} invalid for instrument {}. Valid ranges are {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_iranges</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_irange</span> <span class="o">=</span> <span class="nb">range</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_irange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_irange</span><span class="p">)</span>
        <span class="c">#write new range out to instrument here????</span>
        <span class="c">#print self._irange</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
                <span class="c">#determine polarity and produce _pol_char</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_pol_char</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
        <span class="k">elif</span> <span class="n">current</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_pol_char</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
        <span class="c">#always 7 digits of magnitude, decimal point ignored, pad left side with zeros</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irange</span> <span class="o">==</span> <span class="mf">0.01</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:06.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="mf">0.01</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:05.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">1000</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:05.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_irange</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:07.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">100</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span> <span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span> <span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s">&quot;{pol}{cmd}{rng}{sns}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pol</span><span class="o">=</span><span class="n">_pol_char</span><span class="p">,</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_iranges</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_irange</span><span class="p">],</span><span class="n">sns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span><span class="p">)</span>
<div class="viewcode-block" id="krohnhite_526.add_channel_vrange"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.krohnhite_526.add_channel_vrange">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_vrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to set voltage mode full scale range to +/-(0.1,1,10,100)V or +/-(10,100)mA.  Won&#39;t take effect until the voltage is programmed.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_vrange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_vrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Voltage range {} invalid for instrument {}. Valid ranges are {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">=</span> <span class="nb">range</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span><span class="o">.</span><span class="n">set_max_write_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_channel</span><span class="o">.</span><span class="n">set_min_write_limit</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">)</span>
        <span class="c">#write new range out to instrument here????</span>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="c">#determine polarity and produce _pol_char</span>
        <span class="k">if</span> <span class="n">voltage</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_pol_char</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
        <span class="k">elif</span> <span class="n">voltage</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">_pol_char</span> <span class="o">=</span> <span class="s">&#39;-&#39;</span>
        <span class="c">#always 7 digits of magnitude, decimal point ignored, pad left side with zeros</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="c">#seven digits after decimal</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:06.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:05.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="o">-</span><span class="mi">1000000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:05.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="o">+</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c">#two digits before decimal, five after</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:07.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c">#one digit before decimal, five after</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:07.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c"># #four digits before decimal, three after</span>
            <span class="c"># cmd = &#39;{:07.4f}&#39;.format(voltage)</span>
            <span class="c"># if voltage == 100:</span>
                <span class="c"># cmd = &#39;J&#39; + &#39;{:06.4f}&#39;.format(voltage-100)</span>
            <span class="c"># if voltage == -100:</span>
                <span class="c"># cmd = &#39;J&#39; + &#39;{:06.4f}&#39;.format(voltage+100)</span>
            
            <span class="c">#four digits before decimal, three after</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">voltage</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">voltage</span><span class="o">&gt;-</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:08.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">voltage</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:07.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;{:07.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="o">-</span><span class="mi">100</span><span class="p">:</span>
                <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;J&#39;</span> <span class="o">+</span> <span class="s">&#39;{:06.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span> <span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span> <span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s">&quot;{pol}{cmd}{rng}{sns}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pol</span><span class="o">=</span><span class="n">_pol_char</span><span class="p">,</span><span class="n">cmd</span><span class="o">=</span><span class="n">cmd</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">],</span><span class="n">sns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="data_precision_8200"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.data_precision_8200">[docs]</a><span class="k">class</span> <span class="nc">data_precision_8200</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Data Precision GPIB controlled precision DC Voltage/Current Source</span>
<span class="sd">    Voltage Ranges are +/- 1V, 10V, 100V, 1000V</span>
<span class="sd">    Current Range is +/- 100mA</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Data Precision 8200&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;{} @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">=</span> <span class="mi">10</span> <span class="c">#volt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_control</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">local_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">term_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">term_chars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">term_chars</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c">#need to remove any carriage return or line feed added by visa for this to work correctly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;L&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">term_chars</span> <span class="o">=</span> <span class="n">term_chars</span>
<div class="viewcode-block" id="data_precision_8200.add_channel_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.data_precision_8200.add_channel_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to switch instrument to voltage mode and program voltage. Default voltage range is +/-10V.  Create a vrange channel to adjust range to (0.1,10,100,1000)V</span>
<span class="sd">        +/-100mV range has 0.1uV resolution, output impedance 100 Ohm</span>
<span class="sd">        +/-10V range has 10uV resolution, output impedance 10 mOhm, max current 100mA</span>
<span class="sd">        +/-100V range has 100uV resolution, output impedance 20 mOhm, max current 10mA</span>
<span class="sd">        +/-1000V range specifications are unknown</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="data_precision_8200.add_channel_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.data_precision_8200.add_channel_current">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to switch instrument to current mode and program current between +/-100mA</span>
<span class="sd">        Voltage compliance is +/-10V&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_current</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="data_precision_8200.add_channel_vrange"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.data_precision_8200.add_channel_vrange">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_vrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write channel to set voltage mode full scale range to +/-(0.1,10,100,1000)V</span>
<span class="sd">        Takes immediate effect when in voltage mode, cached until switch to voltage mode when in current mode</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_vrange</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="data_precision_8200.add_channel_mode"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.data_precision_8200.add_channel_mode">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel returns &#39;V&#39; when in Voltage mode and &#39;A&#39; when in current mode&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_mode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">voltage</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">voltage</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="ow">or</span> <span class="n">voltage</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Voltage setting {}V invalid for instrument {} range {}V&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span><span class="p">))</span>
        <span class="c">#always 7 digits of magnitude, decimal point ignored</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="c">#seven digits after decimal</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;V0{:+08.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c">#two digits before decimal, five after</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;V1{:+09.5f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c">#three digits before decimal, four after</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;V2{:+09.4f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="c">#four digits before decimal, three after</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;V3{:+09.3f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="o">=</span> <span class="n">voltage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s">&#39;V&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">current</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="ow">or</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">:</span>
             <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Current setting {}A invalid for instrument {} (+/-100mA max)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="c">#always 6 digits of magnitude, decimal point ignored</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;A{:+07.0f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current</span> <span class="o">=</span> <span class="n">current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_vrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">range</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_vrange</span> <span class="o">=</span> <span class="nb">range</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Voltage range {} invalid for instrument {}. Valid ranges are {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">range</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">_valid_vranges</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_voltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_voltage</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_get_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
</div>
<div class="viewcode-block" id="agilent_35670a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_35670a">[docs]</a><span class="k">class</span> <span class="nc">agilent_35670a</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Agilent 35670a 100kHz Signal Analyzer</span>
<span class="sd">        This driver is not complete and only supports noise measurements at this time.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_35670a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;a35670 @ &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">freqs</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">12.5</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">100000</span><span class="p">],</span> <span class="n">res</span><span class="o">=</span><span class="p">[</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">600</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="n">freqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mb">0b000100010000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SYSTem:PRESet&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INSTrument:SELect FFT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INP2 OFF&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:REJect:STATe ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut1:LOW FLOat&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;INPut1:COUPling DC&quot;</span><span class="p">)</span>
<span class="c">#        self.interface.write(&quot;VOLTage1:RANGe:AUTO 1&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VOLTage1:RANGe 1.0 VPK&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:AVERage ON&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:AVERage:TYPE RMS&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:SWEep:OVERlap 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CALC1:UNIT:VOLTage </span><span class="se">\&quot;</span><span class="s">V/RTHZ</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CALibration:AUTO ONCE&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ABORt;:INIT&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FORMat:DATA ASCii&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_num</span><span class="p">)</span>
<div class="viewcode-block" id="agilent_35670a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_35670a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument.&#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_channel</span><span class="p">(</span><span class="n">channel_num</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="agilent_35670a.read_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_35670a.read_channel">[docs]</a>    <span class="k">def</span> <span class="nf">read_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing meter measurement.  Units are {} etc depending on meter configuration.&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Start : {}, Stop : {}&#39;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:FREQuency:STARt &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:FREQuency:STOP &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:FREQuency:RESolution &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SENSe:AVERage:COUNt &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ABORt;:INIT:IMM&quot;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;STATus:OPERation:CONDition?&quot;</span><span class="p">))</span>
            <span class="c">#condition? returns the sum of the decimal weights of all bits currently set to 1 i the operation status condition register</span>
            <span class="c">#BIT(WEIGHT)Description</span>
            <span class="c">#0(1)Calibrating</span>
            <span class="c">#1(2)Settling</span>
            <span class="c">#2(4)Ranging</span>
            <span class="c">#3(8)</span>
            <span class="c">#4(16)Measuring</span>
            <span class="c">#5(32)Waiting for Trig</span>
            <span class="c">#6(64)Waiting for Arm</span>
            <span class="c">#7(128)</span>
            <span class="c">#8(256)Averaging</span>
            <span class="c">#9(512)Hardcopy in Progress</span>
            <span class="c">#10(1024)Waiting for Accept/Reject</span>
            <span class="c">#11(2048)Loading Waterfall</span>
            <span class="c">#12(4096)</span>
            <span class="c">#13(8192)</span>
            <span class="c">#14(16384)Program Running</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">test</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
            <span class="c">#loop waiting for averaging to complete</span>
            <span class="k">while</span> <span class="n">test</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;STATus:OPERation:CONDition?&quot;</span><span class="p">))</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s"> MEASURING {}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress_chars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">progress_chars</span><span class="p">)]),</span> 
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
                <span class="n">test</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span> <span class="c">#will only equal zero if averaging is complete</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;CALC&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channel_num</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:X:DATA?&quot;</span><span class="p">))</span>
            <span class="n">ydata</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;CALC&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">channel_num</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:DATA?&quot;</span><span class="p">))</span>
            <span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">xlist</span> <span class="o">=</span> <span class="n">xdata</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">ylist</span> <span class="o">=</span> <span class="n">ydata</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="c">#An undocumented &quot;feature&quot; of the 35670A is that it returns more X data points than you have set up for</span>
            <span class="c">#lines of resolution, while all you see on the display is one point per line of resolution continuously</span>
            <span class="c">#connected. The extra data is aliased data that is not used in the display. Unfortunately, the programmer</span>
            <span class="c">#has to take care of this data when the trace data is transferred across GPIB.</span>
            <span class="c">#RES | Array Size</span>
            <span class="c">#400 | 513</span>
            <span class="c">#800 | 1025</span>
            <span class="c">#1600 | 2049</span>
            <span class="c">#the if statements below take care of this</span>
            <span class="n">test</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ylist</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">101</span><span class="p">:</span>
                <span class="n">xlist</span> <span class="o">=</span> <span class="n">xlist</span><span class="p">[:</span><span class="mi">101</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">201</span><span class="p">:</span>
                <span class="n">xlist</span> <span class="o">=</span> <span class="n">xlist</span><span class="p">[:</span><span class="mi">201</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
                <span class="n">xlist</span> <span class="o">=</span> <span class="n">xlist</span><span class="p">[:</span><span class="mi">401</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">801</span><span class="p">:</span>
                <span class="n">xlist</span> <span class="o">=</span> <span class="n">xlist</span><span class="p">[:</span><span class="mi">801</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">test</span> <span class="o">==</span> <span class="mi">1601</span><span class="p">:</span>
                <span class="n">xlist</span> <span class="o">=</span> <span class="n">xlist</span><span class="p">[:</span><span class="mi">1601</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xlist_final</span> <span class="o">=</span> <span class="n">xlist</span>
                <span class="n">ylist_final</span> <span class="o">=</span> <span class="n">ylist</span>
            <span class="k">elif</span> <span class="n">ii</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xlist_final</span> <span class="o">=</span> <span class="n">xlist_final</span> <span class="o">+</span> <span class="n">xlist</span>
                <span class="n">ylist_final</span> <span class="o">=</span> <span class="n">ylist_final</span> <span class="o">+</span> <span class="n">ylist</span>
        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;freq&quot;</span><span class="p">:</span><span class="n">xlist_final</span><span class="p">,</span><span class="s">&quot;noise&quot;</span><span class="p">:</span><span class="n">ylist_final</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dictionary</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="powermux"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux">[docs]</a><span class="k">class</span> <span class="nc">powermux</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Boston Design Center 8x8 crosspoint relay mux + 4 aux channels, this needs an example of how to use AUX channels&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;powermux&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;powermux @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="s">&quot;aux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">## aux relays are treated as x=0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">board</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">add_channel_relay_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">):</span>
        <span class="n">relay_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">closed</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_relay</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">row_name</span><span class="p">,</span> <span class="n">closed</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">relay_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">column_number</span><span class="p">,</span><span class="n">row_number</span><span class="p">):</span>
        <span class="n">relay_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">closed</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay</span><span class="p">(</span><span class="n">column_number</span><span class="p">,</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">closed</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">relay_channel</span><span class="p">)</span>
<div class="viewcode-block" id="powermux.add_column"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.add_column">[docs]</a>    <span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;register named column. num is physical column number.  valid range is [1-8] and [0] for auxiliary channels</span>
<span class="sd">            column &quot;aux&quot; is predefined &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span></div>
<div class="viewcode-block" id="powermux.add_row"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row_name</span><span class="p">,</span><span class="n">num</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;register named row. num is physical row number.  valid range is [1-8] and [1-4] for auxiliary channels</span>
<span class="sd">            column &quot;aux&quot; is predefined &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">row_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span></div>
<div class="viewcode-block" id="powermux.set_relay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.set_relay">[docs]</a>    <span class="k">def</span> <span class="nf">set_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">,</span><span class="n">closed</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open and close a relay by row/column names&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_relay</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_relay</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_number</span><span class="p">,</span><span class="n">row_number</span><span class="p">,</span><span class="n">closed</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">&quot;{}{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span><span class="n">column_number</span><span class="p">,</span><span class="n">row_number</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CLOSe (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OPEN (@{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
<div class="viewcode-block" id="powermux.close_relay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.close_relay">[docs]</a>    <span class="k">def</span> <span class="nf">close_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close relay at named (column, row)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">row_name</span><span class="p">],</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
<div class="viewcode-block" id="powermux.open_relay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.open_relay">[docs]</a>    <span class="k">def</span> <span class="nf">open_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">column_name</span><span class="p">,</span><span class="n">row_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open relay at named (column, row)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">row_name</span><span class="p">],</span> <span class="n">closed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_set_relay_wdelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">relay_list</span><span class="p">,</span><span class="n">closed</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close or open list of relays at named (column, row) with delay between each&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
            <span class="n">command_string</span> <span class="o">=</span> <span class="s">&quot;CLOSe&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">command_string</span> <span class="o">=</span> <span class="s">&quot;OPEN&quot;</span>
        <span class="n">command_string</span> <span class="o">+=</span> <span class="s">&quot;:DELay (@{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">relay</span> <span class="ow">in</span> <span class="n">relay_list</span><span class="p">:</span>
            <span class="n">column_number</span> <span class="o">=</span> <span class="n">relay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">row_number</span> <span class="o">=</span> <span class="n">relay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">command_string</span> <span class="o">+=</span> <span class="s">&quot;,{}{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">,</span><span class="n">column_number</span><span class="p">,</span><span class="n">row_number</span><span class="p">)</span>
        <span class="n">command_string</span> <span class="o">+=</span> <span class="s">&quot;)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command_string</span><span class="p">)</span>
<div class="viewcode-block" id="powermux.close_relay_wdelay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.close_relay_wdelay">[docs]</a>    <span class="k">def</span> <span class="nf">close_relay_wdelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">relay_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close list of relays at named (column, row) with delay between each&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay_wdelay</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span><span class="n">relay_list</span><span class="p">,</span><span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
<div class="viewcode-block" id="powermux.open_relay_wdelay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.open_relay_wdelay">[docs]</a>    <span class="k">def</span> <span class="nf">open_relay_wdelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delay</span><span class="p">,</span><span class="n">relay_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open list of relays at named (column, row) with delay between each&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay_wdelay</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span><span class="n">relay_list</span><span class="p">,</span><span class="n">closed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>
<div class="viewcode-block" id="powermux.open_all"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.open_all">[docs]</a>    <span class="k">def</span> <span class="nf">open_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sync_channels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open all relays, set sync_channels to true to keep the channels synced (no need to do this if shutting down)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sync_channels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">relay_channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_channels_list</span><span class="p">():</span>
                <span class="n">relay_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OPEN ALL&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="powermux.test"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.powermux.test">[docs]</a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;run the built in test routine&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*TST?&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="hp_3458a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a">[docs]</a><span class="k">class</span> <span class="nc">hp_3458a</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;HP 3458A MULTIMETER&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;hp_3458a&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;hp_3458a @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;RESET&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;END 1&#39;</span><span class="p">)</span> <span class="c"># EOI line set true with last byte of last reading</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dc_voltage</span><span class="p">()</span>
<div class="viewcode-block" id="hp_3458a.config_dc_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.config_dc_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure DC volts.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [0-1000] and set range to [AUTO or 0.12, 1.2, 12, 120, 1000]&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span> <span class="o">=</span> <span class="n">NPLC</span>
        <span class="c">#valid NPLC range is 0 to 1000; Default is set to 50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;NPLC &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="c">#range is actually the maximum input voltage the user will apply to the input. The meter then</span>
        <span class="c">#selects the best fixed range.  Not &#39;range&#39; in arguments to keep things backwards compatible</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNC DCV, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FUNC DCV, AUTO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM HOLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIG AUTO&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.config_dc_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.config_dc_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure DC current.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [0-1000] and set range to [AUTO or 0.12E-6, 1.2E-6, 12E-6, 120E-6, 1.2E-3, 12E-3, 120E-3, 1.2]&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span> <span class="o">=</span> <span class="n">NPLC</span>
        <span class="c">#valid NPLC range is 0 to 1000; Default is set to 50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;NPLC &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="c">#range is optional string value that is the manual range the meter should operate in.</span>
        <span class="c">#valid values are in volts: 0.01, 0.1, 1, 3</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNC DCI, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FUNC DCI, AUTO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM HOLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIG AUTO&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.config_ac_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.config_ac_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure AC volts.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [0-1000] and set range to [AUTO or 0.012, 0.12, 1.2, 12, 120, 1000]&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span> <span class="o">=</span> <span class="n">NPLC</span>
        <span class="c">#valid NPLC range is 0 to 1000; Default is set to 50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;NPLC &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="c">#range is optional string value that is the manual range the meter should operate in.</span>
        <span class="c">#valid values are in volts: 0.01, 0.1, 1, 3</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNC ACV, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FUNC ACV, AUTO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM HOLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIG AUTO&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.config_ac_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.config_ac_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure AC current.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [0-1000] and set range to [AUTO or 0.12E-6, 1.2E-6, 12E-6, 120E-6, 1.2E-3, 12E-3, 120E-3, 1.2]&#39;&#39;&#39;</span>
        <span class="c">#TODO: confirm meter ranges.  3458 users guide inconsistent with missing range on page 222</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span> <span class="o">=</span> <span class="n">NPLC</span>
        <span class="c">#valid NPLC range is 0 to 1000; Default is set to 50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;NPLC &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="c">#range is optional string value that is the manual range the meter should operate in.</span>
        <span class="c">#valid values are in volts: 0.01, 0.1, 1, 3</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNC ACI, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FUNC ACI, AUTO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM HOLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIG AUTO&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.config_ohmf"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.config_ohmf">[docs]</a>    <span class="k">def</span> <span class="nf">config_ohmf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NPLC</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set meter to measure 4 terminal ohm.  Optionally set number of powerline cycles for integration to</span>
<span class="sd">            [0-1000] and se</span>
<span class="sd">            t range to [AUTO or 12, 120 1.2e3, 1.2e4, 1.2e5, 1.2e6, 1.2e7, 1.2e8, 1.2e9]&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span> <span class="o">=</span> <span class="n">NPLC</span>
        <span class="c">#valid NPLC range is 0 to 1000; Default is set to 50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;NPLC &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NPLC</span><span class="p">))</span>
        <span class="c">#range is optional string value that is the manual range the meter should operate in.</span>
        <span class="c">#valid values are in ohms: 0.01, 0.1, 1, 3</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FUNC OHMF, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;FUNC OHMF, AUTO&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM HOLD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIG AUTO&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument.  Defaults to DC volts.&#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_meter</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="hp_3458a.read_meter"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.read_meter">[docs]</a>    <span class="k">def</span> <span class="nf">read_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return float representing meter measurement.&#39;&#39;&#39;</span>
        <span class="c">#why does float conversion raise exception? - TODO: Debug!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TARM SGL, 1&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">())</span></div>
<div class="viewcode-block" id="hp_3458a.display"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_3458a.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Write message to instrument front panel display.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DISP MSG,&quot;&#39;</span> <span class="o">+</span> <span class="n">message</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
</div></div>
<span class="k">class</span> <span class="nc">rl1000</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">delegator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">serial_number</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Serial number is unique to every RL1000 and printed on a label attached to the enclosure&#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">PyICe.deps.RL1000.RL1000_CLASS</span> <span class="kn">as</span> <span class="nn">RL1000_CLASS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Reay_Labs_RL1000_Efficieny_Meter&#39;</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="o">=</span> <span class="n">serial_number</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span> <span class="o">=</span> <span class="n">RL1000_CLASS</span><span class="o">.</span><span class="n">rl1000</span><span class="p">(</span><span class="n">rlib</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Problem loading RL1000 WIN32 32-bit DLL.&#39;</span>
            <span class="k">print</span> <span class="s">&#39;Are you running 32-bit python on a windows platform?&#39;</span>
            <span class="k">print</span> <span class="s">&#39;Try copying &quot;RL1000.dll&quot; into c:\windows\system&#39;</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="n">meter_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span> <span class="c">#Open all meters. Returns the number found.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meter_serial_numbers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">meter_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">meter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">meter_count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_meter_number</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serial_number</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meter_serial_numbers</span><span class="p">[</span><span class="n">sn</span><span class="p">]</span> <span class="o">=</span> <span class="n">meter</span>
            <span class="n">meter_str</span> <span class="o">+=</span> <span class="s">&#39;{},&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
        <span class="n">meter_str</span> <span class="o">=</span> <span class="n">meter_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">meter_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;No RL1000 Meters Found!&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">meter_count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Connected to RL1000 Efficiency Meter serial number: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meter_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">meter_str</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">meter_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Multiple RL1000 meters present and serial number not specified: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">meter_str</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meter_serial_numbers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;RL1000 meter serial number {} not present: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span><span class="p">,</span><span class="n">meter_str</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;{}_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_serial_number</span><span class="p">()))</span> <span class="c">#choose RL1000 first by s/n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c">#omit all dll calibration methods for now</span>
    <span class="c">#omit all direct manipulation of voltage and current dacs for now</span>
    <span class="c">#omit set_timeouts</span>
    <span class="c">#omit set_current_load_digit</span>
    <span class="c">#omit set_current_load_variables</span>
    <span class="c">#omit set_autorange_sample_rate</span>
    <span class="c">#omit measure_pulse</span>
    <span class="k">def</span> <span class="nf">_dummy_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_serial_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return serial number of connected/selected RL1000 instrument.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">serial_number</span><span class="p">()</span> <span class="c">#not necessarily the meter specified for thsi instance!</span>
    <span class="k">def</span> <span class="nf">set_active_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_meter_number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meter_serial_numbers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">add_channel_current_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Measures current through &quot;CURRENT1&quot; or &quot;CURRENT2&quot; terminals.</span>
<span class="sd">        Auto-ranging on power-up.</span>
<span class="sd">        Valid channel_numbers are [1,2].&#39;&#39;&#39;</span>
        <span class="n">current_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_number</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">current_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">,</span><span class="n">channel_number</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c">#array index from measure_all() return value</span>
        <span class="n">current_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">current_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_meter</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">current_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Measures voltage across &quot;VOLTAGE1&quot; or &quot;VOLTAGE2&quot; terminals.</span>
<span class="sd">        Valid channel_numbers are [1,2].&#39;&#39;&#39;</span>
        <span class="n">voltage_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">,</span><span class="n">channel_number</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">#array index from measure_all() return value</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">voltage_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage_meter</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">voltage_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_meter_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Select full scale current meter range.</span>
<span class="sd">        Valid channel_numbers are [1,2].</span>
<span class="sd">        Range upper limits are [10uA, 100uA, 1mA, 10mA, 100mA, 1A, 10A, 30A].</span>
<span class="sd">        Write channel to None to re-enable auto-ranging.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">set_meter1_range</span><span class="p">(</span><span class="nb">range</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">range</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">enable_current_meter1_autorange</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">disable_current_meter1_autorange</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_current_meter1_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">calculate_current_meter_range</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">set_meter2_range</span><span class="p">(</span><span class="nb">range</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">range</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">enable_current_meter2_autorange</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">disable_current_meter2_autorange</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_current_meter2_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">calculate_current_meter_range</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">range_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_meter1_range</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">range_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_meter2_range</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;valid RL1000 current meter range channels are 1 and 2&#39;</span><span class="p">)</span>
        <span class="n">range_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_meter_range</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">range_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set load current on &quot;CURRENT 2&quot; terminals.</span>
<span class="sd">        Load enabled and set to 0 on power-up.</span>
<span class="sd">        Load times out and returns to 0 setting after 20 seconds.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">set_load_current</span><span class="p">(</span><span class="n">current</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_load_current</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="n">load_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_load_current</span><span class="p">))</span>
        <span class="n">load_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">load_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_load</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load_channel</span>
        <span class="c">#reset_current_load() not used</span>
    <span class="k">def</span> <span class="nf">add_channel_current_load_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Enable or disables current load on &quot;CURRENT 2&quot; terminals.</span>
<span class="sd">        Load enabled and set to 0 on power up.</span>
<span class="sd">        Write to False to change &quot;CURRENT 2&quot; terminals to pure ammeter.</span>
<span class="sd">        Setting persists across 20-second timeouts.&#39;&#39;&#39;</span>
        <span class="c">#channel 2 only</span>
        <span class="k">def</span> <span class="nf">load_enable</span><span class="p">(</span><span class="n">enable</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">enable_current_load</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">disable_current_load</span><span class="p">()</span>
        <span class="n">load_en_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">load_enable</span><span class="p">))</span>
        <span class="n">load_en_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">load_en_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_load_enable</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load_en_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_regulator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Program series drop across &quot;REGULATOR&quot; terminals.</span>
<span class="sd">        Defaults to 0V.  Most useful with a servo wrapper to keep a constant voltage downstream of shunt.</span>
<span class="sd">        Resets to 0V after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">set_regulator_voltage</span><span class="p">(</span><span class="n">voltage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_regulator_voltage</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="n">regulator_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_regulator_voltage</span><span class="p">))</span>
        <span class="n">regulator_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">regulator_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_regulator</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">regulator_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_vout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Program analog voltage output on V1+,V2+ rear banana terminals.</span>
<span class="sd">        Valid channel_numbers are [1,2].</span>
<span class="sd">        Valid settings are 0-5V.</span>
<span class="sd">        Resets to 0V after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">set_vout1</span><span class="p">(</span><span class="n">voltage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_vout_1</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">set_vout2</span><span class="p">(</span><span class="n">voltage</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_vout_2</span><span class="p">(</span><span class="n">voltage</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vout_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_vout1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">channel_number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">vout_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">set_vout2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;valid RL1000 vout channels are 1 and 2&#39;</span><span class="p">)</span>
        <span class="n">vout_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">vout_channel</span><span class="p">)</span>
        <span class="n">vout_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vout_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_vout</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vout_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_pwm_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Programs PWM output frequency on rear panel BNC jack.</span>
<span class="sd">        Valid frequencies are 50Hz-10kHz.</span>
<span class="sd">        Also requires pwm_duty_cycle and pwm_amplitude channels to be configured to enable output.</span>
<span class="sd">        Output disabled after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="c">#frequency=50-10khz</span>
        <span class="k">def</span> <span class="nf">check_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">50</span> <span class="o">&lt;=</span> <span class="n">frequency</span> <span class="o">&lt;=</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_pwm</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;PWM frequency {} outside valid range 50-10000Hz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>
        <span class="n">pwm_f_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">check_frequency</span><span class="p">))</span>
        <span class="n">pwm_f_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_pwm_frequency</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pwm_f_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_pwm_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Programs PWM output amplitude on rear panel BNC jack.</span>
<span class="sd">        Valid amplitudes are 1.2V-5.25V.</span>
<span class="sd">        Also requires pwm_frequency pwm_duty_cycle and channels to be configured to enable output.</span>
<span class="sd">        Output disabled after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="c">#Amplitude=1.2-5.25V</span>
        <span class="k">def</span> <span class="nf">check_amplitude</span><span class="p">(</span><span class="n">amplitude</span><span class="p">):</span>
            <span class="k">if</span> <span class="mf">1.2</span> <span class="o">&lt;=</span> <span class="n">amplitude</span> <span class="o">&lt;=</span> <span class="mf">5.25</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_pwm</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;PWM amplitude {} outside valid range 1.2-5.25V&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amplitude</span><span class="p">))</span>
        <span class="n">pwm_a_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">check_amplitude</span><span class="p">))</span>
        <span class="n">pwm_a_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_pwm_amplitude</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pwm_a_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_pwm_duty_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Programs PWM output duty cycle on rear panel BNC jack.</span>
<span class="sd">        Valid duty_cycles are 0-1.</span>
<span class="sd">        Also requires pwm_frequency and pwm_amplitude channels to be configured to enable output.</span>
<span class="sd">        Output disabled after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="c">#duty_cycle=0-1</span>
        <span class="k">def</span> <span class="nf">check_duty_cycle</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">duty_cycle</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_pwm</span><span class="p">(</span><span class="n">duty_cycle</span><span class="o">=</span><span class="n">duty_cycle</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;PWM duty cycle {} outside valid range 0-1&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">duty_cycle</span><span class="p">))</span>
        <span class="n">pwm_d_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">check_duty_cycle</span><span class="p">))</span>
        <span class="n">pwm_d_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_pwm_duty_cycle</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pwm_d_channel</span>
    <span class="k">def</span> <span class="nf">_set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">duty_cycle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">duty_cycle</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">disable_pwm</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="k">if</span> <span class="n">duty_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="o">=</span> <span class="n">duty_cycle</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#check clock variables before enabling pwm?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_pwm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span><span class="p">)</span> <span class="c">#Turn on the PWM. Amplitude=1.2-5.25V,duty_cycle=0-1,frequency=50-10khz</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Set PWM frequency to enable PWM.&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_duty_cycle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Set PWM duty cycle to enable PWM.&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pwm_amplitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Set PWM amplitude to enable PWM.&#39;</span>
    <span class="k">def</span> <span class="nf">add_channel_clock_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Programs clock output frequency on rear panel BNC jack.</span>
<span class="sd">        Valid frequencies are 1kHz-50MHz.</span>
<span class="sd">        Also requires clock_amplitude channel to be configured to enable output.</span>
<span class="sd">        Output disabled after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="c">#frequency=1k-50Mhz</span>
        <span class="k">def</span> <span class="nf">check_frequency</span><span class="p">(</span><span class="n">frequency</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">1000</span> <span class="o">&lt;=</span> <span class="n">frequency</span> <span class="o">&lt;=</span> <span class="mi">50000000</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_clock</span><span class="p">(</span><span class="n">frequency</span><span class="o">=</span><span class="n">frequency</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Clock frequency {} outside valid range 1kHz-50MHz&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frequency</span><span class="p">))</span>
        <span class="n">clk_f_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">check_frequency</span><span class="p">))</span>
        <span class="n">clk_f_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_clock_frequency</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clk_f_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_clock_amplitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Programs clock output frequency on rear panel BNC jack.</span>
<span class="sd">        Valid amplitudes are 1.2V-5.25V.</span>
<span class="sd">        Also requires clock_frequency channel to be configured to enable output.</span>
<span class="sd">        Output disabled after 20-second timeout.&#39;&#39;&#39;</span>
        <span class="c">#Amplitude=1.2-5.25V</span>
        <span class="k">def</span> <span class="nf">check_amplitude</span><span class="p">(</span><span class="n">amplitude</span><span class="p">):</span>
            <span class="k">if</span> <span class="mf">1.2</span> <span class="o">&lt;=</span> <span class="n">amplitude</span> <span class="o">&lt;=</span> <span class="mf">5.25</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_clock</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="n">amplitude</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Clock amplitude {} outside valid range 1.2-5.25V&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amplitude</span><span class="p">))</span>
        <span class="n">clk_a_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="n">check_amplitude</span><span class="p">))</span>
        <span class="n">clk_a_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_clock_amplitude</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">clk_a_channel</span>
    <span class="k">def</span> <span class="nf">_set_clock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">disable_pwm</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="k">if</span> <span class="n">amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span> <span class="o">=</span> <span class="n">amplitude</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#check pwm variables before enabling clock?</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">set_clock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span><span class="p">)</span> <span class="c">#Turn on the PWM. Amplitude=1.2-5.25V,frequency=1k-50Mhz</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_frequency</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Set clock frequency to enable PWM.&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock_amplitude</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Set clock amplitude to enable PWM.&#39;</span>
    <span class="k">def</span> <span class="nf">add_channel_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Not yet implemented.&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Not yet implemented.&#39;</span><span class="p">)</span>
        <span class="c">#set_measurement_sample_rate() Set the sample rate of the V and I measurements</span>
        <span class="c">#1=6.875hz, 2=13.75hz, 3=27.5hz, 4=55hz, 5=110hz, 6=220hz, 7=440hz, 8=880hz</span>
        <span class="c">#9=1.76khz, 10=3,52khz.</span>
        <span class="c">#Sample periods faster than 55hz start to introduce noticeable noise.</span>
        <span class="c">#Default on power up=6.875hz</span>
        <span class="c">#set_autorange_sample_rate(self,sample_rate_index) #Set the sample rate background autoranging measurements</span>
    <span class="k">def</span> <span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Blink front panel LED twice.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">identify</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check valid connection to RL1000 and reset 20 second timeout counter.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">add_channel_load_heatsink_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report heatsink temperature for &quot;CHANNEL 2&quot; electronic load in degrees Celsius.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">measure_load_heatsink</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">measure_load_heatsink_temperature</span><span class="p">()</span>
        <span class="n">load_heatsink_temp_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="n">measure_load_heatsink</span><span class="p">))</span>
        <span class="n">load_heatsink_temp_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_load_heatsink_temperature</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">load_heatsink_temp_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_regulator_heatsink_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Report heatsink temperature for &quot;REGULATOR&quot; series regulator in degrees Celsius.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">measure_regulator_heatsink</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">measure_regulator_heatsink_temperature</span><span class="p">()</span>
        <span class="n">regulator_heatsink_temp_channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="n">measure_regulator_heatsink</span><span class="p">))</span>
        <span class="n">regulator_heatsink_temp_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_regulator_heatsink_temperature</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">regulator_heatsink_temp_channel</span>
    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_active_meter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rl1000_lib</span><span class="o">.</span><span class="n">measure_all</span><span class="p">()</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results_dict</span>

<div class="viewcode-block" id="keithley_7002"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_7002">[docs]</a><span class="k">class</span> <span class="nc">keithley_7002</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;KEITHLEY 7002 SWITCH SYSTEM</span>
<span class="sd">        Superclass for the 7011S Quad 10 to 1 multiplexers</span>
<span class="sd">        Additional Cards possible in future</span>
<span class="sd">        note - this setup does not change channel types unless a config_ is called</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;keithley_7002&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="c"># why was this commented then not commited?</span>
        <span class="c"># scpi_instrument.__init__(self,&quot;7002_mux @: {}&quot;.format(self.get_interface()) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;*rst&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="keithley_7002.add_channel_relay"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_7002.add_channel_relay">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel at bay and num</span>
<span class="sd">            bay valid range [1-10]</span>
<span class="sd">            number valid range [1-40] for 7011S Quad 10 to 1 multiplexer card</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">relay_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">closed</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_relay</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">closed</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">relay_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_close_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close named channel relay&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;CLOSE (@{}!{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_open_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open named channel relay&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OPEN (@{}!{})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_relay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">,</span><span class="n">state</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close_relay</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_relay</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">number</span><span class="p">)</span>
<div class="viewcode-block" id="keithley_7002.open_all"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_7002.open_all">[docs]</a>    <span class="k">def</span> <span class="nf">open_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sync_channels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;open all relays, set sync_channels to true to keep the channels synced (no need to do this if shutting down)&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sync_channels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">relay_channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_channels_list</span><span class="p">():</span>
                <span class="n">relay_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OPEN ALL&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="keithley_7002_meter"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_7002_meter">[docs]</a><span class="k">class</span> <span class="nc">keithley_7002_meter</span><span class="p">(</span><span class="n">keithley_7002</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Combines 7002 switch system and any multimeter instrument into a virtual super 34970.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">,</span> <span class="n">multimeter_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa for the Keithley 7002 mux system</span>
<span class="sd">            multimeter_channel is channel object, lb.get_channel(channel_name) or some_meter.get_channel(channel_name) will return ones</span>
<span class="sd">            delay is the number of seconds between closing the channel relay and triggering the meter measurement.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keithley_7002</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;keithley_7002_meter&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multimeter_channel</span> <span class="o">=</span> <span class="n">multimeter_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_all</span><span class="p">()</span> <span class="c">#just to be sure...</span>
<div class="viewcode-block" id="keithley_7002_meter.add_channel_meter"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_7002_meter.add_channel_meter">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">pre_calls</span><span class="o">=</span><span class="p">[],</span><span class="n">post_calls</span><span class="o">=</span><span class="p">[],</span><span class="n">multimeter_channel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add named channel to instrument</span>
<span class="sd">            bay is the switch system plugin bay. Valid range [1-10]</span>
<span class="sd">            num valid range [1-40] for 7011S Quad 10 to 1 multiplexer card</span>
<span class="sd">            pre_calls is a list of functions taking exactly 0 arguments to call after closing channel relay but before triggering multimeter measurement</span>
<span class="sd">            post_calls is a list of functions taking exactly 0 arguments to call after triggering multimeter measurement but before opening channel relay</span>
<span class="sd">            multimeter_channel is a channel with the meter on it, if not specified the instrument meter is used</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_meter</span><span class="p">(</span><span class="n">multimeter_channel</span><span class="p">,</span><span class="n">bay</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">pre_calls</span><span class="p">,</span><span class="n">post_calls</span><span class="p">,</span><span class="n">delay</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multimeter_channel</span><span class="p">,</span> <span class="n">bay</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">pre_calls</span><span class="p">,</span> <span class="n">post_calls</span><span class="p">,</span><span class="n">delay</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;close relay to named channel, run any pre_calls associated with channel,</span>
<span class="sd">            trigger measurement, run any post_calls associated with channel, and return the measurment result</span>

<span class="sd">            pre_ and post_calls can be used, for example, to set different ranges</span>
<span class="sd">            or integration powerline cycles for different channels using the same multimeter.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_all</span><span class="p">()</span> <span class="c">#just to be sure...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_relay</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">pre_calls</span><span class="p">:</span>
            <span class="n">func</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">multimeter_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">multimeter_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multimeter_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">post_calls</span><span class="p">:</span>
            <span class="n">func</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_relay</span><span class="p">(</span><span class="n">bay</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="agilent_3034a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3034a">[docs]</a><span class="k">class</span> <span class="nc">agilent_3034a</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">,</span> <span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Agilent 4-channel mixed signal DSO&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">,</span> <span class="n">force_trigger</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;agilent_3034a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;agilent_3034a @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c"># Clears self._interfaces list, so must happen before add_interface_visa(). --FL 12/21/2016</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:WAVeform:FORMat ASCII&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:WAVeform:POINts:MODE RAW&#39;</span><span class="p">)</span> <span class="c">#maximum number of points by default (scope must be stopped)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span> <span class="o">=</span> <span class="n">force_trigger</span>
<div class="viewcode-block" id="agilent_3034a.set_points"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3034a.set_points">[docs]</a>    <span class="k">def</span> <span class="nf">set_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        set the number of points returned by read_channel() or read_channels()</span>
<span class="sd">        points must be in range [100,250,500] or [1000,2000,5000]*10^[0-4] or [8000000]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">allowed_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">500</span><span class="p">]</span>
        <span class="n">allowed_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lab_utils</span><span class="o">.</span><span class="n">decadeListRange</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">5000</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">allowed_points</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="mi">8000000</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">points</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_points</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;{}: set_points: points argument muse be in range: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">allowed_points</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:WAVeform:POINts {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">points</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">add_channel_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">compute_x_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Data conversion:</span>
<span class="sd">            voltage = [(data value - yreference) * yincrement] + yorigin</span>
<span class="sd">            time = [(data point number - xreference) * xincrement] + xorigin&#39;&#39;&#39;</span>
            <span class="n">xpoints</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;reference&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;origin&#39;</span><span class="p">],</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">xpoints</span>
        <span class="n">time_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">compute_x_points</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">time_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">time_channel</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">get_time_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span>
        <span class="n">time_info</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_info&quot;</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_time_info</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">time_info</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">time_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">time_channel</span>
    <span class="k">def</span> <span class="nf">get_channel_enable_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:DISPlay?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">)))</span>
<div class="viewcode-block" id="agilent_3034a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.agilent_3034a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument. num is 1-4.&#39;&#39;&#39;</span>
        <span class="n">scope_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_channel</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">scope_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">scope_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:WAVeform:SOURce CHANnel{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span> <span class="c">#make sure one of the selected channels is always active to get time info</span>
        <span class="k">def</span> <span class="nf">get_channel_settings</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">):</span>
            <span class="n">result</span>              <span class="o">=</span> <span class="p">{}</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:CHANnel{}:SCALe?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">)))</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:CHANnel{}:OFFSet?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">)))</span><span class="c"># This is the value represented by the screen center.</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;units&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:CHANnel{}:UNITs?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="c"># Pick up just the first letter A for AMP or V for VOLT.</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:LABel?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;bwlimit&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:BWLimit?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;coupling&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:COUPling?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="s">&#39;impedance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:IMPedance?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="n">trace_info</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&quot;_info&quot;</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">get_channel_settings</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">trace_info</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">trace_info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scope_channel</span></div>
    <span class="k">def</span> <span class="nf">get_time_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:TIMebase:RANGe?&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="mi">10</span> <span class="c"># Always 10 horizontal divisions</span>
    <span class="k">def</span> <span class="nf">trigger_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:RUN;:TRIGger:FORCe&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">digitize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:DIGitize&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_scope_time_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span>                <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:WAVeform:POINts?&quot;</span><span class="p">))</span>      <span class="c"># int(preamble[2])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:WAVeform:XINCrement?&quot;</span><span class="p">))</span>  <span class="c"># float(preamble[4])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;origin&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:WAVeform:XORigin?&quot;</span><span class="p">))</span>     <span class="c"># float(preamble[5])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;reference&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;:WAVeform:XREFerence?&quot;</span><span class="p">))</span>  <span class="c"># float(preamble[6])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;scale&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;increment&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;enable_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">scope_channel_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_info</span><span class="p">[</span><span class="s">&#39;enable_status&#39;</span><span class="p">][</span><span class="n">scope_channel_number</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:CHANnel{}:DISPlay?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">_read_scope_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return list of y-axis points for named channel</span>
<span class="sd">            list will be datalogged by logger as a string in a single cell in the table</span>
<span class="sd">            trigger=False can by used to suppress acquisition of new data by the instrument so that</span>
<span class="sd">            data from a single trigger may be retrieved from each of the four channels in turn by read_channels()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;:WAVeform:SOURce CHANnel{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;:WAVeform:DATA?&#39;</span><span class="p">)</span>
        <span class="c">#Example: &#39;#800027579 4.03266e-002, 1.25647e-004, 1.25647e-004, 1.25647e-004,.......&#39;</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="mi">10</span><span class="p">:]</span> <span class="c">#remove header</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">raw_data</span><span class="p">)</span>
        <span class="c">#TODO - implement binary transfer if speed becomes a problem</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channels</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_force</span><span class="p">()</span>
        <span class="c"># self.digitize()</span>
        <span class="c"># self.get_interface().write(&#39;:STOP&#39;)# scope will timeout on :WAVeform:PREamble? if not &#39;STOPped&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_time_info</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>
</div>
<div class="viewcode-block" id="tektronix_3054"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.tektronix_3054">[docs]</a><span class="k">class</span> <span class="nc">tektronix_3054</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">,</span><span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Tek 4-channel DSO&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">,</span> <span class="n">force_trigger</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;tektronix_3054&#39;</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;tektronix_3054 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:ENCdg ASCIi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:WID 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HEADER 1&#39;</span><span class="p">)</span> <span class="c">#data headers help parse results of wfmoutpre? query, since different scopes return different length responses!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span> <span class="o">=</span> <span class="n">force_trigger</span>
    <span class="k">def</span> <span class="nf">add_channel_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">time_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_time</span><span class="p">)</span>
        <span class="n">time_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">time_channel</span><span class="p">)</span>
<div class="viewcode-block" id="tektronix_3054.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.tektronix_3054.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument.  num is 1-4.&#39;&#39;&#39;</span>
        <span class="n">scope_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_channel</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">scope_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">scope_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="tektronix_3054.trigger_force"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.tektronix_3054.trigger_force">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a trigger event. If TRIGger:STATE is set to READy, the acquisition</span>
<span class="sd">        will complete. Otherwise, this command will be ignored.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIGger FORCe&#39;</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_scope_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Data conversion:</span>
<span class="sd">        voltage = [(data value - yreference) * yincrement] + yorigin</span>
<span class="sd">        time = [(data point number - xreference) * xincrement] + xorigin</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;WFMPRE?&#39;</span><span class="p">)</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#remove junk that doesn&#39;t really belong to first field</span>
        <span class="n">preamble_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">preamble</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">preamble_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">])</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">],</span><span class="nb">range</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">xpoints</span>
    <span class="k">def</span> <span class="nf">_read_scope_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return list of y-axis points for named channel</span>
<span class="sd">            list will be datalogged by logger as a string in a single cell in the table</span>
<span class="sd">            trigger=False can by used to suppress acquisition of new data by the instrument so that</span>
<span class="sd">            data from a single trigger may be retrieved from each of the four channels in turn by read_channels()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#trigger / single arm sequence commands need investigation.  Forcing trigger here is not correct</span>
        <span class="c"># if trigger:</span>
            <span class="c"># self.get_interface().write(&#39;TRIGger&#39;)</span>

        <span class="c"># Examples WFMOUTPRE? ? might return the waveform formatting data as:</span>
        <span class="c">#  [0] :WFMOUTPRE:BYT_NR 2;</span>
        <span class="c">#  [1] BIT_NR 16;</span>
        <span class="c">#  [2] ENCDG ASCII;</span>
        <span class="c">#  [3] BN_FMT RI;</span>
        <span class="c">#  [4] BYT_OR MSB;</span>
        <span class="c">#  [5] WFID &quot;Ch1, DC coupling, 100.0mV/div, 4.000us/div, 10000 points, Sample mode&quot;;</span>
        <span class="c">#  [6] NR_PT 10000;</span>
        <span class="c">#  [7] PT_FMT Y;</span>
        <span class="c">#  [8] XUNIT &quot;s&quot;;</span>
        <span class="c">#  [9] XINCR 4.0000E-9;</span>
        <span class="c"># [10] XZERO - 20.0000E-6;</span>
        <span class="c"># [11] PT_OFF 0;</span>
        <span class="c"># [12] YUNIT &quot;V&quot;;</span>
        <span class="c"># [13] YMULT 15.6250E-6;</span>
        <span class="c"># [14] YOFF :&quot;6.4000E+3;</span>
        <span class="c"># [15] YZERO 0.0000</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:SOUrce CH{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;WFMPRE?&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#remove junk that doesn&#39;t really belong to first field</span>
        <span class="n">preamble_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">preamble</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">preamble_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">])</span> <span class="c">#scale int to volts</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">])</span> <span class="c">#offset set into scope, subtract from raw_data before scaling if you want data offset</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">])</span> <span class="c">#waveform position</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;CURVe?&#39;</span><span class="p">)</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="c">#not sure where y_zero goes in eqn! #offset seems to be display only</span>
        <span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">],</span> <span class="n">raw_data</span><span class="p">)</span>
        <span class="c">#TODO - implement binary transfer if speed becomes a problem</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_force</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>

</div>
<div class="viewcode-block" id="hp_4195a"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4195a">[docs]</a><span class="k">class</span> <span class="nc">hp_4195a</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;HP4195A Network Analyzer</span>
<span class="sd">        Current Driver Only Collects Data; no configuration or measurement trigger&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;hp_4195a&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;h4195a @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
<div class="viewcode-block" id="hp_4195a.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4195a.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">register</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;register must be</span>
<span class="sd">            X - frequency</span>
<span class="sd">            A - A register</span>
<span class="sd">            B - B register</span>
<span class="sd">            C - C register</span>
<span class="sd">            D - D register&#39;&#39;&#39;</span>
        <span class="n">register</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">register</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad register {} for 4195a&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register</span><span class="p">))</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_4195a_register</span><span class="p">(</span><span class="n">register</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_4195a_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">register</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;read from one of the five hardware registers associated with this channel_name.  Return list of scalars representing points.&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;{}?&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">register</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="hp_4195a.config_network"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4195a.config_network">[docs]</a>    <span class="k">def</span> <span class="nf">config_network</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mf">500e6</span><span class="p">,</span> <span class="n">RBW</span> <span class="o">=</span> <span class="s">&#39;AUTO&#39;</span><span class="p">,</span> <span class="n">NOP</span> <span class="o">=</span> <span class="mi">401</span><span class="p">,</span> <span class="n">OSCA</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure the 4195 for network analysis  with start, stop, sweep type and resolution&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RST&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OSC1={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OSCA</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FNC1&quot;</span><span class="p">)</span> <span class="c">#set Network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;START={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span> <span class="c">#start freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;STOP={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop</span><span class="p">))</span> <span class="c">#stop freq</span>
        <span class="k">if</span> <span class="n">RBW</span> <span class="o">==</span> <span class="s">&#39;AUTO&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CPL1&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RBW={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RBW</span><span class="p">))</span> <span class="c">#resolution bandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NOP={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NOP</span><span class="p">))</span> <span class="c">#number of points in sweet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SWT2&quot;</span><span class="p">)</span> <span class="c">#log sweep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SWM2&quot;</span><span class="p">)</span> <span class="c">#single trigger mode</span></div>
<div class="viewcode-block" id="hp_4195a.config_spectrum"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4195a.config_spectrum">[docs]</a>    <span class="k">def</span> <span class="nf">config_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mf">500e6</span><span class="p">,</span> <span class="n">RBW</span> <span class="o">=</span> <span class="s">&#39;AUTO&#39;</span><span class="p">,</span> <span class="n">NOP</span> <span class="o">=</span> <span class="mi">401</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure the 4195 for spectrum analysis (noise here) with start, stop, sweep type and resolution&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RST&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;FNC2&quot;</span><span class="p">)</span> <span class="c">#set Spectrum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;START={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="p">))</span> <span class="c">#start freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;STOP={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stop</span><span class="p">))</span> <span class="c">#stop freq</span>
        <span class="k">if</span> <span class="n">RBW</span> <span class="o">==</span> <span class="s">&#39;AUTO&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;CPL1&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RBW={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RBW</span><span class="p">))</span> <span class="c">#resolution bandwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;NOP={}&quot;</span> <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NOP</span><span class="p">))</span> <span class="c">#number of points in sweet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SWT2&quot;</span><span class="p">)</span> <span class="c">#log sweep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SAP6&quot;</span><span class="p">)</span> <span class="c">#uv/rthz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;SWM2&quot;</span><span class="p">)</span> <span class="c">#singletrigger mode</span></div>
<div class="viewcode-block" id="hp_4195a.trigger"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4195a.trigger">[docs]</a>    <span class="k">def</span> <span class="nf">trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the sweep time and trigger once&#39;&#39;&#39;</span>
        <span class="n">ttime</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;ST?&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;SWTRG&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ttime</span>

</div></div>
<div class="viewcode-block" id="semiconductor_parameter_analyzer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.semiconductor_parameter_analyzer">[docs]</a><span class="k">class</span> <span class="nc">semiconductor_parameter_analyzer</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generic parameter analyzer speaking HP4145 Command Set in user mode (US page)&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_set_user_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;US&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_smu_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">v_output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">i_compliance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">v_output_range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set smu voltage and current compliance if enough arguments specified&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">smu_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;v_output_range&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;i_output_range&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">v_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_output</span>
        <span class="k">if</span> <span class="n">i_compliance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_compliance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_compliance</span>
        <span class="k">if</span> <span class="n">v_output_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_output_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v_output_range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;AUTO&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_output_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_output_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_output_range</span><span class="p">(</span><span class="n">v_output_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;v_output&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;i_compliance&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DV {:G}, {:G}, {:G}, {:G}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_measure_channels</span><span class="p">[</span><span class="n">smu_number</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_output_range&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_output&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_compliance&#39;</span><span class="p">]))</span>
            <span class="c">#print &#39;writing these values to voltage SMU:&#39;</span>
            <span class="c">#print self._smu_configuration[smu_number]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;SMU{} disabled.  Write both output_voltage and current_compliance channels to enable output&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">smu_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_smu</span><span class="p">(</span><span class="n">smu_number</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_smu_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">i_output</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">v_compliance</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">i_output_range</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set smu current and voltage compliance if enough arguments specified&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">smu_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;i_output_range&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;v_output_range&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">i_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_output</span>
        <span class="k">if</span> <span class="n">v_compliance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_compliance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_compliance</span>
        <span class="k">if</span> <span class="n">i_output_range</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i_output_range</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i_output_range</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;AUTO&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_output_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_output_range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lookup_output_range</span><span class="p">(</span><span class="n">i_output_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_range</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;i_output&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s">&#39;v_compliance&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DI {:G}, {:G}, {:G}, {:G}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_output_range&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;i_output&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span><span class="p">[</span><span class="n">smu_number</span><span class="p">][</span><span class="s">&#39;v_compliance&#39;</span><span class="p">]))</span>
            <span class="c">#print &#39;writing these values to current SMU:&#39;</span>
            <span class="c">#print self._smu_configuration[smu_number]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;SMU{} disabled.  Write both output_current and voltage_compliance channels to enable output&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">smu_number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_smu</span><span class="p">(</span><span class="n">smu_number</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_disable_smu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DV {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">smu_number</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_lookup_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">range_dict</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">bisect</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">range_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">max</span><span class="p">))</span>
        <span class="k">print</span> <span class="s">&#39;range select chose +/-{}:{} to match input of {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">range_dict</span><span class="p">[</span><span class="n">ranges</span><span class="p">[</span><span class="n">index</span><span class="p">]],</span><span class="nb">max</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">range_dict</span><span class="p">[</span><span class="n">ranges</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>
    <span class="k">def</span> <span class="nf">_set_vsource_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">output</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set vsource voltage&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DS {:G}, {:G}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">output</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_disable_vs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vs_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;DS {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vs_number</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">smu</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_smu</span><span class="p">(</span><span class="n">smu</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vs_numbers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disable_vs</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">):</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TV {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_number</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_measurement_result</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span>
            <span class="c">#raise exception?</span>
            <span class="c">#log in error channel?</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
    <span class="k">def</span> <span class="nf">_read_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_number</span><span class="p">):</span>
        <span class="n">ret_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;TI {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_number</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_measurement_result</span><span class="p">(</span><span class="n">ret_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">result</span>
            <span class="c">#raise exception?</span>
            <span class="c">#log in error channel?</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
    <span class="k">def</span> <span class="nf">_check_measurement_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ret_str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;N&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;V&#39;</span><span class="p">:</span>
            <span class="n">instrument_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_voltage_measure_channels</span>
        <span class="k">elif</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
            <span class="n">instrument_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_current_measure_channels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown data format: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;L&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;WARNING! {}: Interval too short&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_dict</span><span class="p">[</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;V&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;WARNING! {}: A/D Converter Saturated - Overflow&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_dict</span><span class="p">[</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;X&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;WARNING! {}: Oscillation&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_dict</span><span class="p">[</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;WARNING! {}: This channel in compliance&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_dict</span><span class="p">[</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">ret_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;WARNING! {}: Other channel in compliance&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instrument_dict</span><span class="p">[</span><span class="n">ret_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown data format: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ret_str</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_set_integration_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;SHORT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;IT1&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;MEDIUM&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;IT2&quot;</span><span class="p">)</span>
        <span class="k">elif</span>  <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;LONG&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">time</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;IT3&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Valid integration times are &quot;SHORT&quot;, &quot;MEDIUM&quot; or &quot;LONG&quot;&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_add_channels_smu_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_force_channel_name</span><span class="p">,</span><span class="n">current_compliance_channel_name</span><span class="p">):</span>
        <span class="n">voltage_force_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">voltage_force_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_voltage</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">v_output</span><span class="o">=</span><span class="n">output</span><span class="p">))</span>
        <span class="n">current_compliance_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">current_compliance_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">compliance</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_voltage</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">i_compliance</span><span class="o">=</span><span class="n">compliance</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">voltage_force_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">current_compliance_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">voltage_force_channel</span><span class="p">,</span><span class="n">current_compliance_channel</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_add_channel_smu_voltage_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="n">output_range_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">output_range_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">output_range</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_voltage</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">v_output_range</span><span class="o">=</span><span class="n">output_range</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">output_range_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_range_channel</span>
    <span class="k">def</span> <span class="nf">_add_channels_smu_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">voltage_compliance_channel_name</span><span class="p">):</span>
        <span class="n">current_force_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_current</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">i_output</span><span class="o">=</span><span class="n">output</span><span class="p">))</span>
        <span class="n">voltage_compliance_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">voltage_compliance_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">compliance</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_current</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">v_compliance</span><span class="o">=</span><span class="n">compliance</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">current_force_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">voltage_compliance_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">current_force_channel</span><span class="p">,</span><span class="n">voltage_compliance_channel</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_add_channel_smu_current_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="n">output_range_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">output_range_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">output_range</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_smu_current</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">i_output_range</span><span class="o">=</span><span class="n">output_range</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">output_range_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output_range_channel</span>
    <span class="k">def</span> <span class="nf">_add_channel_smu_voltage_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_sense_channel_name</span><span class="p">):</span>
        <span class="n">voltage_sense_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">voltage_sense_channel_name</span><span class="p">,</span><span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_voltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_measure_channels</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">voltage_sense_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">voltage_sense_channel</span>
    <span class="k">def</span> <span class="nf">_add_channel_smu_current_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_sense_channel_name</span><span class="p">):</span>
        <span class="n">current_sense_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">current_sense_channel_name</span><span class="p">,</span><span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_measure_channels</span><span class="p">[</span><span class="n">smu_number</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">current_sense_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_sense_channel</span>
    <span class="k">def</span> <span class="nf">_add_channel_vsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">vsource_channel_name</span><span class="p">):</span>
        <span class="n">vsource_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">vsource_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">output</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_vsource_voltage</span><span class="p">(</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">output</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">vsource_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vsource_channel</span>
    <span class="k">def</span> <span class="nf">_add_channel_vmeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmeter_number</span><span class="p">,</span><span class="n">vmeter_channel_name</span><span class="p">):</span>
        <span class="n">vmeter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">vmeter_channel_name</span><span class="p">,</span><span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_voltage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vm_voltage_measure_channels</span><span class="p">[</span><span class="n">vmeter_number</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">vmeter_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vmeter_channel</span>
    <span class="k">def</span> <span class="nf">add_channel_integration_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">integration_time_channel_name</span><span class="p">):</span>
        <span class="n">integration_time_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">integration_time_channel_name</span><span class="p">,</span><span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_integration_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">integration_time_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">integration_time_channel</span>
</div>
<div class="viewcode-block" id="keithley_4200"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_4200">[docs]</a><span class="k">class</span> <span class="nc">keithley_4200</span><span class="p">(</span><span class="n">semiconductor_parameter_analyzer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Keithley Model 4200-SCS Semiconductor Characterization System&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;keithley_4200-scs&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;keithley_4200-scs @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_user_mode</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_range</span> <span class="o">=</span> <span class="p">{</span><span class="mi">20</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">200</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span> <span class="c">#&#39;AUTO&#39;:0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_range</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1e-9</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mf">10e-9</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mf">100e-9</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mf">10e-6</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mf">100e-6</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mf">10e-3</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mf">100e-3</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="mf">10e-12</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="mf">100e-12</span><span class="p">:</span><span class="mi">12</span><span class="p">}</span> <span class="c">#&#39;AUTO&#39;:0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span><span class="s">&#39;SMU1&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">:</span><span class="s">&#39;SMU2&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&#39;SMU3&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">:</span><span class="s">&#39;SMU4&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">:</span><span class="s">&#39;VM1&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">:</span><span class="s">&#39;VM2&#39;</span><span class="p">,</span><span class="s">&#39;G&#39;</span><span class="p">:</span><span class="s">&#39;SMU5&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">:</span><span class="s">&#39;SMU6&#39;</span><span class="p">,</span><span class="s">&#39;I&#39;</span><span class="p">:</span><span class="s">&#39;SMU7&#39;</span><span class="p">,</span><span class="s">&#39;J&#39;</span><span class="p">:</span><span class="s">&#39;SMU8&#39;</span><span class="p">,</span><span class="s">&#39;K&#39;</span><span class="p">:</span><span class="s">&#39;VM3&#39;</span><span class="p">,</span><span class="s">&#39;L&#39;</span><span class="p">:</span><span class="s">&#39;VM4&#39;</span><span class="p">,</span><span class="s">&#39;M&#39;</span><span class="p">:</span><span class="s">&#39;VM5&#39;</span><span class="p">,</span><span class="s">&#39;N&#39;</span><span class="p">:</span><span class="s">&#39;VM6&#39;</span><span class="p">,</span><span class="s">&#39;O&#39;</span><span class="p">:</span><span class="s">&#39;VM7&#39;</span><span class="p">,</span><span class="s">&#39;P&#39;</span><span class="p">:</span><span class="s">&#39;VM8&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span><span class="s">&#39;SMU1&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">:</span><span class="s">&#39;SMU2&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&#39;SMU3&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">:</span><span class="s">&#39;SMU4&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">:</span><span class="s">&#39;SMU5&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">:</span><span class="s">&#39;SMU6&#39;</span><span class="p">,</span><span class="s">&#39;G&#39;</span><span class="p">:</span><span class="s">&#39;SMU7&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">:</span><span class="s">&#39;SMU8&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vs_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_configuration</span><span class="p">()</span>
        <span class="c">#self._smu_voltage_compliance = 210 #+/-</span>
        <span class="c">#self._smu_current_compliance = 0.105 #4200-SMU</span>
        <span class="c">#self._smu_current_compliance = 1.05 #4210-SMU</span>
    <span class="k">def</span> <span class="nf">get_slot_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;EM 1,0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;*OPT?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;EM 0,0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vs_numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">slot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Slot {} &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;SMU&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span> <span class="c">#what about 10 having 2 digits???</span>
                <span class="k">print</span> <span class="s">&#39;{}: Medium Power SMU without preamp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HPSMU&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="mi">5</span><span class="p">]))</span>
                <span class="k">print</span> <span class="s">&#39;{}: High Power SMU without preamp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;SMUPA&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="mi">5</span><span class="p">]))</span>
                <span class="k">print</span> <span class="s">&#39;{}: Medium Power SMU with preamp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HPSMUPA&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="mi">7</span><span class="p">]))</span>
                <span class="k">print</span> <span class="s">&#39;{}: High Power SMU with preamp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;VS&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vs_numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                <span class="k">print</span> <span class="s">&#39;{}: Voltage Source&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;VM&#39;</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;{}: Voltage Meter&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Empty Slot&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Problem parsing Keithley 4200 slot {} configuration: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">))</span>
<div class="viewcode-block" id="keithley_4200.configure_slot_smu"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_4200.configure_slot_smu">[docs]</a>    <span class="k">def</span> <span class="nf">configure_slot_smu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot_number</span><span class="p">,</span><span class="n">smu_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reconfigure smu instrument in slot_number to act as an smu&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="c">#empty slot shouldn&#39;t be configured</span>
        <span class="k">assert</span> <span class="n">smu_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;MP {}, SMU{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot_number</span><span class="p">,</span><span class="n">smu_number</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_configuration</span><span class="p">()</span></div>
<div class="viewcode-block" id="keithley_4200.configure_slot_vs"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_4200.configure_slot_vs">[docs]</a>    <span class="k">def</span> <span class="nf">configure_slot_vs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot_number</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reconfigure smu instrument in slot_number to act as a vs&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="c">#empty slot shouldn&#39;t be configured</span>
        <span class="k">assert</span> <span class="n">vsource_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">vsource_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;MP {}, VS{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot_number</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_configuration</span><span class="p">()</span></div>
<div class="viewcode-block" id="keithley_4200.configure_slot_vm"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.keithley_4200.configure_slot_vm">[docs]</a>    <span class="k">def</span> <span class="nf">configure_slot_vm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slot_number</span><span class="p">,</span><span class="n">vmeter_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reconfigure smu instrument in slot_number to act as a vm&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">slot_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">slot_conf</span><span class="p">[</span><span class="n">slot_number</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span> <span class="c">#empty slot shouldn&#39;t be configured</span>
        <span class="k">assert</span> <span class="n">vmeter_number</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="n">vmeter_number</span> <span class="o">&lt;=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;MP {}, VM{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slot_number</span><span class="p">,</span><span class="n">vmeter_number</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_slot_configuration</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">add_channels_smu_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smu_number</span><span class="p">,</span> <span class="n">voltage_force_channel_name</span><span class="p">,</span> <span class="n">current_compliance_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channels_smu_voltage</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span> <span class="n">voltage_force_channel_name</span><span class="p">,</span> <span class="n">current_compliance_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_voltage_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_voltage_output_range</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channels_smu_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">voltage_compliance_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channels_smu_current</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">voltage_compliance_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_current_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_current_output_range</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_voltage_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_sense_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_voltage_sense</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_sense_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_current_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_sense_channel_name</span><span class="p">):</span>
        <span class="c">#check smu_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_current_sense</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_sense_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">vsource_channel_name</span><span class="p">):</span>
        <span class="c">#check vsource_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_vsource</span><span class="p">(</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">vsource_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vmeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmeter_number</span><span class="p">,</span><span class="n">vmeter_channel_name</span><span class="p">):</span>
        <span class="c">#check vmeter_number is valid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_vmeter</span><span class="p">(</span><span class="n">vmeter_number</span><span class="p">,</span><span class="n">vmeter_channel_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="hp_4155b"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.hp_4155b">[docs]</a><span class="k">class</span> <span class="nc">hp_4155b</span><span class="p">(</span><span class="n">semiconductor_parameter_analyzer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Hewlett Packard Semiconductor Parameter Analyzer speaking HP4145 Command Set</span>
<span class="sd">    Set System-&gt;MISCELLANEOUS-&gt;COMMAND SET = HP4145</span>
<span class="sd">    Set System-&gt;MISCELLANEOUS-&gt;DELIMITER = COMMA</span>
<span class="sd">    Set System-&gt;MISCELLANEOUS-&gt;EOI = ON&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;hewlett_packard_4155B-scs&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;hewlett_packard_4155B-scs @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span> <span class="c">#PGU1:9,PGU2:10 pulse generator not supported</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vm_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_voltage_range</span> <span class="o">=</span> <span class="p">{</span><span class="mi">20</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mi">200</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="c">#&#39;AUTO&#39;:0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_current_range</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1e-9</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="mf">10e-9</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mf">100e-9</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mf">10e-6</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="mf">100e-6</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="mf">10e-3</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="mf">100e-3</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="mf">10e-12</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">100e-12</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="c">#&#39;AUTO&#39;:0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_voltage_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span><span class="s">&#39;SMU1&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">:</span><span class="s">&#39;SMU2&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&#39;SMU3&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">:</span><span class="s">&#39;SMU4&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">:</span><span class="s">&#39;VM1&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">:</span><span class="s">&#39;VM2&#39;</span><span class="p">,</span><span class="s">&#39;G&#39;</span><span class="p">:</span><span class="s">&#39;SMU5&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">:</span><span class="s">&#39;SMU6&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_current_measure_channels</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;A&#39;</span><span class="p">:</span><span class="s">&#39;SMU1&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">:</span><span class="s">&#39;SMU2&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&#39;SMU3&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">:</span><span class="s">&#39;SMU4&#39;</span><span class="p">,</span><span class="s">&#39;G&#39;</span><span class="p">:</span><span class="s">&#39;SMU5&#39;</span><span class="p">,</span><span class="s">&#39;H&#39;</span><span class="p">:</span><span class="s">&#39;SMU6&#39;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_smu_configuration</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smu_numbers</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vs_numbers</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="c">#print &#39;Changing HP4145 Command Set (wait 5 seconds).&#39;</span>
        <span class="c">#self.get_interface().write(&#39;*RST&#39;)</span>
        <span class="c">#time.sleep(3) #wait for restart</span>
        <span class="c">#self.get_interface().write(&#39;:SYSTem:LANGuage COMPatibility&#39;) #switch to 4145 command set</span>
        <span class="c">#time.sleep(10) #wait for restart</span>
        <span class="c">#print self.get_interface().ask(&#39;CMD?&#39;)</span>
        <span class="c">#if int(self.get_interface().ask(&#39;CMD?&#39;)) != 2: #0=SCPI,1=FLEX,2=4145.  We want 2=4145</span>
        <span class="c">#    raise Exception(&#39;Error: HP4155 must be set to HP4145 Command Set in System:Misc menu&#39;)</span>
        <span class="c"># try:</span>
            <span class="c"># self.get_interface().ask(&#39;*IDN?&#39;) #instrument only responds to this query in SCPI command mode</span>
            <span class="c"># raise Exception(&#39;Error: HP4155 must be set to HP4145 Command Set in System:Misc menu&#39;)</span>
        <span class="c"># except visa_wrappers.visaWrapperException as e:</span>
            <span class="c"># self.get_interface().clear() #normal to not respond; rl1009 locks up with no response</span>
        <span class="c"># except Exception as e:</span>
            <span class="c"># print &quot;Expect timeout error here...&quot;</span>
            <span class="c"># print e #normal to not respond; HP82357 doesn&#39;t seem to lock up with no response</span>
            <span class="c"># #self.get_interface().clear()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_user_mode</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">add_channels_smu_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smu_number</span><span class="p">,</span> <span class="n">voltage_force_channel_name</span><span class="p">,</span> <span class="n">current_compliance_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channels_smu_voltage</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span> <span class="n">voltage_force_channel_name</span><span class="p">,</span> <span class="n">current_compliance_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_voltage_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_voltage_output_range</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channels_smu_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">voltage_compliance_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channels_smu_current</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_force_channel_name</span><span class="p">,</span><span class="n">voltage_compliance_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_current_output_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_current_output_range</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">output_range_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_voltage_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_sense_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_voltage_sense</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">voltage_sense_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_smu_current_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_sense_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">smu_number</span> <span class="o">&lt;=</span> <span class="mi">6</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_smu_current_sense</span><span class="p">(</span><span class="n">smu_number</span><span class="p">,</span><span class="n">current_sense_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">vsource_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">vsource_number</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_vsource</span><span class="p">(</span><span class="n">vsource_number</span><span class="p">,</span><span class="n">vsource_channel_name</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_vmeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vmeter_number</span><span class="p">,</span><span class="n">vmeter_channel_name</span><span class="p">):</span>
        <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">vmeter_number</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel_vmeter</span><span class="p">(</span><span class="n">vmeter_number</span><span class="p">,</span><span class="n">vmeter_channel_name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ADT7410"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ADT7410">[docs]</a><span class="k">class</span> <span class="nc">ADT7410</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Analog Devices Silicon Temperature Sensor</span>
<span class="sd">    http://www.analog.com/static/imported-files/data_sheets/ADT7410.pdf&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_twi</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_twi is a interface_twi</span>
<span class="sd">        addr7 is the 7-bit I2C address of the ADT7410 set by pinstrapping.</span>
<span class="sd">        Choose addr7 from 0x48, 0x49, 0x4A, 0x4B</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Analog Devices ADT7410 Silicon Temperature Sensor at {:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;ADT7410&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr7</span> <span class="o">=</span> <span class="n">addr7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;t_msb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;t_lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;thigh_msb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;thigh_lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;tlow_msb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;tlow_lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x07</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;tcrit_msb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;tcrit_lsb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;t_hyst&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0B</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;reset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<div class="viewcode-block" id="ADT7410.enable"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ADT7410.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Place ADT7410 into shutdown by writing enabled=False</span>
<span class="sd">        Re-enable by writing enabled=True&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mb">0b1</span><span class="o">&lt;&lt;</span><span class="mi">7</span><span class="p">))</span> <span class="c">#16-bit mode</span>
        <span class="k">else</span><span class="p">:</span> <span class="c">#shutdown</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;config&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mb">0b1</span><span class="o">&lt;&lt;</span><span class="mi">7</span> <span class="o">+</span> <span class="mb">0b11</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">))</span></div>
<div class="viewcode-block" id="ADT7410.read_temp"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ADT7410.read_temp">[docs]</a>    <span class="k">def</span> <span class="nf">read_temp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return free-running temperature conversion result.</span>
<span class="sd">        16-bit conversion result scaled to signed degrees Celsius&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_word</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;t_msb&#39;</span><span class="p">])</span> <span class="c">#command code counter autoincrements</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">swap_endian</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">elementCount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>  <span class="c">#msb comes out first, not SMBus compatible!</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">twosComplementToSigned</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bitCount</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span> <span class="o">/</span> <span class="mf">128.0</span> <span class="c">#lsb size adjustment</span></div>
<div class="viewcode-block" id="ADT7410.read_id"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ADT7410.read_id">[docs]</a>    <span class="k">def</span> <span class="nf">read_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return Manufacturer ID and chip revision ID&#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">registers</span><span class="p">[</span><span class="s">&#39;ID&#39;</span><span class="p">])</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;revision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mb">0b111</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;manufacturer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">results</span></div>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">temp_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">temp_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="AD5693R"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.AD5693R">[docs]</a><span class="k">class</span> <span class="nc">AD5693R</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Analog Devices 16 bit DAC</span>
<span class="sd">    http://www.analog.com/en/products/digital-to-analog-converters/da-converters/ad5693r.html&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_twi</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_twi is a interface_twi</span>
<span class="sd">        addr7 is the 7-bit I2C address of the ADT5693R set by pinstrapping.</span>
<span class="sd">        A0 = 0: 1001100 (4C)</span>
<span class="sd">        A1 = 1: 1001110 (4E)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Analog Devices AD5693R Digital to Ananlog Converter at {:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;AD5693R&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr7</span>              <span class="o">=</span> <span class="n">addr7</span>     <span class="c"># user&#39;s address input.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dac_reg</span>            <span class="o">=</span> <span class="mh">0x30</span>      <span class="c"># send dac codes to this address for auto update.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_reg</span>        <span class="o">=</span> <span class="mh">0x40</span>      <span class="c"># sets up gain and power down modes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_code</span>          <span class="o">=</span> <span class="mh">0x0800</span>    <span class="c"># 0 to 5V rather than 0 to 2.5V.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span>          <span class="o">=</span> <span class="mh">0x0000</span>    <span class="c"># start with output on, this sets and r to GND for disable mode.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vref</span>               <span class="o">=</span> <span class="mf">2.5</span>       <span class="c"># an internal constant.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refenable</span>          <span class="o">=</span> <span class="mi">0</span>         <span class="c"># default 0 is reference on, 1 is off.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span>              <span class="o">=</span> <span class="mh">0x8000</span>    <span class="c"># Use carefully, gums up ACKs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_controlreg</span><span class="p">()</span>           <span class="c"># Clear the whole thing out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_voltage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                <span class="c"># In lieu of using the reset bit which nukes the I2C port.</span>
    <span class="k">def</span> <span class="nf">_update_controlreg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_word</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_reg</span><span class="p">,</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">swap_endian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">refenable</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_code</span><span class="p">,</span> <span class="n">elementCount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_set_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the code of the AD5693R&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_word</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dac_reg</span><span class="p">,</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">swap_endian</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">elementCount</span> <span class="o">=</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_set_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gain</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gain</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_code</span> <span class="o">=</span> <span class="mh">0x0800</span>
        <span class="k">elif</span> <span class="n">gain</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain_code</span> <span class="o">=</span> <span class="mh">0x0000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;AD5693R gain setting should be either 1 or 2.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_controlreg</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_set_outputz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="mh">0x0000</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;1k&quot;</span><span class="p">,</span> <span class="s">&quot;1K&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="mh">0x2000</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;100k&quot;</span><span class="p">,</span> <span class="s">&quot;100K&quot;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="mh">0x4000</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;z&quot;</span><span class="p">,</span> <span class="s">&quot;Z&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">impedance</span> <span class="o">=</span> <span class="mh">0x6000</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;AD5693R impedance setting must be one of: {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">([</span><span class="s">&quot;0&quot;</span><span class="p">,</span> <span class="s">&quot;1k&quot;</span><span class="p">,</span> <span class="s">&quot;100k&quot;</span><span class="p">,</span> <span class="s">&quot;z&quot;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_controlreg</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_set_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the voltage of the AD5693R&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_code</span> <span class="o">==</span> <span class="mh">0x0800</span><span class="p">:</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">voltage</span> <span class="o">/</span> <span class="n">gain</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">vref</span> <span class="o">*</span> <span class="mf">65536.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">&gt;</span> <span class="mi">65535</span> <span class="ow">or</span> <span class="n">code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;AD5693R code: {} out of range 0 to 65535. Gain = {}, Requested voltage = {}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">voltage</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_voltage</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_outputz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_outputz</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_gain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_set_gain</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">output</span><span class="p">)</span></div>
<div class="viewcode-block" id="AD5272"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.AD5272">[docs]</a><span class="k">class</span> <span class="nc">AD5272</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Analog Devices I2C Precision Potentiometer / Rheostat</span>
<span class="sd">    http://www.analog.com/static/imported-files/data_sheets/AD5272_5274.pdf&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_twi</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">full_scale_ohms</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_twi is a interface_twi</span>
<span class="sd">        addr7 is the 7-bit I2C address of the AD5272 set by pinstrapping.</span>
<span class="sd">        Choose addr7 from 0x2F, 0x2C, 0x2E</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Analog Devices I2C 10-bit Potentiometer at {:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;AD5272&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="k">if</span> <span class="n">addr7</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0x2E</span><span class="p">,</span> <span class="mh">0x2F</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">AD5272 only supports addresses 0x2C, 0x2E, 0x2F&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr7</span> <span class="o">=</span> <span class="n">addr7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_scale_ohms</span> <span class="o">=</span> <span class="n">full_scale_ohms</span>
    <span class="k">def</span> <span class="nf">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">subaddr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span>
        <span class="k">while</span> <span class="n">tries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">subaddr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">resync_communication</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tries</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
<div class="viewcode-block" id="AD5272.enable"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.AD5272.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Place AD5272 into shutdown by writing enabled=False</span>
<span class="sd">        Re-enable by writing enabled=True&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x9</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x7</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="c">#RDAC register write protect disable (allow i2c update)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c">#shutdown</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x9</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">set_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">lsbyte</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
        <span class="n">msbyte</span> <span class="o">=</span> <span class="mh">0x1</span><span class="o">&lt;&lt;</span><span class="mi">2</span> <span class="o">|</span> <span class="n">value</span><span class="o">&gt;&gt;</span><span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x7</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">)</span> <span class="c">#RDAC register write protect disable (allow i2c update)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="n">msbyte</span><span class="p">,</span> <span class="n">lsbyte</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span>
        <span class="k">while</span> <span class="n">tries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x2</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_addr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">))</span>
                <span class="n">msbyte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_ack</span><span class="p">()</span>
                <span class="n">lsbyte</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_nack</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">msbyte</span> <span class="o">&amp;</span> <span class="mb">0b11</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">lsbyte</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">resync_communication</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;AD5272 Comunication Failed.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">percent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;value is between 0 and 1. DAC is biased toward 0 so that full scale is not achievable&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">percent</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">percent</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">percent</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)),</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">code_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">code_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">percent_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_percent</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">percent_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_resistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">resistance_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">resistance</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_percent</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">resistance</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_scale_ohms</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">resistance_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_code_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">code_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">code_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_percent_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">percent_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">percent_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_resistance_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">resistance_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_scale_ohms</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">10</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">resistance_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">enable_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">enable_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="CAT5140"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.CAT5140">[docs]</a><span class="k">class</span> <span class="nc">CAT5140</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;ONSemi/Catalyst I2C 256 Tap Potentiometer&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_twi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr7</span> <span class="o">=</span> <span class="mb">0b0101000</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;ONSemi/Catalyst I2C 8-bit Potentiometer at {:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;CAT5140&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">def</span> <span class="nf">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr7</span><span class="p">,</span> <span class="n">subaddr</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span>
        <span class="k">while</span> <span class="n">tries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="n">addr7</span><span class="p">,</span> <span class="n">subaddr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">resync_communication</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tries</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
    <span class="k">def</span> <span class="nf">set_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span>
        <span class="k">while</span> <span class="n">tries</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tries</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">read_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">resync_communication</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;CAT5140 Communication Failed.&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_write_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">percent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;value is between 0 and 1. DAC is biased toward 0 so that full scale is not achievable&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">percent</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">percent</span> <span class="o">&lt;=</span> <span class="mi">1</span>
        <span class="n">code</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">percent</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="p">)),</span> <span class="mi">2</span><span class="o">**</span><span class="mi">8</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">code_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">code_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">percent_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_percent</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">percent_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_code_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">code_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">code_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_percent_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">percent_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output</span><span class="p">()</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">8</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">percent_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_select_nonvolatile_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_select_volatile_register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">write_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_select_nonvolatile_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">nvselect_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_select_nonvolatile_register</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">nvselect_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_select_volatile_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">volselect_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">_select_volatile_register</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">volselect_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="PCF8574"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.PCF8574">[docs]</a><span class="k">class</span> <span class="nc">PCF8574</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Multi-vendor 8bit I2C GPIO</span>
<span class="sd">    http://www.ti.com/lit/ds/symlink/pcf8574.pdf&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_twi</span><span class="p">,</span> <span class="n">addr7</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_twi is a interface_twi</span>
<span class="sd">        addr7 is the 7-bit I2C address of the PCF8574 set by pinstrapping.</span>
<span class="sd">        PCF8574  has addr7 from 0x20 - 0x27</span>
<span class="sd">        PCF8574A has addr7 from 0x38 - 0x3F&#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Multi-vendor I2C GPIO at {:X}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addr7</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;PCF8574&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_twi</span><span class="p">(</span><span class="n">interface_twi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">twi</span> <span class="o">=</span> <span class="n">interface_twi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addr7</span> <span class="o">=</span> <span class="n">addr7</span>
    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">send_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_readback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">twi</span><span class="o">.</span><span class="n">receive_byte</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">addr7</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="TDS640A"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.TDS640A">[docs]</a><span class="k">class</span> <span class="nc">TDS640A</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">,</span><span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Tek Digitizing Oscilloscope&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interface_visa</span><span class="p">,</span> <span class="n">force_trigger</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&quot;&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;TDS640A&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;TDS640A @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:ENCdg ASCIi&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:WID 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;HEADER 1&#39;</span><span class="p">)</span> <span class="c">#data headers help parse results of wfmoutpre? query, since different scopes return different length responses!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span> <span class="o">=</span> <span class="n">force_trigger</span>
    <span class="k">def</span> <span class="nf">add_channel_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="n">time_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_time</span><span class="p">)</span>
        <span class="n">time_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">time_channel</span><span class="p">)</span>
<div class="viewcode-block" id="TDS640A.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.TDS640A.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument. num is 1-4.&#39;&#39;&#39;</span>
        <span class="n">scope_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_scope_channel</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">scope_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">scope_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="TDS640A.trigger_force"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.TDS640A.trigger_force">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a trigger event. If TRIGger:STATE is set to READy, the acquisition</span>
<span class="sd">        will complete. Otherwise, this command will be ignored.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;TRIGger FORCe&#39;</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_read_scope_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Data conversion:</span>
<span class="sd">        voltage = [(data value - yreference) * yincrement] + yorigin</span>
<span class="sd">        time = [(data point number - xreference) * xincrement] + xorigin</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;WFMOUTPRE?&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#remove junk that doesn&#39;t really belong to first field</span>
        <span class="n">preamble_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">preamble</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">preamble_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">])</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">])</span>
        <span class="n">xpoints</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;PT_OFF&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XINCR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;XZERO&#39;</span><span class="p">],</span><span class="nb">range</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;NR_PT&#39;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">xpoints</span>
    <span class="k">def</span> <span class="nf">_read_scope_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scope_channel_number</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return list of y-axis points for named channel</span>
<span class="sd">            list will be datalogged by logger as a string in a single cell in the table</span>
<span class="sd">            trigger=False can by used to suppress acquisition of new data by the instrument so that</span>
<span class="sd">            data from a single trigger may be retrieved from each of the four channels in turn by read_channels()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#trigger / single arm sequence commands need investigation.  Forcing trigger here is not correct</span>
        <span class="c"># if trigger:</span>
            <span class="c"># self.get_interface().write(&#39;TRIGger&#39;)</span>

        <span class="c"># Examples WFMOUTPRE? ? might return the waveform formatting data as:</span>
        <span class="c">#  [0] :WFMOUTPRE:BYT_NR 2;</span>
        <span class="c">#  [1] BIT_NR 16;</span>
        <span class="c">#  [2] ENCDG ASCII;</span>
        <span class="c">#  [3] BN_FMT RI;</span>
        <span class="c">#  [4] BYT_OR MSB;</span>
        <span class="c">#  [5] WFID &quot;Ch1, DC coupling, 100.0mV/div, 4.000us/div, 10000 points, Sample mode&quot;;</span>
        <span class="c">#  [6] NR_PT 10000;</span>
        <span class="c">#  [7] PT_FMT Y;</span>
        <span class="c">#  [8] XUNIT &quot;s&quot;;</span>
        <span class="c">#  [9] XINCR 4.0000E-9;</span>
        <span class="c"># [10] XZERO - 20.0000E-6;</span>
        <span class="c"># [11] PT_OFF 0;</span>
        <span class="c"># [12] YUNIT &quot;V&quot;;</span>
        <span class="c"># [13] YMULT 15.6250E-6;</span>
        <span class="c"># [14] YOFF :&quot;6.4000E+3;</span>
        <span class="c"># [15] YZERO 0.0000</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;DATA:SOUrce CH{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scope_channel_number</span><span class="p">))</span>
        <span class="n">preamble</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;WFMOUTPRE?&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">preamble</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c">#remove junk that doesn&#39;t really belong to first field</span>
        <span class="n">preamble_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">preamble</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">preamble_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">])</span> <span class="c">#scale int to volts</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">])</span> <span class="c">#offset set into scope, subtract from raw_data before scaling if you want data offset</span>
        <span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">])</span> <span class="c">#waveform position</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&#39;CURVe?&#39;</span><span class="p">)</span>
        <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="c">#not sure where y_zero goes in eqn! #offset seems to be display only</span>
        <span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YOFF&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YMULT&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">preamble_dict</span><span class="p">[</span><span class="s">&#39;YZERO&#39;</span><span class="p">],</span> <span class="n">raw_data</span><span class="p">)</span>
        <span class="c">#TODO - implement binary transfer if speed becomes a problem</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_trigger</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_force</span><span class="p">()</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span>
</div>
<div class="viewcode-block" id="fluke_45"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45">[docs]</a><span class="k">class</span> <span class="nc">fluke_45</span><span class="p">(</span><span class="n">scpi_instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;single channel fluke_45 meter</span>
<span class="sd">        defaults to dc voltage, note this instrument currently does not support using multiple measurement types at the same time&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface_visa</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;interface_visa&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;fluke_45&#39;</span>
        <span class="n">scpi_instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;f25 @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_interface_visa</span><span class="p">(</span><span class="n">interface_visa</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_dc_voltage</span><span class="p">()</span>
<div class="viewcode-block" id="fluke_45.config_dc_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.config_dc_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for DC voltage measurement.</span>
<span class="sd">        Optionally set range and rate&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">(</span><span class="s">&quot;VDC &quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span></div>
<div class="viewcode-block" id="fluke_45.config_dc_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.config_dc_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_dc_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for DC current measurement.</span>
<span class="sd">        Optionally set range and rate&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">(</span><span class="s">&quot;ADC &quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span></div>
<div class="viewcode-block" id="fluke_45.config_ac_voltage"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.config_ac_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC voltage measurement.</span>
<span class="sd">        Optionally set range and rate&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">(</span><span class="s">&quot;VAC &quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span></div>
<div class="viewcode-block" id="fluke_45.config_ac_current"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.config_ac_current">[docs]</a>    <span class="k">def</span> <span class="nf">config_ac_current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Configure meter for AC current measurement.</span>
<span class="sd">        Optionally set range and rate&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">(</span><span class="s">&quot;AAC &quot;</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span></div>
<div class="viewcode-block" id="fluke_45.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add named channel to instrument without configuring measurement type.&#39;&#39;&#39;</span>
        <span class="n">meter_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">read_meter</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">meter_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="fluke_45.read_meter"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.fluke_45.read_meter">[docs]</a>    <span class="k">def</span> <span class="nf">read_meter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return float representing meter measurement. Units are V,A,Ohm, etc depending on meter configuration.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span><span class="s">&quot;MEAS1?&quot;</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_string</span><span class="p">,</span> <span class="nb">range</span><span class="p">,</span> <span class="n">rate</span><span class="p">):</span>
        <span class="n">RANGE_SETTINGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;AUTO&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
        <span class="n">RATE_SETTINGS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;S&quot;</span><span class="p">,</span> <span class="s">&quot;M&quot;</span><span class="p">,</span> <span class="s">&quot;F&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">range</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RANGE_SETTINGS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error: Not a valid range setting, valid settings are:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">RANGE_SETTINGS</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rate</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RATE_SETTINGS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error: Not a valid rate setting, valid settings are:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">RATE_SETTINGS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">command_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;AUTO &quot;</span> <span class="k">if</span> <span class="nb">range</span> <span class="o">==</span> <span class="s">&quot;AUTO&quot;</span> <span class="k">else</span> <span class="s">&quot;RANGE &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_interface</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;RATE &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rate</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="saleae"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.saleae">[docs]</a><span class="k">class</span> <span class="nc">saleae</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;analog DAQ intrument using Saleae Logic Pro hardware.</span>
<span class="sd">    Requires https://pypi.python.org/pypi/saleae</span>
<span class="sd">    Also requires Saleae Logic software GUI to be running to listen on TCP remote control port.</span>
<span class="sd">    Digital channels not supported (yet). (Mixed analog/digital capture file binary unsupported.)&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">host</span><span class="o">=</span><span class="s">u&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">10429</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">saleae</span> <span class="kn">as</span> <span class="nn">saleae_lib</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Saleae Logic @ {}:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span> <span class="o">=</span> <span class="n">saleae_lib</span><span class="o">.</span><span class="n">Saleae</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_num_samples</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_sample_rate</span><span class="p">()</span> <span class="c">#max rate</span>
<div class="viewcode-block" id="saleae.set_num_samples"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.saleae.set_num_samples">[docs]</a>    <span class="k">def</span> <span class="nf">set_num_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_samples_per_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set number of samples to average and sample rate</span>
<span class="sd">        because valid sample rates change with ???number of configured channels???, may need to call after adding all channels.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">set_num_samples</span><span class="p">(</span><span class="n">num_samples_per_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">set_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_rate</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">sample_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">get_all_sample_rates</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">sample_rate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sample_rate</span> <span class="ow">in</span> <span class="n">sample_rates</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">set_sample_rate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">sample_rate</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sample_rates</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">get_all_sample_rates</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">set_sample_rate</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">sample_rates</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">sample_rates</span>
    <span class="k">def</span> <span class="nf">get_sample_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">get_all_sample_rates</span><span class="p">()]</span>
    <span class="k">def</span> <span class="nf">_set_active_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">set_active_channels</span><span class="p">(</span><span class="n">digital</span><span class="o">=</span><span class="p">[],</span><span class="n">analog</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="p">)</span>
<div class="viewcode-block" id="saleae.add_channel_scalar"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.saleae.add_channel_scalar">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add analog scalar (DMM) DAQ channel to instrument.</span>
<span class="sd">        channel_number is 0-7 or 0-15 for Logic Pro 8 and Logic Pro 16 respectively.&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_number</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="o">&lt;</span> <span class="mi">16</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_number</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;scalar&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_active_channels</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="saleae.add_channel_trace"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.saleae.add_channel_trace">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">channel_number</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add analog vector trace (scope) DAQ channel to instrument.</span>
<span class="sd">        channel_number is 0-7 or 0-15 for Logic Pro 8 and Logic Pro 16 respectively.&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">channel_number</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="o">&lt;</span> <span class="mi">16</span>
        <span class="k">assert</span> <span class="n">channel_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_number</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">,</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;vector&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel_number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_active_channels</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_dummy_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Shouldn&#39;t be here...&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;intermittently, data is slow to flush to disk...&#39;&#39;&#39;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Saleae communication failure&#39;</span><span class="p">)</span>
            <span class="nb">str</span> <span class="o">+=</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">str</span>
<div class="viewcode-block" id="saleae.read_delegated_channel_list"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.saleae.read_delegated_channel_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">temp_dir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#39;saleae_tmp&#39;</span><span class="p">)</span>
        <span class="n">temp_file</span> <span class="o">=</span> <span class="n">temp_dir</span> <span class="o">+</span> <span class="s">&#39;/capture.logicdata&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">capture_start</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">is_processing_complete</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="n">ch_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;channel&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">export_data2</span><span class="p">(</span><span class="n">temp_file</span><span class="p">,</span> <span class="n">digital_channels</span><span class="o">=</span><span class="p">[],</span> <span class="n">analog_channels</span><span class="o">=</span><span class="n">ch_list</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;binary&#39;</span><span class="p">)</span> <span class="c">#</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saleae</span><span class="o">.</span><span class="n">is_processing_complete</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">temp_file</span> <span class="o">+</span> <span class="s">&#39;.bin&#39;</span><span class="p">,</span> <span class="s">&#39;r+b&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">logicdata</span><span class="p">:</span>
            <span class="n">num_samples_per_channel</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;Q&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file</span><span class="p">(</span><span class="n">logicdata</span><span class="p">,</span> <span class="mi">8</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">num_channels</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;L&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file</span><span class="p">(</span><span class="n">logicdata</span><span class="p">,</span> <span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sample_period</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;d&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file</span><span class="p">(</span><span class="n">logicdata</span><span class="p">,</span> <span class="mi">8</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_channels</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span>
                    <span class="n">channel_avg</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples_per_channel</span><span class="p">):</span>
                        <span class="n">channel_avg</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;f&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_from_file</span><span class="p">(</span><span class="n">logicdata</span><span class="p">,</span> <span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">channel_avg</span> <span class="o">/=</span> <span class="n">num_samples_per_channel</span>
                    <span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel_avg</span>
                <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;vector&#39;</span><span class="p">:</span>
                    <span class="n">channel_data</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_samples_per_channel</span><span class="p">):</span>
                        <span class="n">channel_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;&lt;f&#39;</span><span class="p">,</span><span class="n">logicdata</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel_data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Bad &quot;type&quot; channel attribute.&#39;</span><span class="p">)</span>
            <span class="n">logicdata</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">temp_file</span> <span class="o">+</span> <span class="s">&#39;.bin&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results_dict</span>
</div></div>
<div class="viewcode-block" id="firmata"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata">[docs]</a><span class="k">class</span> <span class="nc">firmata</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Firmata is a protocol for communicating with microcontrollers from software on a host computer.</span>
<span class="sd">    The protocol can be implemented in firmware on any microcontroller architecture as well as software on any host computer software package.</span>
<span class="sd">    The Arduino repository described here is a Firmata library for Arduino and Arduino-compatible devices. If you would like to contribute to Firmata, please see the Contributing section below.</span>
<span class="sd">    </span>
<span class="sd">    Usage</span>
<span class="sd">    The model supported by PyICe is to load a general purpose sketch called StandardFirmata</span>
<span class="sd">    on the Arduino board and then use the host computer exclusively to interact with the Arduino board.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    *** Arduino/Linduno specific:</span>
<span class="sd">    *** StandardFirmata is located in the Arduino IDE in File -&gt; Examples -&gt; Firmata.</span>
<span class="sd">    *** This sketch must be flashed onto the microcontroller board to use this instrument driver.</span>
<span class="sd">    </span>
<span class="sd">    *** Other microcontrollers:</span>
<span class="sd">    *** Must flash architechture-specific compiled embedded server.</span>
<span class="sd">    </span>
<span class="sd">    https://github.com/firmata/protocol/blob/master/README.md</span>
<span class="sd">    </span>
<span class="sd">    https://github.com/firmata/arduino/blob/master/readme.md</span>
<span class="sd">    </span>
<span class="sd">    https://github.com/MrYsLab/PyMata/blob/master/README.md</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">serial_port_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        1) note that this makes its own serial object. Can&#39;t use master.get_raw_serial_interface and this will read/write in its own thread.</span>
<span class="sd">        </span>
<span class="sd">        2) inherit from delegator and aggregate pin states with single query???</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PyMata.pymata</span> <span class="kn">import</span> <span class="n">PyMata</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;*** Please install the Pymata module.&quot;</span>
            <span class="k">print</span> <span class="s">&quot;*** https://github.com/MrYsLab/PyMata/blob/master/README.md&quot;</span>
            <span class="k">print</span> <span class="s">&quot;*** Try typing &#39;pip install pymata&#39; or &#39;python PyICe/deps/PyMata_v2.09/setup.py install&#39;.&quot;</span>
            <span class="k">raise</span> <span class="n">e</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Firmata&#39;</span>            
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Firmata Client @ {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">serial_port_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ser_name</span> <span class="o">=</span> <span class="n">serial_port_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span> <span class="o">=</span> <span class="n">PyMata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ser_name</span><span class="p">,</span> <span class="n">bluetooth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#verbose doesn&#39;t seem to print much except board capabilities upon init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">_check_configure_pin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">channel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">)]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Cannot configure {} pin {} as type {}. Pin already configured as type {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Analog&#39;</span> <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG</span> <span class="k">else</span> <span class="s">&#39;Digital&#39;</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">)][</span><span class="n">pin</span><span class="p">]</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_configured_pins</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">)][</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">channel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">set_pin_mode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">),</span> <span class="n">pin_type</span><span class="o">=</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">))</span>
<div class="viewcode-block" id="firmata.add_channel_digital_input"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_digital_input">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_digital_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">enable_pullup</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Digital input pin.</span>
<span class="sd">        Use higher-numbered digital pin aliasing to use analog pins as digital.</span>
<span class="sd">        For Arduno Uno/Linduino:</span>
<span class="sd">        A0=14</span>
<span class="sd">        A1=15</span>
<span class="sd">        A2=16</span>
<span class="sd">        A3=17</span>
<span class="sd">        A4=18</span>
<span class="sd">        A5=19</span>

<span class="sd">        Set enable_pullup=True to enable on-board uC pullups. (~20k in Arduino Uno/Linduino AtMega328P)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">digital_read</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;DIGITAL_INPUT&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pullup_enabled&#39;</span><span class="p">,</span><span class="n">enable_pullup</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_configure_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">new_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">enable_pullup</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_digital_input</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="c"># def add_channel_digital_input_bus(self, channel_name, pin_list):</span>
        <span class="c"># &#39;&#39;&#39;Multi-pin digital input bus.&#39;&#39;&#39;</span>
        <span class="c"># raise Exception(&#39;Not yet implemented&#39;)</span></div>
<div class="viewcode-block" id="firmata.add_channel_digital_output"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_digital_output">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_digital_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Digital output pin.</span>
<span class="sd">        analog_pin argument doesn&#39;t function. Use higher-numbered digital pin aliasing to use analog pins as digital.</span>
<span class="sd">        For Arduno Uno/Linduino:</span>
<span class="sd">        A0=14</span>
<span class="sd">        A1=15</span>
<span class="sd">        A2=16</span>
<span class="sd">        A3=17</span>
<span class="sd">        A4=18</span>
<span class="sd">        A5=19</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">digital_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;DIGITAL_OUTPUT&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_configure_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_digital_output</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="c"># def add_channel_digital_output_bus(self, channel_name, pin_list):</span>
        <span class="c"># &#39;&#39;&#39;Multi-pin digital output bus.&#39;&#39;&#39;</span>
        <span class="c"># raise Exception(&#39;Not yet implemented&#39;)</span></div>
<div class="viewcode-block" id="firmata.add_channel_analog_input"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_analog_input">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_analog_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Analog input pin.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">analog_read</span><span class="p">(</span><span class="n">pin</span><span class="p">))</span> <span class="c">#don&#39;t really know size, but it doesn&#39;t matter. 10-bit answer on Arduino hardware</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;ANALOG_INPUT&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">INPUT</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_configure_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_analog_input</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_adc_5v&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">5.0</span><span class="o">/</span><span class="mi">1024</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="mi">1024</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_adc_3v3&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">3.3</span><span class="o">/</span><span class="mi">1024</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">3.3</span><span class="o">*</span><span class="mi">1024</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="c">#Not sure if Firmata protocol allows ADC reference switch....</span>
        <span class="c">#new_channel.add_format(format_name=&#39;arduino_adc_1v1&#39;, format_function=lambda code: code*1.1/1024, unformat_function=lambda analog: int(round(analog/1.1*1024)), signed=False, units=&#39;V&#39;)</span>
        <span class="c">#new_channel.add_format(format_name=&#39;arduino_adc_2v56&#39;, format_function=lambda code: code*2.56/1024, unformat_function=lambda analog: int(round(analog/2.56*1024)), signed=False, units=&#39;V&#39;)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="firmata.add_channel_pwm_output"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_pwm_output">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_pwm_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;PWM output pin.</span>
<span class="sd">        Arduino UNO (Atmega328) compatible with digital pins 3,5,6,9,10,11.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">analog_write</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span> <span class="c">#8-bit hardware is Arduino specific (0-255 valide PWM values)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;PWM_OUTPUT&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">pin</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">PWM</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_configure_pin</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">new_channel</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_pwm_output</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_pwm_dc&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">1.0</span><span class="o">*</span><span class="mi">255</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_pwm_5v&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">5.0</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="mi">255</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_pwm_3v3&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">3.3</span><span class="o">/</span><span class="mi">255</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">3.3</span><span class="o">*</span><span class="mi">255</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="firmata.add_channel_servo"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_servo">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">pin</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;RC servo control (544ms-2400ms PWM) output.&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Not yet implemented&#39;</span><span class="p">)</span>
        <span class="c">#self.firmata_board.servo_config(pin, min_pulse=544, max_pulse=2400)</span></div>
<div class="viewcode-block" id="firmata.add_channel_digital_latch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_digital_latch">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_digital_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">digital_input_channel</span><span class="p">,</span> <span class="n">threshold_high</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Latch transient signals on a digital input pin. Software logic appears to be edge-triggered.</span>
<span class="sd">        Input pin channel must have been previously configured with firmata.add_channel_digital_input().</span>
<span class="sd">        Pass channel object instance to digital_input_channel argument.</span>
<span class="sd">        latches rising edge by default. Set threshold_high=False to set latch sensitivity to logic low.</span>
<span class="sd">        this doesn&#39;t appear to have access to analog pins (A0-A5) used as digital IO.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">read_latch_status</span><span class="p">(</span><span class="n">latch_channel</span><span class="p">):</span>
            <span class="n">latch_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">get_digital_latch_data</span><span class="p">(</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">))</span>
            <span class="n">latch_state</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">latch_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">LATCH_LATCHED</span> <span class="k">else</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">latch_state</span><span class="p">:</span>
                <span class="c">#re-arm latch</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">set_digital_latch</span><span class="p">(</span><span class="n">pin</span><span class="o">=</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">),</span> <span class="n">threshold_type</span><span class="o">=</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span> <span class="c">#dummy read function until channel instance is created</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">_read</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">read_latch_status</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span> <span class="c">#get reference back to channel for attribute lookup</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;DIGITAL_LATCH&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">digital_input_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL_LATCH_HIGH</span> <span class="k">if</span> <span class="n">threshold_high</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">DIGITAL_LATCH_LOW</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;parent_channel&#39;</span><span class="p">,</span> <span class="n">digital_input_channel</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">digital_input_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;DIGITAL_INPUT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">set_digital_latch</span><span class="p">(</span><span class="n">pin</span><span class="o">=</span><span class="n">new_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">),</span> <span class="n">threshold_type</span><span class="o">=</span><span class="n">new_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_digital_latch</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="firmata.add_channel_analog_latch"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.firmata.add_channel_analog_latch">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_analog_latch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">analog_input_channel</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">threshold_type</span><span class="o">=</span><span class="s">&#39;&gt;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Latch transient signals on an analog (ADC) input pin.</span>
<span class="sd">        Input pin channel must have been previously configured with firmata.add_channel_analog_input().</span>
<span class="sd">        Pass channel object instance to analog_input_channel argument.</span>
<span class="sd">        threshold is in Volts, assuming 5V Arduino ADC full scale (1023). Change format setting of _thresold channel to use raw (0-1023) or 3.3V ADC scales.</span>
<span class="sd">        latches high signal levels by default. Set threshold_type=&#39;&gt;=&#39;, &#39;&lt;&#39; or  to set latch sensitivity to logic low.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">read_latch_status</span><span class="p">(</span><span class="n">latch_channel</span><span class="p">):</span>
            <span class="n">latch_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">get_analog_latch_data</span><span class="p">(</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">))</span>
            <span class="n">latch_state</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">latch_status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">LATCH_LATCHED</span> <span class="k">else</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="n">latch_state</span><span class="p">:</span>
                <span class="c">#re-arm latch</span>
                <span class="n">th_ch</span> <span class="o">=</span> <span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;threshold_channel&#39;</span><span class="p">)</span>
                <span class="n">th_ch</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">th_ch</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">assert</span> <span class="n">analog_input_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;ANALOG_INPUT&#39;</span>
        <span class="n">latch_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">)</span> <span class="c">#dummy read function until channel instance is created</span>
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">_read</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">read_latch_status</span><span class="p">(</span><span class="n">latch_channel</span><span class="p">)</span> <span class="c">#get reference back to channel for attribute lookup</span>
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;channel_type&#39;</span><span class="p">,</span><span class="s">&#39;ANALOG_LATCH&#39;</span><span class="p">)</span>
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">,</span><span class="n">analog_input_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">))</span>
        
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;parent_channel&#39;</span><span class="p">,</span> <span class="n">analog_input_channel</span><span class="p">)</span>
        
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_analog_latch</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">threshold_type</span> <span class="o">==</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span>
            <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG_LATCH_GT</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">threshold_type</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG_LATCH_LT</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">threshold_type</span> <span class="o">==</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">:</span>
            <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG_LATCH_GTE</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">threshold_type</span> <span class="o">==</span> <span class="s">&#39;&lt;=&#39;</span><span class="p">:</span>
            <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">ANALOG_LATCH_LTE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;threshold_type: {} not in [&#39;&gt;&#39;, &#39;&lt;&#39;, &#39;&gt;=&#39;, &#39;&lt;=&#39;]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">threshold_type</span><span class="p">))</span>
        <span class="n">threshold_channel</span> <span class="o">=</span> <span class="n">integer_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">+</span> <span class="s">&#39;_threshold&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">threshold</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">firmata_board</span><span class="o">.</span><span class="n">set_analog_latch</span><span class="p">(</span><span class="n">pin</span><span class="o">=</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;pin&#39;</span><span class="p">),</span>
                                                                                                                                                       <span class="n">threshold_type</span><span class="o">=</span><span class="n">latch_channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">),</span>
                                                                                                                                                       <span class="n">threshold_value</span><span class="o">=</span><span class="n">threshold</span><span class="p">))</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_adc_5v&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">5.0</span><span class="o">/</span><span class="mi">1024</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">5.0</span><span class="o">*</span><span class="mi">1024</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">add_format</span><span class="p">(</span><span class="n">format_name</span><span class="o">=</span><span class="s">&#39;arduino_adc_3v3&#39;</span><span class="p">,</span> <span class="n">format_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">code</span><span class="p">:</span> <span class="n">code</span><span class="o">*</span><span class="mf">3.3</span><span class="o">/</span><span class="mi">1024</span><span class="p">,</span> <span class="n">unformat_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">analog</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">analog</span><span class="o">/</span><span class="mf">3.3</span><span class="o">*</span><span class="mi">1024</span><span class="p">)),</span> <span class="n">signed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s">&#39;V&#39;</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s">&#39;arduino_adc_5v&#39;</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_type&#39;</span><span class="p">,</span><span class="n">threshold_type</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;parent_channel&#39;</span><span class="p">,</span> <span class="n">analog_input_channel</span><span class="p">)</span>
        <span class="n">threshold_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;latch_channel&#39;</span><span class="p">,</span> <span class="n">latch_channel</span><span class="p">)</span>
        <span class="n">latch_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;threshold_channel&#39;</span><span class="p">,</span> <span class="n">threshold_channel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">threshold_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">latch_channel</span><span class="p">)</span>

<span class="c">###############################################</span>
<span class="c">#               Virtual Instruments           #</span>
<span class="c">###############################################</span>
</div></div>
<div class="viewcode-block" id="instrument_humanoid"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.instrument_humanoid">[docs]</a><span class="k">class</span> <span class="nc">instrument_humanoid</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Notification helper to put human control of a manual instrument into an otherwise automated measurement.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notification_function</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Notification will be sent to notification_function when a write occurs to any channel in this instrument.  The function should take a single string argument and deliver it to the user as appropriate (sms, email, etc).</span>
<span class="sd">        Hint: Use a lambda function to include a subject line in the email:</span>
<span class="sd">        myemail = lab_utils.email(destination=&#39;myemail@linear.com&#39;)</span>
<span class="sd">        notification_function=lambda msg: myemail.send(msg,subject=&quot;LTC lab requires attention!&quot;)</span>
<span class="sd">        If notification_function is None, messages will only be sent to the terminal.&#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;manaul instrument interface notifying via {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">notification_function</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Human Feedback&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notification_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">notification_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_notification_function</span><span class="p">(</span><span class="n">notification_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_notifications</span> <span class="o">=</span> <span class="bp">True</span>
<div class="viewcode-block" id="instrument_humanoid.add_notification_function"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.instrument_humanoid.add_notification_function">[docs]</a>    <span class="k">def</span> <span class="nf">add_notification_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">notification_function</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add additional notification function to instrument.  Ex email and SMS.</span>
<span class="sd">        Notification will be sent to notification_function when a write occurs to any channel in this instrument.  The function should take a single string argument and deliver it to the user as appropriate (sms, email, etc).</span>
<span class="sd">        Hint: Use a lambda function to include a subject line in the email:</span>
<span class="sd">        myemail = lab_utils.email(destination=&#39;myemail@linear.com&#39;)</span>
<span class="sd">        notification_function=lambda msg: myemail.send(msg,subject=&quot;LTC lab requires attention!&quot;)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notification_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notification_function</span><span class="p">)</span></div>
<div class="viewcode-block" id="instrument_humanoid.add_channel_notification_enable"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.instrument_humanoid.add_channel_notification_enable">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_notification_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Hook to temporarily suspend notifications, ex for initial setup.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_notification_enable</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_notification_enable</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="instrument_humanoid.set_notification_enable"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.instrument_humanoid.set_notification_enable">[docs]</a>    <span class="k">def</span> <span class="nf">set_notification_enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;non-channel hook to enable/disable notifications&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_notifications</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_notifications</span> <span class="o">=</span> <span class="bp">False</span></div>
<div class="viewcode-block" id="instrument_humanoid.add_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.instrument_humanoid.add_channel">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add new channel named channel_name.  Writes to channel_name will send a notification using notification_function and will block until the user acknowledges (in the terminal) that they have intervened as appropriate.</span>
<span class="sd">        Useful for including manual instruments in an otherwise automated setup.</span>
<span class="sd">        To set delay after changing channel, use set_write_delay() method of returned channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_notifications</span><span class="p">:</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Please modify channel: {} to value: {} now. ({})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">notification_function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_functions</span><span class="p">:</span>
                <span class="n">notification_function</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">msg</span>
            <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;Then press any key to continue.&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="delay_loop"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delay_loop">[docs]</a><span class="k">class</span> <span class="nc">delay_loop</span><span class="p">(</span><span class="n">lab_utils</span><span class="o">.</span><span class="n">delay_loop</span><span class="p">,</span> <span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;instrument wrapper for lab_utils.delay_loop enables logging of delay diagnostic variables&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">begin</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">no_drift</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set strict to True to raise an Exception if loop time is longer than requested delay.</span>
<span class="sd">        Timer will automatically begin when the object is instantiated if begin=True.</span>
<span class="sd">          To start timer only when ready, set begin=False and call begin() method to start timer.</span>
<span class="sd">        If no_drift=True, delay loop will manage loop time over-runs by debiting extra time from next cycle.</span>
<span class="sd">          This insures long-term time stability at the expense of increased jitter.</span>
<span class="sd">          Windows task switching can add multi-mS uncertainty to each delay() call, which can accumulate if not accounted for.</span>
<span class="sd">          Set no_drift=False to ignore time over-runs when computing next delay time.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&quot;delay_loop instrument wrapper&quot;</span><span class="p">)</span>
        <span class="n">lab_utils</span><span class="o">.</span><span class="n">delay_loop</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strict</span><span class="p">,</span> <span class="n">begin</span><span class="p">,</span> <span class="n">no_drift</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Precision Delay Loop Virtual Instrument Wrapper&#39;</span>
<div class="viewcode-block" id="delay_loop.add_channel_count"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delay_loop.add_channel_count">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;total number of times delay() method called&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_count</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_count</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="delay_loop.add_channel_total_time"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delay_loop.add_channel_total_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;total number of seconds since delay() method first called&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_total_time</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_time</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="delay_loop.add_channel_delay_margin"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delay_loop.add_channel_delay_margin">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delay_margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;time remaining after user&#39;s loop tasks completed to sleep before start of next cycle.</span>
<span class="sd">        Negative if user tasks exceed loop time and no time is left to sleep.</span>
<span class="sd">        Includes any make-up contribution if previous iterations over-ran allocated loop time with no_drift attribute set.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_margin</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delay_margin</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="delay_loop.add_channel_achieved_loop_time"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.delay_loop.add_channel_achieved_loop_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_achieved_loop_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;actual time spent during in last loop iteration</span>
<span class="sd">        possibly longer than requested loop time if user taskes exceeded requested time (overrun).&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">achieved_loop_time</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_achieved_loop_time</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="clipboard"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.clipboard">[docs]</a><span class="k">class</span> <span class="nc">clipboard</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual instrument to exchange data with Windows/Linux clipboard for interactive copy and paste with another application.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Clipboard Exchange Virtual Instrument&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Copy/Past Clipboard Virtual Instrument&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pyperclip</span> <span class="c">#cross-platform</span>
            <span class="c">#https://pyperclip.readthedocs.org/</span>
            <span class="c">#https://github.com/asweigart/pyperclip</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span> <span class="o">=</span> <span class="n">pyperclip</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyperclip_copy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pyperclip_paste</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;pyperclip dependency not found.  Attempting to use win32clipboard.&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">win32clipboard</span>
                <span class="c">#http://docs.activestate.com/activepython/2.4/pywin32/win32clipboard.html</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span> <span class="o">=</span> <span class="n">win32clipboard</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win32_copy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_paste</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_win32_paste</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Clipboard virtual instrument requires either pyperclip or pywin32 module win32clipboard.&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="clipboard.add_channel_copy"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.clipboard.add_channel_copy">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Place data written to channel_name onto clipboard.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_copy</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="clipboard.add_channel_paste"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.clipboard.add_channel_paste">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Place data from clipboard into channel_name.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_paste</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_paste</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="clipboard.register_copy_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.clipboard.register_copy_channel">[docs]</a>    <span class="k">def</span> <span class="nf">register_copy_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_object</span><span class="p">,</span> <span class="n">write_copy</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Automatically places results on clipboard each time channel_object is read and optionally when channel_object is written.&#39;&#39;&#39;</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">add_read_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">channel_object</span><span class="p">,</span><span class="n">read_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">read_value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">write_copy</span><span class="p">:</span>
            <span class="n">channel_object</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">channel_object</span><span class="p">,</span><span class="n">write_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy</span><span class="p">(</span><span class="n">write_value</span><span class="p">))</span></div>
    <span class="k">def</span> <span class="nf">_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">clipboard_data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;place clipboard_data onto OS clipboard&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Overloaded implementation is library specific.&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;return OS clipboard contents&#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Overloaded implementation is library specific.&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_pyperclip_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">clipboard_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clipboard_data</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_pyperclip_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">paste</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_win32_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">clipboard_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">OpenClipboard</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">EmptyClipboard</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">SetClipboardText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clipboard_data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_win32_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">OpenClipboard</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">GetClipboardData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lib</span><span class="o">.</span><span class="n">CloseClipboard</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span>
</div>
<div class="viewcode-block" id="accumulator"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.accumulator">[docs]</a><span class="k">class</span> <span class="nc">accumulator</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual accumulator instrument.</span>
<span class="sd">    Writable channel adds value to stored total.</span>
<span class="sd">    Readable channel returns accumulation total.</span>
<span class="sd">    Can be used as a counter by writing accumulation value to +/-1&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Init sets initial accumulation total.  Defaults to 0.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&quot;Accumulator Virtual Instrument&quot;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulation</span> <span class="o">=</span> <span class="n">init</span>
<div class="viewcode-block" id="accumulator.add_channel_accumulation"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.accumulator.add_channel_accumulation">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_accumulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel reads return total accumulated quantity.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulation</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_accumulation</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="accumulator.add_channel_accumulate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.accumulator.add_channel_accumulate">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel writes accumulate value into total previously accumulated quantity.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">accumulate</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_accumulate</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="accumulator.accumulate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.accumulator.accumulate">[docs]</a>    <span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds value to accumulation total.  Use with caution outside channel framework.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accumulation</span> <span class="o">+=</span> <span class="n">value</span>
</div></div>
<div class="viewcode-block" id="timer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer">[docs]</a><span class="k">class</span> <span class="nc">timer</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span> <span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual timer instrument.</span>
<span class="sd">    All channels are read only and return time since either last read or first read, scaled to appropriate time units.</span>
<span class="sd">    All channels operate from a common timebase.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Timer Virtual Instrument&#39;</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">divs</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;seconds&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                      <span class="s">&#39;minutes&#39;</span> <span class="p">:</span> <span class="mf">60.0</span><span class="p">,</span>
                      <span class="s">&#39;hours&#39;</span>   <span class="p">:</span> <span class="mf">3600.0</span><span class="p">,</span>
                      <span class="s">&#39;days&#39;</span>    <span class="p">:</span> <span class="mf">86400.0</span><span class="p">,</span>
                      <span class="c">#weeks, years?</span>
                    <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">_dummy_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel_name</span><span class="p">]</span>
<div class="viewcode-block" id="timer.add_channel_total_seconds"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_total_seconds">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since first read with units of seconds.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;seconds&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;total_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_seconds</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_total_minutes"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_total_minutes">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since first read with units of minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;minutes&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;total_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_minutes</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_total_hours"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_total_hours">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since first read with units of hours.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;total_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_hours</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_total_days"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_total_days">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_days</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since first read with units of days.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;days&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;total_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_days</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_total_scale"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_total_scale">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_total_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">time_div</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since first read with user supplied time units. time_div is seconds per user-unit, eg 60 for minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">time_div</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;total_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_total_scale</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_delta_seconds"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_delta_seconds">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delta_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since last read with units of seconds.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;seconds&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;delta_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delta_seconds</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_delta_minutes"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_delta_minutes">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delta_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since last read with units of minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;minutes&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;delta_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delta_minutes</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_delta_hours"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_delta_hours">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delta_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since last read with units of hours.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;delta_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delta_hours</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_delta_days"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_delta_days">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delta_days</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since last read with units of days.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;days&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;delta_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delta_days</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_delta_scale"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_delta_scale">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_delta_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">time_div</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports elapsed time since last read with user supplied time units. time_div is seconds per user-unit, eg 60 for minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">time_div</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;delta_timer&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_delta_scale</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_frequency_hz"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_frequency_hz">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_frequency_hz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports read frequency in Hz.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;seconds&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;frequency&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_frequency_hz</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.add_channel_frequency_scale"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.add_channel_frequency_scale">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_frequency_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">time_div</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports read frequency with user supplied time units. time_div is seconds per user-unit, eg 60 for RPM.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">time_div</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;frequency&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_frequency_scale</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_compute_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_time</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_time</span>
<div class="viewcode-block" id="timer.reset_timer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.reset_timer">[docs]</a>    <span class="k">def</span> <span class="nf">reset_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Resets timer to 0. Use with caution outside channel framework.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_delta</span><span class="p">()</span></div>
<div class="viewcode-block" id="timer.stop_and_reset_timer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.stop_and_reset_timer">[docs]</a>    <span class="k">def</span> <span class="nf">stop_and_reset_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Halts and resets timer to 0. Timer will begin running after first read,</span>
<span class="sd">        same behavior as after timer object instantiation.</span>
<span class="sd">        Use with caution outside channel framework.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="bp">None</span></div>
<div class="viewcode-block" id="timer.pause_timer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.pause_timer">[docs]</a>    <span class="k">def</span> <span class="nf">pause_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;pause timer . Call resume_timer() to continue counting.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Attemped to pause already paused timer.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c">#update internal variables because _compute_delta won&#39;t while paused </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pause_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="c">#shouldn&#39;t ever pause a timer before it starts...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span> <span class="o">=</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="timer.resume_timer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.resume_timer">[docs]</a>    <span class="k">def</span> <span class="nf">resume_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;resume timer . Call pause_timer() to stop counting again. Can also call resume_timer() at the beginning of time to start the timer.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span><span class="p">:</span>
            <span class="n">time_paused</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pause_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span> <span class="c">#undo temporatry accumulation during pause_timer()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="o">+=</span> <span class="n">time_paused</span> <span class="c">#time warp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="c">#allow unpause of never-started timer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_timer</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Attemped to resume unpaused timer.&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="timer.read_delegated_channel_list"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.timer.read_delegated_channel_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_delta</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;delta_timer&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;total_timer&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;frequency&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown channel type: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span>
</div></div>
<div class="viewcode-block" id="integrator"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator">[docs]</a><span class="k">class</span> <span class="nc">integrator</span><span class="p">(</span><span class="n">accumulator</span><span class="p">,</span> <span class="n">timer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual integrator instrument.</span>
<span class="sd">    Integrate channel is writable and accumulates value to internally stored total, </span>
<span class="sd">    multiplied by elapsed time since last integrate channel write.</span>
<span class="sd">    Integration channels are read only and return integration total, scaled to appropriate time units.</span>
<span class="sd">    Timer channels are read-only and return elapsed time used to compute time time differential,</span>
<span class="sd">    scaled to appropriate time units.</span>
<span class="sd">    A readable channel from a different instrument can be registered with this instrument</span>
<span class="sd">    so that any read of that channel causes its value to be integrated automatically</span>
<span class="sd">    without requiring an explicit call to this instrument&#39;s integrate method or channel. </span>
<span class="sd">    All channels operate from a common timebase.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Init sets initial accumulation total.  Defaults to 0.&#39;&#39;&#39;</span>
        <span class="n">accumulator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Integrator Virtual Instrument&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="bp">None</span>
<div class="viewcode-block" id="integrator.add_channel_integration_seconds"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integration_seconds">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integration_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports integration value with time units of seconds.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;seconds&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;integrator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integration_seconds</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.add_channel_integration_minutes"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integration_minutes">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integration_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports integration value with time units of minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;minutes&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;integrator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integration_minutes</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.add_channel_integration_hours"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integration_hours">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integration_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports integration value with time units of hours.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;integrator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integration_hours</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.add_channel_integration_days"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integration_days">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integration_days</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports integration value with time units of days.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;days&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;integrator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integration_days</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.add_channel_integration_scale"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integration_scale">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integration_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">time_div</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports integration value with user supplied time units. time_div is seconds per user-unit, eg 60 for minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">time_div</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;integrator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integration_scale</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.add_channel_integrate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.add_channel_integrate">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Writing to this channel causes written value to be added to accumulator scaled by elapsed time since last write.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_integrate</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="integrator.register_integrand_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.register_integrand_channel">[docs]</a>    <span class="k">def</span> <span class="nf">register_integrand_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Automatically calls integrate method each time channel_object is read, for example in logger.log().&#39;&#39;&#39;</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">add_read_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">channel_object</span><span class="p">,</span><span class="n">read_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">read_value</span><span class="p">))</span></div>
<div class="viewcode-block" id="integrator.integrate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Scale value by elapsed time and store to accumulator.  Should typically be used through integrate channel above.&#39;&#39;&#39;</span>
        <span class="c">#results stored internally in value*seconds.  Read channels scale to other time units on the way out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_delta</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">interval_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
                <span class="c">#interval_val = value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">interval_val</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="n">value</span> <span class="c">#first order hold to record interval average rather than endpoint</span></div>
<div class="viewcode-block" id="integrator.read_delegated_channel_list"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.integrator.read_delegated_channel_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;integrator&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accumulation</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
            <span class="c">#actually returns 0 first time</span>
            <span class="c">#elif self.elapsed is None: #first read; can&#39;t call total_seconds() method of NoneType</span>
            <span class="c">#        results_dict[channel.get_name()] = None</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;delta_timer&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c">#first read before call to integrate()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;total_timer&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c">#first read before call to integrate()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown channel type: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span>
</div></div>
<div class="viewcode-block" id="differencer"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differencer">[docs]</a><span class="k">class</span> <span class="nc">differencer</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual differencer instrument.</span>
<span class="sd">    Compute_difference channel is writable and causes computation of first difference from last written value.</span>
<span class="sd">    Read_difference channel is read-only and returns computed difference.</span>
<span class="sd">    A readable channel from a different instrument can be registered with this instrument</span>
<span class="sd">    so that any read of that channel causes its value to be differenced automatically</span>
<span class="sd">    without requiring an explicit call to this instrument&#39;s difference method.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">init</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Init sets initial value of previous value used to compute difference.  Defaults to None.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="n">init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Differencer Virtual Instrument&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
<div class="viewcode-block" id="differencer.add_channel_read_difference"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differencer.add_channel_read_difference">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_read_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read returns difference between previous two values passed to difference method.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_read_difference</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differencer.add_channel_compute_difference"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differencer.add_channel_compute_difference">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_compute_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel write computes difference between previous two values passed to difference method.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_compute_difference</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differencer.difference"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differencer.difference">[docs]</a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns difference between value and value passed in last method call.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">=</span> <span class="n">value</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span></div>
<div class="viewcode-block" id="differencer.register_difference_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differencer.register_difference_channel">[docs]</a>    <span class="k">def</span> <span class="nf">register_difference_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Automatically calls difference method each time channel_object is read, for example in logger.log().&#39;&#39;&#39;</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">add_read_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">channel_object</span><span class="p">,</span><span class="n">read_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">read_value</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="differentiator"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator">[docs]</a><span class="k">class</span> <span class="nc">differentiator</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span><span class="n">differencer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual differentiator instrument.</span>
<span class="sd">    Differentiate channel is writable and causes computation of first time derivative between value and last written value.</span>
<span class="sd">    Differentiation channels are read-only and return previously computed time derivative, scaled to appropriate time units.</span>
<span class="sd">    Timer channels are read-only and return elapsed time used to compute derivative, scaled to appropriate time units.</span>
<span class="sd">    A readable channel from a different instrument can be registered with this instrument</span>
<span class="sd">    so that any read of that channel causes its value to be differentiated automatically</span>
<span class="sd">    without requiring an explicit call to this instrument&#39;s differentiate method or channel.&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">differencer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;Differentiator Virtual Instrument&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="bp">None</span>
<div class="viewcode-block" id="differentiator.add_channel_differentiation_seconds"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiation_seconds">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiation_seconds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports derivative value with time units of seconds.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;seconds&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;differentiator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiation_seconds</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.add_channel_differentiation_minutes"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiation_minutes">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiation_minutes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports derivative value with time units of minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;minutes&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;differentiator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiation_minutes</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.add_channel_differentiation_hours"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiation_hours">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiation_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports derivative value with time units of hours.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;hours&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;differentiator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiation_hours</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.add_channel_differentiation_days"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiation_days">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiation_days</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports derivative value with time units of days.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">divs</span><span class="p">[</span><span class="s">&#39;days&#39;</span><span class="p">])</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;differentiator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiation_days</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.add_channel_differentiation_scale"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiation_scale">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiation_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">time_div</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel read reports derivative value with user supplied time units. time_div is seconds per user-unit, eg 60 for minutes.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_read</span><span class="p">(</span><span class="n">channel_name</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">time_div</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;differentiator&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiation_scale</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.differentiate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.differentiate">[docs]</a>    <span class="k">def</span> <span class="nf">differentiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Scale value by elapsed time and store to accumulator.  Should typically be used through integrate channel above.&#39;&#39;&#39;</span>
        <span class="c">#results stored internally in value*seconds.  Read channels scale to other time units on the way out.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_delta</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_paused</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diff</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span></div>
<div class="viewcode-block" id="differentiator.add_channel_differentiate"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.add_channel_differentiate">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_differentiate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel write causes time derivative between write value and previous write value to be computed and stored.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">differentiate</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_differentiate</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="differentiator.register_derivative_channel"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.register_derivative_channel">[docs]</a>    <span class="k">def</span> <span class="nf">register_derivative_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Automatically calls difference method each time channel_object is read, for example in logger.log().&#39;&#39;&#39;</span>
        <span class="n">channel_object</span><span class="o">.</span><span class="n">add_read_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">channel_object</span><span class="p">,</span><span class="n">read_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">differentiate</span><span class="p">(</span><span class="n">read_value</span><span class="p">))</span></div>
<div class="viewcode-block" id="differentiator.read_delegated_channel_list"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.differentiator.read_delegated_channel_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;differentiator&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivative</span> <span class="o">*</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;delta_timer&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;total_timer&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;time_div&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unknown channel type: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)))</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dict</span>
</div></div>
<span class="k">class</span> <span class="nc">servo</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fb_channel</span><span class="p">,</span><span class="n">output_channel</span><span class="p">,</span><span class="n">minimum</span><span class="p">,</span><span class="n">maximum</span><span class="p">,</span><span class="n">abstol</span><span class="p">,</span><span class="n">reltol</span><span class="o">=.</span><span class="mo">001</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Single channel virtual servo instrument.  Given a forcing channel object and a measurement channel object,</span>
<span class="sd">            modifies the forcing channel value until the measurement channel is within specified tolerance or</span>
<span class="sd">            the number of allowed tries is exceeded.  Max number of tries can be varied by modifying the &#39;tries&#39; property.</span>

<span class="sd">            fb_channel is the measurement channel object</span>
<span class="sd">            output_channel is the forcing channel object</span>
<span class="sd">            minimum is the lowest value that may be forced during the servo attempt</span>
<span class="sd">            maximum is the highest value that may be forced during the servo attempt</span>
<span class="sd">            abstol is the amount that the measurement may differ from the target value to consider the servo complete. units are the same as the measurement channel (window is +/-abstol)</span>
<span class="sd">            reltol is the unitless scale factor that determines when the servo loop is sufficiently settled.  (window is target*(1 +/- reltol))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;servo&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fb_channel</span> <span class="o">=</span> <span class="n">fb_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span> <span class="o">=</span> <span class="n">output_channel</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Servo Instrument forcing {} via {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fb_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">output_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gain_est</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="n">minimum</span><span class="p">,</span><span class="n">maximum</span><span class="p">,</span><span class="n">abstol</span><span class="p">,</span><span class="n">reltol</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">reconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">abstol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">abstol</span> <span class="o">=</span> <span class="n">abstol</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">reltol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reltol</span> <span class="o">=</span> <span class="n">reltol</span>
    <span class="k">def</span> <span class="nf">add_channel_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Channel write causes output_channel to servo to new target value.&#39;&#39;&#39;</span>
        <span class="n">servo_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">servo</span><span class="p">)</span>
        <span class="n">servo_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_target</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">servo_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Servo fb_channel to target by varying output_channel.</span>
<span class="sd">            If target is omitted, previous target is maintained.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Servoing {} to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;   reltol:{} abstol:{} min:{} max:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reltol</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">abstol</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">)</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cnt_break</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">readback</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">servo_check</span><span class="p">(</span><span class="n">readback</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">cnt</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">readback</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>
            <span class="n">change_by</span> <span class="o">=</span> <span class="n">error</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_est</span>
            <span class="n">new_setting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setting</span> <span class="o">+</span> <span class="n">change_by</span>
            <span class="k">if</span> <span class="n">new_setting</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span><span class="p">:</span>
                <span class="n">new_setting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span>
                <span class="k">print</span> <span class="s">&quot;      Limit Max: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">new_setting</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">:</span>
                <span class="n">new_setting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span>
                <span class="k">print</span> <span class="s">&quot;      Limit Min: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_setting</span><span class="p">)</span>
            <span class="n">new_readback</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">change</span> <span class="o">=</span> <span class="n">new_readback</span> <span class="o">-</span> <span class="n">readback</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">new_setting</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setting</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gain_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">change</span> <span class="o">/</span> <span class="p">(</span><span class="n">new_setting</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">setting</span><span class="p">))</span>
            <span class="n">readback</span> <span class="o">=</span> <span class="n">new_readback</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;   {}: TGT:{:3.5f} ERR:{:3.5f} FRC:{:3.5f} RES:{:3.5f} GAIN:{:3.5f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">new_setting</span><span class="p">,</span> <span class="n">new_readback</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_est</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setting</span> <span class="o">=</span> <span class="n">new_setting</span>
            <span class="c"># Added following code to quit if two consecutive tries are within</span>
            <span class="c"># reltol even though final target has not been achieved. This will</span>
            <span class="c"># help if available current is lower than the target</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstol</span><span class="p">:</span>
                <span class="n">cnt_break</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">cnt_break</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;{}: abstol limit reached&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
                    <span class="k">return</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">servo_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">readback</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns True if servo is within abstol or reltol tolerances.</span>
<span class="sd">            Returns False if servo failed to converge within alotted number of tries.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">readback</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">readback</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fb_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">readback</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reltol</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">readback</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">reltol</span><span class="p">)))):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">readback</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstol</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">readback</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">abstol</span><span class="p">))):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

<div class="viewcode-block" id="servo_group"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.servo_group">[docs]</a><span class="k">class</span> <span class="nc">servo_group</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This is a group of servos.</span>
<span class="sd">        It will servo each servo in that group until</span>
<span class="sd">        all are in regulation or up to servo_group.tries times&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servos</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<div class="viewcode-block" id="servo_group.add_servo"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.servo_group.add_servo">[docs]</a>    <span class="k">def</span> <span class="nf">add_servo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">servo_inst</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add a servo virtual instrument to the servo_group&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">servo_inst</span><span class="p">,</span> <span class="n">servo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">servos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">servo_inst</span><span class="p">)</span></div>
<div class="viewcode-block" id="servo_group.servo"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.servo_group.servo">[docs]</a>    <span class="k">def</span> <span class="nf">servo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;run each servo in turn until all are in regulation.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Looping all servos &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">servo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">servos</span><span class="p">:</span>
                <span class="n">servo</span><span class="o">.</span><span class="n">servo</span><span class="p">()</span>
            <span class="c">#must make it through all servos twice</span>
            <span class="n">restart</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">servo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">servos</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">servo</span><span class="o">.</span><span class="n">servo_check</span><span class="p">():</span>
                    <span class="n">restart</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;{} failed servo_check, restarting&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">servo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">restart</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;unable to servo in &quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span><span class="p">)</span> <span class="o">+</span>  <span class="s">&quot;, failed, END&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
</div></div>
<div class="viewcode-block" id="ramp_to"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ramp_to">[docs]</a><span class="k">class</span> <span class="nc">ramp_to</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Virtual instrument that changes channel setting incrementally.</span>
<span class="sd">    Useful to minimize impact of overshoot when trying to use power supply as a precision voltage source.</span>
<span class="sd">    This is a crutch. A better option would be to use an SMU if available.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;ramp_to virtual instrument&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&quot;ramp_to&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<div class="viewcode-block" id="ramp_to.add_channel_binary"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ramp_to.add_channel_binary">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">abstol</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_step</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Writes binarily decreasing magnitude steps to forcing_channel until within abstol of final voltage.</span>
<span class="sd">        If specified, max_step will bound the step upper magnitude.</span>
<span class="sd">        Use forcing_channel.set_write_delay(seconds) to control ramp rate.&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">abstol</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">max_step</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">max_step</span> <span class="o">&gt;</span> <span class="n">abstol</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">final_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_binary</span><span class="p">(</span><span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">abstol</span><span class="p">,</span> <span class="n">max_step</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;{}: binary ramping slave channel: {}. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_linear</span><span class="o">.</span><span class="n">__doc__</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">:</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">final_value</span><span class="p">))</span> <span class="c">#keep channels sync&#39;d in both directions</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="ramp_to.add_channel_linear"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ramp_to.add_channel_linear">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Writes constant steps of size step_size (linear_ramp) to forcing_channel until within abstol of final voltage.</span>
<span class="sd">        Use forcing_channel.set_write_delay(seconds) to control ramp rate.&#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">step_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">final_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_linear</span><span class="p">(</span><span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">step_size</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;{}: linear ramping slave channel: {}. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_linear</span><span class="o">.</span><span class="n">__doc__</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">:</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">final_value</span><span class="p">))</span> <span class="c">#keep channels sync&#39;d in both directions</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="ramp_to.add_channel_overshoot"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.ramp_to.add_channel_overshoot">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_overshoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">abstol</span><span class="p">,</span> <span class="n">estimated_overshoot</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Writes steps to forcing channel_such that peak overshoot magnitude never exceeds written value by more than abstol.</span>
<span class="sd">        estimated_overshoot is specified as a fraction of setting change (peak = final_value + (final_value - previous_value)*estimated_overshoot).</span>
<span class="sd">        For example, to model 10% overshoot (5V to 6V transition hits peak 6.1V), set estimated_overshoot=0.1.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">abstol</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">estimated_overshoot</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="n">estimated_overshoot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">estimated_overshoot</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">final_value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramp_overshoot</span><span class="p">(</span><span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">abstol</span><span class="p">,</span> <span class="n">estimated_overshoot</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s">&#39;{}: overshoot controlling slave channel: {}. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_overshoot</span><span class="o">.</span><span class="n">__doc__</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">:</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">final_value</span><span class="p">))</span> <span class="c">#keep channels sync&#39;d in both directions</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">delta</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="c">#no direction if we&#39;re already there</span>
            <span class="k">return</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">_ramp_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">abstol</span><span class="p">,</span> <span class="n">max_step</span><span class="p">):</span>
        <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">present_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;You must write a value to underlying channel {} before using {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">final_value</span> <span class="o">-</span> <span class="n">present_value</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">abstol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">max_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_step</span><span class="p">:</span>
                <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">present_value</span> <span class="o">+</span>  <span class="nb">float</span><span class="p">(</span><span class="n">max_step</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Slewing channel: {} to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">present_value</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Binary ramping channel: {} to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">final_value</span> <span class="o">-</span> <span class="n">present_value</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_ramp_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">step_size</span><span class="p">):</span>
        <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">present_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error: must write a value to underlying channel {} before using {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">final_value</span> <span class="o">-</span> <span class="n">present_value</span>
        <span class="k">while</span> <span class="nb">abs</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">step_size</span><span class="p">:</span>
            <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">present_value</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
            <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">final_value</span> <span class="o">-</span> <span class="n">present_value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Linear ramping channel: {} to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_ramp_overshoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">final_value</span><span class="p">,</span> <span class="n">abstol</span><span class="p">,</span> <span class="n">estimated_overshoot</span><span class="p">):</span>
        <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">present_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Error: must write a value to underlying channel {} before using {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">final_value</span> <span class="o">-</span> <span class="n">present_value</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_direction</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span>
        <span class="c">#calculate next output such that output+overshoot &lt;= final_value +/- abstol</span>
        <span class="c">#x + (x-pv)*estimated_overshoot = final_value + sign*abstol</span>
        <span class="nb">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_value</span> <span class="o">+</span> <span class="n">direction</span><span class="o">*</span><span class="n">abstol</span> <span class="o">+</span> <span class="n">present_value</span><span class="o">*</span><span class="n">estimated_overshoot</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">estimated_overshoot</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">next</span> <span class="o">&lt;</span> <span class="n">final_value</span> <span class="ow">or</span> <span class="n">direction</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">next</span> <span class="o">&gt;</span> <span class="n">final_value</span><span class="p">:</span>
            <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="n">peak</span> <span class="o">=</span> <span class="nb">next</span> <span class="o">+</span> <span class="p">(</span><span class="nb">next</span><span class="o">-</span><span class="n">present_value</span><span class="p">)</span><span class="o">*</span><span class="n">estimated_overshoot</span>
                <span class="k">print</span> <span class="s">&quot;Controlled overshoot stepping channel: {} to: {} with estimated overshoot to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">peak</span><span class="p">)</span>
            <span class="n">present_value</span> <span class="o">=</span> <span class="n">forcing_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="nb">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">final_value</span> <span class="o">+</span> <span class="n">direction</span><span class="o">*</span><span class="n">abstol</span> <span class="o">+</span> <span class="n">present_value</span><span class="o">*</span><span class="n">estimated_overshoot</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">estimated_overshoot</span><span class="p">)</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="threshold_finder"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder">[docs]</a><span class="k">class</span> <span class="nc">threshold_finder</span><span class="p">(</span><span class="n">instrument</span><span class="p">,</span><span class="n">delegator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;virtual instrument</span>
<span class="sd">        Does not automatically find threshold unless auto_find is enabled from add_channel. Otherwise, you must call threshold_finder.find(), or .find_linear()</span>

<span class="sd">        The channels used with this instrument may want to be virtual instruments. For example the comparator_input_channel_force</span>
<span class="sd">        could be used to clear a latched output before a new value is set, or the comparator_output_sense_channel could interpret complex</span>
<span class="sd">        comparator outputs that are not direct measurements.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">comparator_input_force_channel</span><span class="p">,</span>
                      <span class="n">comparator_output_sense_channel</span><span class="p">,</span>
                      <span class="n">minimum</span><span class="p">,</span>
                      <span class="n">maximum</span><span class="p">,</span>
                      <span class="n">abstol</span><span class="p">,</span>
                      <span class="n">comparator_input_sense_channel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">forcing_overshoot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">output_threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        comparator_input_force_channel - DUT comparator input forcing channel object.</span>
<span class="sd">        comparator_output_sense_channel - DUT comparator output measurement channel object.</span>
<span class="sd">        minimum - minimum forced input to the DUT comparator via comparator_input_force_channel.</span>
<span class="sd">        maximum - maximum forced input to the DUT comparator via comparator_input_force_channel.</span>
<span class="sd">        abstol - resolution of search. Relative to comparator_input_channel_force, not comparator_input_sense_channel.</span>
<span class="sd">        comparator_input_sense_channel - optionally specify a channel object to read back actual (Kelvin) input to DUT from comparator_input_force_channel.</span>
<span class="sd">        forcing_overshoot - optionally specify an expected overshoot of forcing channel as a fraction of setting change. Steps toward threshold will be magnitude-controlled to keep peak value within abstol of target. Over-estimation will slow down search and Under-estimation may corrupt search results.</span>
<span class="sd">        output_threshold - optional digitization level threshold for comparator_output_sense_channel. If unspecified, will be calculated from mean of comparator_output_sense_channel reading with comparator_input_channel_force set to minimum and maximum.</span>
<span class="sd">        verbose - print extra information about search progress.</span>
<span class="sd">        cautious - take extra measurements to make sure search is proceeding correctly and has not been corrupted by overshoot, oscillation, etc.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;threshold_finder_{}_{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comparator_input_force_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">comparator_output_sense_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Threshold_finder virtual instrument forcing:{} reading:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">comparator_input_force_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">comparator_output_sense_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="p">))</span>
        <span class="n">delegator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconfigure</span><span class="p">(</span><span class="n">comparator_input_force_channel</span><span class="p">,</span>
                         <span class="n">comparator_output_sense_channel</span><span class="p">,</span>
                         <span class="n">comparator_input_sense_channel</span><span class="p">,</span>
                         <span class="n">output_threshold</span><span class="p">,</span>
                         <span class="n">minimum</span><span class="p">,</span>
                         <span class="n">maximum</span><span class="p">,</span>
                         <span class="n">abstol</span><span class="p">,</span>
                         <span class="n">forcing_overshoot</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c">#default output before first find()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forced_rising</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forced_falling</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span> <span class="o">=</span> <span class="bp">None</span>
<div class="viewcode-block" id="threshold_finder.reconfigure"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.reconfigure">[docs]</a>    <span class="k">def</span> <span class="nf">reconfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparator_input_force_channel</span><span class="p">,</span>
                          <span class="n">comparator_output_sense_channel</span><span class="p">,</span>
                          <span class="n">comparator_input_sense_channel</span><span class="p">,</span>
                          <span class="n">output_threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">minimum</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">maximum</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">abstol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">forcing_overshoot</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reconfigure channel settings to use a single threshold finder instrument with multiplexed DUT channels.</span>
<span class="sd">        Required arguments:</span>
<span class="sd">        comparator_input_force_channel - DUT comparator input forcing channel object.</span>
<span class="sd">        comparator_output_sense_channel - DUT comparator output measurement channel object.</span>
<span class="sd">        comparator_input_sense_channel - optionally specify a channel object to read back actual (Kelvin) input to DUT from comparator_input_force_channel. Set to None to disable.</span>

<span class="sd">        Optional argument (set to automatic if unspecified):</span>
<span class="sd">        output_threshold - optional digitization level threshold for comparator_output_sense_channel. If unspecified, will be calculated from mean of comparator_output_sense_channel reading with comparator_input_channel_force set to minimum and maximum.</span>

<span class="sd">        Optional arguments (unchanged if unspecified):</span>
<span class="sd">        minimum - minimum forced input to the DUT comparator via comparator_input_force_channel.</span>
<span class="sd">        maximum - maximum forced input to the DUT comparator via comparator_input_force_channel.</span>
<span class="sd">        abstol - resolution of search. Relative to comparator_input_channel_force, not comparator_input_sense_channel.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_channel</span> <span class="o">=</span> <span class="n">comparator_input_force_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_output_sense_channel</span> <span class="o">=</span> <span class="n">comparator_output_sense_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="o">=</span> <span class="n">comparator_input_sense_channel</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold</span> <span class="o">=</span> <span class="n">output_threshold</span>

        <span class="k">if</span> <span class="n">minimum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">minimum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maximum</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">maximum</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">abstol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">abstol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">forcing_overshoot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forcing_overshoot</span> <span class="o">=</span> <span class="n">forcing_overshoot</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;abstol must be finite and positive&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;minimum must be less than maximum&#39;</span><span class="p">)</span>
            
            
        <span class="bp">self</span><span class="o">.</span><span class="n">_ramper</span> <span class="o">=</span> <span class="n">ramp_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing_overshoot</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_ramper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ramper</span><span class="o">.</span><span class="n">add_channel_overshoot</span><span class="p">(</span><span class="s">&#39;input_ramper&#39;</span><span class="p">,</span>
                                                                               <span class="n">forcing_channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_channel</span><span class="p">,</span>
                                                                               <span class="n">abstol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span>
                                                                               <span class="n">estimated_overshoot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing_overshoot</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_ramper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_channel</span>
</div>
<div class="viewcode-block" id="threshold_finder.add_channel_all"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_all">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">auto_find</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;shortcut method adds the following channels:</span>
<span class="sd">        threshold (Average of rising and falling thresolds. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        rising threshold (Average of measurments at low and high endpoints of rising threshold uncertainty window. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        falling threshold (Average of measurments at low and high endpoints of falling threshold uncertainty window. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        tries (Number of binary search steps required to reduce uncertainty window to within abstol, or number of abstol-sized steps required to find threshold with linear search.)</span>
<span class="sd">        hysteresis (Difference between rising and falling thresholds. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        abstol (Maximum two-sided uncertainty range (window width) for binary search, or step size for linear search. Relative to comparator_input_force_channel.)</span>
<span class="sd">        rising uncertainty (Achieved one-sided additive rising threshold uncertainty range for binary or linear search. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        falling uncertainty (Achieved one-sided additive falling threshold uncertainty range for binary or linear search. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        rising relative uncertainty (Achieved one-sided multiplicative rising threshold uncertainty range for binary or linear search. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        falling relative uncertainty (Achieved one-sided multiplicative falling threshold uncertainty range for binary or linear search. Relative to comparator_input_sense_channel.)</span>
<span class="sd">        forced rising threshold (Average of low and high forced endpoints of rising threshold uncertainty window. Relative to comparator_input_force_channel.)</span>
<span class="sd">        forced falling threshold (Average of low and high forced endpoints of falling threshold uncertainty window. Relative to comparator_input_force_channel.)</span>
<span class="sd">        output_threshold (Calculated or specified digitization threshold for comparator_output_sense_channel.)</span>
<span class="sd">        </span>
<span class="sd">        if auto_find is &#39;linear&#39;, automatically call find_linear() when channel is read.</span>
<span class="sd">        if auto_find is &#39;geometric&#39;, automatically call find_geometric() when channel is read.</span>
<span class="sd">        if auto_find is any other true value, automatically call find() when channel is read.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_threshold</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">auto_find</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_rising</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_rising&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_falling</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_falling&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_tries</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_tries&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_hysteresis</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_hysteresis&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_abstol</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_abstol&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_uncertainty</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_uncertainty&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_relative_uncertainty</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_relative_uncertainty&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_forced_rising</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_forced_rising&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_forced_falling</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_forced_falling&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_output_threshold</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_output_threshold&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_algorithm</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_search_algorithm&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">th</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_threshold"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">,</span><span class="n">auto_find</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average of rising and falling thresholds found by last call to find() method.</span>
<span class="sd">        Relative to comparator_input_sense_channel.</span>
<span class="sd">        if auto_find is &#39;linear&#39;, automatically call find_linear() when channel is read.</span>
<span class="sd">        if auto_find is &#39;geometric&#39;, automatically call find_geometric() when channel is read.</span>
<span class="sd">        if auto_find is any other true value, automatically call find() when channel is read.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span> <span class="o">=</span> <span class="n">auto_find</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_threshold</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_rising"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_rising">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_rising</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average of measurments at low and high endpoints of rising threshold uncertainty window. Relative to comparator_input_sense_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_rising</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_falling"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_falling">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_falling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average of measurments at low and high endpoints of falling threshold uncertainty window. Relative to comparator_input_sense_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_falling</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_tries"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_tries">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_tries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Number of binary search steps required to reduce uncertainty window to within abstol, or number of abstol-sized steps required to find threshold with linear search.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_tries</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_channel</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_hysteresis"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_hysteresis">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_hysteresis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Difference between rising and falling thresholds. Relative to comparator_input_sense_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_hysteresis</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_abstol"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_abstol">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_abstol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Maximum two-sided uncertainty range (window width) for binary search, or step size for linear search. Relative to comparator_input_force_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_abstol</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_uncertainty"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_uncertainty">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Single sided measured threshold uncertainty at termination of search.</span>
<span class="sd">        i.e (threshold_rising - uncertainty_rising) &lt; {true rising threshold} &lt; (threshold_rising + uncertainty_rising) and</span>
<span class="sd">            (threshold_falling - uncertainty_falling) &lt; {true falling threshold} &lt; (threshold_falling + uncertainty_falling).</span>

<span class="sd">        For binary search with comparator_input_sense_channel=None, will be between 0.5*abstol and 0.25*abstol.</span>
<span class="sd">        For linear sweep with comparator_input_sense_channel=None, will be 0.5*abstol.</span>

<span class="sd">        With comparator_input_sense_channel defined, uncertainty will be relative to measured rather than forced inputs and may be scaled differently than forcing (abstol) units.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">rising_threshold_uncertainty_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_rising&quot;</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span><span class="p">)</span>
        <span class="n">rising_threshold_uncertainty_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_uncertainty</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">rising_threshold_uncertainty_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">rising_threshold_uncertainty_channel</span><span class="p">)</span>
        <span class="n">falling_threshold_uncertainty_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_falling&quot;</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span><span class="p">)</span>
        <span class="n">falling_threshold_uncertainty_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_uncertainty</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">falling_threshold_uncertainty_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">falling_threshold_uncertainty_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rising_threshold_uncertainty_channel</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_relative_uncertainty"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_relative_uncertainty">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_relative_uncertainty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Single sided relative meatured threshold uncertainty at termination of search.</span>
<span class="sd">        i.e threshold_rising * (1 - relative_uncertainty_rising) &lt; {true rising threshold} &lt; threshold_rising * (1 + relative_uncertainty_rising) and</span>
<span class="sd">            threshold_falling * (1 - relative_uncertainty_falling) &lt; {true falling threshold} &lt; threshold_falling * (1 + relative_uncertainty_falling)</span>

<span class="sd">        With comparator_input_sense_channel defined, uncertainty will be relative to measured rather than forced inputs and may be scaled differently than forcing (abstol) units.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">rising_threshold_relative_uncertainty_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_rising&quot;</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span><span class="p">)</span>
        <span class="n">rising_threshold_relative_uncertainty_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_relative_uncertainty</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">rising_threshold_relative_uncertainty_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">rising_threshold_relative_uncertainty_channel</span><span class="p">)</span>
        <span class="n">falling_threshold_relative_uncertainty_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="o">+</span><span class="s">&quot;_falling&quot;</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span><span class="p">)</span>
        <span class="n">falling_threshold_relative_uncertainty_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_relative_uncertainty</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">falling_threshold_relative_uncertainty_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">falling_threshold_relative_uncertainty_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rising_threshold_relative_uncertainty_channel</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_forced_rising"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_forced_rising">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_forced_rising</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average of low and high forced endpoints of rising threshold uncertainty window. Relative to comparator_input_force_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_rising</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_forced_rising</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_forced_falling"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_forced_falling">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_forced_falling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average of low and high forced endpoints of falling threshold uncertainty window. Relative to comparator_input_force_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_falling</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_forced_falling</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_output_threshold"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_output_threshold">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_output_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Digitization threshold for comparator_output_sense_channel.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_output_threshold</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
<div class="viewcode-block" id="threshold_finder.add_channel_algorithm"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.add_channel_algorithm">[docs]</a>    <span class="k">def</span> <span class="nf">add_channel_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Search method used to determine threshold.&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">read_function</span><span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_algorithm</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_delegator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">,</span> <span class="n">controlled</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;set forced input to DUT comparator&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">controlled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_ramper</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_read_comparator_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;measure analog output of DUT comparator&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_output_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_read_input_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_set</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;measure sensed input to dut comparator.</span>
<span class="sd">        Data is stored internally for future use.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">sensed_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="n">input_set</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensed_input</span>
            <span class="k">return</span> <span class="n">sensed_input</span>
    <span class="k">def</span> <span class="nf">_digitize_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Convert analog output to boolean by polarity-aware comparison with threshold.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span>
    <span class="k">def</span> <span class="nf">_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_force</span><span class="p">,</span> <span class="n">measure_input</span><span class="p">,</span> <span class="n">controlled</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Private procedure to test each point during sweep.</span>
<span class="sd">        1) write new value to comparator_input_force_channel</span>
<span class="sd">        2) read comparator_output_sense_channel and digitize</span>
<span class="sd">        3) optionally read comparator_input_sense_channel and store for future reference</span>
<span class="sd">        4) return results dict</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">input_force</span><span class="p">,</span> <span class="n">controlled</span><span class="p">)</span>
        <span class="n">output_analog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_comparator_output</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">output_digital</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_digitize_output</span><span class="p">(</span><span class="n">output_analog</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c">#can&#39;t digitize output before threshold and polarity have been determined</span>
            <span class="n">output_digital</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">measure_input</span><span class="p">:</span>
            <span class="n">sensed_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_input_sense</span><span class="p">(</span><span class="n">input_force</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sensed_input</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_results</span><span class="p">[</span><span class="n">input_force</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;forced_input&#39;</span><span class="p">:</span> <span class="n">input_force</span><span class="p">,</span>
                                                   <span class="s">&#39;output_analog&#39;</span><span class="p">:</span> <span class="n">output_analog</span><span class="p">,</span>
                                                   <span class="s">&#39;output_digital&#39;</span><span class="p">:</span> <span class="n">output_digital</span><span class="p">,</span>
                                                   <span class="s">&#39;sensed_input&#39;</span><span class="p">:</span> <span class="n">sensed_input</span>
                                                  <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_results</span><span class="p">[</span><span class="n">input_force</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_check_polarity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#fill the variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span> <span class="o">=</span> <span class="p">{}</span> <span class="c">#TODO: consider merging with _intermediate_results?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_results</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Check polarity and output digitizer threshold.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">))</span>

        <span class="c">#get the polarity</span>
        
        <span class="n">low_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Measured low output: {} at input: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">low_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">))</span>
        
        <span class="n">high_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Measured high output: {} at input: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">high_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">high_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">low_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;{}: Comparator output unchanged at max and min input forcing levels!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">low_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">high_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">low_test</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Threshold: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Polarity: {}1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;+&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="s">&quot;-&quot;</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">_compute_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Shared math for binary and linear search outputs</span>
<span class="sd">        Takes instance variables self.falling_min, self.falling_max, self.rising_min, self.rising_max as input.</span>
<span class="sd">        Stores output instance variables self.forced_rising, self.forced_falling, self.rising, self.falling, self.hysteresis, self.threshold, self.rising_uncertainty, self.falling_uncertainty, self.rising_relative_uncertainty, self.falling_relative_uncertainty.</span>
<span class="sd">        Passes through self.tries, self._abstol.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forced_rising</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forced_falling</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#replace comparator_input_channel_force values with comparator_input_sense_channel values.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_reads</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)</span> <span class="k">as</span> <span class="n">excp</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Something is wrong with the threshold finder instrument.&quot;</span>
                <span class="k">print</span> <span class="n">excp</span>
                <span class="kn">import</span> <span class="nn">pdb</span>
                <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_rising</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forced_falling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">begin_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span>
                <span class="p">(</span><span class="s">&quot;threshold&quot;</span><span class="p">,</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;rising&quot;</span><span class="p">,</span>                       <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;falling&quot;</span><span class="p">,</span>                      <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;hysteresis&quot;</span><span class="p">,</span>                   <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;forced_rising&quot;</span><span class="p">,</span>                <span class="bp">self</span><span class="o">.</span><span class="n">forced_rising</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;forced_falling&quot;</span><span class="p">,</span>               <span class="bp">self</span><span class="o">.</span><span class="n">forced_falling</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;rising_uncertainty&quot;</span><span class="p">,</span>           <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;falling_uncertainty&quot;</span><span class="p">,</span>          <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;rising_relative_uncertainty&quot;</span><span class="p">,</span>  <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;falling_relative_uncertainty&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;polarity&quot;</span><span class="p">,</span>                     <span class="bp">self</span><span class="o">.</span><span class="n">pol</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;tries&quot;</span><span class="p">,</span>                        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;abstol&quot;</span><span class="p">,</span>                       <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;elapsed_time&quot;</span><span class="p">,</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;output_threshold&quot;</span><span class="p">,</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_output_threshold_calc</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&quot;search_algorithm&quot;</span><span class="p">,</span>             <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span><span class="p">)</span>
                <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Search results:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">{}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span>
<div class="viewcode-block" id="threshold_finder.measure_input"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.measure_input">[docs]</a>    <span class="k">def</span> <span class="nf">measure_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_sense_channel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Measure input sense (Kelvin) channel manually after completion of search algorithm.</span>
<span class="sd">        This may be somewhat less accurate than measuring sense channel during search.</span>
<span class="sd">        It exposes possibly non-ideal hysteresis or gain/offset drift of the forcing instrument by uncorrelating measurements in time.</span>
<span class="sd">        </span>
<span class="sd">        Typically used with comparator_input_sense_channel=None to speed up search at each point.</span>
<span class="sd">        Updates and returns internal results dictionary.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Post-measuring input sense....&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;ERROR: Must complete a threshold search before calling this method.&#39;</span><span class="p">)</span>
        <span class="n">begin_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">rising_min_sense</span> <span class="o">=</span> <span class="n">input_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">rising_max_sense</span> <span class="o">=</span> <span class="n">input_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="p">(</span><span class="n">rising_min_sense</span> <span class="o">+</span> <span class="n">rising_max_sense</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">falling_max_sense</span> <span class="o">=</span> <span class="n">input_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">falling_min_sense</span> <span class="o">=</span> <span class="n">input_sense_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">=</span> <span class="p">(</span><span class="n">falling_min_sense</span> <span class="o">+</span> <span class="n">falling_max_sense</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">begin_time</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rising_max_sense</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="n">rising_min_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">falling_max_sense</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">-</span> <span class="n">falling_min_sense</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rising_max_sense</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rising_min_sense</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">falling_max_sense</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">falling_min_sense</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;rising&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;falling&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;hysteresis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hysteresis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;elapsed_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;rising_uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;falling_uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;rising_relative_uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_relative_uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="p">[</span><span class="s">&quot;falling_relative_uncertainty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_relative_uncertainty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Updated results with input sense:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">{}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dictionary</span></div>
    <span class="k">def</span> <span class="nf">debug_print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">msg</span>
<div class="viewcode-block" id="threshold_finder.find"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cautious</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Hysteresis-aware double binary search.</span>
<span class="sd">        Returns dictionary of results.</span>
<span class="sd">        if cautious, perform extra measurment at each step to ensure hsyteresis flips and search region has not been corrupted.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_polarity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="c">#Binary searching a given interval to within a given abstol always takes the same number of steps.</span>
        <span class="n">abstol_divisions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">abstol_divisions</span><span class="p">,</span><span class="mi">2</span><span class="p">))),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Binary searching with {} iterations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-----------------&quot;</span><span class="p">)</span>
            <span class="c">#work on falling threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Falling Min: {} Max: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">))</span>
            <span class="c">#cross high threshold to look for low</span>
            <span class="n">reset</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cautious</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Failed to change comparator output high at: {}. Check comparator_input_channel overshoot and adjust forcing_overshoot.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reset</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">cautious</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Try {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Analog: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Digital: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------&quot;</span><span class="p">)</span>
            <span class="c">#work on rising threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Rising Min: {} Max: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">))</span>
            <span class="c">#cross low threshold to look for high</span>
            <span class="n">reset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cautious</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Failed to change comparator output low at: {}. Check comparator_input_channel overshoot and adjust forcing_overshoot.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reset</span><span class="p">))</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">cautious</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Try: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Analog: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Digital: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-----------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="s">&quot;binary search&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_outputs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
<div class="viewcode-block" id="threshold_finder.find_no_hysteresis"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.find_no_hysteresis">[docs]</a>    <span class="k">def</span> <span class="nf">find_no_hysteresis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Hysteresis-unaware single binary search.</span>
<span class="sd">        Returns dictionary of results.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_polarity</span><span class="p">()</span>
        <span class="n">th_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="n">th_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        
        <span class="c">#Binary searching a given interval to within a given abstol always takes the same number of steps.</span>
        <span class="n">abstol_divisions</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">abstol_divisions</span><span class="p">,</span><span class="mi">2</span><span class="p">))),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Binary searching with {} iterations, ignoring hysteresis.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_tries</span>
        <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-----------------&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Min: {} Max: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">th_min</span><span class="p">,</span><span class="n">th_max</span><span class="p">))</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">th_max</span> <span class="o">+</span> <span class="n">th_min</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Try {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_value</span><span class="p">))</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Analog: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Digital: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                <span class="n">th_max</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">th_min</span> <span class="o">=</span> <span class="n">new_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-----------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="s">&quot;binary search without hysteresis&quot;</span>
        <span class="c">#fill the input variables to _compute_outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="n">th_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="n">th_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="n">th_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="n">th_max</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_outputs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
<div class="viewcode-block" id="threshold_finder.find_linear"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.find_linear">[docs]</a>    <span class="k">def</span> <span class="nf">find_linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Hysteresis aware linear sweep. Returns dictionary of results&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_polarity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Searching for rising threshold&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">)</span> <span class="c"># find rising threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-------------------------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Searching for falling threshold&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">)</span> <span class="c"># find falling threshold starting just after rising hysteresis flip.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="s">&quot;linear search&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_outputs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
<div class="viewcode-block" id="threshold_finder.find_geometric"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.find_geometric">[docs]</a>    <span class="k">def</span> <span class="nf">find_geometric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decades</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Perform repeated linear searches for rising and falling thresholds with 10x increase in resolution each iteration.</span>
<span class="sd">        Final resolution is abstol</span>
<span class="sd">        Optionally specify decades argment to control how many searches are performed. Defaults to as many as possible for given min/max range and abstol.</span>
<span class="sd">        No steps are ever made toward the thresold with magnitude largee than current search&#39;s resolution in case of overshoot.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_polarity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
    
        <span class="n">max_decades</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span><span class="mi">10</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">decades</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">decades</span> <span class="o">=</span> <span class="n">max_decades</span>
        <span class="k">assert</span> <span class="n">decades</span> <span class="o">&gt;=</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">decades</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">decades</span> <span class="o">&lt;=</span> <span class="n">max_decades</span>
        <span class="n">cisc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">decades</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">step_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">e</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="o">=</span> <span class="n">cisc</span> <span class="c">#only read back input on last sweep</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Ramping to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#small steps toward threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Searching for rising threshold with step size: {} between: {} and: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span><span class="p">,</span> <span class="n">step_size</span><span class="p">)</span> <span class="c"># find rising threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-------------------------------&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Ramping to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#small steps toward threshold</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Searching for falling threshold with step size: {} between: {} and: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">step_size</span><span class="p">)</span> <span class="c"># find falling threshold starting just after rising hysteresis flip.</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c">#account for possible forcing instrument overshoot in travel direction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">+</span> <span class="n">step_size</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">-</span> <span class="n">step_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="s">&quot;geometric linear search&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_outputs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
<div class="viewcode-block" id="threshold_finder.find_hybrid"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.find_hybrid">[docs]</a>    <span class="k">def</span> <span class="nf">find_hybrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linear_backtrack</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Perform course binary search, then approach rising and falling thresholds from correct direction with linear search.</span>
<span class="sd">        Both binary and linear searches will be performed to abstol forcing tolerance.</span>
<span class="sd">        The linear search will be started linear_backtrack distance away from expected threshold, with default of 5 * reltol.</span>
<span class="sd">        Each of the two linear sweeps will take approximatley (linear_backtrack / reltol) steps toward threshold.</span>
<span class="sd">        Steps toward threshold are of max magnitude max_step.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">linear_backtrack</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">linear_backtrack</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span>
        <span class="k">assert</span> <span class="n">linear_backtrack</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span>
        <span class="k">assert</span> <span class="n">linear_backtrack</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c">#First run quick binary search to get rough answers</span>
        <span class="c">#Don&#39;t need to read back inputs for this phase.</span>
        <span class="n">cisc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">binary_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">cautious</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_comparator_input_sense_channel</span> <span class="o">=</span> <span class="n">cisc</span>

        <span class="n">min_rising</span> <span class="o">=</span> <span class="n">binary_res</span><span class="p">[</span><span class="s">&#39;forced_rising&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">linear_backtrack</span>
        <span class="n">max_rising</span> <span class="o">=</span> <span class="n">binary_res</span><span class="p">[</span><span class="s">&#39;forced_rising&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">linear_backtrack</span>
        <span class="n">min_falling</span> <span class="o">=</span> <span class="n">binary_res</span><span class="p">[</span><span class="s">&#39;forced_falling&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">linear_backtrack</span>
        <span class="n">max_falling</span> <span class="o">=</span> <span class="n">binary_res</span><span class="p">[</span><span class="s">&#39;forced_falling&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">linear_backtrack</span>
        <span class="k">if</span> <span class="n">min_rising</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="ow">or</span> <span class="n">max_rising</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span> <span class="ow">or</span> <span class="n">min_falling</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span> <span class="ow">or</span> <span class="n">max_falling</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Hybrid sweep abstol: {} and linear_backtrack: {} too large for input range: {} to: {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span> <span class="n">linear_backtrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">))</span>
        
        <span class="c">#Then run one-sided linear search for rising threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="c">#set hysteresis up for rising threshold</span>
        <span class="n">reset</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">min_falling</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minimum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Setting hysteresis state low and ramping from: {} to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">min_rising</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c">#start below falling threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">min_rising</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#small steps back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Linear searching for rising threshold between: {} and: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">min_rising</span><span class="p">,</span> <span class="n">max_rising</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="n">min_rising</span><span class="p">,</span> <span class="n">max_rising</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">)</span> <span class="c">#then start looking</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Hybrid threshold finder failed to reset hysteresis before rising threshold linear sweep. Try increasing linear_backtrack.&#39;</span><span class="p">)</span>

        <span class="c">#Then run one-sided linear search for falling threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;------------------------------&quot;</span><span class="p">)</span>
        <span class="c">#set hysteresis up for falling threshold</span>
        <span class="n">reset</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_rising</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maximum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Setting hysteresis state high and ramping from: {} to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">max_falling</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="c">#start above rising threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_comparator_input</span><span class="p">(</span><span class="n">max_falling</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c">#take small steps back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Linear searching for falling threshold between: {} and: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_falling</span><span class="p">,</span> <span class="n">min_falling</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_linear_threshold</span><span class="p">(</span><span class="n">min_falling</span><span class="p">,</span> <span class="n">max_falling</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abstol</span><span class="p">)</span> <span class="c">#then start looking</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Hybrid threshold finder failed to reset hysteresis before falling threshold linear sweep. Try increasing linear_backtrack.&#39;</span><span class="p">)</span>

        <span class="c">#Lastly, compute outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_algorithm</span> <span class="o">=</span> <span class="s">&quot;binary tuned linear search&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_outputs</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span></div>
    <span class="k">def</span> <span class="nf">_find_linear_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;One sided Linear sweep which sweeps up if step is positive or down if step is negative and finds the threshold</span>
<span class="sd">            Pol is the polarity of the comparator output&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcing_overshoot</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c">#eventually all linear searches use step size abstol, so might as well detect problems here right away.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Can&#39;t make linear steps of magnitude abstol with over 100% peak overshoot,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">try_threshold</span> <span class="o">=</span> <span class="nb">min</span>
            <span class="n">test</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">try_threshold</span> <span class="o">=</span> <span class="nb">max</span>
            <span class="n">test</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">test_result</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;output_digital&#39;</span><span class="p">:</span> <span class="n">test</span><span class="p">}</span>
        <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test</span><span class="p">:</span>
            <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;-----------------&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Try {}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tries</span><span class="o">+</span><span class="n">tries</span><span class="p">,</span> <span class="n">try_threshold</span><span class="p">))</span>
            <span class="n">test_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test</span><span class="p">(</span><span class="n">try_threshold</span><span class="p">,</span> <span class="n">measure_input</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">controlled</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Analog: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_analog&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_print</span><span class="p">(</span><span class="s">&quot;Output Digital: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rising_max</span> <span class="o">=</span> <span class="n">try_threshold</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rising_min</span> <span class="o">=</span> <span class="n">try_threshold</span>
                <span class="k">if</span> <span class="n">try_threshold</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">try_threshold</span> <span class="o">+</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="nb">max</span><span class="p">:</span>
                    <span class="n">try_threshold</span> <span class="o">=</span> <span class="nb">max</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">try_threshold</span> <span class="o">+=</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">falling_min</span> <span class="o">=</span> <span class="n">try_threshold</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">falling_max</span> <span class="o">=</span> <span class="n">try_threshold</span>
                <span class="k">if</span> <span class="n">try_threshold</span> <span class="o">==</span> <span class="nb">min</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">try_threshold</span> <span class="o">+</span> <span class="n">step</span> <span class="o">&lt;=</span> <span class="nb">min</span><span class="p">:</span>
                    <span class="n">try_threshold</span> <span class="o">=</span> <span class="nb">min</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">try_threshold</span> <span class="o">+=</span> <span class="n">step</span>
        <span class="k">if</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Linear sweep too few steps. Step: {} too large for input range: {} or threshold: {} not enclosed by interval {}:{}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span><span class="p">,</span> <span class="n">try_threshold</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">test_result</span><span class="p">[</span><span class="s">&#39;output_digital&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Linear search failed to find transition between: {} and: {}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">+=</span> <span class="n">tries</span>
    <span class="k">def</span> <span class="nf">test_repeatability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linear_backtrack</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">decades</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">binary_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">cautious</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">hybrid_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_hybrid</span><span class="p">(</span><span class="n">linear_backtrack</span><span class="o">=</span><span class="n">linear_backtrack</span><span class="p">)</span>
        <span class="n">linear_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_linear</span><span class="p">()</span>
        <span class="n">geometric_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_geometric</span><span class="p">(</span><span class="n">decades</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="nb">str</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="n">max_key_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">binary_results</span><span class="p">:</span> <span class="c">#same keys in all 3 results</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s">&quot;search_algorithm&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_key_len</span><span class="p">:</span>
                <span class="n">max_key_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="nb">str</span> <span class="o">+=</span> <span class="s">&quot;{}:</span><span class="se">\t</span><span class="s">binary:{:1.6G}  linear:{:1.6G}  hybrid:{:1.6G}  geometric:{:1.6G}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                                                                  <span class="n">binary_results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                                  <span class="n">linear_results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                                  <span class="n">hybrid_results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                                                                  <span class="n">geometric_results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                                                                                  <span class="c">#max(binary_results[key], linear_results[key], hybrid_results[key], geometric_results[key]) - min(binary_results[key], linear_results[key], hybrid_results[key], geometric_results[key])</span>
                                                                                  <span class="p">)</span>
        <span class="k">print</span> <span class="nb">str</span><span class="o">.</span><span class="n">expandtabs</span><span class="p">(</span><span class="n">max_key_len</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;binary&#39;</span><span class="p">:</span> <span class="n">binary_results</span><span class="p">,</span>
                <span class="s">&#39;linear&#39;</span><span class="p">:</span> <span class="n">linear_results</span><span class="p">,</span>
                <span class="s">&#39;hybrid&#39;</span><span class="p">:</span> <span class="n">hybrid_results</span>
               <span class="p">}</span>
<div class="viewcode-block" id="threshold_finder.read_delegated_channel_list"><a class="viewcode-back" href="../../_autosummary/PyICe.lab_instruments.html#PyICe.lab_instruments.threshold_finder.read_delegated_channel_list">[docs]</a>    <span class="k">def</span> <span class="nf">read_delegated_channel_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">channels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;private&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;linear&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_linear</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_find</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;geometric&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_geometric</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">results_dict</span><span class="p">[</span><span class="n">channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">read_without_delegator</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results_dict</span>
</div></div>
<span class="k">class</span> <span class="nc">calibrator</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calibrator virtual instrument. Corrects channel&#39;s read/write values based on either two-point gain/offset correction or full lookup table.</span>
<span class="sd">        Requires numpy for least squares computation during calibration measurement. Can be used without numpy if gain/offset numbers are supplied from elsewhere.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;calibrator&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;calibrator virtual instrument&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">readback_channel</span><span class="p">,</span> <span class="n">forcing_values</span><span class="p">,</span> <span class="n">results_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;produce calibration table and gain/offset calculation for later use by 2point and spline calibrators&#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">numpy</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">force_v</span> <span class="ow">in</span> <span class="n">forcing_values</span><span class="p">:</span>
            <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">force_v</span><span class="p">)</span>
            <span class="n">points</span><span class="p">[</span><span class="n">force_v</span><span class="p">]</span> <span class="o">=</span> <span class="n">readback_channel</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">force_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">points</span><span class="p">)]</span>
        <span class="n">readback_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">force_values</span><span class="p">]</span>
        <span class="n">x_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">readback_values</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">force_values</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;force_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">force_values</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;readback_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">readback_values</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;gain&#39;</span><span class="p">],</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">x_arr</span><span class="p">,</span> <span class="n">force_values</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">results_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pickle</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">results_filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="k">def</span> <span class="nf">add_channel_calibrated_2point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">calibration_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;correct channel writes by previously determined 2-point gain/offset trim. Can pass in **calibrate() to get gain/offset measurements.</span>
<span class="sd">        offset and gain are specified in the direction of readback channel to forcing channel. ie forcing channel error.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">calibration_filename</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">gain</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">calibration_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">gain</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">offset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pickle</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">calibration_filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cal_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">gain</span> <span class="o">=</span> <span class="n">cal_dict</span><span class="p">[</span><span class="s">&#39;gain&#39;</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">cal_dict</span><span class="p">[</span><span class="s">&#39;offset&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Specify either calibration_filename or gain and offset arguments, but not both.&#39;</span><span class="p">)</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_correct_2point</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_calibrated_2point</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">raw_value</span><span class="p">:</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">_set_value</span><span class="p">((</span><span class="n">raw_value</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">gain</span><span class="p">))</span> <span class="c">#keep channels sync&#39;d in both directions</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_correct_2point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">gain</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="n">raw_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">+</span> <span class="n">offset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Correcting {} to {} to get {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">raw_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">raw_value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_calibrated_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">calibration_filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;correct channel writes by previously determined mapping (from calibrate()).</span>
<span class="sd">        Can pass in **calibrate() to get cal map, store results dict locally, or use pickle file.</span>
<span class="sd">        Requires scipy.interpolate.UnivariateSpline</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;force_values&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;readback_values&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">calibration_filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">force_values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;force_values&#39;</span><span class="p">]</span>
            <span class="n">readback_values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;readback_values&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;force_values&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;readback_values&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">calibration_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pickle</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">calibration_filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">cal_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">force_values</span> <span class="o">=</span> <span class="n">cal_dict</span><span class="p">[</span><span class="s">&#39;force_values&#39;</span><span class="p">]</span>
            <span class="n">readback_values</span> <span class="o">=</span> <span class="n">cal_dict</span><span class="p">[</span><span class="s">&#39;readback_values&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Specify either calibration_filename or **dictionary from calibrate(), but not both.&#39;</span><span class="p">)</span>
        <span class="n">spl_rev</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">force_values</span><span class="p">,</span> <span class="n">readback_values</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c">#change raw output to desired output for callback</span>
        <span class="n">readback_values_sort</span><span class="p">,</span> <span class="n">force_values_sort</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">readback_values</span><span class="p">,</span> <span class="n">force_values</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">tup</span><span class="p">:</span> <span class="n">tup</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c">#SORT by readback</span>
        <span class="n">spl</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">readback_values_sort</span><span class="p">,</span> <span class="n">force_values_sort</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c">#change desired output to raw output</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span><span class="n">write_function</span><span class="o">=</span> <span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_correct_spline</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">spl</span><span class="p">))</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_channel_calibrated_spline</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">add_write_callback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">raw_value</span><span class="p">:</span> <span class="n">new_channel</span><span class="o">.</span><span class="n">_set_value</span><span class="p">(</span><span class="n">spl_rev</span><span class="p">(</span><span class="n">raw_value</span><span class="p">)))</span> <span class="c">#keep channels sync&#39;d in both directions</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_correct_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">forcing_channel</span><span class="p">,</span> <span class="n">spl</span><span class="p">):</span>
        <span class="n">corrected_value</span> <span class="o">=</span> <span class="n">spl</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Correcting {} to {} to get {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">forcing_channel</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">corrected_value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">forcing_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">corrected_value</span><span class="p">)</span>
        
<span class="k">class</span> <span class="nc">smart_battery_emulator</span><span class="p">(</span><span class="n">instrument</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">voltage_channel_name</span><span class="p">,</span> <span class="n">current_channel_name</span><span class="p">,</span> <span class="n">voltage_interval</span><span class="p">,</span> <span class="n">current_interval</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Smart Battery emulator to kick out voltage and current requests to keep a smart-battery charger alive.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_name</span> <span class="o">=</span> <span class="s">&#39;SB_emulator&#39;</span>
        <span class="n">instrument</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&quot;Smart Battery Emulator&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">lab_utils</span><span class="o">.</span><span class="n">threaded_writer</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">voltage_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">connect_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">=</span> <span class="n">voltage_channel_name</span><span class="p">,</span> <span class="n">time_interval</span> <span class="o">=</span> <span class="n">voltage_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_thread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">connect_channel</span><span class="p">(</span><span class="n">channel_name</span> <span class="o">=</span> <span class="n">current_channel_name</span><span class="p">,</span> <span class="n">time_interval</span> <span class="o">=</span> <span class="n">current_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_voltage_interval</span> <span class="o">=</span> <span class="n">voltage_interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_current_interval</span> <span class="o">=</span> <span class="n">current_interval</span>
    <span class="k">def</span> <span class="nf">stop_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Kills all threaded channels, can&#39;t be restarted.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">stop_all</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">add_channel_voltage_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a channel that can change the update interval of the smart battery voltage&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">voltage_thread</span><span class="o">.</span><span class="n">set_time_interval</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_voltage_interval</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_voltage_interval</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add_channel_current_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;adds a channel that can change the update interval of the smart battery current&#39;&#39;&#39;</span>
        <span class="n">new_channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">(</span><span class="n">channel_name</span><span class="p">,</span> <span class="n">write_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_thread</span><span class="o">.</span><span class="n">set_time_interval</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">add_channel_current_interval</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="n">new_channel</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_current_interval</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_channel</span><span class="p">(</span><span class="n">new_channel</span><span class="p">)</span>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../PyICe.html">
              <img class="logo" src="../../_static/tssop.png" alt="Logo"/>
            </a></p>
<h3><a href="../../PyICe.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_instruments.html">PyICe.lab_instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_core.html">PyICe.lab_core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_utils.html">PyICe.lab_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.LTC_plot.html">PyICe.LTC_plot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_gui.html">PyICe.lab_gui</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.lab_interfaces.html">PyICe.lab_interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.twi_instrument.html">PyICe.twi_instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.twoWireInterface.html">PyICe.twoWireInterface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.spi_instrument.html">PyICe.spi_instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.spi_interface.html">PyICe.spi_interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.visa_wrappers.html">PyICe.visa_wrappers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../_autosummary/PyICe.xml_registers.html">PyICe.xml_registers</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../PyICe.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Linear Technology Corporation.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>